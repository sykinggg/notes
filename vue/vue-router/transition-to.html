<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.43">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>路径切换 | </title><meta name="description" content="君子藏器于身 待时而动 天下有道则见 无道则隐">
    <link rel="modulepreload" href="/notes/assets/app.a6d8e189.js"><link rel="modulepreload" href="/notes/assets/transition-to.html.27ec532b.js"><link rel="modulepreload" href="/notes/assets/transition-to.html.8863f272.js"><link rel="prefetch" href="/notes/assets/index.html.e5e32dff.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.53187fd3.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.21947b0b.js"><link rel="prefetch" href="/notes/assets/base.html.a2c64d88.js"><link rel="prefetch" href="/notes/assets/customCli.html.585d5031.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.4d252f2a.js"><link rel="prefetch" href="/notes/assets/adapter.html.7b40b76b.js"><link rel="prefetch" href="/notes/assets/amd.html.566d1d82.js"><link rel="prefetch" href="/notes/assets/builder.html.6a706a5d.js"><link rel="prefetch" href="/notes/assets/censorJquery.html.17a7b82b.js"><link rel="prefetch" href="/notes/assets/combination.html.db0c0488.js"><link rel="prefetch" href="/notes/assets/command.html.baceea9c.js"><link rel="prefetch" href="/notes/assets/commonJS.html.22302f58.js"><link rel="prefetch" href="/notes/assets/constructor.html.97b4c4d1.js"><link rel="prefetch" href="/notes/assets/decoration.html.d9c64ddb.js"><link rel="prefetch" href="/notes/assets/esHarmony.html.429f381e.js"><link rel="prefetch" href="/notes/assets/exposed.html.8df2c0bf.js"><link rel="prefetch" href="/notes/assets/exterior.html.cbec9227.js"><link rel="prefetch" href="/notes/assets/factory.html.6c42e1aa.js"><link rel="prefetch" href="/notes/assets/flyweight.html.3a76a406.js"><link rel="prefetch" href="/notes/assets/functionalProgramming.html.5b9cc46e.js"><link rel="prefetch" href="/notes/assets/intermediary.html.2c4ff01b.js"><link rel="prefetch" href="/notes/assets/iterator.html.dffa1e2e.js"><link rel="prefetch" href="/notes/assets/lazyInitial.html.c84e3779.js"><link rel="prefetch" href="/notes/assets/mixin.html.c671c1f8.js"><link rel="prefetch" href="/notes/assets/module.html.37300240.js"><link rel="prefetch" href="/notes/assets/mvc.html.4c3c67cb.js"><link rel="prefetch" href="/notes/assets/mvp.html.4b38bc24.js"><link rel="prefetch" href="/notes/assets/mvvm.html.4177c1cd.js"><link rel="prefetch" href="/notes/assets/observer.html.5253faba.js"><link rel="prefetch" href="/notes/assets/outward.html.680d632e.js"><link rel="prefetch" href="/notes/assets/overview.html.ab4d86d5.js"><link rel="prefetch" href="/notes/assets/prototype.html.a8ec3ff6.js"><link rel="prefetch" href="/notes/assets/proxy.html.5d2156e6.js"><link rel="prefetch" href="/notes/assets/singleton.html.ddb65c82.js"><link rel="prefetch" href="/notes/assets/axios.html.cab310c7.js"><link rel="prefetch" href="/notes/assets/createUnderscore.html.7b532e1c.js"><link rel="prefetch" href="/notes/assets/jquery.html.6799bbfb.js"><link rel="prefetch" href="/notes/assets/lodash.html.4e637e73.js"><link rel="prefetch" href="/notes/assets/sentry.html.339b798b.js"><link rel="prefetch" href="/notes/assets/underscore.html.0e40e320.js"><link rel="prefetch" href="/notes/assets/vuex.html.7eb4e3db.js"><link rel="prefetch" href="/notes/assets/customCli.html.47953fbc.js"><link rel="prefetch" href="/notes/assets/description.html.4f345395.js"><link rel="prefetch" href="/notes/assets/indx.html.47c895d7.js"><link rel="prefetch" href="/notes/assets/rebase.html.760a9f22.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.aa7c3d15.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.0ff2a956.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.b8d12045.js"><link rel="prefetch" href="/notes/assets/44Questions.html.027f5824.js"><link rel="prefetch" href="/notes/assets/asyncAwait.html.91994a9f.js"><link rel="prefetch" href="/notes/assets/babelCompile.html.e3111ffa.js"><link rel="prefetch" href="/notes/assets/base.html.0f2229f3.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.65b5b2b7.js"><link rel="prefetch" href="/notes/assets/baseWebpack.html.e073981e.js"><link rel="prefetch" href="/notes/assets/codeSeparation.html.f02b6fd3.js"><link rel="prefetch" href="/notes/assets/cycle.html.1376554d.js"><link rel="prefetch" href="/notes/assets/cycleOtherWay.html.a0248552.js"><link rel="prefetch" href="/notes/assets/executionMechanism.html.fd731b3c.js"><link rel="prefetch" href="/notes/assets/hybrid.html.79623b35.js"><link rel="prefetch" href="/notes/assets/jsHandwriting.html.21d702b1.js"><link rel="prefetch" href="/notes/assets/jsonStringify.html.94e2c6e2.js"><link rel="prefetch" href="/notes/assets/largeFileResumableUpload.html.a3e9f3b0.js"><link rel="prefetch" href="/notes/assets/performance.html.97817b69.js"><link rel="prefetch" href="/notes/assets/promise.html.d165dd6b.js"><link rel="prefetch" href="/notes/assets/promiseAll.html.b8b28c90.js"><link rel="prefetch" href="/notes/assets/spa.html.c2361f5e.js"><link rel="prefetch" href="/notes/assets/tsBaseInterview.html.49ff7b25.js"><link rel="prefetch" href="/notes/assets/useEs6.html.61f70826.js"><link rel="prefetch" href="/notes/assets/webAnimations.html.84cb12fa.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.b214a5a9.js"><link rel="prefetch" href="/notes/assets/webpackLoader.html.8f266e15.js"><link rel="prefetch" href="/notes/assets/webpackPublic.html.3f08805a.js"><link rel="prefetch" href="/notes/assets/weird.html.5f93ea11.js"><link rel="prefetch" href="/notes/assets/es10News.html.a6da9b89.js"><link rel="prefetch" href="/notes/assets/es6Interview1.html.1a4a01da.js"><link rel="prefetch" href="/notes/assets/es6Interview2.html.bd14b106.js"><link rel="prefetch" href="/notes/assets/es6Interview3.html.9c29fb02.js"><link rel="prefetch" href="/notes/assets/es6News.html.f832f091.js"><link rel="prefetch" href="/notes/assets/es7News.html.7b72511d.js"><link rel="prefetch" href="/notes/assets/es8News.html.dcc965c5.js"><link rel="prefetch" href="/notes/assets/es9News.html.e4817ff0.js"><link rel="prefetch" href="/notes/assets/base.html.ba26d34e.js"><link rel="prefetch" href="/notes/assets/nginxComprehensiveScene.html.9a7cb22f.js"><link rel="prefetch" href="/notes/assets/commonlyUsed.html.cedb361c.js"><link rel="prefetch" href="/notes/assets/inelegantHook.html.c6352676.js"><link rel="prefetch" href="/notes/assets/interview1.html.113c46a7.js"><link rel="prefetch" href="/notes/assets/interview2.html.52161d42.js"><link rel="prefetch" href="/notes/assets/interview3.html.a3de2bcd.js"><link rel="prefetch" href="/notes/assets/interview4.html.0c9e4aad.js"><link rel="prefetch" href="/notes/assets/base.html.1e5dcdbb.js"><link rel="prefetch" href="/notes/assets/introduction.html.4ecc771c.js"><link rel="prefetch" href="/notes/assets/base.html.5cf4607a.js"><link rel="prefetch" href="/notes/assets/summarize.html.380ae7bd.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.0525c9ef.js"><link rel="prefetch" href="/notes/assets/index.html.4d1221b0.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.40250cdb.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.52aa2360.js"><link rel="prefetch" href="/notes/assets/bigDataRender.html.7d72ffe3.js"><link rel="prefetch" href="/notes/assets/progress.html.59ec74e3.js"><link rel="prefetch" href="/notes/assets/quirksStandards.html.0e3ca1f8.js"><link rel="prefetch" href="/notes/assets/redrawReflow.html.f1043490.js"><link rel="prefetch" href="/notes/assets/storageSpace.html.dec7ccfc.js"><link rel="prefetch" href="/notes/assets/webComLink.html.6ee97897.js"><link rel="prefetch" href="/notes/assets/webUrl.html.e79ca591.js"><link rel="prefetch" href="/notes/assets/spanWidthHeight.html.97404399.js"><link rel="prefetch" href="/notes/assets/baseCss.html.9b82626d.js"><link rel="prefetch" href="/notes/assets/blockFormattingContext.html.218287b5.js"><link rel="prefetch" href="/notes/assets/containingBlock.html.10b6403f.js"><link rel="prefetch" href="/notes/assets/cssBeforeAfter.html.5072a1b5.js"><link rel="prefetch" href="/notes/assets/cssBoxModal.html.24ef947e.js"><link rel="prefetch" href="/notes/assets/cssCollapsing.html.3152bb99.js"><link rel="prefetch" href="/notes/assets/cssCompatible.html.1f585578.js"><link rel="prefetch" href="/notes/assets/cssFlexDemo.html.cde23cde.js"><link rel="prefetch" href="/notes/assets/cssFlexLayout.html.3e5d4487.js"><link rel="prefetch" href="/notes/assets/cssGridLayout.html.98329f89.js"><link rel="prefetch" href="/notes/assets/cssHack.html.3c721194.js"><link rel="prefetch" href="/notes/assets/cssInlineBlock.html.6b8bd7a4.js"><link rel="prefetch" href="/notes/assets/cssPriority.html.b15f2b6d.js"><link rel="prefetch" href="/notes/assets/cssPseudo.html.78763d64.js"><link rel="prefetch" href="/notes/assets/cssPseudoClass.html.b650c990.js"><link rel="prefetch" href="/notes/assets/cssSelector.html.3d67ef54.js"><link rel="prefetch" href="/notes/assets/cssTutorial.html.35c75777.js"><link rel="prefetch" href="/notes/assets/fieldInvalid.html.2f1813b7.js"><link rel="prefetch" href="/notes/assets/frame.html.dc5bf905.js"><link rel="prefetch" href="/notes/assets/knowledgePoints.html.ec12b979.js"><link rel="prefetch" href="/notes/assets/linkImport.html.f03be5d9.js"><link rel="prefetch" href="/notes/assets/stackingContext.html.64b28ca2.js"><link rel="prefetch" href="/notes/assets/tools.html.5d8943b8.js"><link rel="prefetch" href="/notes/assets/units.html.2dbb4d98.js"><link rel="prefetch" href="/notes/assets/transform.html.9948d2c9.js"><link rel="prefetch" href="/notes/assets/content.html.34fee20a.js"><link rel="prefetch" href="/notes/assets/plugins.html.65a204bb.js"><link rel="prefetch" href="/notes/assets/accesskey.html.8ebb8c73.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.41d48db1.js"><link rel="prefetch" href="/notes/assets/canvasSvg.html.a0e1946b.js"><link rel="prefetch" href="/notes/assets/deviceAPI.html.bcdbce3a.js"><link rel="prefetch" href="/notes/assets/globalAttr.html.e03c3886.js"><link rel="prefetch" href="/notes/assets/htmlDatalist.html.e5e807a4.js"><link rel="prefetch" href="/notes/assets/htmlElement.html.9d5fe839.js"><link rel="prefetch" href="/notes/assets/interview10.html.53161aff.js"><link rel="prefetch" href="/notes/assets/interview11.html.11b10083.js"><link rel="prefetch" href="/notes/assets/interview12.html.a71f0636.js"><link rel="prefetch" href="/notes/assets/interview13.html.b7c5fc96.js"><link rel="prefetch" href="/notes/assets/interview14.html.e41c1245.js"><link rel="prefetch" href="/notes/assets/interview15.html.a0a7f963.js"><link rel="prefetch" href="/notes/assets/interview16.html.6ce9ff60.js"><link rel="prefetch" href="/notes/assets/interview17.html.e97cb484.js"><link rel="prefetch" href="/notes/assets/interview18.html.48948d8d.js"><link rel="prefetch" href="/notes/assets/interview19.html.c828173f.js"><link rel="prefetch" href="/notes/assets/interview20.html.41185797.js"><link rel="prefetch" href="/notes/assets/interview21.html.99413275.js"><link rel="prefetch" href="/notes/assets/interview22.html.64342faa.js"><link rel="prefetch" href="/notes/assets/interview23.html.aee138f4.js"><link rel="prefetch" href="/notes/assets/interview24.html.3391e4c6.js"><link rel="prefetch" href="/notes/assets/interview25.html.7ebfe835.js"><link rel="prefetch" href="/notes/assets/interview26.html.14fe344c.js"><link rel="prefetch" href="/notes/assets/interview27.html.e21ec796.js"><link rel="prefetch" href="/notes/assets/interview28.html.c62820fb.js"><link rel="prefetch" href="/notes/assets/interview29.html.60c3f984.js"><link rel="prefetch" href="/notes/assets/interview30.html.7d32fce4.js"><link rel="prefetch" href="/notes/assets/interview31.html.a49224b7.js"><link rel="prefetch" href="/notes/assets/interview32.html.fa03f4e0.js"><link rel="prefetch" href="/notes/assets/interview33.html.fddd3c8d.js"><link rel="prefetch" href="/notes/assets/interview34.html.cff4a724.js"><link rel="prefetch" href="/notes/assets/interview35.html.3f15d85b.js"><link rel="prefetch" href="/notes/assets/interview36.html.497f5979.js"><link rel="prefetch" href="/notes/assets/interview37.html.16c76c2f.js"><link rel="prefetch" href="/notes/assets/interview38.html.25f00468.js"><link rel="prefetch" href="/notes/assets/interview39.html.ca20cec7.js"><link rel="prefetch" href="/notes/assets/interview40.html.a5d3bd6f.js"><link rel="prefetch" href="/notes/assets/interview41.html.f7a813b8.js"><link rel="prefetch" href="/notes/assets/interview42.html.2b486c1a.js"><link rel="prefetch" href="/notes/assets/interview43.html.d18323b1.js"><link rel="prefetch" href="/notes/assets/interview44.html.8e5017d9.js"><link rel="prefetch" href="/notes/assets/interview45.html.2d6cc982.js"><link rel="prefetch" href="/notes/assets/interview46.html.096655b2.js"><link rel="prefetch" href="/notes/assets/interview47.html.cb980cad.js"><link rel="prefetch" href="/notes/assets/interview48.html.c3d39795.js"><link rel="prefetch" href="/notes/assets/interview49.html.9ad94a2f.js"><link rel="prefetch" href="/notes/assets/interview5.html.95b58b57.js"><link rel="prefetch" href="/notes/assets/interview50.html.9ecec4f1.js"><link rel="prefetch" href="/notes/assets/interview51.html.c5569464.js"><link rel="prefetch" href="/notes/assets/interview52.html.5e31854b.js"><link rel="prefetch" href="/notes/assets/interview53.html.1add2fe6.js"><link rel="prefetch" href="/notes/assets/interview54.html.592e8dfc.js"><link rel="prefetch" href="/notes/assets/interview55.html.ca339486.js"><link rel="prefetch" href="/notes/assets/interview56.html.a61d790e.js"><link rel="prefetch" href="/notes/assets/interview57.html.47d24726.js"><link rel="prefetch" href="/notes/assets/interview58.html.e3e33c9a.js"><link rel="prefetch" href="/notes/assets/interview59.html.937c2e84.js"><link rel="prefetch" href="/notes/assets/interview6.html.596da4ea.js"><link rel="prefetch" href="/notes/assets/interview7.html.dce0dfeb.js"><link rel="prefetch" href="/notes/assets/interview8.html.ba7c26da.js"><link rel="prefetch" href="/notes/assets/interview9.html.9e115ec9.js"><link rel="prefetch" href="/notes/assets/linkImport.html.257bb3c7.js"><link rel="prefetch" href="/notes/assets/offlineStorage.html.0bea7837.js"><link rel="prefetch" href="/notes/assets/regular.html.fc794cdc.js"><link rel="prefetch" href="/notes/assets/shake.html.68e25748.js"><link rel="prefetch" href="/notes/assets/webWorker.html.d4fa9d39.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.3c908a85.js"><link rel="prefetch" href="/notes/assets/cors.html.50c4b8e7.js"><link rel="prefetch" href="/notes/assets/crossDomainCookie.html.2cac082a.js"><link rel="prefetch" href="/notes/assets/fetch.html.fd22db11.js"><link rel="prefetch" href="/notes/assets/nestAxios.html.3f45d909.js"><link rel="prefetch" href="/notes/assets/debounce.html.00f2d211.js"><link rel="prefetch" href="/notes/assets/lodashPrinciple.html.96190afe.js"><link rel="prefetch" href="/notes/assets/lodashThrottleDebounce.html.e89c59ea.js"><link rel="prefetch" href="/notes/assets/throttle.html.bbb71910.js"><link rel="prefetch" href="/notes/assets/throttleDebounceReact.html.be6c5a6e.js"><link rel="prefetch" href="/notes/assets/cloneIntroduction.html.eee3d490.js"><link rel="prefetch" href="/notes/assets/deepClone.html.bc3aefe1.js"><link rel="prefetch" href="/notes/assets/lodashDeepClone.html.76ca7181.js"><link rel="prefetch" href="/notes/assets/objectAssign.html.5574dfbd.js"><link rel="prefetch" href="/notes/assets/arraySourceCode.html.fe05d97d.js"><link rel="prefetch" href="/notes/assets/baseHigh.html.e427b6e5.js"><link rel="prefetch" href="/notes/assets/currying.html.70ab42c5.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.6fe1d4f0.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.afbac7e8.js"><link rel="prefetch" href="/notes/assets/iife.html.ab9cc7cd.js"><link rel="prefetch" href="/notes/assets/interview1.html.409349b1.js"><link rel="prefetch" href="/notes/assets/jsCompatible.html.e28d6729.js"><link rel="prefetch" href="/notes/assets/baseProyotype.html.c46f919f.js"><link rel="prefetch" href="/notes/assets/functionObjectResource.html.41d778f2.js"><link rel="prefetch" href="/notes/assets/prototypeInherit.html.68288c3f.js"><link rel="prefetch" href="/notes/assets/closureInterview.html.cd9acf2d.js"><link rel="prefetch" href="/notes/assets/scopeChain.html.0000e285.js"><link rel="prefetch" href="/notes/assets/understandingClosures.html.5633454f.js"><link rel="prefetch" href="/notes/assets/executionStack.html.37d49b45.js"><link rel="prefetch" href="/notes/assets/memoryLeak.html.755c85dd.js"><link rel="prefetch" href="/notes/assets/memoryMechanism.html.73d84217.js"><link rel="prefetch" href="/notes/assets/memorySpace.html.7d57990c.js"><link rel="prefetch" href="/notes/assets/precompiled.html.479e2fc5.js"><link rel="prefetch" href="/notes/assets/variableObject.html.5a40d87b.js"><link rel="prefetch" href="/notes/assets/arrowFunctionThis.html.7e189b05.js"><link rel="prefetch" href="/notes/assets/bindSimulation.html.e1d0d986.js"><link rel="prefetch" href="/notes/assets/callApply.html.1bbbb223.js"><link rel="prefetch" href="/notes/assets/newSimulation.html.d70b56ee.js"><link rel="prefetch" href="/notes/assets/thisBind.html.5ace5b71.js"><link rel="prefetch" href="/notes/assets/interview1.html.c296e653.js"><link rel="prefetch" href="/notes/assets/interview10.html.b45980ab.js"><link rel="prefetch" href="/notes/assets/interview11.html.40a6458a.js"><link rel="prefetch" href="/notes/assets/interview12.html.1cef9635.js"><link rel="prefetch" href="/notes/assets/interview13.html.66099216.js"><link rel="prefetch" href="/notes/assets/interview14.html.328cee73.js"><link rel="prefetch" href="/notes/assets/interview15.html.7b03b859.js"><link rel="prefetch" href="/notes/assets/interview16.html.e5ecfeff.js"><link rel="prefetch" href="/notes/assets/interview17.html.cc3d7d72.js"><link rel="prefetch" href="/notes/assets/interview18.html.dfd8e71e.js"><link rel="prefetch" href="/notes/assets/interview19.html.5b301493.js"><link rel="prefetch" href="/notes/assets/interview2.html.b2870393.js"><link rel="prefetch" href="/notes/assets/interview20.html.17243f17.js"><link rel="prefetch" href="/notes/assets/interview21.html.7550153f.js"><link rel="prefetch" href="/notes/assets/interview22.html.4b5d2d97.js"><link rel="prefetch" href="/notes/assets/interview23.html.df48f020.js"><link rel="prefetch" href="/notes/assets/interview24.html.54fa0570.js"><link rel="prefetch" href="/notes/assets/interview25.html.80efef28.js"><link rel="prefetch" href="/notes/assets/interview26.html.021989cc.js"><link rel="prefetch" href="/notes/assets/interview27.html.f35245fb.js"><link rel="prefetch" href="/notes/assets/interview28.html.eb36de7b.js"><link rel="prefetch" href="/notes/assets/interview29.html.7f7332fd.js"><link rel="prefetch" href="/notes/assets/interview3.html.c8a16fda.js"><link rel="prefetch" href="/notes/assets/interview30.html.125f22b5.js"><link rel="prefetch" href="/notes/assets/interview4.html.6ed6c2d6.js"><link rel="prefetch" href="/notes/assets/interview5.html.8d4e4e60.js"><link rel="prefetch" href="/notes/assets/interview6.html.6e850b94.js"><link rel="prefetch" href="/notes/assets/interview7.html.29b16799.js"><link rel="prefetch" href="/notes/assets/interview8.html.2a42b4b0.js"><link rel="prefetch" href="/notes/assets/interview9.html.c6d1c06f.js"><link rel="prefetch" href="/notes/assets/adjacentSiblingCombinator.html.2217f329.js"><link rel="prefetch" href="/notes/assets/attributeSelectors.html.f5e372dc.js"><link rel="prefetch" href="/notes/assets/charset.html.8e174f4c.js"><link rel="prefetch" href="/notes/assets/childCombinator.html.34098fec.js"><link rel="prefetch" href="/notes/assets/classSelectors.html.20b91899.js"><link rel="prefetch" href="/notes/assets/descendantCombinator.html.568ab75f.js"><link rel="prefetch" href="/notes/assets/generalSiblingCombinator.html.8d1271c3.js"><link rel="prefetch" href="/notes/assets/iDSelectors.html.1de7d5df.js"><link rel="prefetch" href="/notes/assets/pseudoClasses.html.3b91f392.js"><link rel="prefetch" href="/notes/assets/pseudoElements.html.c6cae51d.js"><link rel="prefetch" href="/notes/assets/selectorList.html.1f5aae11.js"><link rel="prefetch" href="/notes/assets/typeSelectors.html.99b4add0.js"><link rel="prefetch" href="/notes/assets/universalSelectors.html.ed40adba.js"><link rel="prefetch" href="/notes/assets/IterationProtocols.html.195444c3.js"><link rel="prefetch" href="/notes/assets/arrayFlat.html.66625492.js"><link rel="prefetch" href="/notes/assets/asyncHistory.html.158b0c55.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.0a0720b6.js"><link rel="prefetch" href="/notes/assets/fileReader.html.76387c51.js"><link rel="prefetch" href="/notes/assets/formData.html.abcffe23.js"><link rel="prefetch" href="/notes/assets/functionGenerator.html.7cea8daf.js"><link rel="prefetch" href="/notes/assets/generator.html.3c2b2c21.js"><link rel="prefetch" href="/notes/assets/intersectionObserver.html.c07467f1.js"><link rel="prefetch" href="/notes/assets/map.html.ba1e252c.js"><link rel="prefetch" href="/notes/assets/promise.html.7ca305f9.js"><link rel="prefetch" href="/notes/assets/set.html.16058582.js"><link rel="prefetch" href="/notes/assets/string.html.19384e82.js"><link rel="prefetch" href="/notes/assets/symbol.html.5f97c582.js"><link rel="prefetch" href="/notes/assets/xMLHttpRequest.html.f55fdc19.js"><link rel="prefetch" href="/notes/assets/spreadSyntax.html.7cf14250.js"><link rel="prefetch" href="/notes/assets/strictMode.html.f5a164c3.js"><link rel="prefetch" href="/notes/assets/cache.html.ba36d6fb.js"><link rel="prefetch" href="/notes/assets/drag1.html.9e652494.js"><link rel="prefetch" href="/notes/assets/oneLineCode.html.b0d45ea8.js"><link rel="prefetch" href="/notes/assets/oneLineCodeArray.html.85ce4d5a.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDOM.html.17250460.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDateTime.html.9776089a.js"><link rel="prefetch" href="/notes/assets/oneLineCodeFunction.html.5c4baa61.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMath.html.a24a953a.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMisc.html.425c9d74.js"><link rel="prefetch" href="/notes/assets/oneLineCodeNumber.html.ac840eea.js"><link rel="prefetch" href="/notes/assets/oneLineCodeObject.html.9e0f20ac.js"><link rel="prefetch" href="/notes/assets/oneLineCodeRandom.html.0ad03f59.js"><link rel="prefetch" href="/notes/assets/oneLineCodeString.html.6c2d2e48.js"><link rel="prefetch" href="/notes/assets/oneLineCodeValidator.html.b3228672.js"><link rel="prefetch" href="/notes/assets/typeScriptCache.html.7aa7f085.js"><link rel="prefetch" href="/notes/assets/reactBase.html.b28f1bf8.js"><link rel="prefetch" href="/notes/assets/reactTypescript.html.3b964c58.js"><link rel="prefetch" href="/notes/assets/vue2Base.html.544d19ba.js"><link rel="prefetch" href="/notes/assets/vue2Table.html.0ba44fb1.js"><link rel="prefetch" href="/notes/assets/vue2offsetTop.html.5402aec2.js"><link rel="prefetch" href="/notes/assets/componentWillXXX.html.4c864035.js"><link rel="prefetch" href="/notes/assets/disrupt.html.fc48b8af.js"><link rel="prefetch" href="/notes/assets/lane.html.63a5eecf.js"><link rel="prefetch" href="/notes/assets/prepare.html.35d7d595.js"><link rel="prefetch" href="/notes/assets/redux.html.2493be7e.js"><link rel="prefetch" href="/notes/assets/scheduler.html.23075f67.js"><link rel="prefetch" href="/notes/assets/multi.html.e92574d2.js"><link rel="prefetch" href="/notes/assets/one.html.9d952a16.js"><link rel="prefetch" href="/notes/assets/prepare.html.56067a86.js"><link rel="prefetch" href="/notes/assets/create.html.0bc3f090.js"><link rel="prefetch" href="/notes/assets/prepare.html.92ca1a1e.js"><link rel="prefetch" href="/notes/assets/structure.html.8de61853.js"><link rel="prefetch" href="/notes/assets/useeffect.html.df92a925.js"><link rel="prefetch" href="/notes/assets/usememo.html.437a6aed.js"><link rel="prefetch" href="/notes/assets/useref.html.a8c7940f.js"><link rel="prefetch" href="/notes/assets/usestate.html.8da9d799.js"><link rel="prefetch" href="/notes/assets/file.html.e88880d5.js"><link rel="prefetch" href="/notes/assets/idea.html.aa0f95e7.js"><link rel="prefetch" href="/notes/assets/jsx.html.b8e30671.js"><link rel="prefetch" href="/notes/assets/newConstructure.html.862be1d3.js"><link rel="prefetch" href="/notes/assets/oldConstructure.html.380c865e.js"><link rel="prefetch" href="/notes/assets/source.html.ca0fd7d2.js"><link rel="prefetch" href="/notes/assets/summary.html.ae62b44a.js"><link rel="prefetch" href="/notes/assets/basePrinciple.html.09481f7f.js"><link rel="prefetch" href="/notes/assets/componentApi.html.0f322ec6.js"><link rel="prefetch" href="/notes/assets/domApi.html.8d473b4b.js"><link rel="prefetch" href="/notes/assets/hoc.html.f5b2aa66.js"><link rel="prefetch" href="/notes/assets/hookApi.html.df6d2615.js"><link rel="prefetch" href="/notes/assets/hookCustom.html.502225f2.js"><link rel="prefetch" href="/notes/assets/hookPrinciple.html.26280e27.js"><link rel="prefetch" href="/notes/assets/hookUse.html.8eac1c83.js"><link rel="prefetch" href="/notes/assets/reactKeeplive.html.2f554af7.js"><link rel="prefetch" href="/notes/assets/reactRedux.html.134987ac.js"><link rel="prefetch" href="/notes/assets/reactRouter.html.e2a75ca7.js"><link rel="prefetch" href="/notes/assets/toolApi.html.ad44e65a.js"><link rel="prefetch" href="/notes/assets/beginWork.html.c87d0308.js"><link rel="prefetch" href="/notes/assets/completeWork.html.aa6cbf1f.js"><link rel="prefetch" href="/notes/assets/doubleBuffer.html.d52918e2.js"><link rel="prefetch" href="/notes/assets/fiber-mental.html.bef45234.js"><link rel="prefetch" href="/notes/assets/fiber.html.1483dbe2.js"><link rel="prefetch" href="/notes/assets/reconciler.html.b8f9298e.js"><link rel="prefetch" href="/notes/assets/beforeMutation.html.7be27320.js"><link rel="prefetch" href="/notes/assets/layout.html.a4dd1d18.js"><link rel="prefetch" href="/notes/assets/mutation.html.2dc9bc0e.js"><link rel="prefetch" href="/notes/assets/prepare.html.282f80ae.js"><link rel="prefetch" href="/notes/assets/mental.html.10eaf210.js"><link rel="prefetch" href="/notes/assets/prepare.html.2b9d575d.js"><link rel="prefetch" href="/notes/assets/priority.html.fb2ee431.js"><link rel="prefetch" href="/notes/assets/reactdom.html.2bd257c8.js"><link rel="prefetch" href="/notes/assets/setstate.html.b048a49a.js"><link rel="prefetch" href="/notes/assets/update.html.0f14ee3f.js"><link rel="prefetch" href="/notes/assets/bitfiled.html.0696bca0.js"><link rel="prefetch" href="/notes/assets/dfs.html.0222160b.js"><link rel="prefetch" href="/notes/assets/diff.html.c861486f.js"><link rel="prefetch" href="/notes/assets/heapsort.html.813ec255.js"><link rel="prefetch" href="/notes/assets/linkedlist.html.b9a05b39.js"><link rel="prefetch" href="/notes/assets/stack.html.4bac2f66.js"><link rel="prefetch" href="/notes/assets/bootstrap.html.f0a21832.js"><link rel="prefetch" href="/notes/assets/context.html.5213e4d4.js"><link rel="prefetch" href="/notes/assets/fibertree-commit.html.72ca1ab8.js"><link rel="prefetch" href="/notes/assets/fibertree-create.html.3ad2871c.js"><link rel="prefetch" href="/notes/assets/fibertree-prepare.html.f5a41814.js"><link rel="prefetch" href="/notes/assets/fibertree-update.html.4a485e0c.js"><link rel="prefetch" href="/notes/assets/hook-effect.html.8d2ea294.js"><link rel="prefetch" href="/notes/assets/hook-state.html.0d2b0908.js"><link rel="prefetch" href="/notes/assets/hook-summary.html.aee25904.js"><link rel="prefetch" href="/notes/assets/macro-structure.html.038bcbf6.js"><link rel="prefetch" href="/notes/assets/object-structure.html.27d191c3.js"><link rel="prefetch" href="/notes/assets/priority.html.c3068403.js"><link rel="prefetch" href="/notes/assets/reconciler-workflow.html.a6408e25.js"><link rel="prefetch" href="/notes/assets/scheduler.html.dbcbbbe7.js"><link rel="prefetch" href="/notes/assets/state-effects.html.35a57d3b.js"><link rel="prefetch" href="/notes/assets/synthetic-event.html.dbaad71f.js"><link rel="prefetch" href="/notes/assets/workloop.html.23542eb0.js"><link rel="prefetch" href="/notes/assets/ast.html.b6c6e7a5.js"><link rel="prefetch" href="/notes/assets/binder.html.3add67cf.js"><link rel="prefetch" href="/notes/assets/checker.html.aa7a4fe0.js"><link rel="prefetch" href="/notes/assets/emitter.html.8b18a104.js"><link rel="prefetch" href="/notes/assets/overview.html.9f765f7c.js"><link rel="prefetch" href="/notes/assets/parser.html.45809a8e.js"><link rel="prefetch" href="/notes/assets/program.html.2e8577af.js"><link rel="prefetch" href="/notes/assets/scanner.html.0e52cef3.js"><link rel="prefetch" href="/notes/assets/common.html.7ff50c22.js"><link rel="prefetch" href="/notes/assets/interpreting.html.640974b6.js"><link rel="prefetch" href="/notes/assets/class.html.56041a21.js"><link rel="prefetch" href="/notes/assets/commandline-behavior.html.b5e17ae7.js"><link rel="prefetch" href="/notes/assets/comments.html.724e56b5.js"><link rel="prefetch" href="/notes/assets/common-bug-not-bugs.html.bda56914.js"><link rel="prefetch" href="/notes/assets/common-feature-request.html.d91306a3.js"><link rel="prefetch" href="/notes/assets/decorators.html.0792f156.js"><link rel="prefetch" href="/notes/assets/enums.html.94806105.js"><link rel="prefetch" href="/notes/assets/function.html.9303f624.js"><link rel="prefetch" href="/notes/assets/generics.html.5a217485.js"><link rel="prefetch" href="/notes/assets/glossary-and-terms.html.fc013a53.js"><link rel="prefetch" href="/notes/assets/jsx-and-react.html.06db73ae.js"><link rel="prefetch" href="/notes/assets/modules.html.735fba1e.js"><link rel="prefetch" href="/notes/assets/thing-that-dont-work.html.5d6b281d.js"><link rel="prefetch" href="/notes/assets/tsconfig-behavior.html.8d1b5bf3.js"><link rel="prefetch" href="/notes/assets/type-guards.html.45e9be72.js"><link rel="prefetch" href="/notes/assets/type-system-behavior.html.1d2f38ef.js"><link rel="prefetch" href="/notes/assets/nonReactJSX.html.5803c838.js"><link rel="prefetch" href="/notes/assets/reactJSX.html.d2e905f6.js"><link rel="prefetch" href="/notes/assets/support.html.cacf88ab.js"><link rel="prefetch" href="/notes/assets/typescript-3.7.html.ddd77423.js"><link rel="prefetch" href="/notes/assets/typescript-3.8.html.4c809fb9.js"><link rel="prefetch" href="/notes/assets/typescript-3.9.html.402b0676.js"><link rel="prefetch" href="/notes/assets/compilationContext.html.e810fa11.js"><link rel="prefetch" href="/notes/assets/declarationspaces.html.13dbf655.js"><link rel="prefetch" href="/notes/assets/dynamicImportExpressions.html.84834f71.js"><link rel="prefetch" href="/notes/assets/inDepthTs.html.a1e38dfe.js"><link rel="prefetch" href="/notes/assets/modules.html.54c06f4d.js"><link rel="prefetch" href="/notes/assets/namespaces.html.a1e9515c.js"><link rel="prefetch" href="/notes/assets/unknownAny.html.2c6e3da6.js"><link rel="prefetch" href="/notes/assets/avoidExportDefault.html.53f85703.js"><link rel="prefetch" href="/notes/assets/barrel.html.139c236f.js"><link rel="prefetch" href="/notes/assets/bind.html.f5aaaac0.js"><link rel="prefetch" href="/notes/assets/buildToggles.html.d8da50e4.js"><link rel="prefetch" href="/notes/assets/classAreUseful.html.d7bae9a9.js"><link rel="prefetch" href="/notes/assets/covarianceAndContravariance.html.b2a695b4.js"><link rel="prefetch" href="/notes/assets/createArrays.html.58ea0a96.js"><link rel="prefetch" href="/notes/assets/curry.html.93930603.js"><link rel="prefetch" href="/notes/assets/functionParameters.html.54af2211.js"><link rel="prefetch" href="/notes/assets/infer.html.e6cad365.js"><link rel="prefetch" href="/notes/assets/lazyObjectLiteralInitialization.html.661ccf8e.js"><link rel="prefetch" href="/notes/assets/limitPropertySetters.html.00db3d15.js"><link rel="prefetch" href="/notes/assets/metadata.html.6ff861fa.js"><link rel="prefetch" href="/notes/assets/nominalTyping.html.a4afb87e.js"><link rel="prefetch" href="/notes/assets/outFileCaution.html.20331d2d.js"><link rel="prefetch" href="/notes/assets/singletonPatern.html.c56c87ed.js"><link rel="prefetch" href="/notes/assets/statefulFunctions.html.b4ae5019.js"><link rel="prefetch" href="/notes/assets/staticConstructors.html.ec876aca.js"><link rel="prefetch" href="/notes/assets/stringBasedEmuns.html.7ff11b83.js"><link rel="prefetch" href="/notes/assets/truthy.html.a795b032.js"><link rel="prefetch" href="/notes/assets/typeInstantiation.html.e5999eea.js"><link rel="prefetch" href="/notes/assets/typesafeEventEmitter.html.4d1eb40b.js"><link rel="prefetch" href="/notes/assets/ambient.html.8e1046ea.js"><link rel="prefetch" href="/notes/assets/callable.html.0e168556.js"><link rel="prefetch" href="/notes/assets/discrominatedUnion.html.7f609982.js"><link rel="prefetch" href="/notes/assets/enums.html.bfc061f9.js"><link rel="prefetch" href="/notes/assets/exceptionsHanding.html.1188b985.js"><link rel="prefetch" href="/notes/assets/freshness.html.9af6b82e.js"><link rel="prefetch" href="/notes/assets/functions.html.239836d8.js"><link rel="prefetch" href="/notes/assets/generices.html.35d8f045.js"><link rel="prefetch" href="/notes/assets/indexSignatures.html.1a156c52.js"><link rel="prefetch" href="/notes/assets/interfaces.html.c71c1347.js"><link rel="prefetch" href="/notes/assets/lib.html.b59fe319.js"><link rel="prefetch" href="/notes/assets/literals.html.f7609265.js"><link rel="prefetch" href="/notes/assets/migrating.html.2c9942f3.js"><link rel="prefetch" href="/notes/assets/mixins.html.a9d774b6.js"><link rel="prefetch" href="/notes/assets/movingTypes.html.af93c58f.js"><link rel="prefetch" href="/notes/assets/neverType.html.4bec8c63.js"><link rel="prefetch" href="/notes/assets/overview.html.80c1fbd6.js"><link rel="prefetch" href="/notes/assets/readonly.html.86bf5a91.js"><link rel="prefetch" href="/notes/assets/thisType.html.f8a9f193.js"><link rel="prefetch" href="/notes/assets/typeAssertion.html.2c4a1d87.js"><link rel="prefetch" href="/notes/assets/typeCompatibility.html.7ef3c043.js"><link rel="prefetch" href="/notes/assets/typeGuard.html.3cac3318.js"><link rel="prefetch" href="/notes/assets/typeInference.html.872467ea.js"><link rel="prefetch" href="/notes/assets/types.html.438fa5b6.js"><link rel="prefetch" href="/notes/assets/pluginDva.html.119c4ee2.js"><link rel="prefetch" href="/notes/assets/pluginQiankun.html.ede15d85.js"><link rel="prefetch" href="/notes/assets/codegen.html.9899ff8b.js"><link rel="prefetch" href="/notes/assets/entrance.html.8205d22a.js"><link rel="prefetch" href="/notes/assets/optimize.html.a869783a.js"><link rel="prefetch" href="/notes/assets/outline.html.8bf89a6b.js"><link rel="prefetch" href="/notes/assets/parse.html.e323e1a9.js"><link rel="prefetch" href="/notes/assets/async-component.html.98db9ff4.js"><link rel="prefetch" href="/notes/assets/component-register.html.ce753ce2.js"><link rel="prefetch" href="/notes/assets/create-component.html.26e9cc41.js"><link rel="prefetch" href="/notes/assets/lifecycle.html.c76ae353.js"><link rel="prefetch" href="/notes/assets/merge-option.html.7e75c4c6.js"><link rel="prefetch" href="/notes/assets/outline.html.45bde7ff.js"><link rel="prefetch" href="/notes/assets/patch.html.231ffc11.js"><link rel="prefetch" href="/notes/assets/_index.html.ff76bfab.js"><link rel="prefetch" href="/notes/assets/create-element.html.e38cc5d0.js"><link rel="prefetch" href="/notes/assets/mounted.html.ec726d78.js"><link rel="prefetch" href="/notes/assets/new-vue.html.9056c88a.js"><link rel="prefetch" href="/notes/assets/render.html.52fefdc0.js"><link rel="prefetch" href="/notes/assets/update.html.8bd73e1d.js"><link rel="prefetch" href="/notes/assets/virtual-dom.html.0deb8902.js"><link rel="prefetch" href="/notes/assets/event.html.0b4c3126.js"><link rel="prefetch" href="/notes/assets/keep-alive.html.84216677.js"><link rel="prefetch" href="/notes/assets/outline.html.317d0444.js"><link rel="prefetch" href="/notes/assets/slot.html.3d1dcec9.js"><link rel="prefetch" href="/notes/assets/tansition-group.html.aa34ec26.js"><link rel="prefetch" href="/notes/assets/tansition.html.da3b6662.js"><link rel="prefetch" href="/notes/assets/v-model.html.b3610d00.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.20347b3d.js"><link rel="prefetch" href="/notes/assets/baseInterviewSecond.html.6cc75e07.js"><link rel="prefetch" href="/notes/assets/componentCommunication.html.93f71ac3.js"><link rel="prefetch" href="/notes/assets/detailedResponsiveness.html.5fd773bd.js"><link rel="prefetch" href="/notes/assets/diff.html.3ac3df77.js"><link rel="prefetch" href="/notes/assets/eventBinding.html.46e9cb33.js"><link rel="prefetch" href="/notes/assets/eventMechanism.html.e884d85c.js"><link rel="prefetch" href="/notes/assets/key.html.50fbef1a.js"><link rel="prefetch" href="/notes/assets/knowledgeSystem.html.4f6a03b8.js"><link rel="prefetch" href="/notes/assets/slot.html.54d2dc08.js"><link rel="prefetch" href="/notes/assets/sourceCodeAsyncDomUpdateNextTick.html.25fccaed.js"><link rel="prefetch" href="/notes/assets/sourceCodeElementBroadcastDispatch.html.1d6bf64f.js"><link rel="prefetch" href="/notes/assets/sourceCodeKeepAlive.html.a868f2e9.js"><link rel="prefetch" href="/notes/assets/sourceCodeResponsiveness.html.f39d2c00.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateCompilation.html.aa6873a9.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateDom.html.73f7427d.js"><link rel="prefetch" href="/notes/assets/sourceCodeVuex.html.8a9e96e8.js"><link rel="prefetch" href="/notes/assets/templateCompilation.html.e6171674.js"><link rel="prefetch" href="/notes/assets/vNode.html.8181fb33.js"><link rel="prefetch" href="/notes/assets/vNodeDiff.html.d9d8664d.js"><link rel="prefetch" href="/notes/assets/build.html.5a109691.js"><link rel="prefetch" href="/notes/assets/directory.html.122f8239.js"><link rel="prefetch" href="/notes/assets/entrance.html.684da85c.js"><link rel="prefetch" href="/notes/assets/flow.html.07a9984c.js"><link rel="prefetch" href="/notes/assets/component-update.html.d045f043.js"><link rel="prefetch" href="/notes/assets/computed-watcher.html.3d2db117.js"><link rel="prefetch" href="/notes/assets/getters.html.aebd2ace.js"><link rel="prefetch" href="/notes/assets/next-tick.html.815d53ef.js"><link rel="prefetch" href="/notes/assets/outline.html.0956ca80.js"><link rel="prefetch" href="/notes/assets/props.html.4a012203.js"><link rel="prefetch" href="/notes/assets/questions.html.800c371c.js"><link rel="prefetch" href="/notes/assets/reactive-object.html.f647642d.js"><link rel="prefetch" href="/notes/assets/setters.html.01ba90ca.js"><link rel="prefetch" href="/notes/assets/summary.html.14dda540.js"><link rel="prefetch" href="/notes/assets/install.html.0146f736.js"><link rel="prefetch" href="/notes/assets/matcher.html.0a1f68c0.js"><link rel="prefetch" href="/notes/assets/outline.html.42f34faf.js"><link rel="prefetch" href="/notes/assets/router.html.d78ef736.js"><link rel="prefetch" href="/notes/assets/api.html.ca451d86.js"><link rel="prefetch" href="/notes/assets/idex.html.067bc1d1.js"><link rel="prefetch" href="/notes/assets/init.html.34c4b5ff.js"><link rel="prefetch" href="/notes/assets/plugin.html.b165e6ae.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.f55a54a7.js"><link rel="prefetch" href="/notes/assets/configuration.html.a25d1c11.js"><link rel="prefetch" href="/notes/assets/entryPoints.html.2dcd36f1.js"><link rel="prefetch" href="/notes/assets/loader.html.ab32c971.js"><link rel="prefetch" href="/notes/assets/output.html.abd08f4d.js"><link rel="prefetch" href="/notes/assets/plugin.html.12bfcb86.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.e5cd94da.js"><link rel="prefetch" href="/notes/assets/reactApi.html.b21a352b.js"><link rel="prefetch" href="/notes/assets/reactChildren.html.314a3e0f.js"><link rel="prefetch" href="/notes/assets/reactElement.html.c326afb7.js"><link rel="prefetch" href="/notes/assets/reactFiber.html.06a16ab8.js"><link rel="prefetch" href="/notes/assets/commitAllHostEffects.html.592dc2b1.js"><link rel="prefetch" href="/notes/assets/commitAllLifeCycles.html.8032bb9c.js"><link rel="prefetch" href="/notes/assets/commitBeforeMutationLifecycles.html.b240d9c2.js"><link rel="prefetch" href="/notes/assets/commitDeletion.html.969efebb.js"><link rel="prefetch" href="/notes/assets/commitPlacement.html.5fa08268.js"><link rel="prefetch" href="/notes/assets/commitRoot.html.b55f50d2.js"><link rel="prefetch" href="/notes/assets/commitWork.html.3ed03c6c.js"><link rel="prefetch" href="/notes/assets/invokeGuardedCallback.html.f89157c5.js"><link rel="prefetch" href="/notes/assets/expirationTime.html.19d99961.js"><link rel="prefetch" href="/notes/assets/reactDomRender.html.7281246e.js"><link rel="prefetch" href="/notes/assets/setStateForceUpdate.html.19346c99.js"><link rel="prefetch" href="/notes/assets/context.html.8abe1e6c.js"><link rel="prefetch" href="/notes/assets/evenInit.html.696f7e31.js"><link rel="prefetch" href="/notes/assets/eventBind.html.0efb2368.js"><link rel="prefetch" href="/notes/assets/eventCreateEventObject.html.10367552.js"><link rel="prefetch" href="/notes/assets/eventDispath.html.f49dfba1.js"><link rel="prefetch" href="/notes/assets/hydrate.html.1a3d6ad3.js"><link rel="prefetch" href="/notes/assets/ref.html.4580de8d.js"><link rel="prefetch" href="/notes/assets/suspense.html.38e3e989.js"><link rel="prefetch" href="/notes/assets/suspenseLazy.html.44128125.js"><link rel="prefetch" href="/notes/assets/suspenseWork.html.efeba255.js"><link rel="prefetch" href="/notes/assets/hooksCommon.html.783885f3.js"><link rel="prefetch" href="/notes/assets/hooksOther.html.61efdaa6.js"><link rel="prefetch" href="/notes/assets/start.html.b8c6acc2.js"><link rel="prefetch" href="/notes/assets/useEffect.html.a2659d58.js"><link rel="prefetch" href="/notes/assets/useState.html.b628aa01.js"><link rel="prefetch" href="/notes/assets/base.html.d70e39a8.js"><link rel="prefetch" href="/notes/assets/commpontDiff.html.85fea2d1.js"><link rel="prefetch" href="/notes/assets/componentUpdate.html.d3d70891.js"><link rel="prefetch" href="/notes/assets/renderProcess.html.07d222f3.js"><link rel="prefetch" href="/notes/assets/schedulingPrinciple.html.b0d0b281.js"><link rel="prefetch" href="/notes/assets/beginWork.html.7dd2d6ee.js"><link rel="prefetch" href="/notes/assets/globalVariable.html.aeb87cf3.js"><link rel="prefetch" href="/notes/assets/mountIndeterminateComponent.html.df01a636.js"><link rel="prefetch" href="/notes/assets/mountLazyCompont.html.d8d7476d.js"><link rel="prefetch" href="/notes/assets/performUnitOfWork.html.f059413c.js"><link rel="prefetch" href="/notes/assets/performWork.html.98ea55c4.js"><link rel="prefetch" href="/notes/assets/reactScheduler.html.60551e9d.js"><link rel="prefetch" href="/notes/assets/reconcileChildren.html.87f49cd1.js"><link rel="prefetch" href="/notes/assets/reconcileChildrenArray.html.d629cdfe.js"><link rel="prefetch" href="/notes/assets/reconcileSingleElement.html.754a842a.js"><link rel="prefetch" href="/notes/assets/renderRoot.html.a264f633.js"><link rel="prefetch" href="/notes/assets/scheduleWork.html.1f5fda5d.js"><link rel="prefetch" href="/notes/assets/throwException.html.f998d796.js"><link rel="prefetch" href="/notes/assets/updateClassComponent.html.0738b35d.js"><link rel="prefetch" href="/notes/assets/updateContextConsumer.html.07d0e40e.js"><link rel="prefetch" href="/notes/assets/updateContextProvider.html.f7bb0ee2.js"><link rel="prefetch" href="/notes/assets/updateForwardRef.html.b222eead.js"><link rel="prefetch" href="/notes/assets/updateFragment.html.91bff584.js"><link rel="prefetch" href="/notes/assets/updateFunctionalComponent.html.6547e5b1.js"><link rel="prefetch" href="/notes/assets/updateHostComponent.html.dce28500.js"><link rel="prefetch" href="/notes/assets/updateHostRoot.html.182d191b.js"><link rel="prefetch" href="/notes/assets/updateHostText.html.0bb779b6.js"><link rel="prefetch" href="/notes/assets/updateMode.html.68367dfb.js"><link rel="prefetch" href="/notes/assets/updatePortalComponent.html.9e7516cb.js"><link rel="prefetch" href="/notes/assets/updateProfiler.html.3953d623.js"><link rel="prefetch" href="/notes/assets/updateSuspenseComponent.html.362e2bd6.js"><link rel="prefetch" href="/notes/assets/interview1.html.b8176efe.js"><link rel="prefetch" href="/notes/assets/interview2.html.9b55c63b.js"><link rel="prefetch" href="/notes/assets/interview3.html.7a32737a.js"><link rel="prefetch" href="/notes/assets/interview51.html.e0f1f1a9.js"><link rel="prefetch" href="/notes/assets/interview52.html.80a1c513.js"><link rel="prefetch" href="/notes/assets/interview53.html.e78dc6a9.js"><link rel="prefetch" href="/notes/assets/interview54.html.deca415d.js"><link rel="prefetch" href="/notes/assets/interview55.html.fcf9381c.js"><link rel="prefetch" href="/notes/assets/interview56.html.8a71c67d.js"><link rel="prefetch" href="/notes/assets/interview57.html.99a46bb3.js"><link rel="prefetch" href="/notes/assets/interview1.html.1c1620b6.js"><link rel="prefetch" href="/notes/assets/interview10.html.de12a786.js"><link rel="prefetch" href="/notes/assets/interview11.html.e5f55a61.js"><link rel="prefetch" href="/notes/assets/interview12.html.1d481617.js"><link rel="prefetch" href="/notes/assets/interview13.html.8f2ec9c4.js"><link rel="prefetch" href="/notes/assets/interview14.html.6a97d43f.js"><link rel="prefetch" href="/notes/assets/interview15.html.ea06eddf.js"><link rel="prefetch" href="/notes/assets/interview16.html.739e3c51.js"><link rel="prefetch" href="/notes/assets/interview17.html.43b3bc2b.js"><link rel="prefetch" href="/notes/assets/interview18.html.d30d7b68.js"><link rel="prefetch" href="/notes/assets/interview19.html.9199cb94.js"><link rel="prefetch" href="/notes/assets/interview2.html.bdb636fb.js"><link rel="prefetch" href="/notes/assets/interview20.html.6937d525.js"><link rel="prefetch" href="/notes/assets/interview21.html.5d7264d1.js"><link rel="prefetch" href="/notes/assets/interview22.html.8704f59e.js"><link rel="prefetch" href="/notes/assets/interview23.html.63866971.js"><link rel="prefetch" href="/notes/assets/interview24.html.1ac65b32.js"><link rel="prefetch" href="/notes/assets/interview25.html.f93ef969.js"><link rel="prefetch" href="/notes/assets/interview26.html.7a1fbae8.js"><link rel="prefetch" href="/notes/assets/interview27.html.d771e053.js"><link rel="prefetch" href="/notes/assets/interview28.html.f4f84cfa.js"><link rel="prefetch" href="/notes/assets/interview29.html.90be3a41.js"><link rel="prefetch" href="/notes/assets/interview3.html.7fa3cac1.js"><link rel="prefetch" href="/notes/assets/interview30.html.d03a8e7c.js"><link rel="prefetch" href="/notes/assets/interview31.html.7ac8311e.js"><link rel="prefetch" href="/notes/assets/interview32.html.088d8d14.js"><link rel="prefetch" href="/notes/assets/interview33.html.4ca3d654.js"><link rel="prefetch" href="/notes/assets/interview34.html.c1bbfc25.js"><link rel="prefetch" href="/notes/assets/interview35.html.896279c7.js"><link rel="prefetch" href="/notes/assets/interview36.html.618f381d.js"><link rel="prefetch" href="/notes/assets/interview37.html.cc02df1c.js"><link rel="prefetch" href="/notes/assets/interview38.html.59985330.js"><link rel="prefetch" href="/notes/assets/interview39.html.3f4fe19e.js"><link rel="prefetch" href="/notes/assets/interview4.html.d61a3a7b.js"><link rel="prefetch" href="/notes/assets/interview40.html.2856af7d.js"><link rel="prefetch" href="/notes/assets/interview41.html.21164101.js"><link rel="prefetch" href="/notes/assets/interview42.html.61a9ccf9.js"><link rel="prefetch" href="/notes/assets/interview43.html.4466c286.js"><link rel="prefetch" href="/notes/assets/interview44.html.2dde0fc6.js"><link rel="prefetch" href="/notes/assets/interview45.html.8603f33b.js"><link rel="prefetch" href="/notes/assets/interview46.html.72132218.js"><link rel="prefetch" href="/notes/assets/interview47.html.bdc94146.js"><link rel="prefetch" href="/notes/assets/interview48.html.20775404.js"><link rel="prefetch" href="/notes/assets/interview49.html.774090d1.js"><link rel="prefetch" href="/notes/assets/interview5.html.a7e22b93.js"><link rel="prefetch" href="/notes/assets/interview50.html.4288eaed.js"><link rel="prefetch" href="/notes/assets/interview6.html.1359f807.js"><link rel="prefetch" href="/notes/assets/interview7.html.7b05d73e.js"><link rel="prefetch" href="/notes/assets/interview8.html.675124a5.js"><link rel="prefetch" href="/notes/assets/interview9.html.46502504.js"><link rel="prefetch" href="/notes/assets/404.html.93146c89.js"><link rel="prefetch" href="/notes/assets/index.html.fe731a68.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.b80ee296.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.a9a3805e.js"><link rel="prefetch" href="/notes/assets/base.html.e4c04700.js"><link rel="prefetch" href="/notes/assets/customCli.html.22eacdb5.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.fa31fc77.js"><link rel="prefetch" href="/notes/assets/adapter.html.5e05b8e7.js"><link rel="prefetch" href="/notes/assets/amd.html.27956217.js"><link rel="prefetch" href="/notes/assets/builder.html.5206e00b.js"><link rel="prefetch" href="/notes/assets/censorJquery.html.e06dc225.js"><link rel="prefetch" href="/notes/assets/combination.html.08ce9ee5.js"><link rel="prefetch" href="/notes/assets/command.html.185f49ae.js"><link rel="prefetch" href="/notes/assets/commonJS.html.6c1a2389.js"><link rel="prefetch" href="/notes/assets/constructor.html.fd284450.js"><link rel="prefetch" href="/notes/assets/decoration.html.0f31ab6c.js"><link rel="prefetch" href="/notes/assets/esHarmony.html.5573349a.js"><link rel="prefetch" href="/notes/assets/exposed.html.34886811.js"><link rel="prefetch" href="/notes/assets/exterior.html.a42e9054.js"><link rel="prefetch" href="/notes/assets/factory.html.bd3b9aec.js"><link rel="prefetch" href="/notes/assets/flyweight.html.a7f57e1b.js"><link rel="prefetch" href="/notes/assets/functionalProgramming.html.8da58976.js"><link rel="prefetch" href="/notes/assets/intermediary.html.baddc613.js"><link rel="prefetch" href="/notes/assets/iterator.html.611aadd5.js"><link rel="prefetch" href="/notes/assets/lazyInitial.html.2f5ddade.js"><link rel="prefetch" href="/notes/assets/mixin.html.1302ff92.js"><link rel="prefetch" href="/notes/assets/module.html.1661f5cb.js"><link rel="prefetch" href="/notes/assets/mvc.html.8c339742.js"><link rel="prefetch" href="/notes/assets/mvp.html.90a1dad9.js"><link rel="prefetch" href="/notes/assets/mvvm.html.b45202c5.js"><link rel="prefetch" href="/notes/assets/observer.html.bb602b90.js"><link rel="prefetch" href="/notes/assets/outward.html.a74b61b4.js"><link rel="prefetch" href="/notes/assets/overview.html.549c3c03.js"><link rel="prefetch" href="/notes/assets/prototype.html.e3be60dd.js"><link rel="prefetch" href="/notes/assets/proxy.html.a9898c30.js"><link rel="prefetch" href="/notes/assets/singleton.html.4716e1d1.js"><link rel="prefetch" href="/notes/assets/axios.html.b20c0ed0.js"><link rel="prefetch" href="/notes/assets/createUnderscore.html.73299f52.js"><link rel="prefetch" href="/notes/assets/jquery.html.4510f0d0.js"><link rel="prefetch" href="/notes/assets/lodash.html.369465ce.js"><link rel="prefetch" href="/notes/assets/sentry.html.67d8a163.js"><link rel="prefetch" href="/notes/assets/underscore.html.e2303bc7.js"><link rel="prefetch" href="/notes/assets/vuex.html.f3aba5e7.js"><link rel="prefetch" href="/notes/assets/customCli.html.eebbe6b7.js"><link rel="prefetch" href="/notes/assets/description.html.3cfdc5e4.js"><link rel="prefetch" href="/notes/assets/indx.html.90f769b9.js"><link rel="prefetch" href="/notes/assets/rebase.html.96f8396d.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.dc4c44a6.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.26e36bd3.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.e0716d44.js"><link rel="prefetch" href="/notes/assets/44Questions.html.7cae0b48.js"><link rel="prefetch" href="/notes/assets/asyncAwait.html.f2af51e6.js"><link rel="prefetch" href="/notes/assets/babelCompile.html.1d838ed2.js"><link rel="prefetch" href="/notes/assets/base.html.078e7f28.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.b2a4b821.js"><link rel="prefetch" href="/notes/assets/baseWebpack.html.c675f04f.js"><link rel="prefetch" href="/notes/assets/codeSeparation.html.aafe95d8.js"><link rel="prefetch" href="/notes/assets/cycle.html.c3c01f40.js"><link rel="prefetch" href="/notes/assets/cycleOtherWay.html.17e6e244.js"><link rel="prefetch" href="/notes/assets/executionMechanism.html.cfa68400.js"><link rel="prefetch" href="/notes/assets/hybrid.html.9f3dc407.js"><link rel="prefetch" href="/notes/assets/jsHandwriting.html.19ab43fc.js"><link rel="prefetch" href="/notes/assets/jsonStringify.html.289b4ef2.js"><link rel="prefetch" href="/notes/assets/largeFileResumableUpload.html.bbc23367.js"><link rel="prefetch" href="/notes/assets/performance.html.fec6f730.js"><link rel="prefetch" href="/notes/assets/promise.html.dd8c8f70.js"><link rel="prefetch" href="/notes/assets/promiseAll.html.d7714793.js"><link rel="prefetch" href="/notes/assets/spa.html.bd8d4784.js"><link rel="prefetch" href="/notes/assets/tsBaseInterview.html.d6422d1c.js"><link rel="prefetch" href="/notes/assets/useEs6.html.9bb90421.js"><link rel="prefetch" href="/notes/assets/webAnimations.html.a5941eee.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.04d365d9.js"><link rel="prefetch" href="/notes/assets/webpackLoader.html.b434f11d.js"><link rel="prefetch" href="/notes/assets/webpackPublic.html.aa0a09d4.js"><link rel="prefetch" href="/notes/assets/weird.html.caf6fe0e.js"><link rel="prefetch" href="/notes/assets/es10News.html.23d27d5e.js"><link rel="prefetch" href="/notes/assets/es6Interview1.html.87d5b679.js"><link rel="prefetch" href="/notes/assets/es6Interview2.html.f5811d4a.js"><link rel="prefetch" href="/notes/assets/es6Interview3.html.d3bd496e.js"><link rel="prefetch" href="/notes/assets/es6News.html.3d76ef55.js"><link rel="prefetch" href="/notes/assets/es7News.html.f97b5641.js"><link rel="prefetch" href="/notes/assets/es8News.html.dc256afa.js"><link rel="prefetch" href="/notes/assets/es9News.html.6716b1f6.js"><link rel="prefetch" href="/notes/assets/base.html.f4a8fe37.js"><link rel="prefetch" href="/notes/assets/nginxComprehensiveScene.html.c714bfd1.js"><link rel="prefetch" href="/notes/assets/commonlyUsed.html.49cf5cb8.js"><link rel="prefetch" href="/notes/assets/inelegantHook.html.d793c474.js"><link rel="prefetch" href="/notes/assets/interview1.html.6e421aed.js"><link rel="prefetch" href="/notes/assets/interview2.html.f0afdb4e.js"><link rel="prefetch" href="/notes/assets/interview3.html.2893bd75.js"><link rel="prefetch" href="/notes/assets/interview4.html.7e289098.js"><link rel="prefetch" href="/notes/assets/base.html.7156893e.js"><link rel="prefetch" href="/notes/assets/introduction.html.6270fa5e.js"><link rel="prefetch" href="/notes/assets/base.html.9d13ca5b.js"><link rel="prefetch" href="/notes/assets/summarize.html.8e1398f0.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.c096e4b5.js"><link rel="prefetch" href="/notes/assets/index.html.cf2e28ca.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.17b5600c.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.d0f6dd29.js"><link rel="prefetch" href="/notes/assets/bigDataRender.html.c628330f.js"><link rel="prefetch" href="/notes/assets/progress.html.c001cf9c.js"><link rel="prefetch" href="/notes/assets/quirksStandards.html.9adbb4b8.js"><link rel="prefetch" href="/notes/assets/redrawReflow.html.f7a98f83.js"><link rel="prefetch" href="/notes/assets/storageSpace.html.35523635.js"><link rel="prefetch" href="/notes/assets/webComLink.html.076002cf.js"><link rel="prefetch" href="/notes/assets/webUrl.html.601f3c7d.js"><link rel="prefetch" href="/notes/assets/spanWidthHeight.html.b9b6432a.js"><link rel="prefetch" href="/notes/assets/baseCss.html.fea9833a.js"><link rel="prefetch" href="/notes/assets/blockFormattingContext.html.151c6313.js"><link rel="prefetch" href="/notes/assets/containingBlock.html.7633c0fd.js"><link rel="prefetch" href="/notes/assets/cssBeforeAfter.html.fd25f54b.js"><link rel="prefetch" href="/notes/assets/cssBoxModal.html.3411b1ee.js"><link rel="prefetch" href="/notes/assets/cssCollapsing.html.a603e98d.js"><link rel="prefetch" href="/notes/assets/cssCompatible.html.71c6ab71.js"><link rel="prefetch" href="/notes/assets/cssFlexDemo.html.fb872d08.js"><link rel="prefetch" href="/notes/assets/cssFlexLayout.html.0f167e5a.js"><link rel="prefetch" href="/notes/assets/cssGridLayout.html.5e6995ca.js"><link rel="prefetch" href="/notes/assets/cssHack.html.8299616b.js"><link rel="prefetch" href="/notes/assets/cssInlineBlock.html.28d48106.js"><link rel="prefetch" href="/notes/assets/cssPriority.html.e1fa5c3b.js"><link rel="prefetch" href="/notes/assets/cssPseudo.html.e632fa4f.js"><link rel="prefetch" href="/notes/assets/cssPseudoClass.html.0e39a8bf.js"><link rel="prefetch" href="/notes/assets/cssSelector.html.0e8b529f.js"><link rel="prefetch" href="/notes/assets/cssTutorial.html.2ee1774e.js"><link rel="prefetch" href="/notes/assets/fieldInvalid.html.1987f413.js"><link rel="prefetch" href="/notes/assets/frame.html.d7a10730.js"><link rel="prefetch" href="/notes/assets/knowledgePoints.html.9fde1900.js"><link rel="prefetch" href="/notes/assets/linkImport.html.0058bbdc.js"><link rel="prefetch" href="/notes/assets/stackingContext.html.5fd68493.js"><link rel="prefetch" href="/notes/assets/tools.html.661c48fd.js"><link rel="prefetch" href="/notes/assets/units.html.dba69635.js"><link rel="prefetch" href="/notes/assets/transform.html.03a55987.js"><link rel="prefetch" href="/notes/assets/content.html.277b760c.js"><link rel="prefetch" href="/notes/assets/plugins.html.84a5fa14.js"><link rel="prefetch" href="/notes/assets/accesskey.html.1b38e9ee.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.e4eff942.js"><link rel="prefetch" href="/notes/assets/canvasSvg.html.ddf5f677.js"><link rel="prefetch" href="/notes/assets/deviceAPI.html.37478fb6.js"><link rel="prefetch" href="/notes/assets/globalAttr.html.1545856e.js"><link rel="prefetch" href="/notes/assets/htmlDatalist.html.a1dba46d.js"><link rel="prefetch" href="/notes/assets/htmlElement.html.182db0aa.js"><link rel="prefetch" href="/notes/assets/interview10.html.fac9e613.js"><link rel="prefetch" href="/notes/assets/interview11.html.c511875f.js"><link rel="prefetch" href="/notes/assets/interview12.html.28671749.js"><link rel="prefetch" href="/notes/assets/interview13.html.f59f567f.js"><link rel="prefetch" href="/notes/assets/interview14.html.51e169a0.js"><link rel="prefetch" href="/notes/assets/interview15.html.38363c2f.js"><link rel="prefetch" href="/notes/assets/interview16.html.e8b6f494.js"><link rel="prefetch" href="/notes/assets/interview17.html.c12370c6.js"><link rel="prefetch" href="/notes/assets/interview18.html.1f3f6e25.js"><link rel="prefetch" href="/notes/assets/interview19.html.edc5e10e.js"><link rel="prefetch" href="/notes/assets/interview20.html.f4c2a23f.js"><link rel="prefetch" href="/notes/assets/interview21.html.e4f45c3c.js"><link rel="prefetch" href="/notes/assets/interview22.html.6354e6f0.js"><link rel="prefetch" href="/notes/assets/interview23.html.f2160193.js"><link rel="prefetch" href="/notes/assets/interview24.html.1e460f90.js"><link rel="prefetch" href="/notes/assets/interview25.html.0c1b8a23.js"><link rel="prefetch" href="/notes/assets/interview26.html.9745abf2.js"><link rel="prefetch" href="/notes/assets/interview27.html.7a8ed7cb.js"><link rel="prefetch" href="/notes/assets/interview28.html.3512c30b.js"><link rel="prefetch" href="/notes/assets/interview29.html.28ad7109.js"><link rel="prefetch" href="/notes/assets/interview30.html.59d56caa.js"><link rel="prefetch" href="/notes/assets/interview31.html.7a6c8379.js"><link rel="prefetch" href="/notes/assets/interview32.html.c3373f18.js"><link rel="prefetch" href="/notes/assets/interview33.html.23891783.js"><link rel="prefetch" href="/notes/assets/interview34.html.b08cb30b.js"><link rel="prefetch" href="/notes/assets/interview35.html.f9fb69dd.js"><link rel="prefetch" href="/notes/assets/interview36.html.0502efa3.js"><link rel="prefetch" href="/notes/assets/interview37.html.42b9b7ad.js"><link rel="prefetch" href="/notes/assets/interview38.html.60a3ab7a.js"><link rel="prefetch" href="/notes/assets/interview39.html.7d2e86eb.js"><link rel="prefetch" href="/notes/assets/interview40.html.6b7cc7e5.js"><link rel="prefetch" href="/notes/assets/interview41.html.f257a45c.js"><link rel="prefetch" href="/notes/assets/interview42.html.725ffde0.js"><link rel="prefetch" href="/notes/assets/interview43.html.5683217a.js"><link rel="prefetch" href="/notes/assets/interview44.html.93bc0682.js"><link rel="prefetch" href="/notes/assets/interview45.html.aa7951f0.js"><link rel="prefetch" href="/notes/assets/interview46.html.4f3e5811.js"><link rel="prefetch" href="/notes/assets/interview47.html.b08054d7.js"><link rel="prefetch" href="/notes/assets/interview48.html.aacab9a0.js"><link rel="prefetch" href="/notes/assets/interview49.html.563bb340.js"><link rel="prefetch" href="/notes/assets/interview5.html.ee675d13.js"><link rel="prefetch" href="/notes/assets/interview50.html.f82e825b.js"><link rel="prefetch" href="/notes/assets/interview51.html.7a896921.js"><link rel="prefetch" href="/notes/assets/interview52.html.86863786.js"><link rel="prefetch" href="/notes/assets/interview53.html.0fac675b.js"><link rel="prefetch" href="/notes/assets/interview54.html.21f1899e.js"><link rel="prefetch" href="/notes/assets/interview55.html.8cccb27b.js"><link rel="prefetch" href="/notes/assets/interview56.html.18dd4f18.js"><link rel="prefetch" href="/notes/assets/interview57.html.641a7c2b.js"><link rel="prefetch" href="/notes/assets/interview58.html.bfb9be25.js"><link rel="prefetch" href="/notes/assets/interview59.html.935420b0.js"><link rel="prefetch" href="/notes/assets/interview6.html.95556a5a.js"><link rel="prefetch" href="/notes/assets/interview7.html.682b86e5.js"><link rel="prefetch" href="/notes/assets/interview8.html.70b3f32c.js"><link rel="prefetch" href="/notes/assets/interview9.html.a6c6e9c9.js"><link rel="prefetch" href="/notes/assets/linkImport.html.8da43728.js"><link rel="prefetch" href="/notes/assets/offlineStorage.html.80493980.js"><link rel="prefetch" href="/notes/assets/regular.html.d49a578e.js"><link rel="prefetch" href="/notes/assets/shake.html.4a6d66c8.js"><link rel="prefetch" href="/notes/assets/webWorker.html.0d429dc0.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.2ed7b391.js"><link rel="prefetch" href="/notes/assets/cors.html.8636ea22.js"><link rel="prefetch" href="/notes/assets/crossDomainCookie.html.cc9ca866.js"><link rel="prefetch" href="/notes/assets/fetch.html.d235a684.js"><link rel="prefetch" href="/notes/assets/nestAxios.html.bd31920d.js"><link rel="prefetch" href="/notes/assets/debounce.html.453b29d3.js"><link rel="prefetch" href="/notes/assets/lodashPrinciple.html.db70483e.js"><link rel="prefetch" href="/notes/assets/lodashThrottleDebounce.html.0a4cd605.js"><link rel="prefetch" href="/notes/assets/throttle.html.059f62fd.js"><link rel="prefetch" href="/notes/assets/throttleDebounceReact.html.77db3cb7.js"><link rel="prefetch" href="/notes/assets/cloneIntroduction.html.0cf63a53.js"><link rel="prefetch" href="/notes/assets/deepClone.html.52ba6ce5.js"><link rel="prefetch" href="/notes/assets/lodashDeepClone.html.eedbe06d.js"><link rel="prefetch" href="/notes/assets/objectAssign.html.703a76d6.js"><link rel="prefetch" href="/notes/assets/arraySourceCode.html.346491cd.js"><link rel="prefetch" href="/notes/assets/baseHigh.html.a944206e.js"><link rel="prefetch" href="/notes/assets/currying.html.47571bc7.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.68abb360.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.83da91fb.js"><link rel="prefetch" href="/notes/assets/iife.html.879fe622.js"><link rel="prefetch" href="/notes/assets/interview1.html.cf8bd4b8.js"><link rel="prefetch" href="/notes/assets/jsCompatible.html.3a822573.js"><link rel="prefetch" href="/notes/assets/baseProyotype.html.9e9c3053.js"><link rel="prefetch" href="/notes/assets/functionObjectResource.html.dc1034f1.js"><link rel="prefetch" href="/notes/assets/prototypeInherit.html.2fde0fa4.js"><link rel="prefetch" href="/notes/assets/closureInterview.html.3623e4fc.js"><link rel="prefetch" href="/notes/assets/scopeChain.html.b57eb1c9.js"><link rel="prefetch" href="/notes/assets/understandingClosures.html.c83a63d5.js"><link rel="prefetch" href="/notes/assets/executionStack.html.c44e7a14.js"><link rel="prefetch" href="/notes/assets/memoryLeak.html.7c29f03e.js"><link rel="prefetch" href="/notes/assets/memoryMechanism.html.2cdf5dd7.js"><link rel="prefetch" href="/notes/assets/memorySpace.html.a98e89ad.js"><link rel="prefetch" href="/notes/assets/precompiled.html.025f6256.js"><link rel="prefetch" href="/notes/assets/variableObject.html.23e45516.js"><link rel="prefetch" href="/notes/assets/arrowFunctionThis.html.5d0b43bc.js"><link rel="prefetch" href="/notes/assets/bindSimulation.html.5b8e1e35.js"><link rel="prefetch" href="/notes/assets/callApply.html.b24d1072.js"><link rel="prefetch" href="/notes/assets/newSimulation.html.d5973283.js"><link rel="prefetch" href="/notes/assets/thisBind.html.88704bd6.js"><link rel="prefetch" href="/notes/assets/interview1.html.5eaa6b7a.js"><link rel="prefetch" href="/notes/assets/interview10.html.d38a2d57.js"><link rel="prefetch" href="/notes/assets/interview11.html.afeb85d9.js"><link rel="prefetch" href="/notes/assets/interview12.html.5037e3d9.js"><link rel="prefetch" href="/notes/assets/interview13.html.2244cd0a.js"><link rel="prefetch" href="/notes/assets/interview14.html.f1347c7a.js"><link rel="prefetch" href="/notes/assets/interview15.html.9b9709dd.js"><link rel="prefetch" href="/notes/assets/interview16.html.c0a9fbab.js"><link rel="prefetch" href="/notes/assets/interview17.html.7d9ef19c.js"><link rel="prefetch" href="/notes/assets/interview18.html.276de16b.js"><link rel="prefetch" href="/notes/assets/interview19.html.6ffc1d19.js"><link rel="prefetch" href="/notes/assets/interview2.html.55c58a53.js"><link rel="prefetch" href="/notes/assets/interview20.html.cbdd7473.js"><link rel="prefetch" href="/notes/assets/interview21.html.5e502248.js"><link rel="prefetch" href="/notes/assets/interview22.html.7be10b23.js"><link rel="prefetch" href="/notes/assets/interview23.html.26e2334e.js"><link rel="prefetch" href="/notes/assets/interview24.html.fd999f85.js"><link rel="prefetch" href="/notes/assets/interview25.html.faa3b46c.js"><link rel="prefetch" href="/notes/assets/interview26.html.9e3d1049.js"><link rel="prefetch" href="/notes/assets/interview27.html.c1e7456f.js"><link rel="prefetch" href="/notes/assets/interview28.html.9cb63231.js"><link rel="prefetch" href="/notes/assets/interview29.html.a995d8e5.js"><link rel="prefetch" href="/notes/assets/interview3.html.a0185425.js"><link rel="prefetch" href="/notes/assets/interview30.html.1b305e02.js"><link rel="prefetch" href="/notes/assets/interview4.html.e5d7b33e.js"><link rel="prefetch" href="/notes/assets/interview5.html.247cddad.js"><link rel="prefetch" href="/notes/assets/interview6.html.f78cad96.js"><link rel="prefetch" href="/notes/assets/interview7.html.4f63e760.js"><link rel="prefetch" href="/notes/assets/interview8.html.b1a49c1b.js"><link rel="prefetch" href="/notes/assets/interview9.html.9dde09ac.js"><link rel="prefetch" href="/notes/assets/adjacentSiblingCombinator.html.6752de17.js"><link rel="prefetch" href="/notes/assets/attributeSelectors.html.521ac97e.js"><link rel="prefetch" href="/notes/assets/charset.html.27865e32.js"><link rel="prefetch" href="/notes/assets/childCombinator.html.a0682b50.js"><link rel="prefetch" href="/notes/assets/classSelectors.html.7d43332f.js"><link rel="prefetch" href="/notes/assets/descendantCombinator.html.c794930d.js"><link rel="prefetch" href="/notes/assets/generalSiblingCombinator.html.1bac4a9d.js"><link rel="prefetch" href="/notes/assets/iDSelectors.html.015bb9b9.js"><link rel="prefetch" href="/notes/assets/pseudoClasses.html.64d51fc5.js"><link rel="prefetch" href="/notes/assets/pseudoElements.html.fd0cc7ae.js"><link rel="prefetch" href="/notes/assets/selectorList.html.04299cc9.js"><link rel="prefetch" href="/notes/assets/typeSelectors.html.6010437b.js"><link rel="prefetch" href="/notes/assets/universalSelectors.html.dee5fec4.js"><link rel="prefetch" href="/notes/assets/IterationProtocols.html.ee5ae73a.js"><link rel="prefetch" href="/notes/assets/arrayFlat.html.ecebfa5d.js"><link rel="prefetch" href="/notes/assets/asyncHistory.html.55e03b25.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.9b76a0fd.js"><link rel="prefetch" href="/notes/assets/fileReader.html.3be8cb41.js"><link rel="prefetch" href="/notes/assets/formData.html.02a2b92a.js"><link rel="prefetch" href="/notes/assets/functionGenerator.html.d81f0f10.js"><link rel="prefetch" href="/notes/assets/generator.html.02728b85.js"><link rel="prefetch" href="/notes/assets/intersectionObserver.html.b41f01b1.js"><link rel="prefetch" href="/notes/assets/map.html.869fb789.js"><link rel="prefetch" href="/notes/assets/promise.html.550342c1.js"><link rel="prefetch" href="/notes/assets/set.html.e77846cd.js"><link rel="prefetch" href="/notes/assets/string.html.59b40ffc.js"><link rel="prefetch" href="/notes/assets/symbol.html.751962a8.js"><link rel="prefetch" href="/notes/assets/xMLHttpRequest.html.76b7f660.js"><link rel="prefetch" href="/notes/assets/spreadSyntax.html.807a83ef.js"><link rel="prefetch" href="/notes/assets/strictMode.html.34b27b79.js"><link rel="prefetch" href="/notes/assets/cache.html.c6522965.js"><link rel="prefetch" href="/notes/assets/drag1.html.5cc3b0da.js"><link rel="prefetch" href="/notes/assets/oneLineCode.html.2e606e52.js"><link rel="prefetch" href="/notes/assets/oneLineCodeArray.html.4048850e.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDOM.html.88806006.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDateTime.html.dea33f74.js"><link rel="prefetch" href="/notes/assets/oneLineCodeFunction.html.f0e6dfbc.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMath.html.8b8558ad.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMisc.html.81b2b576.js"><link rel="prefetch" href="/notes/assets/oneLineCodeNumber.html.9d9b981a.js"><link rel="prefetch" href="/notes/assets/oneLineCodeObject.html.ddd23dc0.js"><link rel="prefetch" href="/notes/assets/oneLineCodeRandom.html.1877ebd8.js"><link rel="prefetch" href="/notes/assets/oneLineCodeString.html.33b48cfc.js"><link rel="prefetch" href="/notes/assets/oneLineCodeValidator.html.bb23bc9a.js"><link rel="prefetch" href="/notes/assets/typeScriptCache.html.9d7cd13d.js"><link rel="prefetch" href="/notes/assets/reactBase.html.624b081e.js"><link rel="prefetch" href="/notes/assets/reactTypescript.html.b25b56c1.js"><link rel="prefetch" href="/notes/assets/vue2Base.html.78c1dccc.js"><link rel="prefetch" href="/notes/assets/vue2Table.html.6a5dd9e9.js"><link rel="prefetch" href="/notes/assets/vue2offsetTop.html.a980a13b.js"><link rel="prefetch" href="/notes/assets/componentWillXXX.html.46e64cd9.js"><link rel="prefetch" href="/notes/assets/disrupt.html.80ba103e.js"><link rel="prefetch" href="/notes/assets/lane.html.4e140709.js"><link rel="prefetch" href="/notes/assets/prepare.html.d05a2549.js"><link rel="prefetch" href="/notes/assets/redux.html.027fa9fb.js"><link rel="prefetch" href="/notes/assets/scheduler.html.708be132.js"><link rel="prefetch" href="/notes/assets/multi.html.bee1a26f.js"><link rel="prefetch" href="/notes/assets/one.html.8267d54d.js"><link rel="prefetch" href="/notes/assets/prepare.html.6bbe6381.js"><link rel="prefetch" href="/notes/assets/create.html.0e33ff65.js"><link rel="prefetch" href="/notes/assets/prepare.html.64188691.js"><link rel="prefetch" href="/notes/assets/structure.html.499da036.js"><link rel="prefetch" href="/notes/assets/useeffect.html.d331ff87.js"><link rel="prefetch" href="/notes/assets/usememo.html.f0a17878.js"><link rel="prefetch" href="/notes/assets/useref.html.6a788b1f.js"><link rel="prefetch" href="/notes/assets/usestate.html.c146198b.js"><link rel="prefetch" href="/notes/assets/file.html.1566405b.js"><link rel="prefetch" href="/notes/assets/idea.html.d348b032.js"><link rel="prefetch" href="/notes/assets/jsx.html.bfe0b6ee.js"><link rel="prefetch" href="/notes/assets/newConstructure.html.863ee8cc.js"><link rel="prefetch" href="/notes/assets/oldConstructure.html.4edb6b27.js"><link rel="prefetch" href="/notes/assets/source.html.2392f4c5.js"><link rel="prefetch" href="/notes/assets/summary.html.ff57867d.js"><link rel="prefetch" href="/notes/assets/basePrinciple.html.eba582cd.js"><link rel="prefetch" href="/notes/assets/componentApi.html.87fb9c52.js"><link rel="prefetch" href="/notes/assets/domApi.html.ed0705f7.js"><link rel="prefetch" href="/notes/assets/hoc.html.769ebb6d.js"><link rel="prefetch" href="/notes/assets/hookApi.html.83072269.js"><link rel="prefetch" href="/notes/assets/hookCustom.html.9b805ed8.js"><link rel="prefetch" href="/notes/assets/hookPrinciple.html.715c94ed.js"><link rel="prefetch" href="/notes/assets/hookUse.html.65779c25.js"><link rel="prefetch" href="/notes/assets/reactKeeplive.html.eba4d295.js"><link rel="prefetch" href="/notes/assets/reactRedux.html.b905a858.js"><link rel="prefetch" href="/notes/assets/reactRouter.html.b4038950.js"><link rel="prefetch" href="/notes/assets/toolApi.html.9993b95d.js"><link rel="prefetch" href="/notes/assets/beginWork.html.48be20a6.js"><link rel="prefetch" href="/notes/assets/completeWork.html.326c7689.js"><link rel="prefetch" href="/notes/assets/doubleBuffer.html.099882d2.js"><link rel="prefetch" href="/notes/assets/fiber-mental.html.ec68a17a.js"><link rel="prefetch" href="/notes/assets/fiber.html.7bd1ad17.js"><link rel="prefetch" href="/notes/assets/reconciler.html.a9f754b9.js"><link rel="prefetch" href="/notes/assets/beforeMutation.html.78330410.js"><link rel="prefetch" href="/notes/assets/layout.html.920feb57.js"><link rel="prefetch" href="/notes/assets/mutation.html.cbbfab65.js"><link rel="prefetch" href="/notes/assets/prepare.html.4c9c9cee.js"><link rel="prefetch" href="/notes/assets/mental.html.acc27a56.js"><link rel="prefetch" href="/notes/assets/prepare.html.5ab8d805.js"><link rel="prefetch" href="/notes/assets/priority.html.faf96498.js"><link rel="prefetch" href="/notes/assets/reactdom.html.aa87707b.js"><link rel="prefetch" href="/notes/assets/setstate.html.17936fb0.js"><link rel="prefetch" href="/notes/assets/update.html.ee65b408.js"><link rel="prefetch" href="/notes/assets/bitfiled.html.341ae1c9.js"><link rel="prefetch" href="/notes/assets/dfs.html.cdad358f.js"><link rel="prefetch" href="/notes/assets/diff.html.dd373fe7.js"><link rel="prefetch" href="/notes/assets/heapsort.html.95b7507a.js"><link rel="prefetch" href="/notes/assets/linkedlist.html.fcd5e258.js"><link rel="prefetch" href="/notes/assets/stack.html.ed9c5f4c.js"><link rel="prefetch" href="/notes/assets/bootstrap.html.469f6050.js"><link rel="prefetch" href="/notes/assets/context.html.fc072afb.js"><link rel="prefetch" href="/notes/assets/fibertree-commit.html.e7a14211.js"><link rel="prefetch" href="/notes/assets/fibertree-create.html.4100460c.js"><link rel="prefetch" href="/notes/assets/fibertree-prepare.html.b44bcc96.js"><link rel="prefetch" href="/notes/assets/fibertree-update.html.83b19f13.js"><link rel="prefetch" href="/notes/assets/hook-effect.html.7daeffa9.js"><link rel="prefetch" href="/notes/assets/hook-state.html.88056ea5.js"><link rel="prefetch" href="/notes/assets/hook-summary.html.0eb9c43d.js"><link rel="prefetch" href="/notes/assets/macro-structure.html.e599c5d1.js"><link rel="prefetch" href="/notes/assets/object-structure.html.1ee943b8.js"><link rel="prefetch" href="/notes/assets/priority.html.cdee8eb4.js"><link rel="prefetch" href="/notes/assets/reconciler-workflow.html.d4121555.js"><link rel="prefetch" href="/notes/assets/scheduler.html.fc484dc1.js"><link rel="prefetch" href="/notes/assets/state-effects.html.e1a2824b.js"><link rel="prefetch" href="/notes/assets/synthetic-event.html.cb72042f.js"><link rel="prefetch" href="/notes/assets/workloop.html.2130df22.js"><link rel="prefetch" href="/notes/assets/ast.html.b400a256.js"><link rel="prefetch" href="/notes/assets/binder.html.03e242a3.js"><link rel="prefetch" href="/notes/assets/checker.html.af0c8d66.js"><link rel="prefetch" href="/notes/assets/emitter.html.60750975.js"><link rel="prefetch" href="/notes/assets/overview.html.744f86fe.js"><link rel="prefetch" href="/notes/assets/parser.html.eecb5d49.js"><link rel="prefetch" href="/notes/assets/program.html.d41b0b19.js"><link rel="prefetch" href="/notes/assets/scanner.html.3f807fb2.js"><link rel="prefetch" href="/notes/assets/common.html.371c51c8.js"><link rel="prefetch" href="/notes/assets/interpreting.html.1a87553f.js"><link rel="prefetch" href="/notes/assets/class.html.3005ef11.js"><link rel="prefetch" href="/notes/assets/commandline-behavior.html.4a278b6a.js"><link rel="prefetch" href="/notes/assets/comments.html.a687597c.js"><link rel="prefetch" href="/notes/assets/common-bug-not-bugs.html.1f6f9373.js"><link rel="prefetch" href="/notes/assets/common-feature-request.html.0932dc0b.js"><link rel="prefetch" href="/notes/assets/decorators.html.d8ea07c8.js"><link rel="prefetch" href="/notes/assets/enums.html.528b2c83.js"><link rel="prefetch" href="/notes/assets/function.html.61eebf3d.js"><link rel="prefetch" href="/notes/assets/generics.html.f37bbb2f.js"><link rel="prefetch" href="/notes/assets/glossary-and-terms.html.51c2c8b3.js"><link rel="prefetch" href="/notes/assets/jsx-and-react.html.e7589a6b.js"><link rel="prefetch" href="/notes/assets/modules.html.c8a2f74b.js"><link rel="prefetch" href="/notes/assets/thing-that-dont-work.html.d8d152c7.js"><link rel="prefetch" href="/notes/assets/tsconfig-behavior.html.64b8ebbd.js"><link rel="prefetch" href="/notes/assets/type-guards.html.10ed4360.js"><link rel="prefetch" href="/notes/assets/type-system-behavior.html.e75f83e0.js"><link rel="prefetch" href="/notes/assets/nonReactJSX.html.2f79853f.js"><link rel="prefetch" href="/notes/assets/reactJSX.html.58a73adf.js"><link rel="prefetch" href="/notes/assets/support.html.ff7e625e.js"><link rel="prefetch" href="/notes/assets/typescript-3.7.html.ea404e48.js"><link rel="prefetch" href="/notes/assets/typescript-3.8.html.a9599a8f.js"><link rel="prefetch" href="/notes/assets/typescript-3.9.html.4e54a9a9.js"><link rel="prefetch" href="/notes/assets/compilationContext.html.ccf51f0e.js"><link rel="prefetch" href="/notes/assets/declarationspaces.html.57154145.js"><link rel="prefetch" href="/notes/assets/dynamicImportExpressions.html.9cb6f2ec.js"><link rel="prefetch" href="/notes/assets/inDepthTs.html.3ed991b1.js"><link rel="prefetch" href="/notes/assets/modules.html.9349b344.js"><link rel="prefetch" href="/notes/assets/namespaces.html.2c417047.js"><link rel="prefetch" href="/notes/assets/unknownAny.html.368ae4db.js"><link rel="prefetch" href="/notes/assets/avoidExportDefault.html.211c6d7a.js"><link rel="prefetch" href="/notes/assets/barrel.html.3e49ad2e.js"><link rel="prefetch" href="/notes/assets/bind.html.884a0f96.js"><link rel="prefetch" href="/notes/assets/buildToggles.html.9249ab95.js"><link rel="prefetch" href="/notes/assets/classAreUseful.html.09e32082.js"><link rel="prefetch" href="/notes/assets/covarianceAndContravariance.html.b4a2bc3d.js"><link rel="prefetch" href="/notes/assets/createArrays.html.3fe4bfd7.js"><link rel="prefetch" href="/notes/assets/curry.html.bb078cb8.js"><link rel="prefetch" href="/notes/assets/functionParameters.html.86e08278.js"><link rel="prefetch" href="/notes/assets/infer.html.8fc8b8d7.js"><link rel="prefetch" href="/notes/assets/lazyObjectLiteralInitialization.html.deef35e2.js"><link rel="prefetch" href="/notes/assets/limitPropertySetters.html.8d4b11c4.js"><link rel="prefetch" href="/notes/assets/metadata.html.4986b16a.js"><link rel="prefetch" href="/notes/assets/nominalTyping.html.b2da4104.js"><link rel="prefetch" href="/notes/assets/outFileCaution.html.3e44b52b.js"><link rel="prefetch" href="/notes/assets/singletonPatern.html.1b83f5dd.js"><link rel="prefetch" href="/notes/assets/statefulFunctions.html.b5c489f7.js"><link rel="prefetch" href="/notes/assets/staticConstructors.html.47d6c76b.js"><link rel="prefetch" href="/notes/assets/stringBasedEmuns.html.f84babf2.js"><link rel="prefetch" href="/notes/assets/truthy.html.f3fa251a.js"><link rel="prefetch" href="/notes/assets/typeInstantiation.html.5789d056.js"><link rel="prefetch" href="/notes/assets/typesafeEventEmitter.html.598e3cba.js"><link rel="prefetch" href="/notes/assets/ambient.html.8b2a1a18.js"><link rel="prefetch" href="/notes/assets/callable.html.6bdddb9e.js"><link rel="prefetch" href="/notes/assets/discrominatedUnion.html.4ce620c5.js"><link rel="prefetch" href="/notes/assets/enums.html.f633a2a4.js"><link rel="prefetch" href="/notes/assets/exceptionsHanding.html.d9ce1a99.js"><link rel="prefetch" href="/notes/assets/freshness.html.efa5ccab.js"><link rel="prefetch" href="/notes/assets/functions.html.871418f2.js"><link rel="prefetch" href="/notes/assets/generices.html.b06a67ff.js"><link rel="prefetch" href="/notes/assets/indexSignatures.html.373d3332.js"><link rel="prefetch" href="/notes/assets/interfaces.html.60e289d6.js"><link rel="prefetch" href="/notes/assets/lib.html.8a7bfa15.js"><link rel="prefetch" href="/notes/assets/literals.html.7490b426.js"><link rel="prefetch" href="/notes/assets/migrating.html.8a864bbf.js"><link rel="prefetch" href="/notes/assets/mixins.html.46d66d87.js"><link rel="prefetch" href="/notes/assets/movingTypes.html.dc928b15.js"><link rel="prefetch" href="/notes/assets/neverType.html.7f7571b1.js"><link rel="prefetch" href="/notes/assets/overview.html.0a339e08.js"><link rel="prefetch" href="/notes/assets/readonly.html.a7f3322a.js"><link rel="prefetch" href="/notes/assets/thisType.html.a93e875e.js"><link rel="prefetch" href="/notes/assets/typeAssertion.html.4bab3146.js"><link rel="prefetch" href="/notes/assets/typeCompatibility.html.577683e8.js"><link rel="prefetch" href="/notes/assets/typeGuard.html.4b47469d.js"><link rel="prefetch" href="/notes/assets/typeInference.html.f9f49371.js"><link rel="prefetch" href="/notes/assets/types.html.d28467f7.js"><link rel="prefetch" href="/notes/assets/pluginDva.html.124b82dc.js"><link rel="prefetch" href="/notes/assets/pluginQiankun.html.71fa386d.js"><link rel="prefetch" href="/notes/assets/codegen.html.9206928a.js"><link rel="prefetch" href="/notes/assets/entrance.html.87f26a1c.js"><link rel="prefetch" href="/notes/assets/optimize.html.f6a400f3.js"><link rel="prefetch" href="/notes/assets/outline.html.4518262e.js"><link rel="prefetch" href="/notes/assets/parse.html.faa15069.js"><link rel="prefetch" href="/notes/assets/async-component.html.ceb20d35.js"><link rel="prefetch" href="/notes/assets/component-register.html.e8e00e3e.js"><link rel="prefetch" href="/notes/assets/create-component.html.48027a69.js"><link rel="prefetch" href="/notes/assets/lifecycle.html.48ac433f.js"><link rel="prefetch" href="/notes/assets/merge-option.html.b8007d63.js"><link rel="prefetch" href="/notes/assets/outline.html.45842f27.js"><link rel="prefetch" href="/notes/assets/patch.html.7bb30a9e.js"><link rel="prefetch" href="/notes/assets/_index.html.1f6ea5c3.js"><link rel="prefetch" href="/notes/assets/create-element.html.a152c748.js"><link rel="prefetch" href="/notes/assets/mounted.html.64becaec.js"><link rel="prefetch" href="/notes/assets/new-vue.html.a57ae88b.js"><link rel="prefetch" href="/notes/assets/render.html.7fddf8ac.js"><link rel="prefetch" href="/notes/assets/update.html.03315720.js"><link rel="prefetch" href="/notes/assets/virtual-dom.html.b04d33df.js"><link rel="prefetch" href="/notes/assets/event.html.28b67869.js"><link rel="prefetch" href="/notes/assets/keep-alive.html.7cdcedf8.js"><link rel="prefetch" href="/notes/assets/outline.html.d50fcc7b.js"><link rel="prefetch" href="/notes/assets/slot.html.a5b32e85.js"><link rel="prefetch" href="/notes/assets/tansition-group.html.07c59cdb.js"><link rel="prefetch" href="/notes/assets/tansition.html.dcf06e2e.js"><link rel="prefetch" href="/notes/assets/v-model.html.88138a43.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.333348e1.js"><link rel="prefetch" href="/notes/assets/baseInterviewSecond.html.e32b5f96.js"><link rel="prefetch" href="/notes/assets/componentCommunication.html.22ef8606.js"><link rel="prefetch" href="/notes/assets/detailedResponsiveness.html.4d10183f.js"><link rel="prefetch" href="/notes/assets/diff.html.15c056b6.js"><link rel="prefetch" href="/notes/assets/eventBinding.html.2f5b7fc9.js"><link rel="prefetch" href="/notes/assets/eventMechanism.html.33d5ea3a.js"><link rel="prefetch" href="/notes/assets/key.html.739c3c67.js"><link rel="prefetch" href="/notes/assets/knowledgeSystem.html.13d45b9f.js"><link rel="prefetch" href="/notes/assets/slot.html.160195f4.js"><link rel="prefetch" href="/notes/assets/sourceCodeAsyncDomUpdateNextTick.html.c472008b.js"><link rel="prefetch" href="/notes/assets/sourceCodeElementBroadcastDispatch.html.cd147411.js"><link rel="prefetch" href="/notes/assets/sourceCodeKeepAlive.html.d4683109.js"><link rel="prefetch" href="/notes/assets/sourceCodeResponsiveness.html.dd3c8d7c.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateCompilation.html.06067411.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateDom.html.96f21c0f.js"><link rel="prefetch" href="/notes/assets/sourceCodeVuex.html.452f57ce.js"><link rel="prefetch" href="/notes/assets/templateCompilation.html.49d22423.js"><link rel="prefetch" href="/notes/assets/vNode.html.642a75dc.js"><link rel="prefetch" href="/notes/assets/vNodeDiff.html.37dea167.js"><link rel="prefetch" href="/notes/assets/build.html.f1d8e283.js"><link rel="prefetch" href="/notes/assets/directory.html.bdc23a19.js"><link rel="prefetch" href="/notes/assets/entrance.html.c226e526.js"><link rel="prefetch" href="/notes/assets/flow.html.6a5090bb.js"><link rel="prefetch" href="/notes/assets/component-update.html.82b6205c.js"><link rel="prefetch" href="/notes/assets/computed-watcher.html.26dd2306.js"><link rel="prefetch" href="/notes/assets/getters.html.9b5bf449.js"><link rel="prefetch" href="/notes/assets/next-tick.html.832b2544.js"><link rel="prefetch" href="/notes/assets/outline.html.247750bd.js"><link rel="prefetch" href="/notes/assets/props.html.0d0b6bab.js"><link rel="prefetch" href="/notes/assets/questions.html.4913a974.js"><link rel="prefetch" href="/notes/assets/reactive-object.html.902e4005.js"><link rel="prefetch" href="/notes/assets/setters.html.f95414b6.js"><link rel="prefetch" href="/notes/assets/summary.html.3402b560.js"><link rel="prefetch" href="/notes/assets/install.html.fe0eb0ac.js"><link rel="prefetch" href="/notes/assets/matcher.html.beef4e5e.js"><link rel="prefetch" href="/notes/assets/outline.html.0092bd1e.js"><link rel="prefetch" href="/notes/assets/router.html.40cacf03.js"><link rel="prefetch" href="/notes/assets/api.html.781f9919.js"><link rel="prefetch" href="/notes/assets/idex.html.fd8a2725.js"><link rel="prefetch" href="/notes/assets/init.html.b4723dfb.js"><link rel="prefetch" href="/notes/assets/plugin.html.f10b5499.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.975b47dd.js"><link rel="prefetch" href="/notes/assets/configuration.html.b281a6f6.js"><link rel="prefetch" href="/notes/assets/entryPoints.html.37c3daf8.js"><link rel="prefetch" href="/notes/assets/loader.html.0ee9f618.js"><link rel="prefetch" href="/notes/assets/output.html.eb71ccdf.js"><link rel="prefetch" href="/notes/assets/plugin.html.cb1b0b59.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.3a154eb0.js"><link rel="prefetch" href="/notes/assets/reactApi.html.c8744e85.js"><link rel="prefetch" href="/notes/assets/reactChildren.html.f5776ec8.js"><link rel="prefetch" href="/notes/assets/reactElement.html.d4731e40.js"><link rel="prefetch" href="/notes/assets/reactFiber.html.218d6731.js"><link rel="prefetch" href="/notes/assets/commitAllHostEffects.html.970eac2a.js"><link rel="prefetch" href="/notes/assets/commitAllLifeCycles.html.e41302a1.js"><link rel="prefetch" href="/notes/assets/commitBeforeMutationLifecycles.html.ca8bb2bc.js"><link rel="prefetch" href="/notes/assets/commitDeletion.html.adde4740.js"><link rel="prefetch" href="/notes/assets/commitPlacement.html.9fcbc252.js"><link rel="prefetch" href="/notes/assets/commitRoot.html.59f0f8ab.js"><link rel="prefetch" href="/notes/assets/commitWork.html.151c7557.js"><link rel="prefetch" href="/notes/assets/invokeGuardedCallback.html.ec7c2dc3.js"><link rel="prefetch" href="/notes/assets/expirationTime.html.f618dc28.js"><link rel="prefetch" href="/notes/assets/reactDomRender.html.960931f2.js"><link rel="prefetch" href="/notes/assets/setStateForceUpdate.html.6c083638.js"><link rel="prefetch" href="/notes/assets/context.html.a10525df.js"><link rel="prefetch" href="/notes/assets/evenInit.html.21781f9e.js"><link rel="prefetch" href="/notes/assets/eventBind.html.81d434ca.js"><link rel="prefetch" href="/notes/assets/eventCreateEventObject.html.ee33e75c.js"><link rel="prefetch" href="/notes/assets/eventDispath.html.955f987f.js"><link rel="prefetch" href="/notes/assets/hydrate.html.956d9100.js"><link rel="prefetch" href="/notes/assets/ref.html.d5cf7e46.js"><link rel="prefetch" href="/notes/assets/suspense.html.65be2fc0.js"><link rel="prefetch" href="/notes/assets/suspenseLazy.html.e5680fbe.js"><link rel="prefetch" href="/notes/assets/suspenseWork.html.fac205f7.js"><link rel="prefetch" href="/notes/assets/hooksCommon.html.65080171.js"><link rel="prefetch" href="/notes/assets/hooksOther.html.570e91a5.js"><link rel="prefetch" href="/notes/assets/start.html.af4ca005.js"><link rel="prefetch" href="/notes/assets/useEffect.html.370659b8.js"><link rel="prefetch" href="/notes/assets/useState.html.a1c463ad.js"><link rel="prefetch" href="/notes/assets/base.html.0cdd85bb.js"><link rel="prefetch" href="/notes/assets/commpontDiff.html.d572c430.js"><link rel="prefetch" href="/notes/assets/componentUpdate.html.9ec691f9.js"><link rel="prefetch" href="/notes/assets/renderProcess.html.fb9f4238.js"><link rel="prefetch" href="/notes/assets/schedulingPrinciple.html.f7faecdd.js"><link rel="prefetch" href="/notes/assets/beginWork.html.07467e4f.js"><link rel="prefetch" href="/notes/assets/globalVariable.html.0493971a.js"><link rel="prefetch" href="/notes/assets/mountIndeterminateComponent.html.8af88ec9.js"><link rel="prefetch" href="/notes/assets/mountLazyCompont.html.fedf4af9.js"><link rel="prefetch" href="/notes/assets/performUnitOfWork.html.85abea4f.js"><link rel="prefetch" href="/notes/assets/performWork.html.df7ca8a7.js"><link rel="prefetch" href="/notes/assets/reactScheduler.html.89c7632b.js"><link rel="prefetch" href="/notes/assets/reconcileChildren.html.a7636b48.js"><link rel="prefetch" href="/notes/assets/reconcileChildrenArray.html.a48175f4.js"><link rel="prefetch" href="/notes/assets/reconcileSingleElement.html.8bb5ff2e.js"><link rel="prefetch" href="/notes/assets/renderRoot.html.d2e36335.js"><link rel="prefetch" href="/notes/assets/scheduleWork.html.c6a5836c.js"><link rel="prefetch" href="/notes/assets/throwException.html.83ee3ea3.js"><link rel="prefetch" href="/notes/assets/updateClassComponent.html.7ef13aa3.js"><link rel="prefetch" href="/notes/assets/updateContextConsumer.html.d28d0732.js"><link rel="prefetch" href="/notes/assets/updateContextProvider.html.8e3034bf.js"><link rel="prefetch" href="/notes/assets/updateForwardRef.html.f982e019.js"><link rel="prefetch" href="/notes/assets/updateFragment.html.d751c72a.js"><link rel="prefetch" href="/notes/assets/updateFunctionalComponent.html.10a8fc18.js"><link rel="prefetch" href="/notes/assets/updateHostComponent.html.a9131d9c.js"><link rel="prefetch" href="/notes/assets/updateHostRoot.html.0287bbb9.js"><link rel="prefetch" href="/notes/assets/updateHostText.html.689102a7.js"><link rel="prefetch" href="/notes/assets/updateMode.html.bdc59166.js"><link rel="prefetch" href="/notes/assets/updatePortalComponent.html.7fca5d24.js"><link rel="prefetch" href="/notes/assets/updateProfiler.html.1f9c1711.js"><link rel="prefetch" href="/notes/assets/updateSuspenseComponent.html.d6f9ffce.js"><link rel="prefetch" href="/notes/assets/interview1.html.b57a775e.js"><link rel="prefetch" href="/notes/assets/interview2.html.c99b58d8.js"><link rel="prefetch" href="/notes/assets/interview3.html.496f5dd7.js"><link rel="prefetch" href="/notes/assets/interview51.html.26128fe9.js"><link rel="prefetch" href="/notes/assets/interview52.html.8de22d29.js"><link rel="prefetch" href="/notes/assets/interview53.html.d5ed1de1.js"><link rel="prefetch" href="/notes/assets/interview54.html.21aa3465.js"><link rel="prefetch" href="/notes/assets/interview55.html.f1bf8aa4.js"><link rel="prefetch" href="/notes/assets/interview56.html.973fb6c9.js"><link rel="prefetch" href="/notes/assets/interview57.html.55c8138e.js"><link rel="prefetch" href="/notes/assets/interview1.html.9803147f.js"><link rel="prefetch" href="/notes/assets/interview10.html.3bd06693.js"><link rel="prefetch" href="/notes/assets/interview11.html.87295979.js"><link rel="prefetch" href="/notes/assets/interview12.html.197f78df.js"><link rel="prefetch" href="/notes/assets/interview13.html.51064b87.js"><link rel="prefetch" href="/notes/assets/interview14.html.aed0258d.js"><link rel="prefetch" href="/notes/assets/interview15.html.6317d62f.js"><link rel="prefetch" href="/notes/assets/interview16.html.a599e16c.js"><link rel="prefetch" href="/notes/assets/interview17.html.c41ca13d.js"><link rel="prefetch" href="/notes/assets/interview18.html.94361f24.js"><link rel="prefetch" href="/notes/assets/interview19.html.befd810d.js"><link rel="prefetch" href="/notes/assets/interview2.html.e5266962.js"><link rel="prefetch" href="/notes/assets/interview20.html.102d5835.js"><link rel="prefetch" href="/notes/assets/interview21.html.e00c409b.js"><link rel="prefetch" href="/notes/assets/interview22.html.224a0d1d.js"><link rel="prefetch" href="/notes/assets/interview23.html.24bb951a.js"><link rel="prefetch" href="/notes/assets/interview24.html.5df11ec5.js"><link rel="prefetch" href="/notes/assets/interview25.html.ab3e8b6e.js"><link rel="prefetch" href="/notes/assets/interview26.html.e11aeaa4.js"><link rel="prefetch" href="/notes/assets/interview27.html.f4876d6f.js"><link rel="prefetch" href="/notes/assets/interview28.html.9280820a.js"><link rel="prefetch" href="/notes/assets/interview29.html.d6cfc607.js"><link rel="prefetch" href="/notes/assets/interview3.html.79df1aa5.js"><link rel="prefetch" href="/notes/assets/interview30.html.6cff6821.js"><link rel="prefetch" href="/notes/assets/interview31.html.b9fc4058.js"><link rel="prefetch" href="/notes/assets/interview32.html.9d6d2851.js"><link rel="prefetch" href="/notes/assets/interview33.html.7ae29338.js"><link rel="prefetch" href="/notes/assets/interview34.html.a888cef4.js"><link rel="prefetch" href="/notes/assets/interview35.html.6f6b4076.js"><link rel="prefetch" href="/notes/assets/interview36.html.500618fd.js"><link rel="prefetch" href="/notes/assets/interview37.html.4db25f34.js"><link rel="prefetch" href="/notes/assets/interview38.html.4d84d1f3.js"><link rel="prefetch" href="/notes/assets/interview39.html.cd63c417.js"><link rel="prefetch" href="/notes/assets/interview4.html.6c5c1680.js"><link rel="prefetch" href="/notes/assets/interview40.html.2da218f1.js"><link rel="prefetch" href="/notes/assets/interview41.html.a3484c8b.js"><link rel="prefetch" href="/notes/assets/interview42.html.8ab232c9.js"><link rel="prefetch" href="/notes/assets/interview43.html.689e0e72.js"><link rel="prefetch" href="/notes/assets/interview44.html.5125344a.js"><link rel="prefetch" href="/notes/assets/interview45.html.7200c09f.js"><link rel="prefetch" href="/notes/assets/interview46.html.1e589add.js"><link rel="prefetch" href="/notes/assets/interview47.html.6dfa952f.js"><link rel="prefetch" href="/notes/assets/interview48.html.833f1ab9.js"><link rel="prefetch" href="/notes/assets/interview49.html.9edc7685.js"><link rel="prefetch" href="/notes/assets/interview5.html.f419469d.js"><link rel="prefetch" href="/notes/assets/interview50.html.780a3fad.js"><link rel="prefetch" href="/notes/assets/interview6.html.7031ad0e.js"><link rel="prefetch" href="/notes/assets/interview7.html.d29fe602.js"><link rel="prefetch" href="/notes/assets/interview8.html.f8287f38.js"><link rel="prefetch" href="/notes/assets/interview9.html.fe6fe8cc.js"><link rel="prefetch" href="/notes/assets/404.html.53392900.js"><link rel="prefetch" href="/notes/assets/404.717ff6a0.js"><link rel="prefetch" href="/notes/assets/Layout.77a7a3a5.js">
    <link rel="stylesheet" href="/notes/assets/style.524e36e5.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/notes/" class=""><!----><!----></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">路径切换 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/vue/vue-router/transition-to.html#导航守卫" class="router-link-active router-link-exact-active sidebar-item" aria-label="导航守卫"><!--[--><!--]--> 导航守卫 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/vue-router/transition-to.html#url" class="router-link-active router-link-exact-active sidebar-item" aria-label="url"><!--[--><!--]--> url <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/vue-router/transition-to.html#组件" class="router-link-active router-link-exact-active sidebar-item" aria-label="组件"><!--[--><!--]--> 组件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/vue-router/transition-to.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="路径切换" tabindex="-1"><a class="header-anchor" href="#路径切换" aria-hidden="true">#</a> 路径切换</h1><p><code>history.transitionTo</code> 是 Vue-Router 中非常重要的方法，当切换路由线路的时候，就会执行到该方法，前一节分析了 <code>matcher</code> 的相关实现，知道它是如何找到匹配的新线路，那么匹配到新线路后又做了哪些事情，接下来来完整分析一下 <code>transitionTo</code> 的实现，它的定义在 <code>src/history/base.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">transitionTo</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">location</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span> onComplete<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> onAbort<span class="token operator">?</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">confirmTransition</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
    onComplete <span class="token operator">&amp;&amp;</span> <span class="token function">onComplete</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ensureURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>ready <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>readyCbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>onAbort<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onAbort</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>ready <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>readyErrorCbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>transitionTo</code> 首先根据目标 <code>location</code> 和当前路径 <code>this.current</code> 执行 <code>this.router.match</code> 方法去匹配到目标的路径。这里 <code>this.current</code> 是 <code>history</code> 维护的当前路径，它的初始值是在 <code>history</code> 的构造函数中初始化的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token constant">START</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>START</code> 的定义在 <code>src/util/route.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">START</span> <span class="token operator">=</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样就创建了一个初始的 <code>Route</code>，而 <code>transitionTo</code> 实际上也就是在切换 <code>this.current</code>，稍后会看到。</p><p>拿到新的路径后，那么接下来就会执行 <code>confirmTransition</code> 方法去做真正的切换，由于这个过程可能有一些异步的操作（如异步组件），所以整个 <code>confirmTransition</code> API 设计成带有成功回调函数和失败回调函数，先来看一下它的定义：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">confirmTransition</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">route</span><span class="token operator">:</span> Route<span class="token punctuation">,</span> <span class="token literal-property property">onComplete</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> onAbort<span class="token operator">?</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current
  <span class="token keyword">const</span> <span class="token function-variable function">abort</span> <span class="token operator">=</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>errorCbs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>errorCbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&#39;uncaught error during route navigation:&#39;</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    onAbort <span class="token operator">&amp;&amp;</span> <span class="token function">onAbort</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token function">isSameRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> current<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    route<span class="token punctuation">.</span>matched<span class="token punctuation">.</span>length <span class="token operator">===</span> current<span class="token punctuation">.</span>matched<span class="token punctuation">.</span>length
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ensureURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    updated<span class="token punctuation">,</span>
    deactivated<span class="token punctuation">,</span>
    activated
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">resolveQueue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token punctuation">.</span>matched<span class="token punctuation">,</span> route<span class="token punctuation">.</span>matched<span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token literal-property property">queue</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token operator">?</span>NavigationGuard<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>
    <span class="token function">extractLeaveGuards</span><span class="token punctuation">(</span>deactivated<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>beforeHooks<span class="token punctuation">,</span>
    <span class="token function">extractUpdateHooks</span><span class="token punctuation">(</span>updated<span class="token punctuation">)</span><span class="token punctuation">,</span>
    activated<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>beforeEnter<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">resolveAsyncComponents</span><span class="token punctuation">(</span>activated<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">=</span> route
  <span class="token keyword">const</span> <span class="token function-variable function">iterator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">hook</span><span class="token operator">:</span> NavigationGuard<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">!==</span> route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">hook</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> current<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">to</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>to <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">||</span> <span class="token function">isError</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ensureURL</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
          <span class="token function">abort</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token keyword">typeof</span> to <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span> <span class="token operator">||</span>
          <span class="token punctuation">(</span><span class="token keyword">typeof</span> to <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
            <span class="token keyword">typeof</span> to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span> <span class="token operator">||</span>
            <span class="token keyword">typeof</span> to<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> to <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> to<span class="token punctuation">.</span>replace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">next</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">abort</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">runQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> iterator<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> postEnterCbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> <span class="token function-variable function">isValid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">===</span> route
    <span class="token keyword">const</span> enterGuards <span class="token operator">=</span> <span class="token function">extractEnterGuards</span><span class="token punctuation">(</span>activated<span class="token punctuation">,</span> postEnterCbs<span class="token punctuation">,</span> isValid<span class="token punctuation">)</span>
    <span class="token keyword">const</span> queue <span class="token operator">=</span> enterGuards<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>resolveHooks<span class="token punctuation">)</span>
    <span class="token function">runQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> iterator<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">!==</span> route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token function">onComplete</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>app<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          postEnterCbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><p>首先定义了 <code>abort</code> 函数，然后判断如果满足计算后的 <code>route</code> 和 <code>current</code> 是相同路径的话，则直接调用 <code>this.ensureUrl</code> 和 <code>abort</code>，<code>ensureUrl</code> 这个函数之后会介绍。</p><p>接着又根据 <code>current.matched</code> 和 <code>route.matched</code> 执行了 <code>resolveQueue</code> 方法解析出 3 个队列：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolveQueue</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">current</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">next</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">updated</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">activated</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">deactivated</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span>
<span class="token punctuation">}</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i
  <span class="token keyword">const</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span>length<span class="token punctuation">,</span> next<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> max<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!==</span> next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">updated</span><span class="token operator">:</span> next<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">activated</span><span class="token operator">:</span> next<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">deactivated</span><span class="token operator">:</span> current<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>因为 <code>route.matched</code> 是一个 <code>RouteRecord</code> 的数组，由于路径是由 <code>current</code> 变向 <code>route</code>，那么就遍历对比 2 边的 <code>RouteRecord</code>，找到一个不一样的位置 <code>i</code>，那么 <code>next</code> 中从 0 到 <code>i</code> 的 <code>RouteRecord</code> 是两边都一样，则为 <code>updated</code> 的部分；从 <code>i</code> 到最后的 <code>RouteRecord</code> 是 <code>next</code> 独有的，为 <code>activated</code> 的部分；而 <code>current</code> 中从 <code>i</code> 到最后的 <code>RouteRecord</code> 则没有了，为 <code>deactivated</code> 的部分。</p><p>拿到 <code>updated</code>、<code>activated</code>、<code>deactivated</code> 3 个 <code>ReouteRecord</code> 数组后，接下来就是路径变换后的一个重要部分，执行一系列的钩子函数。</p><h2 id="导航守卫" tabindex="-1"><a class="header-anchor" href="#导航守卫" aria-hidden="true">#</a> 导航守卫</h2><p>官方的说法叫导航守卫，实际上就是发生在路由路径切换的时候，执行的一系列钩子函数。</p><p>先从整体上看一下这些钩子函数执行的逻辑，首先构造一个队列 <code>queue</code>，它实际上是一个数组；然后再定义一个迭代器函数 <code>iterator</code>；最后再执行 <code>runQueue</code> 方法来执行这个队列。先来看一下 <code>runQueue</code> 的定义，在 <code>src/util/async.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">runQueue</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">queue</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token operator">?</span>NavigationGuard<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token literal-property property">fn</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> <span class="token literal-property property">cb</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">step</span> <span class="token operator">=</span> <span class="token parameter">index</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span>queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">step</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">step</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>这是一个非常经典的异步函数队列化执行的模式， <code>queue</code> 是一个 <code>NavigationGuard</code> 类型的数组，定义了 <code>step</code> 函数，每次根据 <code>index</code> 从 <code>queue</code> 中取一个 <code>guard</code>，然后执行 <code>fn</code> 函数，并且把 <code>guard</code> 作为参数传入，第二个参数是一个函数，当这个函数执行的时候再递归执行 <code>step</code> 函数，前进到下一个，注意这里的 <code>fn</code> 就是刚才的 <code>iterator</code> 函数，那么再回到 <code>iterator</code> 函数的定义：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">iterator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">hook</span><span class="token operator">:</span> NavigationGuard<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">!==</span> route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">hook</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> current<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">to</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>to <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">||</span> <span class="token function">isError</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ensureURL</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token function">abort</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token keyword">typeof</span> to <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span> <span class="token operator">||</span>
        <span class="token punctuation">(</span><span class="token keyword">typeof</span> to <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
          <span class="token keyword">typeof</span> to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span> <span class="token operator">||</span>
          <span class="token keyword">typeof</span> to<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> to <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> to<span class="token punctuation">.</span>replace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">abort</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><code>iterator</code> 函数逻辑很简单，它就是去执行每一个 导航守卫 <code>hook</code>，并传入 <code>route</code>、<code>current</code> 和匿名函数，这些参数对应文档中的 <code>to</code>、<code>from</code>、<code>next</code>，当执行了匿名函数，会根据一些条件执行 <code>abort</code> 或 <code>next</code>，只有执行 <code>next</code> 的时候，才会前进到下一个导航守卫钩子函数中，这也就是为什么官方文档会说只有执行 <code>next</code> 方法来 <code>resolve</code> 这个钩子函数。</p><p>那么最后来看 <code>queue</code> 是怎么构造的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token literal-property property">queue</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token operator">?</span>NavigationGuard<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>
  <span class="token function">extractLeaveGuards</span><span class="token punctuation">(</span>deactivated<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>beforeHooks<span class="token punctuation">,</span>
  <span class="token function">extractUpdateHooks</span><span class="token punctuation">(</span>updated<span class="token punctuation">)</span><span class="token punctuation">,</span>
  activated<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>beforeEnter<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">resolveAsyncComponents</span><span class="token punctuation">(</span>activated<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>按照顺序如下：</p><ol><li><p>在失活的组件里调用离开守卫。</p></li><li><p>调用全局的 <code>beforeEach</code> 守卫。</p></li><li><p>在重用的组件里调用 <code>beforeRouteUpdate</code> 守卫</p></li><li><p>在激活的路由配置里调用 <code>beforeEnter</code>。</p></li><li><p>解析异步路由组件。</p></li></ol><p>接下来来分别介绍这 5 步的实现。</p><p>第一步是通过执行 <code>extractLeaveGuards(deactivated)</code>，先来看一下 <code>extractLeaveGuards</code> 的定义：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">extractLeaveGuards</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">deactivated</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token operator">?</span>Function<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">extractGuards</span><span class="token punctuation">(</span>deactivated<span class="token punctuation">,</span> <span class="token string">&#39;beforeRouteLeave&#39;</span><span class="token punctuation">,</span> bindGuard<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>它内部调用了 <code>extractGuards</code> 的通用方法，可以从 <code>RouteRecord</code> 数组中提取各个阶段的守卫：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">extractGuards</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">records</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">bind</span><span class="token operator">:</span> Function<span class="token punctuation">,</span>
  reverse<span class="token operator">?</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token operator">?</span>Function<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> guards <span class="token operator">=</span> <span class="token function">flatMapComponents</span><span class="token punctuation">(</span>records<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">def<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> match<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> guard <span class="token operator">=</span> <span class="token function">extractGuard</span><span class="token punctuation">(</span>def<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>guard<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>guard<span class="token punctuation">)</span>
        <span class="token operator">?</span> guard<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">guard</span> <span class="token operator">=&gt;</span> <span class="token function">bind</span><span class="token punctuation">(</span>guard<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> match<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">bind</span><span class="token punctuation">(</span>guard<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> match<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">flatten</span><span class="token punctuation">(</span>reverse <span class="token operator">?</span> guards<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> guards<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>这里用到了 <code>flatMapComponents</code> 方法去从 <code>records</code> 中获取所有的导航，它的定义在 <code>src/util/resolve-components.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">flatMapComponents</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">matched</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">fn</span><span class="token operator">:</span> Function</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token operator">?</span>Function<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">flatten</span><span class="token punctuation">(</span>matched<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>components<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span>
      m<span class="token punctuation">.</span>components<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
      m<span class="token punctuation">.</span>instances<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
      m<span class="token punctuation">,</span> key
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">flatten</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">arr</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>flatMapComponents</code> 的作用就是返回一个数组，数组的元素是从 <code>matched</code> 里获取到所有组件的 <code>key</code>，然后返回 <code>fn</code> 函数执行的结果，<code>flatten</code> 作用是把二维数组拍平成一维数组。</p><p>那么对于 <code>extractGuards</code> 中 <code>flatMapComponents</code> 的调用，执行每个 <code>fn</code> 的时候，通过 <code>extractGuard(def, name)</code> 获取到组件中对应 <code>name</code> 的导航守卫：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">extractGuard</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">def</span><span class="token operator">:</span> Object <span class="token operator">|</span> Function<span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> NavigationGuard <span class="token operator">|</span> Array<span class="token operator">&lt;</span>NavigationGuard<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> def <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    def <span class="token operator">=</span> _Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>def<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> def<span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>获取到 <code>guard</code> 后，还会调用 <code>bind</code> 方法把组件的实例 <code>instance</code> 作为函数执行的上下文绑定到 <code>guard</code> 上，<code>bind </code> 方法的对应的是 <code>bindGuard</code>：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">bindGuard</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">guard</span><span class="token operator">:</span> NavigationGuard<span class="token punctuation">,</span> <span class="token literal-property property">instance</span><span class="token operator">:</span> <span class="token operator">?</span>_Vue</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>NavigationGuard <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">boundRouteGuard</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">guard</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>那么对于 <code>extractLeaveGuards(deactivated)</code> 而言，获取到的就是所有失活组件中定义的 <code>beforeRouteLeave</code> 钩子函数。</p><p>第二步是 <code>this.router.beforeHooks</code>，在的 <code>VueRouter</code> 类中定义了 <code>beforeEach</code> 方法，在 <code>src/index.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">beforeEach</span> <span class="token punctuation">(</span>fn<span class="token operator">:</span> Function<span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">registerHook</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beforeHooks<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">registerHook</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">list</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token literal-property property">fn</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> i <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>当用户使用 <code>router.beforeEach</code> 注册了一个全局守卫，就会往 <code>router.beforeHooks</code> 添加一个钩子函数，这样 <code>this.router.beforeHooks</code> 获取的就是用户注册的全局 <code>beforeEach</code> 守卫。</p><p>第三步执行了 <code>extractUpdateHooks(updated)</code>，来看一下 <code>extractUpdateHooks</code> 的定义：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">extractUpdateHooks</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">updated</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token operator">?</span>Function<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">extractGuards</span><span class="token punctuation">(</span>updated<span class="token punctuation">,</span> <span class="token string">&#39;beforeRouteUpdate&#39;</span><span class="token punctuation">,</span> bindGuard<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>和 <code>extractLeaveGuards(deactivated)</code> 类似，<code>extractUpdateHooks(updated)</code> 获取到的就是所有重用的组件中定义的 <code>beforeRouteUpdate</code> 钩子函数。</p><p>第四步是执行 <code>activated.map(m =&gt; m.beforeEnter)</code>，获取的是在激活的路由配置中定义的 <code>beforeEnter</code> 函数。</p><p>第五步是执行 <code>resolveAsyncComponents(activated)</code> 解析异步组件，先来看一下 <code>resolveAsyncComponents</code> 的定义，在 <code>src/util/resolve-components.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">resolveAsyncComponents</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">matched</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> hasAsync <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> error <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token function">flatMapComponents</span><span class="token punctuation">(</span>matched<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">def<span class="token punctuation">,</span> _<span class="token punctuation">,</span> match<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> def <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">&amp;&amp;</span> def<span class="token punctuation">.</span>cid <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hasAsync <span class="token operator">=</span> <span class="token boolean">true</span>
        pending<span class="token operator">++</span>

        <span class="token keyword">const</span> resolve <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">resolvedDef</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isESModule</span><span class="token punctuation">(</span>resolvedDef<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            resolvedDef <span class="token operator">=</span> resolvedDef<span class="token punctuation">.</span>default
          <span class="token punctuation">}</span>
          def<span class="token punctuation">.</span>resolved <span class="token operator">=</span> <span class="token keyword">typeof</span> resolvedDef <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span>
            <span class="token operator">?</span> resolvedDef
            <span class="token operator">:</span> _Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>resolvedDef<span class="token punctuation">)</span>
          match<span class="token punctuation">.</span>components<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> resolvedDef
          pending<span class="token operator">--</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>pending <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> reject <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to resolve async component </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reason<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
          process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            error <span class="token operator">=</span> <span class="token function">isError</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
              <span class="token operator">?</span> reason
              <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
            <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">let</span> res
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          res <span class="token operator">=</span> <span class="token function">def</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> res<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> comp <span class="token operator">=</span> res<span class="token punctuation">.</span>component
            <span class="token keyword">if</span> <span class="token punctuation">(</span>comp <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> comp<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              comp<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasAsync<span class="token punctuation">)</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p><code>resolveAsyncComponents</code> 返回的是一个导航守卫函数，有标准的 <code>to</code>、<code>from</code>、<code>next</code> 参数。它的内部实现很简单，利用了 <code>flatMapComponents</code> 方法从 <code>matched</code> 中获取到每个组件的定义，判断如果是异步组件，则执行异步组件加载逻辑，这块和之前分析 <code>Vue</code> 加载异步组件很类似，加载成功后会执行 <code> match.components[key] = resolvedDef</code> 把解析好的异步组件放到对应的 <code>components</code> 上，并且执行 <code>next</code> 函数。</p><p>这样在 <code>resolveAsyncComponents(activated)</code> 解析完所有激活的异步组件后，就可以拿到这一次所有激活的组件。这样在做完这 5 步后又做了一些事情：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">runQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> iterator<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> postEnterCbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token function-variable function">isValid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">===</span> route
  <span class="token keyword">const</span> enterGuards <span class="token operator">=</span> <span class="token function">extractEnterGuards</span><span class="token punctuation">(</span>activated<span class="token punctuation">,</span> postEnterCbs<span class="token punctuation">,</span> isValid<span class="token punctuation">)</span>
  <span class="token keyword">const</span> queue <span class="token operator">=</span> enterGuards<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>resolveHooks<span class="token punctuation">)</span>
  <span class="token function">runQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> iterator<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">!==</span> route<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token function">onComplete</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>app<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        postEnterCbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="6"><li><p>在被激活的组件里调用 <code>beforeRouteEnter</code>。</p></li><li><p>调用全局的 <code>beforeResolve</code> 守卫。</p></li><li><p>调用全局的 <code>afterEach</code> 钩子。</p></li></ol><p>对于第六步有这些相关的逻辑：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> postEnterCbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token function-variable function">isValid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">===</span> route
<span class="token keyword">const</span> enterGuards <span class="token operator">=</span> <span class="token function">extractEnterGuards</span><span class="token punctuation">(</span>activated<span class="token punctuation">,</span> postEnterCbs<span class="token punctuation">,</span> isValid<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">extractEnterGuards</span> <span class="token punctuation">(</span>
  <span class="token literal-property property">activated</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">cbs</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">isValid</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean
<span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token operator">?</span>Function<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">extractGuards</span><span class="token punctuation">(</span>activated<span class="token punctuation">,</span> <span class="token string">&#39;beforeRouteEnter&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">guard<span class="token punctuation">,</span> _<span class="token punctuation">,</span> match<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">bindEnterGuard</span><span class="token punctuation">(</span>guard<span class="token punctuation">,</span> match<span class="token punctuation">,</span> key<span class="token punctuation">,</span> cbs<span class="token punctuation">,</span> isValid<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bindEnterGuard</span> <span class="token punctuation">(</span>
  <span class="token literal-property property">guard</span><span class="token operator">:</span> NavigationGuard<span class="token punctuation">,</span>
  <span class="token literal-property property">match</span><span class="token operator">:</span> RouteRecord<span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">cbs</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">isValid</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean
<span class="token punctuation">)</span><span class="token operator">:</span> NavigationGuard <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">routeEnterGuard</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">guard</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> <span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> cb <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">poll</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> match<span class="token punctuation">.</span>instances<span class="token punctuation">,</span> key<span class="token punctuation">,</span> isValid<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">poll</span> <span class="token punctuation">(</span>
  <span class="token literal-property property">cb</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">instances</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token function-variable function">isValid</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>instances<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span>instances<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">poll</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> instances<span class="token punctuation">,</span> key<span class="token punctuation">,</span> isValid<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p><code>extractEnterGuards</code> 函数的实现也是利用了 <code>extractGuards</code> 方法提取组件中的 <code>beforeRouteEnter</code> 导航钩子函数，和之前不同的是 <code>bind</code> 方法的不同。文档中特意强调了 <code>beforeRouteEnter</code> 钩子函数中是拿不到组件实例的，因为当守卫执行前，组件实例还没被创建，但是可以通过传一个回调给 <code>next</code> 来访问组件实例。在导航被确认的时候执行回调，并且把组件实例作为回调方法的参数：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">beforeRouteEnter</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">vm</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过 `vm` 访问组件实例</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>来看一下这是怎么实现的。</p><p>在 <code>bindEnterGuard</code> 函数中，返回的是 <code>routeEnterGuard</code> 函数，所以在执行 <code>iterator</code> 中的 <code>hook</code> 函数的时候，就相当于执行 <code>routeEnterGuard</code> 函数，那么就会执行定义的导航守卫 <code>guard</code> 函数，并且当这个回调函数执行的时候，首先执行 <code>next</code> 函数 <code>rersolve</code> 当前导航钩子，然后把回调函数的参数，它也是一个回调函数用 <code>cbs</code> 收集起来，其实就是收集到外面定义的 <code>postEnterCbs</code> 中，然后在最后会执行：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>app<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    postEnterCbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在根路由组件重新渲染后，遍历 <code>postEnterCbs</code> 执行回调，每一个回调执行的时候，其实是执行 <code> poll(cb, match.instances, key, isValid)</code> 方法，因为考虑到一些了路由组件被套 <code>transition</code> 組件在一些缓动模式下不一定能拿到实例，所以用一个轮询方法不断去判断，直到能获取到组件实例，再去调用 <code>cb</code>，并把组件实例作为参数传入，这就是在回调函数中能拿到组件实例的原因。</p><p>第七步是获取 <code>this.router.resolveHooks</code>，这个和 <code>this.router.beforeHooks</code> 的获取类似，在的 <code>VueRouter</code> 类中定义了 <code>beforeResolve</code> 方法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">beforeResolve</span> <span class="token punctuation">(</span>fn<span class="token operator">:</span> Function<span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">registerHook</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolveHooks<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>当用户使用 <code>router.beforeResolve</code> 注册了一个全局守卫，就会往 <code>router.resolveHooks</code> 添加一个钩子函数，这样 <code>this.router.resolveHooks</code> 获取的就是用户注册的全局 <code>beforeResolve</code> 守卫。</p><p>第八步是在最后执行了 <code>onComplete(route)</code> 后，会执行 <code>this.updateRoute(route)</code> 方法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateRoute</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">route</span><span class="token operator">:</span> Route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> prev <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current
  <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> route
  <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>afterHooks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">hook</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    hook <span class="token operator">&amp;&amp;</span> <span class="token function">hook</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> prev<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>同样在的 <code>VueRouter</code> 类中定义了 <code>afterEach</code> 方法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">afterEach</span> <span class="token punctuation">(</span>fn<span class="token operator">:</span> Function<span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">registerHook</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>afterHooks<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>当用户使用 <code>router.afterEach</code> 注册了一个全局守卫，就会往 <code>router.afterHooks</code> 添加一个钩子函数，这样 <code>this.router.afterHooks</code> 获取的就是用户注册的全局 <code>afterHooks</code> 守卫。</p><p>那么至此把所有导航守卫的执行分析完毕了，知道路由切换除了执行这些钩子函数，从表象上有 2 个地方会发生变化，一个是 url 发生变化，一个是组件发生变化。接下来分别介绍这两块的实现原理。</p><h2 id="url" tabindex="-1"><a class="header-anchor" href="#url" aria-hidden="true">#</a> url</h2><p>当点击 <code>router-link</code> 的时候，实际上最终会执行 <code>router.push</code>，如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">push</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">location</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span> onComplete<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> onAbort<span class="token operator">?</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> onComplete<span class="token punctuation">,</span> onAbort<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>this.history.push</code> 函数，这个函数是子类实现的，不同模式下该函数的实现略有不同，来看一下平时使用比较多的 <code>hash</code> 模式该函数的实现，在 <code>src/history/hash.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">push</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">location</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span> onComplete<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> onAbort<span class="token operator">?</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">current</span><span class="token operator">:</span> fromRoute <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transitionTo</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> <span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">pushHash</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>fullPath<span class="token punctuation">)</span>
    <span class="token function">handleScroll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">,</span> route<span class="token punctuation">,</span> fromRoute<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    onComplete <span class="token operator">&amp;&amp;</span> <span class="token function">onComplete</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> onAbort<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>push</code> 函数会先执行 <code>this.transitionTo</code> 做路径切换，在切换完成的回调函数中，执行 <code>pushHash</code> 函数：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">pushHash</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>supportsPushState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pushState</span><span class="token punctuation">(</span><span class="token function">getUrl</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> path
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>supportsPushState</code> 的定义在 <code>src/util/push-state.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> supportsPushState <span class="token operator">=</span> inBrowser <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ua <span class="token operator">=</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>userAgent

  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token punctuation">(</span>ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;Android 2.&#39;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;Android 4.0&#39;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;Mobile Safari&#39;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
    ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;Chrome&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
    ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;Windows Phone&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> window<span class="token punctuation">.</span>history <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;pushState&#39;</span> <span class="token keyword">in</span> window<span class="token punctuation">.</span>history
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>如果支持的话，则获取当前完整的 <code>url</code>，执行 <code>pushState</code> 方法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pushState</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">,</span> replace<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">saveScrollPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> history <span class="token operator">=</span> window<span class="token punctuation">.</span>history
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>replace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> _key <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      _key <span class="token operator">=</span> <span class="token function">genKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> _key <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">[</span>replace <span class="token operator">?</span> <span class="token string">&#39;replace&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;assign&#39;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>pushState</code> 会调用浏览器原生的 <code>history</code> 的 <code>pushState</code> 接口或者 <code>replaceState</code> 接口，更新浏览器的 url 地址，并把当前 url 压入历史栈中。</p><p>然后在 <code>history</code> 的初始化中，会设置一个监听器，监听历史栈的变化：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setupListeners</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>router
  <span class="token keyword">const</span> expectScroll <span class="token operator">=</span> router<span class="token punctuation">.</span>options<span class="token punctuation">.</span>scrollBehavior
  <span class="token keyword">const</span> supportsScroll <span class="token operator">=</span> supportsPushState <span class="token operator">&amp;&amp;</span> expectScroll

  <span class="token keyword">if</span> <span class="token punctuation">(</span>supportsScroll<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setupScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>supportsPushState <span class="token operator">?</span> <span class="token string">&#39;popstate&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;hashchange&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">ensureSlash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transitionTo</span><span class="token punctuation">(</span><span class="token function">getHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>supportsScroll<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleScroll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">,</span> route<span class="token punctuation">,</span> current<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>supportsPushState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">replaceHash</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>fullPath<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>当点击浏览器返回按钮的时候，如果已经有 url 被压入历史栈，则会触发 <code>popstate</code> 事件，然后拿到当前要跳转的 <code>hash</code>，执行 <code>transtionTo</code> 方法做一次路径转换。</p><p>同学们在使用 Vue-Router 开发项目的时候，打开调试页面 <code>http://localhost:8080</code> 后会自动把 url 修改为 <code>http://localhost:8080/#/</code>，这是怎么做到呢？原来在实例化 <code>HashHistory</code> 的时候，构造函数会执行 <code>ensureSlash()</code> 方法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">ensureSlash</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">getHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token function">replaceHash</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> path<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getHash</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
  <span class="token comment">// We can&#39;t use window.location.hash here because it&#39;s not</span>
  <span class="token comment">// consistent across browsers - Firefox will pre-decode it!</span>
  <span class="token keyword">const</span> href <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href
  <span class="token keyword">const</span> index <span class="token operator">=</span> href<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;#&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&#39;&#39;</span> <span class="token operator">:</span> href<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getUrl</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> href <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href
  <span class="token keyword">const</span> i <span class="token operator">=</span> href<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;#&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> base <span class="token operator">=</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">?</span> href<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">:</span> href
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>base<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">replaceHash</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>supportsPushState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token function">getUrl</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token function">getUrl</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">replaceState</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token operator">?</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">pushState</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>这个时候 <code>path</code> 为空，所以执行 <code>replaceHash(&#39;/&#39; + path)</code>，然后内部会执行一次 <code>getUrl</code>，计算出来的新的 <code>url</code> 为 <code>http://localhost:8080/#/</code>，最终会执行 <code>pushState(url, true)</code>，这就是 url 会改变的原因。</p><h2 id="组件" tabindex="-1"><a class="header-anchor" href="#组件" aria-hidden="true">#</a> 组件</h2><p>路由最终的渲染离不开组件，Vue-Router 内置了 <code>&lt;router-view&gt;</code> 组件，它的定义在 <code>src/components/view.js</code> 中。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;RouterView&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">functional</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;default&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> <span class="token punctuation">{</span> props<span class="token punctuation">,</span> children<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">.</span>routerView <span class="token operator">=</span> <span class="token boolean">true</span>
   
    <span class="token keyword">const</span> h <span class="token operator">=</span> parent<span class="token punctuation">.</span>$createElement
    <span class="token keyword">const</span> name <span class="token operator">=</span> props<span class="token punctuation">.</span>name
    <span class="token keyword">const</span> route <span class="token operator">=</span> parent<span class="token punctuation">.</span>$route
    <span class="token keyword">const</span> cache <span class="token operator">=</span> parent<span class="token punctuation">.</span>_routerViewCache <span class="token operator">||</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>_routerViewCache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> depth <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> inactive <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>_routerRoot <span class="token operator">!==</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$vnode <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>$vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>routerView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        depth<span class="token operator">++</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>_inactive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        inactive <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
      parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent
    <span class="token punctuation">}</span>
    data<span class="token punctuation">.</span>routerViewDepth <span class="token operator">=</span> depth

    <span class="token keyword">if</span> <span class="token punctuation">(</span>inactive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> matched <span class="token operator">=</span> route<span class="token punctuation">.</span>matched<span class="token punctuation">[</span>depth<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> component <span class="token operator">=</span> cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> matched<span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
   
    data<span class="token punctuation">.</span><span class="token function-variable function">registerRouteInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>     
      <span class="token keyword">const</span> current <span class="token operator">=</span> matched<span class="token punctuation">.</span>instances<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span>val <span class="token operator">&amp;&amp;</span> current <span class="token operator">!==</span> vm<span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token punctuation">(</span><span class="token operator">!</span>val <span class="token operator">&amp;&amp;</span> current <span class="token operator">===</span> vm<span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        matched<span class="token punctuation">.</span>instances<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> val
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token punctuation">;</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>hook <span class="token operator">||</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>hook <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">prepatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      matched<span class="token punctuation">.</span>instances<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> vnode<span class="token punctuation">.</span>componentInstance
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> propsToPass <span class="token operator">=</span> data<span class="token punctuation">.</span>props <span class="token operator">=</span> <span class="token function">resolveProps</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> matched<span class="token punctuation">.</span>props <span class="token operator">&amp;&amp;</span> matched<span class="token punctuation">.</span>props<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>propsToPass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      propsToPass <span class="token operator">=</span> data<span class="token punctuation">.</span>props <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> propsToPass<span class="token punctuation">)</span>
      <span class="token keyword">const</span> attrs <span class="token operator">=</span> data<span class="token punctuation">.</span>attrs <span class="token operator">=</span> data<span class="token punctuation">.</span>attrs <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> propsToPass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>component<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> component<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> propsToPass<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
          <span class="token keyword">delete</span> propsToPass<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p><code>&lt;router-view&gt;</code> 是一个 <code>functional</code> 组件，它的渲染也是依赖 <code>render</code> 函数，那么 <code>&lt;router-view&gt;</code> 具体应该渲染什么组件呢，首先获取当前的路径：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> route <span class="token operator">=</span> parent<span class="token punctuation">.</span>$route
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>之前分析过，在 <code>src/install.js</code> 中，给 Vue 的原型上定义了 <code>$route</code>：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&#39;$route&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_routerRoot<span class="token punctuation">.</span>_route <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后在 <code>VueRouter</code> 的实例执行 <code>router.init</code> 方法的时候，会执行如下逻辑，定义在 <code>src/index.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>apps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span>_route <span class="token operator">=</span> route
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>而 <code>history.listen</code> 方法定义在 <code>src/history/base.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">listen</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">cb</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后在 <code>updateRoute</code> 的时候执行 <code>this.cb</code>：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateRoute</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">route</span><span class="token operator">:</span> Route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//. ..</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> route
  <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>也就是执行 <code>transitionTo</code> 方法最后执行 <code>updateRoute</code> 的时候会执行回调，然后会更新 <code>this.apps</code> 保存的组件实例的 <code>_route</code> 值，<code>this.apps</code> 数组保存的实例的特点都是在初始化的时候传入了 <code>router</code> 配置项，一般的场景数组只会保存根 Vue 实例，因为是在 <code>new Vue</code> 传入了 <code>router</code> 实例。<code>$route</code> 是定义在 <code>Vue.prototype</code> 上。每个组件实例访问 <code>$route</code> 属性，就是访问根实例的 <code>_route</code>，也就是当前的路由线路。</p><p><code>&lt;router-view&gt;</code> 是支持嵌套的，回到 <code>render</code> 函数，其中定义了 <code>depth</code> 的概念，它表示 <code>&lt;router-view&gt;</code> 嵌套的深度。每个 <code>&lt;router-view&gt;</code> 在渲染的时候，执行如下逻辑：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>data<span class="token punctuation">.</span>routerView <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// ...</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>_routerRoot <span class="token operator">!==</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$vnode <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>$vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>routerView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    depth<span class="token operator">++</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>_inactive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inactive <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent
<span class="token punctuation">}</span>

<span class="token keyword">const</span> matched <span class="token operator">=</span> route<span class="token punctuation">.</span>matched<span class="token punctuation">[</span>depth<span class="token punctuation">]</span>
<span class="token comment">// ...</span>
<span class="token keyword">const</span> component <span class="token operator">=</span> cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> matched<span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>parent._routerRoot</code> 表示的是根 Vue 实例，那么这个循环就是从当前的 <code>&lt;router-view&gt;</code> 的父节点向上找，一直找到根 Vue 实例，在这个过程，如果碰到了父节点也是 <code>&lt;router-view&gt;</code> 的时候，说明 <code>&lt;router-view&gt;</code> 有嵌套的情况，<code>depth++</code>。遍历完成后，根据当前线路匹配的路径和 <code>depth</code> 找到对应的 <code>RouteRecord</code>，进而找到该渲染的组件。</p><p>除了找到了应该渲染的组件，还定义了一个注册路由实例的方法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>data<span class="token punctuation">.</span><span class="token function-variable function">registerRouteInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>     
  <span class="token keyword">const</span> current <span class="token operator">=</span> matched<span class="token punctuation">.</span>instances<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token punctuation">(</span>val <span class="token operator">&amp;&amp;</span> current <span class="token operator">!==</span> vm<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token punctuation">(</span><span class="token operator">!</span>val <span class="token operator">&amp;&amp;</span> current <span class="token operator">===</span> vm<span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    matched<span class="token punctuation">.</span>instances<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>给 <code>vnode</code> 的 <code>data</code> 定义了 <code>registerRouteInstance</code> 方法，在 <code>src/install.js</code> 中，会调用该方法去注册路由的实例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">registerInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> callVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_parentVnode
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>registerRouteInstance<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">i</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> callVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">beforeCreate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function">registerInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroyed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">registerInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在混入的 <code>beforeCreate</code> 钩子函数中，会执行 <code>registerInstance</code> 方法，进而执行 <code>render</code> 函数中定义的 <code>registerRouteInstance</code> 方法，从而给 <code>matched.instances[name]</code> 赋值当前组件的 <code>vm</code> 实例。</p><p><code>render</code> 函数的最后根据 <code>component</code> 渲染出对应的组件 <code>vonde</code>：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>那么当执行 <code>transitionTo</code> 来更改路由线路后，组件是如何重新渲染的呢？在混入的 <code>beforeCreate</code> 钩子函数中有这么一段逻辑：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">beforeCreate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Vue<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&#39;_route&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span>history<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>由于把根 Vue 实例的 <code>_route</code> 属性定义成响应式的，在每个 <code>&lt;router-view&gt;</code> 执行 <code>render</code> 函数的时候，都会访问 <code>parent.$route</code>，如之前分析会访问 <code>this._routerRoot._route</code>，触发了它的 <code>getter</code>，相当于 <code>&lt;router-view&gt;</code> 对它有依赖，然后再执行完 <code>transitionTo</code> 后，修改 <code>app._route</code> 的时候，又触发了<code>setter</code>，因此会通知 <code>&lt;router-view&gt;</code> 的渲染 <code>watcher</code> 更新，重新渲染组件。</p><p>Vue-Router 还内置了另一个组件 <code>&lt;router-link&gt;</code>， 它支持用户在具有路由功能的应用中（点击）导航。 通过 <code>to</code> 属性指定目标地址，默认渲染成带有正确链接的 <code>&lt;a&gt;</code> 标签，可以通过配置 <code>tag</code> 属性生成别的标签。另外，当目标路由成功激活时，链接元素自动设置一个表示激活的 CSS 类名。</p><p><code>&lt;router-link&gt;</code> 比起写死的 <code>&lt;a href=&quot;...&quot;&gt;</code> 会好一些，理由如下：</p><p>无论是 HTML5 <code>history</code> 模式还是 <code>hash</code> 模式，它的表现行为一致，所以，当你要切换路由模式，或者在 IE9 降级使用 <code>hash</code> 模式，无须作任何变动。</p><p>在 HTML5 <code>history</code> 模式下，<code>router-link</code> 会守卫点击事件，让浏览器不再重新加载页面。</p><p>当你在 HTML5 <code>history</code> 模式下使用 <code>base</code> 选项之后，所有的 to 属性都不需要写（基路径）了。</p><p>那么接下来就来分析它的实现，它的定义在 <code>src/components/link.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;RouterLink&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> toTypes<span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;a&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exact</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">append</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">replace</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">activeClass</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">exactActiveClass</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> eventTypes<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;click&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">h</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router
    <span class="token keyword">const</span> current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route
    <span class="token keyword">const</span> <span class="token punctuation">{</span> location<span class="token punctuation">,</span> route<span class="token punctuation">,</span> href <span class="token punctuation">}</span> <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">,</span> current<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>append<span class="token punctuation">)</span>

    <span class="token keyword">const</span> classes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> globalActiveClass <span class="token operator">=</span> router<span class="token punctuation">.</span>options<span class="token punctuation">.</span>linkActiveClass
    <span class="token keyword">const</span> globalExactActiveClass <span class="token operator">=</span> router<span class="token punctuation">.</span>options<span class="token punctuation">.</span>linkExactActiveClass
    <span class="token keyword">const</span> activeClassFallback <span class="token operator">=</span> globalActiveClass <span class="token operator">==</span> <span class="token keyword">null</span>
            <span class="token operator">?</span> <span class="token string">&#39;router-link-active&#39;</span>
            <span class="token operator">:</span> globalActiveClass
    <span class="token keyword">const</span> exactActiveClassFallback <span class="token operator">=</span> globalExactActiveClass <span class="token operator">==</span> <span class="token keyword">null</span>
            <span class="token operator">?</span> <span class="token string">&#39;router-link-exact-active&#39;</span>
            <span class="token operator">:</span> globalExactActiveClass
    <span class="token keyword">const</span> activeClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>activeClass <span class="token operator">==</span> <span class="token keyword">null</span>
            <span class="token operator">?</span> activeClassFallback
            <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>activeClass
    <span class="token keyword">const</span> exactActiveClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>exactActiveClass <span class="token operator">==</span> <span class="token keyword">null</span>
            <span class="token operator">?</span> exactActiveClassFallback
            <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>exactActiveClass
    <span class="token keyword">const</span> compareTarget <span class="token operator">=</span> location<span class="token punctuation">.</span>path
      <span class="token operator">?</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> location<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>
      <span class="token operator">:</span> route

    classes<span class="token punctuation">[</span>exactActiveClass<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">isSameRoute</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> compareTarget<span class="token punctuation">)</span>
    classes<span class="token punctuation">[</span>activeClass<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>exact
      <span class="token operator">?</span> classes<span class="token punctuation">[</span>exactActiveClass<span class="token punctuation">]</span>
      <span class="token operator">:</span> <span class="token function">isIncludedRoute</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> compareTarget<span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">guardEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>replace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> on <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> guardEvent <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> on<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> handler <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      on<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> handler
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token literal-property property">data</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword">class</span><span class="token operator">:</span> classes
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data<span class="token punctuation">.</span>on <span class="token operator">=</span> on
      data<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token punctuation">{</span> href <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">findAnchor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        a<span class="token punctuation">.</span>isStatic <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">const</span> extend <span class="token operator">=</span> _Vue<span class="token punctuation">.</span>util<span class="token punctuation">.</span>extend
        <span class="token keyword">const</span> aData <span class="token operator">=</span> a<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        aData<span class="token punctuation">.</span>on <span class="token operator">=</span> on
        <span class="token keyword">const</span> aAttrs <span class="token operator">=</span> a<span class="token punctuation">.</span>data<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>data<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span>
        aAttrs<span class="token punctuation">.</span>href <span class="token operator">=</span> href
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">.</span>on <span class="token operator">=</span> on
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><p><code>&lt;router-link&gt;</code> 标签的渲染也是基于 <code>render</code> 函数，它首先做了路由解析：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router
<span class="token keyword">const</span> current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route
<span class="token keyword">const</span> <span class="token punctuation">{</span> location<span class="token punctuation">,</span> route<span class="token punctuation">,</span> href <span class="token punctuation">}</span> <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">,</span> current<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>append<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>router.resolve</code> 是 <code>VueRouter</code> 的实例方法，它的定义在 <code>src/index.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">resolve</span> <span class="token punctuation">(</span>
  <span class="token literal-property property">to</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span>
  current<span class="token operator">?</span><span class="token operator">:</span> Route<span class="token punctuation">,</span>
  append<span class="token operator">?</span><span class="token operator">:</span> boolean
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">location</span><span class="token operator">:</span> Location<span class="token punctuation">,</span>
  <span class="token literal-property property">route</span><span class="token operator">:</span> Route<span class="token punctuation">,</span>
  <span class="token literal-property property">href</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">normalizedTo</span><span class="token operator">:</span> Location<span class="token punctuation">,</span>
  <span class="token literal-property property">resolved</span><span class="token operator">:</span> Route
<span class="token punctuation">}</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">normalizeLocation</span><span class="token punctuation">(</span>
    to<span class="token punctuation">,</span>
    current <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current<span class="token punctuation">,</span>
    append<span class="token punctuation">,</span>
    <span class="token keyword">this</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> current<span class="token punctuation">)</span>
  <span class="token keyword">const</span> fullPath <span class="token operator">=</span> route<span class="token punctuation">.</span>redirectedFrom <span class="token operator">||</span> route<span class="token punctuation">.</span>fullPath
  <span class="token keyword">const</span> base <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>base
  <span class="token keyword">const</span> href <span class="token operator">=</span> <span class="token function">createHref</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> fullPath<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mode<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    location<span class="token punctuation">,</span>
    route<span class="token punctuation">,</span>
    href<span class="token punctuation">,</span>
    <span class="token literal-property property">normalizedTo</span><span class="token operator">:</span> location<span class="token punctuation">,</span>
    <span class="token literal-property property">resolved</span><span class="token operator">:</span> route
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createHref</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">base</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">fullPath</span><span class="token operator">:</span> string<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> path <span class="token operator">=</span> mode <span class="token operator">===</span> <span class="token string">&#39;hash&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;#&#39;</span> <span class="token operator">+</span> fullPath <span class="token operator">:</span> fullPath
  <span class="token keyword">return</span> base <span class="token operator">?</span> <span class="token function">cleanPath</span><span class="token punctuation">(</span>base <span class="token operator">+</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> path<span class="token punctuation">)</span> <span class="token operator">:</span> path
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>它先规范生成目标 <code>location</code>，再根据 <code>location</code> 和 <code>match</code> 通过 <code>this.match</code> 方法计算生成目标路径 <code>route</code>，然后再根据 <code>base</code>、<code>fullPath</code> 和 <code>this.mode</code> 通过 <code>createHref</code> 方法计算出最终跳转的 <code>href</code>。</p><p>解析完 <code>router</code> 获得目标 <code>location</code>、<code>route</code>、<code>href</code> 后，接下来对 <code>exactActiveClass</code> 和 <code>activeClass</code> 做处理，当配置 <code>exact</code> 为 true 的时候，只有当目标路径和当前路径完全匹配的时候，会添加 <code>exactActiveClass</code>；而当目标路径包含当前路径的时候，会添加 <code>activeClass</code>。</p><p>接着创建了一个守卫函数 ：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">guardEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>replace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">guardEvent</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>metaKey <span class="token operator">||</span> e<span class="token punctuation">.</span>altKey <span class="token operator">||</span> e<span class="token punctuation">.</span>ctrlKey <span class="token operator">||</span> e<span class="token punctuation">.</span>shiftKey<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>defaultPrevented<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>button <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>button <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> 
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>getAttribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b_blank\b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>preventDefault<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> on <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> guardEvent <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> on<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> handler <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    on<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> handler
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>最终会监听点击事件或者其它可以通过 <code>prop</code> 传入的事件类型，执行 <code>hanlder</code> 函数，最终执行 <code>router.push</code> 或者 <code>router.replace</code> 函数，它们的定义在 <code>src/index.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">push</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">location</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span> onComplete<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> onAbort<span class="token operator">?</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> onComplete<span class="token punctuation">,</span> onAbort<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">replace</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">location</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span> onComplete<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> onAbort<span class="token operator">?</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> onComplete<span class="token punctuation">,</span> onAbort<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>实际上就是执行了 <code>history</code> 的 <code>push</code> 和 <code>replace</code> 方法做路由跳转。</p><p>最后判断当前 <code>tag</code> 是否是 <code>&lt;a&gt;</code> 标签，<code>&lt;router-link&gt;</code> 默认会渲染成 <code>&lt;a&gt;</code> 标签，当然也可以修改 <code>tag</code> 的 <code>prop</code> 渲染成其他节点，这种情况下会尝试找它子元素的 <code>&lt;a&gt;</code> 标签，如果有则把事件绑定到 <code>&lt;a&gt;</code> 标签上并添加 <code>href</code> 属性，否则绑定到外层元素本身。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>那么至此把路由的 <code>transitionTo</code> 的主体过程分析完毕了，其他一些分支比如重定向、别名、滚动行为等同学们可以自行再去分析。</p><p>路径变化是路由中最重要的功能，要记住以下内容：路由始终会维护当前的线路，路由切换的时候会把当前线路切换到目标线路，切换过程中会执行一系列的导航守卫钩子函数，会更改 url，同样也会渲染对应的组件，切换完毕后会把目标线路更新替换当前线路，这样就会作为下一次的路径切换的依据。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: dean@57blocks.com">DeanSui</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/notes/assets/app.a6d8e189.js" defer></script>
  </body>
</html>
