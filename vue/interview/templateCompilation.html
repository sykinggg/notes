<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.46">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title></title><meta name="description" content="君子藏器于身 待时而动 天下有道则见 无道则隐">
    <link rel="modulepreload" href="/notes/assets/app.e9fd9ffa.js"><link rel="modulepreload" href="/notes/assets/templateCompilation.html.93b3a5a7.js"><link rel="modulepreload" href="/notes/assets/templateCompilation.html.c892ed89.js"><link rel="prefetch" href="/notes/assets/index.html.5fd94bab.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.a6abb857.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.ae77e968.js"><link rel="prefetch" href="/notes/assets/base.html.3d754fa5.js"><link rel="prefetch" href="/notes/assets/customCli.html.36e53760.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.2d46cabb.js"><link rel="prefetch" href="/notes/assets/adapter.html.5a9d6af2.js"><link rel="prefetch" href="/notes/assets/amd.html.2bea2db4.js"><link rel="prefetch" href="/notes/assets/builder.html.729f6b2e.js"><link rel="prefetch" href="/notes/assets/censorJquery.html.39371bf2.js"><link rel="prefetch" href="/notes/assets/combination.html.d817f852.js"><link rel="prefetch" href="/notes/assets/command.html.b4ecb5f8.js"><link rel="prefetch" href="/notes/assets/commonJS.html.0798834e.js"><link rel="prefetch" href="/notes/assets/constructor.html.30e7985e.js"><link rel="prefetch" href="/notes/assets/decoration.html.71ad24e0.js"><link rel="prefetch" href="/notes/assets/esHarmony.html.7c39ce29.js"><link rel="prefetch" href="/notes/assets/exposed.html.cb9784d3.js"><link rel="prefetch" href="/notes/assets/exterior.html.404cbc0a.js"><link rel="prefetch" href="/notes/assets/factory.html.c6fa80a5.js"><link rel="prefetch" href="/notes/assets/flyweight.html.d6fcb6c1.js"><link rel="prefetch" href="/notes/assets/functionalProgramming.html.1195cfd1.js"><link rel="prefetch" href="/notes/assets/intermediary.html.dec9cb53.js"><link rel="prefetch" href="/notes/assets/iterator.html.95b44153.js"><link rel="prefetch" href="/notes/assets/lazyInitial.html.5cde602d.js"><link rel="prefetch" href="/notes/assets/mixin.html.9c154f1d.js"><link rel="prefetch" href="/notes/assets/module.html.0f568c6d.js"><link rel="prefetch" href="/notes/assets/mvc.html.7795f31a.js"><link rel="prefetch" href="/notes/assets/mvp.html.b2ac7e69.js"><link rel="prefetch" href="/notes/assets/mvvm.html.b2ea5257.js"><link rel="prefetch" href="/notes/assets/observer.html.2e944745.js"><link rel="prefetch" href="/notes/assets/outward.html.9caf1ef6.js"><link rel="prefetch" href="/notes/assets/overview.html.f5d3c45f.js"><link rel="prefetch" href="/notes/assets/prototype.html.721f6b79.js"><link rel="prefetch" href="/notes/assets/proxy.html.53d7bdce.js"><link rel="prefetch" href="/notes/assets/singleton.html.b6dd9543.js"><link rel="prefetch" href="/notes/assets/axios.html.65151ad6.js"><link rel="prefetch" href="/notes/assets/createUnderscore.html.31b0b486.js"><link rel="prefetch" href="/notes/assets/jquery.html.531d64e8.js"><link rel="prefetch" href="/notes/assets/lodash.html.4b2564ab.js"><link rel="prefetch" href="/notes/assets/sentry.html.e888b325.js"><link rel="prefetch" href="/notes/assets/underscore.html.6110ee50.js"><link rel="prefetch" href="/notes/assets/vuex.html.fc16ecfa.js"><link rel="prefetch" href="/notes/assets/customCli.html.51768ec9.js"><link rel="prefetch" href="/notes/assets/description.html.766a5b08.js"><link rel="prefetch" href="/notes/assets/indx.html.9df0d7fc.js"><link rel="prefetch" href="/notes/assets/rebase.html.e99965ec.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.325841e6.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.1fae09b0.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.a531b81d.js"><link rel="prefetch" href="/notes/assets/44Questions.html.cfcba87e.js"><link rel="prefetch" href="/notes/assets/asyncAwait.html.f0015aa3.js"><link rel="prefetch" href="/notes/assets/babelCompile.html.77d68e32.js"><link rel="prefetch" href="/notes/assets/base.html.33fa02fb.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.c24e8ade.js"><link rel="prefetch" href="/notes/assets/baseWebpack.html.292b14cb.js"><link rel="prefetch" href="/notes/assets/codeSeparation.html.9d879cd5.js"><link rel="prefetch" href="/notes/assets/cycle.html.137809e7.js"><link rel="prefetch" href="/notes/assets/cycleOtherWay.html.ada0833d.js"><link rel="prefetch" href="/notes/assets/executionMechanism.html.951d5374.js"><link rel="prefetch" href="/notes/assets/hybrid.html.b0b3d836.js"><link rel="prefetch" href="/notes/assets/jsHandwriting.html.19b021ba.js"><link rel="prefetch" href="/notes/assets/jsonStringify.html.52da0969.js"><link rel="prefetch" href="/notes/assets/largeFileResumableUpload.html.508feaaf.js"><link rel="prefetch" href="/notes/assets/performance.html.68c4fc21.js"><link rel="prefetch" href="/notes/assets/promise.html.3b0b5c5e.js"><link rel="prefetch" href="/notes/assets/promiseAll.html.1b4e5e96.js"><link rel="prefetch" href="/notes/assets/spa.html.938883e6.js"><link rel="prefetch" href="/notes/assets/tsBaseInterview.html.bb72859b.js"><link rel="prefetch" href="/notes/assets/useEs6.html.7d7e4a2c.js"><link rel="prefetch" href="/notes/assets/webAnimations.html.6661a43e.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.3a3d02ad.js"><link rel="prefetch" href="/notes/assets/webpackLoader.html.6cfc263d.js"><link rel="prefetch" href="/notes/assets/webpackPublic.html.ec37b3f0.js"><link rel="prefetch" href="/notes/assets/weird.html.26aa839f.js"><link rel="prefetch" href="/notes/assets/es10News.html.291746c2.js"><link rel="prefetch" href="/notes/assets/es11News.html.8eff96d2.js"><link rel="prefetch" href="/notes/assets/es6Interview1.html.2b11b6e0.js"><link rel="prefetch" href="/notes/assets/es6Interview2.html.2b98737a.js"><link rel="prefetch" href="/notes/assets/es6Interview3.html.9ccf5fb1.js"><link rel="prefetch" href="/notes/assets/es6News.html.a9d31612.js"><link rel="prefetch" href="/notes/assets/es7News.html.9b4781b3.js"><link rel="prefetch" href="/notes/assets/es8News.html.9307577a.js"><link rel="prefetch" href="/notes/assets/es9News.html.6ac1e35c.js"><link rel="prefetch" href="/notes/assets/base.html.4c28f783.js"><link rel="prefetch" href="/notes/assets/nginxComprehensiveScene.html.f320dc2a.js"><link rel="prefetch" href="/notes/assets/commonlyUsed.html.3492e665.js"><link rel="prefetch" href="/notes/assets/inelegantHook.html.b55d7207.js"><link rel="prefetch" href="/notes/assets/interview1.html.2e20a58d.js"><link rel="prefetch" href="/notes/assets/interview2.html.9f5ee4a9.js"><link rel="prefetch" href="/notes/assets/interview3.html.c36fc333.js"><link rel="prefetch" href="/notes/assets/interview4.html.e024e4f1.js"><link rel="prefetch" href="/notes/assets/base.html.ad052a66.js"><link rel="prefetch" href="/notes/assets/introduction.html.5494f7c1.js"><link rel="prefetch" href="/notes/assets/base.html.d6e33357.js"><link rel="prefetch" href="/notes/assets/summarize.html.ad4e1588.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.6fc18be1.js"><link rel="prefetch" href="/notes/assets/index.html.dd06691f.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.675a8c87.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.78dd0170.js"><link rel="prefetch" href="/notes/assets/bigDataRender.html.d1f6216b.js"><link rel="prefetch" href="/notes/assets/progress.html.c7533ef6.js"><link rel="prefetch" href="/notes/assets/quirksStandards.html.1cab042f.js"><link rel="prefetch" href="/notes/assets/redrawReflow.html.2c7ff78e.js"><link rel="prefetch" href="/notes/assets/storageSpace.html.f29e9739.js"><link rel="prefetch" href="/notes/assets/webComLink.html.f667a10d.js"><link rel="prefetch" href="/notes/assets/webUrl.html.a93630bb.js"><link rel="prefetch" href="/notes/assets/spanWidthHeight.html.e4ad25d8.js"><link rel="prefetch" href="/notes/assets/baseCss.html.ec237054.js"><link rel="prefetch" href="/notes/assets/blockFormattingContext.html.9ab811ce.js"><link rel="prefetch" href="/notes/assets/containingBlock.html.9e23e696.js"><link rel="prefetch" href="/notes/assets/cssBeforeAfter.html.502b8b57.js"><link rel="prefetch" href="/notes/assets/cssBoxModal.html.cbe3c632.js"><link rel="prefetch" href="/notes/assets/cssCollapsing.html.a7d77cae.js"><link rel="prefetch" href="/notes/assets/cssCompatible.html.2377bc79.js"><link rel="prefetch" href="/notes/assets/cssFlexDemo.html.3eaeadc9.js"><link rel="prefetch" href="/notes/assets/cssFlexLayout.html.fc0f35eb.js"><link rel="prefetch" href="/notes/assets/cssGridLayout.html.8a22c979.js"><link rel="prefetch" href="/notes/assets/cssHack.html.3acfa041.js"><link rel="prefetch" href="/notes/assets/cssInlineBlock.html.3c2bf647.js"><link rel="prefetch" href="/notes/assets/cssPriority.html.20999d4d.js"><link rel="prefetch" href="/notes/assets/cssPseudo.html.10c6046c.js"><link rel="prefetch" href="/notes/assets/cssPseudoClass.html.1efe0528.js"><link rel="prefetch" href="/notes/assets/cssSelector.html.4c005d78.js"><link rel="prefetch" href="/notes/assets/cssTutorial.html.e9db71fd.js"><link rel="prefetch" href="/notes/assets/fieldInvalid.html.c03e5356.js"><link rel="prefetch" href="/notes/assets/frame.html.a01f241f.js"><link rel="prefetch" href="/notes/assets/knowledgePoints.html.63fc8117.js"><link rel="prefetch" href="/notes/assets/linkImport.html.c753a459.js"><link rel="prefetch" href="/notes/assets/stackingContext.html.61c46214.js"><link rel="prefetch" href="/notes/assets/tools.html.053a5b49.js"><link rel="prefetch" href="/notes/assets/units.html.b9e11db9.js"><link rel="prefetch" href="/notes/assets/transform.html.344d9c0e.js"><link rel="prefetch" href="/notes/assets/content.html.07e14491.js"><link rel="prefetch" href="/notes/assets/plugins.html.574ca307.js"><link rel="prefetch" href="/notes/assets/accesskey.html.bf424b11.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.adab2861.js"><link rel="prefetch" href="/notes/assets/canvasSvg.html.87df6fba.js"><link rel="prefetch" href="/notes/assets/deviceAPI.html.bf65293f.js"><link rel="prefetch" href="/notes/assets/globalAttr.html.f4ac6831.js"><link rel="prefetch" href="/notes/assets/htmlDatalist.html.3f218328.js"><link rel="prefetch" href="/notes/assets/htmlElement.html.d7b24e52.js"><link rel="prefetch" href="/notes/assets/interview10.html.89a58f87.js"><link rel="prefetch" href="/notes/assets/interview11.html.b7962668.js"><link rel="prefetch" href="/notes/assets/interview12.html.85c95a5c.js"><link rel="prefetch" href="/notes/assets/interview13.html.88df657a.js"><link rel="prefetch" href="/notes/assets/interview14.html.39d2f828.js"><link rel="prefetch" href="/notes/assets/interview15.html.aaef0b52.js"><link rel="prefetch" href="/notes/assets/interview16.html.ff167a6b.js"><link rel="prefetch" href="/notes/assets/interview17.html.c9001163.js"><link rel="prefetch" href="/notes/assets/interview18.html.880e3d1e.js"><link rel="prefetch" href="/notes/assets/interview19.html.1958d466.js"><link rel="prefetch" href="/notes/assets/interview20.html.21e48354.js"><link rel="prefetch" href="/notes/assets/interview21.html.6023e07c.js"><link rel="prefetch" href="/notes/assets/interview22.html.4677d656.js"><link rel="prefetch" href="/notes/assets/interview23.html.b8220b4c.js"><link rel="prefetch" href="/notes/assets/interview24.html.7f19c01b.js"><link rel="prefetch" href="/notes/assets/interview25.html.9ac61831.js"><link rel="prefetch" href="/notes/assets/interview26.html.377dde62.js"><link rel="prefetch" href="/notes/assets/interview27.html.5e98aced.js"><link rel="prefetch" href="/notes/assets/interview28.html.c1bfe472.js"><link rel="prefetch" href="/notes/assets/interview29.html.f741b535.js"><link rel="prefetch" href="/notes/assets/interview30.html.9696b49d.js"><link rel="prefetch" href="/notes/assets/interview31.html.4119a1a0.js"><link rel="prefetch" href="/notes/assets/interview32.html.117b8ee8.js"><link rel="prefetch" href="/notes/assets/interview33.html.f8e21947.js"><link rel="prefetch" href="/notes/assets/interview34.html.535144fb.js"><link rel="prefetch" href="/notes/assets/interview35.html.f2e76b28.js"><link rel="prefetch" href="/notes/assets/interview36.html.1f550f8d.js"><link rel="prefetch" href="/notes/assets/interview37.html.4000dac3.js"><link rel="prefetch" href="/notes/assets/interview38.html.e91632bf.js"><link rel="prefetch" href="/notes/assets/interview39.html.21e7baea.js"><link rel="prefetch" href="/notes/assets/interview40.html.f785a5f6.js"><link rel="prefetch" href="/notes/assets/interview41.html.73f4f84b.js"><link rel="prefetch" href="/notes/assets/interview42.html.d3d3e9ce.js"><link rel="prefetch" href="/notes/assets/interview43.html.5d63065b.js"><link rel="prefetch" href="/notes/assets/interview44.html.b19a4028.js"><link rel="prefetch" href="/notes/assets/interview45.html.9b8cda30.js"><link rel="prefetch" href="/notes/assets/interview46.html.24f10f5a.js"><link rel="prefetch" href="/notes/assets/interview47.html.f751d2f0.js"><link rel="prefetch" href="/notes/assets/interview48.html.12a690e2.js"><link rel="prefetch" href="/notes/assets/interview49.html.b4be6982.js"><link rel="prefetch" href="/notes/assets/interview5.html.3a3f66f3.js"><link rel="prefetch" href="/notes/assets/interview50.html.45a1a5cd.js"><link rel="prefetch" href="/notes/assets/interview51.html.19354eb8.js"><link rel="prefetch" href="/notes/assets/interview52.html.efd71ae9.js"><link rel="prefetch" href="/notes/assets/interview53.html.9e229722.js"><link rel="prefetch" href="/notes/assets/interview54.html.3ead9d6a.js"><link rel="prefetch" href="/notes/assets/interview55.html.473afc35.js"><link rel="prefetch" href="/notes/assets/interview56.html.7dfbd31d.js"><link rel="prefetch" href="/notes/assets/interview57.html.94e1e9b1.js"><link rel="prefetch" href="/notes/assets/interview58.html.31f24461.js"><link rel="prefetch" href="/notes/assets/interview59.html.4ed31be6.js"><link rel="prefetch" href="/notes/assets/interview6.html.f07f88a0.js"><link rel="prefetch" href="/notes/assets/interview7.html.747e06ec.js"><link rel="prefetch" href="/notes/assets/interview8.html.7b389f23.js"><link rel="prefetch" href="/notes/assets/interview9.html.a5375e9d.js"><link rel="prefetch" href="/notes/assets/linkImport.html.21b8f92b.js"><link rel="prefetch" href="/notes/assets/offlineStorage.html.2dbcc5e3.js"><link rel="prefetch" href="/notes/assets/regular.html.08ba75e6.js"><link rel="prefetch" href="/notes/assets/shake.html.6f9e1c10.js"><link rel="prefetch" href="/notes/assets/webWorker.html.b711262e.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.49e07d77.js"><link rel="prefetch" href="/notes/assets/cors.html.85e40ac6.js"><link rel="prefetch" href="/notes/assets/crossDomainCookie.html.29b16251.js"><link rel="prefetch" href="/notes/assets/fetch.html.601d2dea.js"><link rel="prefetch" href="/notes/assets/nestAxios.html.4d4fb363.js"><link rel="prefetch" href="/notes/assets/debounce.html.f9c9ebe3.js"><link rel="prefetch" href="/notes/assets/lodashPrinciple.html.0b11438b.js"><link rel="prefetch" href="/notes/assets/lodashThrottleDebounce.html.6f7ac4a0.js"><link rel="prefetch" href="/notes/assets/throttle.html.fa956948.js"><link rel="prefetch" href="/notes/assets/throttleDebounceReact.html.902e6e58.js"><link rel="prefetch" href="/notes/assets/cloneIntroduction.html.7e9b7555.js"><link rel="prefetch" href="/notes/assets/deepClone.html.9c670832.js"><link rel="prefetch" href="/notes/assets/lodashDeepClone.html.5d982cc4.js"><link rel="prefetch" href="/notes/assets/objectAssign.html.fd2a8018.js"><link rel="prefetch" href="/notes/assets/arraySourceCode.html.198d518d.js"><link rel="prefetch" href="/notes/assets/baseHigh.html.b6f9a2ec.js"><link rel="prefetch" href="/notes/assets/currying.html.3ae0ed6f.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.095e69bb.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.9c0541d6.js"><link rel="prefetch" href="/notes/assets/iife.html.af8ca19a.js"><link rel="prefetch" href="/notes/assets/interview1.html.9063c7a3.js"><link rel="prefetch" href="/notes/assets/jsCompatible.html.96812c57.js"><link rel="prefetch" href="/notes/assets/baseProyotype.html.0bcddabd.js"><link rel="prefetch" href="/notes/assets/functionObjectResource.html.9c0931e5.js"><link rel="prefetch" href="/notes/assets/prototypeInherit.html.37802d14.js"><link rel="prefetch" href="/notes/assets/closureInterview.html.154b277a.js"><link rel="prefetch" href="/notes/assets/scopeChain.html.01bf2994.js"><link rel="prefetch" href="/notes/assets/understandingClosures.html.65acdf9e.js"><link rel="prefetch" href="/notes/assets/executionStack.html.e929b218.js"><link rel="prefetch" href="/notes/assets/memoryLeak.html.926d804a.js"><link rel="prefetch" href="/notes/assets/memoryMechanism.html.7cd99172.js"><link rel="prefetch" href="/notes/assets/memorySpace.html.c936958b.js"><link rel="prefetch" href="/notes/assets/precompiled.html.679c2302.js"><link rel="prefetch" href="/notes/assets/variableObject.html.637de206.js"><link rel="prefetch" href="/notes/assets/arrowFunctionThis.html.464b1960.js"><link rel="prefetch" href="/notes/assets/bindSimulation.html.1caac5bf.js"><link rel="prefetch" href="/notes/assets/callApply.html.04d662f8.js"><link rel="prefetch" href="/notes/assets/newSimulation.html.fa412734.js"><link rel="prefetch" href="/notes/assets/thisBind.html.30924f25.js"><link rel="prefetch" href="/notes/assets/interview1.html.fcb31793.js"><link rel="prefetch" href="/notes/assets/interview10.html.d3e7493d.js"><link rel="prefetch" href="/notes/assets/interview11.html.18a56544.js"><link rel="prefetch" href="/notes/assets/interview12.html.99321eaf.js"><link rel="prefetch" href="/notes/assets/interview13.html.44b1476b.js"><link rel="prefetch" href="/notes/assets/interview14.html.45b2c26a.js"><link rel="prefetch" href="/notes/assets/interview15.html.0d81e102.js"><link rel="prefetch" href="/notes/assets/interview16.html.688d10d3.js"><link rel="prefetch" href="/notes/assets/interview17.html.3e54c07c.js"><link rel="prefetch" href="/notes/assets/interview18.html.a371161d.js"><link rel="prefetch" href="/notes/assets/interview19.html.27acdd64.js"><link rel="prefetch" href="/notes/assets/interview2.html.15df2cfb.js"><link rel="prefetch" href="/notes/assets/interview20.html.354c37ba.js"><link rel="prefetch" href="/notes/assets/interview21.html.40979faa.js"><link rel="prefetch" href="/notes/assets/interview22.html.bb445fc9.js"><link rel="prefetch" href="/notes/assets/interview23.html.a8e75836.js"><link rel="prefetch" href="/notes/assets/interview24.html.409c61a5.js"><link rel="prefetch" href="/notes/assets/interview25.html.1843ea8d.js"><link rel="prefetch" href="/notes/assets/interview26.html.f4ca513a.js"><link rel="prefetch" href="/notes/assets/interview27.html.fc367e09.js"><link rel="prefetch" href="/notes/assets/interview28.html.7402b5d2.js"><link rel="prefetch" href="/notes/assets/interview29.html.0dde0c88.js"><link rel="prefetch" href="/notes/assets/interview3.html.d4dfc1cc.js"><link rel="prefetch" href="/notes/assets/interview30.html.be7e9c89.js"><link rel="prefetch" href="/notes/assets/interview4.html.9ae3190b.js"><link rel="prefetch" href="/notes/assets/interview5.html.25c7953c.js"><link rel="prefetch" href="/notes/assets/interview6.html.23353288.js"><link rel="prefetch" href="/notes/assets/interview7.html.ee377fc3.js"><link rel="prefetch" href="/notes/assets/interview8.html.9bcae03d.js"><link rel="prefetch" href="/notes/assets/interview9.html.55c4e196.js"><link rel="prefetch" href="/notes/assets/adjacentSiblingCombinator.html.07f34992.js"><link rel="prefetch" href="/notes/assets/attributeSelectors.html.ce90852c.js"><link rel="prefetch" href="/notes/assets/charset.html.078dbfdb.js"><link rel="prefetch" href="/notes/assets/childCombinator.html.4ff9d830.js"><link rel="prefetch" href="/notes/assets/classSelectors.html.6b949801.js"><link rel="prefetch" href="/notes/assets/descendantCombinator.html.fb2c8962.js"><link rel="prefetch" href="/notes/assets/generalSiblingCombinator.html.0fd2d0c6.js"><link rel="prefetch" href="/notes/assets/iDSelectors.html.39037901.js"><link rel="prefetch" href="/notes/assets/pseudoClasses.html.25d078a3.js"><link rel="prefetch" href="/notes/assets/pseudoElements.html.8dc0191a.js"><link rel="prefetch" href="/notes/assets/selectorList.html.6fe90e0a.js"><link rel="prefetch" href="/notes/assets/typeSelectors.html.b491ac5f.js"><link rel="prefetch" href="/notes/assets/universalSelectors.html.816f3c7b.js"><link rel="prefetch" href="/notes/assets/IterationProtocols.html.7d48aa19.js"><link rel="prefetch" href="/notes/assets/arrayFlat.html.5fa02b31.js"><link rel="prefetch" href="/notes/assets/asyncHistory.html.8dce6d6c.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.a507c544.js"><link rel="prefetch" href="/notes/assets/fileReader.html.28b32ac8.js"><link rel="prefetch" href="/notes/assets/formData.html.36930f6c.js"><link rel="prefetch" href="/notes/assets/functionGenerator.html.c22d434a.js"><link rel="prefetch" href="/notes/assets/generator.html.fa79ded8.js"><link rel="prefetch" href="/notes/assets/intersectionObserver.html.d0a34581.js"><link rel="prefetch" href="/notes/assets/map.html.1c60889c.js"><link rel="prefetch" href="/notes/assets/promise.html.0d3e87d5.js"><link rel="prefetch" href="/notes/assets/set.html.6c24d5c7.js"><link rel="prefetch" href="/notes/assets/string.html.5ba9d368.js"><link rel="prefetch" href="/notes/assets/symbol.html.6fdbbd29.js"><link rel="prefetch" href="/notes/assets/xMLHttpRequest.html.33d4ce2a.js"><link rel="prefetch" href="/notes/assets/spreadSyntax.html.f3c9ea47.js"><link rel="prefetch" href="/notes/assets/strictMode.html.e8207ff6.js"><link rel="prefetch" href="/notes/assets/cache.html.4940d7b2.js"><link rel="prefetch" href="/notes/assets/drag1.html.afd4ea62.js"><link rel="prefetch" href="/notes/assets/oneLineCode.html.55bfff06.js"><link rel="prefetch" href="/notes/assets/oneLineCodeArray.html.bedca4e8.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDOM.html.80aa1194.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDateTime.html.ac4e9ccb.js"><link rel="prefetch" href="/notes/assets/oneLineCodeFunction.html.84c7454e.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMath.html.5742ddd7.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMisc.html.0cb08be7.js"><link rel="prefetch" href="/notes/assets/oneLineCodeNumber.html.f0aa314e.js"><link rel="prefetch" href="/notes/assets/oneLineCodeObject.html.245a76f8.js"><link rel="prefetch" href="/notes/assets/oneLineCodeRandom.html.d3e82fdf.js"><link rel="prefetch" href="/notes/assets/oneLineCodeString.html.f6633104.js"><link rel="prefetch" href="/notes/assets/oneLineCodeValidator.html.aa3f2d2a.js"><link rel="prefetch" href="/notes/assets/typeScriptCache.html.039f0904.js"><link rel="prefetch" href="/notes/assets/reactBase.html.552b6769.js"><link rel="prefetch" href="/notes/assets/reactTypescript.html.93bff7eb.js"><link rel="prefetch" href="/notes/assets/vue2Base.html.4b24158e.js"><link rel="prefetch" href="/notes/assets/vue2Table.html.2318d76c.js"><link rel="prefetch" href="/notes/assets/vue2offsetTop.html.bfdac791.js"><link rel="prefetch" href="/notes/assets/componentWillXXX.html.d91a05e2.js"><link rel="prefetch" href="/notes/assets/disrupt.html.5ef7dcea.js"><link rel="prefetch" href="/notes/assets/lane.html.9b262dfe.js"><link rel="prefetch" href="/notes/assets/prepare.html.87381a22.js"><link rel="prefetch" href="/notes/assets/redux.html.4f7d6c76.js"><link rel="prefetch" href="/notes/assets/scheduler.html.3c27a810.js"><link rel="prefetch" href="/notes/assets/multi.html.99533875.js"><link rel="prefetch" href="/notes/assets/one.html.b16c51c1.js"><link rel="prefetch" href="/notes/assets/prepare.html.3385c4d6.js"><link rel="prefetch" href="/notes/assets/create.html.0ab7996b.js"><link rel="prefetch" href="/notes/assets/prepare.html.91332b0b.js"><link rel="prefetch" href="/notes/assets/structure.html.5933ee9d.js"><link rel="prefetch" href="/notes/assets/useeffect.html.f2f6257f.js"><link rel="prefetch" href="/notes/assets/usememo.html.23ce2e2f.js"><link rel="prefetch" href="/notes/assets/useref.html.3eec1369.js"><link rel="prefetch" href="/notes/assets/usestate.html.d4ae4308.js"><link rel="prefetch" href="/notes/assets/file.html.8851f09a.js"><link rel="prefetch" href="/notes/assets/idea.html.3ef26f24.js"><link rel="prefetch" href="/notes/assets/jsx.html.37b1b037.js"><link rel="prefetch" href="/notes/assets/newConstructure.html.becdd02d.js"><link rel="prefetch" href="/notes/assets/oldConstructure.html.b667b873.js"><link rel="prefetch" href="/notes/assets/source.html.e172df48.js"><link rel="prefetch" href="/notes/assets/summary.html.cf5b0199.js"><link rel="prefetch" href="/notes/assets/basePrinciple.html.10653078.js"><link rel="prefetch" href="/notes/assets/componentApi.html.315ee627.js"><link rel="prefetch" href="/notes/assets/domApi.html.415f4315.js"><link rel="prefetch" href="/notes/assets/hoc.html.1d76d049.js"><link rel="prefetch" href="/notes/assets/hookApi.html.0d83a935.js"><link rel="prefetch" href="/notes/assets/hookCustom.html.fda10772.js"><link rel="prefetch" href="/notes/assets/hookPrinciple.html.6f4d0ebd.js"><link rel="prefetch" href="/notes/assets/hookUse.html.ead46266.js"><link rel="prefetch" href="/notes/assets/reactKeeplive.html.30cd74b5.js"><link rel="prefetch" href="/notes/assets/reactRedux.html.677fb4e0.js"><link rel="prefetch" href="/notes/assets/reactRouter.html.1cef54c7.js"><link rel="prefetch" href="/notes/assets/toolApi.html.99668bba.js"><link rel="prefetch" href="/notes/assets/beginWork.html.7a33c00f.js"><link rel="prefetch" href="/notes/assets/completeWork.html.2035893d.js"><link rel="prefetch" href="/notes/assets/doubleBuffer.html.cc4445bd.js"><link rel="prefetch" href="/notes/assets/fiber-mental.html.4dfd8f47.js"><link rel="prefetch" href="/notes/assets/fiber.html.52caaab5.js"><link rel="prefetch" href="/notes/assets/reconciler.html.9699e007.js"><link rel="prefetch" href="/notes/assets/beforeMutation.html.33716e1b.js"><link rel="prefetch" href="/notes/assets/layout.html.a14b1eed.js"><link rel="prefetch" href="/notes/assets/mutation.html.f7e1003d.js"><link rel="prefetch" href="/notes/assets/prepare.html.ddc74f37.js"><link rel="prefetch" href="/notes/assets/mental.html.14317c32.js"><link rel="prefetch" href="/notes/assets/prepare.html.3ca09907.js"><link rel="prefetch" href="/notes/assets/priority.html.26fe7059.js"><link rel="prefetch" href="/notes/assets/reactdom.html.c2db9055.js"><link rel="prefetch" href="/notes/assets/setstate.html.b94928c4.js"><link rel="prefetch" href="/notes/assets/update.html.c22aefc2.js"><link rel="prefetch" href="/notes/assets/bitfiled.html.617d13be.js"><link rel="prefetch" href="/notes/assets/dfs.html.ec91a986.js"><link rel="prefetch" href="/notes/assets/diff.html.cc4104fd.js"><link rel="prefetch" href="/notes/assets/heapsort.html.f7d22f26.js"><link rel="prefetch" href="/notes/assets/linkedlist.html.5d65c236.js"><link rel="prefetch" href="/notes/assets/stack.html.bd0c161f.js"><link rel="prefetch" href="/notes/assets/bootstrap.html.88423719.js"><link rel="prefetch" href="/notes/assets/context.html.c7443262.js"><link rel="prefetch" href="/notes/assets/fibertree-commit.html.838d32d9.js"><link rel="prefetch" href="/notes/assets/fibertree-create.html.b7f49839.js"><link rel="prefetch" href="/notes/assets/fibertree-prepare.html.8d41cc2e.js"><link rel="prefetch" href="/notes/assets/fibertree-update.html.0d18b903.js"><link rel="prefetch" href="/notes/assets/hook-effect.html.0f255dcd.js"><link rel="prefetch" href="/notes/assets/hook-state.html.f8558f5d.js"><link rel="prefetch" href="/notes/assets/hook-summary.html.61a205c0.js"><link rel="prefetch" href="/notes/assets/macro-structure.html.fbf7eef1.js"><link rel="prefetch" href="/notes/assets/object-structure.html.edd9c1b5.js"><link rel="prefetch" href="/notes/assets/priority.html.5439c4ff.js"><link rel="prefetch" href="/notes/assets/reconciler-workflow.html.e0bbcc08.js"><link rel="prefetch" href="/notes/assets/scheduler.html.10c55373.js"><link rel="prefetch" href="/notes/assets/state-effects.html.e60ede50.js"><link rel="prefetch" href="/notes/assets/synthetic-event.html.d0770b3a.js"><link rel="prefetch" href="/notes/assets/workloop.html.13b1a682.js"><link rel="prefetch" href="/notes/assets/ast.html.d21023b0.js"><link rel="prefetch" href="/notes/assets/binder.html.a2714bf7.js"><link rel="prefetch" href="/notes/assets/checker.html.24906eb0.js"><link rel="prefetch" href="/notes/assets/emitter.html.b1029e01.js"><link rel="prefetch" href="/notes/assets/overview.html.19eebc00.js"><link rel="prefetch" href="/notes/assets/parser.html.2d94d647.js"><link rel="prefetch" href="/notes/assets/program.html.4db1161d.js"><link rel="prefetch" href="/notes/assets/scanner.html.c2c24c94.js"><link rel="prefetch" href="/notes/assets/common.html.8eba1020.js"><link rel="prefetch" href="/notes/assets/interpreting.html.30f91541.js"><link rel="prefetch" href="/notes/assets/class.html.5ae13692.js"><link rel="prefetch" href="/notes/assets/commandline-behavior.html.0473e087.js"><link rel="prefetch" href="/notes/assets/comments.html.65dd32cd.js"><link rel="prefetch" href="/notes/assets/common-bug-not-bugs.html.43a82661.js"><link rel="prefetch" href="/notes/assets/common-feature-request.html.b1331da1.js"><link rel="prefetch" href="/notes/assets/decorators.html.17216663.js"><link rel="prefetch" href="/notes/assets/enums.html.3fc69842.js"><link rel="prefetch" href="/notes/assets/function.html.e1d07c96.js"><link rel="prefetch" href="/notes/assets/generics.html.0b7a519c.js"><link rel="prefetch" href="/notes/assets/glossary-and-terms.html.ce339703.js"><link rel="prefetch" href="/notes/assets/jsx-and-react.html.32a80645.js"><link rel="prefetch" href="/notes/assets/modules.html.af19d0f1.js"><link rel="prefetch" href="/notes/assets/thing-that-dont-work.html.fc69aaa7.js"><link rel="prefetch" href="/notes/assets/tsconfig-behavior.html.6a2d0189.js"><link rel="prefetch" href="/notes/assets/type-guards.html.d21e2a7d.js"><link rel="prefetch" href="/notes/assets/type-system-behavior.html.0e39b791.js"><link rel="prefetch" href="/notes/assets/nonReactJSX.html.19eab2c4.js"><link rel="prefetch" href="/notes/assets/reactJSX.html.fd2bb738.js"><link rel="prefetch" href="/notes/assets/support.html.cb016cd3.js"><link rel="prefetch" href="/notes/assets/typescript-3.7.html.2fac1e82.js"><link rel="prefetch" href="/notes/assets/typescript-3.8.html.a220982d.js"><link rel="prefetch" href="/notes/assets/typescript-3.9.html.6167b329.js"><link rel="prefetch" href="/notes/assets/compilationContext.html.bbad3955.js"><link rel="prefetch" href="/notes/assets/declarationspaces.html.3bd1aac8.js"><link rel="prefetch" href="/notes/assets/dynamicImportExpressions.html.12ca7d94.js"><link rel="prefetch" href="/notes/assets/inDepthTs.html.41bd2192.js"><link rel="prefetch" href="/notes/assets/modules.html.a6bcaddb.js"><link rel="prefetch" href="/notes/assets/namespaces.html.4bb82e1a.js"><link rel="prefetch" href="/notes/assets/unknownAny.html.f557d28e.js"><link rel="prefetch" href="/notes/assets/avoidExportDefault.html.82c3363f.js"><link rel="prefetch" href="/notes/assets/barrel.html.ec59a7f8.js"><link rel="prefetch" href="/notes/assets/bind.html.f576f83b.js"><link rel="prefetch" href="/notes/assets/buildToggles.html.4c044ce6.js"><link rel="prefetch" href="/notes/assets/classAreUseful.html.4a58ec93.js"><link rel="prefetch" href="/notes/assets/covarianceAndContravariance.html.992ff90f.js"><link rel="prefetch" href="/notes/assets/createArrays.html.72326f33.js"><link rel="prefetch" href="/notes/assets/curry.html.0a0a4a8e.js"><link rel="prefetch" href="/notes/assets/functionParameters.html.4779bba1.js"><link rel="prefetch" href="/notes/assets/infer.html.f0f8f422.js"><link rel="prefetch" href="/notes/assets/lazyObjectLiteralInitialization.html.9d27e86b.js"><link rel="prefetch" href="/notes/assets/limitPropertySetters.html.d7fb2131.js"><link rel="prefetch" href="/notes/assets/metadata.html.09b09148.js"><link rel="prefetch" href="/notes/assets/nominalTyping.html.06f4c02c.js"><link rel="prefetch" href="/notes/assets/outFileCaution.html.1b1564f3.js"><link rel="prefetch" href="/notes/assets/singletonPatern.html.93fe6c2e.js"><link rel="prefetch" href="/notes/assets/statefulFunctions.html.acc67a02.js"><link rel="prefetch" href="/notes/assets/staticConstructors.html.1f2ea4dd.js"><link rel="prefetch" href="/notes/assets/stringBasedEmuns.html.9cf73254.js"><link rel="prefetch" href="/notes/assets/truthy.html.7b3d8315.js"><link rel="prefetch" href="/notes/assets/typeInstantiation.html.03ce0207.js"><link rel="prefetch" href="/notes/assets/typesafeEventEmitter.html.fed58529.js"><link rel="prefetch" href="/notes/assets/ambient.html.b80ddcae.js"><link rel="prefetch" href="/notes/assets/callable.html.e9d545d6.js"><link rel="prefetch" href="/notes/assets/discrominatedUnion.html.ff3dcf08.js"><link rel="prefetch" href="/notes/assets/enums.html.22190da6.js"><link rel="prefetch" href="/notes/assets/exceptionsHanding.html.8504963b.js"><link rel="prefetch" href="/notes/assets/freshness.html.64e8a122.js"><link rel="prefetch" href="/notes/assets/functions.html.13d15914.js"><link rel="prefetch" href="/notes/assets/generices.html.b6921a89.js"><link rel="prefetch" href="/notes/assets/indexSignatures.html.13d6d22b.js"><link rel="prefetch" href="/notes/assets/interfaces.html.d45c37f0.js"><link rel="prefetch" href="/notes/assets/lib.html.4beff787.js"><link rel="prefetch" href="/notes/assets/literals.html.3f2f849c.js"><link rel="prefetch" href="/notes/assets/migrating.html.339ba887.js"><link rel="prefetch" href="/notes/assets/mixins.html.7b55b989.js"><link rel="prefetch" href="/notes/assets/movingTypes.html.38aa51b0.js"><link rel="prefetch" href="/notes/assets/neverType.html.75619579.js"><link rel="prefetch" href="/notes/assets/overview.html.d10a6a35.js"><link rel="prefetch" href="/notes/assets/readonly.html.28810593.js"><link rel="prefetch" href="/notes/assets/thisType.html.47c0c223.js"><link rel="prefetch" href="/notes/assets/typeAssertion.html.87d528f7.js"><link rel="prefetch" href="/notes/assets/typeCompatibility.html.9c3c7d06.js"><link rel="prefetch" href="/notes/assets/typeGuard.html.317bac98.js"><link rel="prefetch" href="/notes/assets/typeInference.html.8f05f6c3.js"><link rel="prefetch" href="/notes/assets/types.html.d19cc157.js"><link rel="prefetch" href="/notes/assets/pluginDva.html.d1d9e748.js"><link rel="prefetch" href="/notes/assets/pluginQiankun.html.7dab7334.js"><link rel="prefetch" href="/notes/assets/codegen.html.1735e461.js"><link rel="prefetch" href="/notes/assets/entrance.html.266225da.js"><link rel="prefetch" href="/notes/assets/optimize.html.674b11b3.js"><link rel="prefetch" href="/notes/assets/outline.html.ae40e5c4.js"><link rel="prefetch" href="/notes/assets/parse.html.f64a2d11.js"><link rel="prefetch" href="/notes/assets/async-component.html.28d5d444.js"><link rel="prefetch" href="/notes/assets/component-register.html.b65135c0.js"><link rel="prefetch" href="/notes/assets/create-component.html.6ab6521e.js"><link rel="prefetch" href="/notes/assets/lifecycle.html.8d7a96ae.js"><link rel="prefetch" href="/notes/assets/merge-option.html.fce5ab83.js"><link rel="prefetch" href="/notes/assets/outline.html.a8e7fe79.js"><link rel="prefetch" href="/notes/assets/patch.html.24db82cb.js"><link rel="prefetch" href="/notes/assets/_index.html.e07c74b0.js"><link rel="prefetch" href="/notes/assets/create-element.html.2f8cf81c.js"><link rel="prefetch" href="/notes/assets/mounted.html.e3474385.js"><link rel="prefetch" href="/notes/assets/new-vue.html.b1d29325.js"><link rel="prefetch" href="/notes/assets/render.html.f1ea2503.js"><link rel="prefetch" href="/notes/assets/update.html.27f64c43.js"><link rel="prefetch" href="/notes/assets/virtual-dom.html.c7b55b01.js"><link rel="prefetch" href="/notes/assets/event.html.b4efa3b2.js"><link rel="prefetch" href="/notes/assets/keep-alive.html.4f803771.js"><link rel="prefetch" href="/notes/assets/outline.html.6a524ae3.js"><link rel="prefetch" href="/notes/assets/slot.html.eaf5c9a4.js"><link rel="prefetch" href="/notes/assets/tansition-group.html.cbb8a3d6.js"><link rel="prefetch" href="/notes/assets/tansition.html.a69ccf5b.js"><link rel="prefetch" href="/notes/assets/v-model.html.63c7fa55.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.0306d961.js"><link rel="prefetch" href="/notes/assets/baseInterviewSecond.html.49263449.js"><link rel="prefetch" href="/notes/assets/componentCommunication.html.1addc104.js"><link rel="prefetch" href="/notes/assets/detailedResponsiveness.html.654fec55.js"><link rel="prefetch" href="/notes/assets/diff.html.5c7a53ac.js"><link rel="prefetch" href="/notes/assets/eventBinding.html.1747d384.js"><link rel="prefetch" href="/notes/assets/eventMechanism.html.62b75039.js"><link rel="prefetch" href="/notes/assets/key.html.48506e77.js"><link rel="prefetch" href="/notes/assets/knowledgeSystem.html.e1447b13.js"><link rel="prefetch" href="/notes/assets/slot.html.a8513190.js"><link rel="prefetch" href="/notes/assets/sourceCodeAsyncDomUpdateNextTick.html.dd364f2d.js"><link rel="prefetch" href="/notes/assets/sourceCodeElementBroadcastDispatch.html.56ebef73.js"><link rel="prefetch" href="/notes/assets/sourceCodeKeepAlive.html.09fa79aa.js"><link rel="prefetch" href="/notes/assets/sourceCodeResponsiveness.html.0da0a55c.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateCompilation.html.de8ecd3e.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateDom.html.3ba45fe7.js"><link rel="prefetch" href="/notes/assets/sourceCodeVuex.html.a33f53db.js"><link rel="prefetch" href="/notes/assets/vNode.html.3fe1ba1a.js"><link rel="prefetch" href="/notes/assets/vNodeDiff.html.94f17e77.js"><link rel="prefetch" href="/notes/assets/build.html.bb96d7fd.js"><link rel="prefetch" href="/notes/assets/directory.html.04a221e0.js"><link rel="prefetch" href="/notes/assets/entrance.html.424b6dd1.js"><link rel="prefetch" href="/notes/assets/flow.html.4b479893.js"><link rel="prefetch" href="/notes/assets/component-update.html.598c84a1.js"><link rel="prefetch" href="/notes/assets/computed-watcher.html.e6150b01.js"><link rel="prefetch" href="/notes/assets/getters.html.2dce3eca.js"><link rel="prefetch" href="/notes/assets/next-tick.html.c306007a.js"><link rel="prefetch" href="/notes/assets/outline.html.26e4b651.js"><link rel="prefetch" href="/notes/assets/props.html.84d728db.js"><link rel="prefetch" href="/notes/assets/questions.html.faae8d87.js"><link rel="prefetch" href="/notes/assets/reactive-object.html.0a684e2e.js"><link rel="prefetch" href="/notes/assets/setters.html.961aafc8.js"><link rel="prefetch" href="/notes/assets/summary.html.c4853ec8.js"><link rel="prefetch" href="/notes/assets/install.html.f509d18f.js"><link rel="prefetch" href="/notes/assets/matcher.html.067ea897.js"><link rel="prefetch" href="/notes/assets/outline.html.a111b655.js"><link rel="prefetch" href="/notes/assets/router.html.fea98cc5.js"><link rel="prefetch" href="/notes/assets/transition-to.html.ebf8d62b.js"><link rel="prefetch" href="/notes/assets/api.html.45043f9b.js"><link rel="prefetch" href="/notes/assets/idex.html.e112457d.js"><link rel="prefetch" href="/notes/assets/init.html.9d2e055b.js"><link rel="prefetch" href="/notes/assets/plugin.html.928c2159.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.4ef068ff.js"><link rel="prefetch" href="/notes/assets/configuration.html.8083a0ca.js"><link rel="prefetch" href="/notes/assets/entryPoints.html.4bea34de.js"><link rel="prefetch" href="/notes/assets/loader.html.68794263.js"><link rel="prefetch" href="/notes/assets/output.html.bae04749.js"><link rel="prefetch" href="/notes/assets/plugin.html.4eeb072b.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.95f30c3f.js"><link rel="prefetch" href="/notes/assets/reactApi.html.2104e776.js"><link rel="prefetch" href="/notes/assets/reactChildren.html.6b7f3068.js"><link rel="prefetch" href="/notes/assets/reactElement.html.08b2978f.js"><link rel="prefetch" href="/notes/assets/reactFiber.html.f919a48c.js"><link rel="prefetch" href="/notes/assets/commitAllHostEffects.html.7b11170a.js"><link rel="prefetch" href="/notes/assets/commitAllLifeCycles.html.16da4023.js"><link rel="prefetch" href="/notes/assets/commitBeforeMutationLifecycles.html.5ba39311.js"><link rel="prefetch" href="/notes/assets/commitDeletion.html.f742b166.js"><link rel="prefetch" href="/notes/assets/commitPlacement.html.b4775d16.js"><link rel="prefetch" href="/notes/assets/commitRoot.html.2bf6c1ca.js"><link rel="prefetch" href="/notes/assets/commitWork.html.dc3ab2b1.js"><link rel="prefetch" href="/notes/assets/invokeGuardedCallback.html.f5292698.js"><link rel="prefetch" href="/notes/assets/expirationTime.html.b8a67046.js"><link rel="prefetch" href="/notes/assets/reactDomRender.html.0b76fdb9.js"><link rel="prefetch" href="/notes/assets/setStateForceUpdate.html.a5023b8b.js"><link rel="prefetch" href="/notes/assets/context.html.5041dfce.js"><link rel="prefetch" href="/notes/assets/evenInit.html.2cd645a3.js"><link rel="prefetch" href="/notes/assets/eventBind.html.e37dd4c9.js"><link rel="prefetch" href="/notes/assets/eventCreateEventObject.html.fb328078.js"><link rel="prefetch" href="/notes/assets/eventDispath.html.f6f045bb.js"><link rel="prefetch" href="/notes/assets/hydrate.html.b74fb015.js"><link rel="prefetch" href="/notes/assets/ref.html.6898834e.js"><link rel="prefetch" href="/notes/assets/suspense.html.7b33e91d.js"><link rel="prefetch" href="/notes/assets/suspenseLazy.html.b0f2aa2c.js"><link rel="prefetch" href="/notes/assets/suspenseWork.html.e275034c.js"><link rel="prefetch" href="/notes/assets/hooksCommon.html.597fcea1.js"><link rel="prefetch" href="/notes/assets/hooksOther.html.de33223b.js"><link rel="prefetch" href="/notes/assets/start.html.dc53f83a.js"><link rel="prefetch" href="/notes/assets/useEffect.html.4cde9c87.js"><link rel="prefetch" href="/notes/assets/useState.html.8bbec48b.js"><link rel="prefetch" href="/notes/assets/base.html.5440e744.js"><link rel="prefetch" href="/notes/assets/commpontDiff.html.d7104fc7.js"><link rel="prefetch" href="/notes/assets/componentUpdate.html.59d0e27d.js"><link rel="prefetch" href="/notes/assets/renderProcess.html.2f886f53.js"><link rel="prefetch" href="/notes/assets/schedulingPrinciple.html.160d98cd.js"><link rel="prefetch" href="/notes/assets/beginWork.html.e8a4ae65.js"><link rel="prefetch" href="/notes/assets/globalVariable.html.cebaa128.js"><link rel="prefetch" href="/notes/assets/mountIndeterminateComponent.html.85755a9e.js"><link rel="prefetch" href="/notes/assets/mountLazyCompont.html.44e8bfbb.js"><link rel="prefetch" href="/notes/assets/performUnitOfWork.html.c236e137.js"><link rel="prefetch" href="/notes/assets/performWork.html.111cb729.js"><link rel="prefetch" href="/notes/assets/reactScheduler.html.8034a0cb.js"><link rel="prefetch" href="/notes/assets/reconcileChildren.html.f5a21cb0.js"><link rel="prefetch" href="/notes/assets/reconcileChildrenArray.html.aa74cf86.js"><link rel="prefetch" href="/notes/assets/reconcileSingleElement.html.b360dbc7.js"><link rel="prefetch" href="/notes/assets/renderRoot.html.b1d0c1be.js"><link rel="prefetch" href="/notes/assets/scheduleWork.html.28b4d5db.js"><link rel="prefetch" href="/notes/assets/throwException.html.269ae6a0.js"><link rel="prefetch" href="/notes/assets/updateClassComponent.html.1c51bd3d.js"><link rel="prefetch" href="/notes/assets/updateContextConsumer.html.bd5557fb.js"><link rel="prefetch" href="/notes/assets/updateContextProvider.html.191c8bfe.js"><link rel="prefetch" href="/notes/assets/updateForwardRef.html.98f2c65a.js"><link rel="prefetch" href="/notes/assets/updateFragment.html.eee79c9e.js"><link rel="prefetch" href="/notes/assets/updateFunctionalComponent.html.2066a73a.js"><link rel="prefetch" href="/notes/assets/updateHostComponent.html.4dcff0e9.js"><link rel="prefetch" href="/notes/assets/updateHostRoot.html.17211a9a.js"><link rel="prefetch" href="/notes/assets/updateHostText.html.177e061d.js"><link rel="prefetch" href="/notes/assets/updateMode.html.94722d4f.js"><link rel="prefetch" href="/notes/assets/updatePortalComponent.html.e52826e9.js"><link rel="prefetch" href="/notes/assets/updateProfiler.html.57117274.js"><link rel="prefetch" href="/notes/assets/updateSuspenseComponent.html.daf8c75d.js"><link rel="prefetch" href="/notes/assets/interview1.html.e77fef8b.js"><link rel="prefetch" href="/notes/assets/interview2.html.efc87d5c.js"><link rel="prefetch" href="/notes/assets/interview3.html.c024243e.js"><link rel="prefetch" href="/notes/assets/interview51.html.5acdd80f.js"><link rel="prefetch" href="/notes/assets/interview52.html.c306af68.js"><link rel="prefetch" href="/notes/assets/interview53.html.34bff16e.js"><link rel="prefetch" href="/notes/assets/interview54.html.09f9341f.js"><link rel="prefetch" href="/notes/assets/interview55.html.0d7b47d6.js"><link rel="prefetch" href="/notes/assets/interview56.html.be5608f7.js"><link rel="prefetch" href="/notes/assets/interview57.html.44dfe8a9.js"><link rel="prefetch" href="/notes/assets/interview1.html.524fe5c8.js"><link rel="prefetch" href="/notes/assets/interview10.html.6b6661d9.js"><link rel="prefetch" href="/notes/assets/interview11.html.de86ffd8.js"><link rel="prefetch" href="/notes/assets/interview12.html.8d04894b.js"><link rel="prefetch" href="/notes/assets/interview13.html.3fd9ed5c.js"><link rel="prefetch" href="/notes/assets/interview14.html.e7757074.js"><link rel="prefetch" href="/notes/assets/interview15.html.004fd17c.js"><link rel="prefetch" href="/notes/assets/interview16.html.eb595a40.js"><link rel="prefetch" href="/notes/assets/interview17.html.fd2aff6c.js"><link rel="prefetch" href="/notes/assets/interview18.html.7145c350.js"><link rel="prefetch" href="/notes/assets/interview19.html.6f06169b.js"><link rel="prefetch" href="/notes/assets/interview2.html.2df5d69d.js"><link rel="prefetch" href="/notes/assets/interview20.html.49c4ff89.js"><link rel="prefetch" href="/notes/assets/interview21.html.cfed4f54.js"><link rel="prefetch" href="/notes/assets/interview22.html.b81d04c7.js"><link rel="prefetch" href="/notes/assets/interview23.html.40d68929.js"><link rel="prefetch" href="/notes/assets/interview24.html.70e31c98.js"><link rel="prefetch" href="/notes/assets/interview25.html.9ff89387.js"><link rel="prefetch" href="/notes/assets/interview26.html.d208a025.js"><link rel="prefetch" href="/notes/assets/interview27.html.a1eaa849.js"><link rel="prefetch" href="/notes/assets/interview28.html.14b7d1bc.js"><link rel="prefetch" href="/notes/assets/interview29.html.a5732620.js"><link rel="prefetch" href="/notes/assets/interview3.html.b7590473.js"><link rel="prefetch" href="/notes/assets/interview30.html.4d4eea82.js"><link rel="prefetch" href="/notes/assets/interview31.html.dc7dae65.js"><link rel="prefetch" href="/notes/assets/interview32.html.c1a7fc28.js"><link rel="prefetch" href="/notes/assets/interview33.html.ac3c1683.js"><link rel="prefetch" href="/notes/assets/interview34.html.df20642e.js"><link rel="prefetch" href="/notes/assets/interview35.html.79db6c5e.js"><link rel="prefetch" href="/notes/assets/interview36.html.b1f05e0e.js"><link rel="prefetch" href="/notes/assets/interview37.html.581db9fd.js"><link rel="prefetch" href="/notes/assets/interview38.html.e19f689d.js"><link rel="prefetch" href="/notes/assets/interview39.html.2de50b2e.js"><link rel="prefetch" href="/notes/assets/interview4.html.52a1ce9f.js"><link rel="prefetch" href="/notes/assets/interview40.html.d1b405eb.js"><link rel="prefetch" href="/notes/assets/interview41.html.a9385882.js"><link rel="prefetch" href="/notes/assets/interview42.html.10af55c0.js"><link rel="prefetch" href="/notes/assets/interview43.html.19a61756.js"><link rel="prefetch" href="/notes/assets/interview44.html.239d098f.js"><link rel="prefetch" href="/notes/assets/interview45.html.7fc33488.js"><link rel="prefetch" href="/notes/assets/interview46.html.398fdf68.js"><link rel="prefetch" href="/notes/assets/interview47.html.69634aec.js"><link rel="prefetch" href="/notes/assets/interview48.html.0d2d4de1.js"><link rel="prefetch" href="/notes/assets/interview49.html.d6d3f786.js"><link rel="prefetch" href="/notes/assets/interview5.html.65dc3fb7.js"><link rel="prefetch" href="/notes/assets/interview50.html.1075a599.js"><link rel="prefetch" href="/notes/assets/interview6.html.437406d4.js"><link rel="prefetch" href="/notes/assets/interview7.html.159a0065.js"><link rel="prefetch" href="/notes/assets/interview8.html.2c17813c.js"><link rel="prefetch" href="/notes/assets/interview9.html.48c5a0ad.js"><link rel="prefetch" href="/notes/assets/404.html.93146c89.js"><link rel="prefetch" href="/notes/assets/index.html.826c4efe.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.d8bbaf0b.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.4fb3c96b.js"><link rel="prefetch" href="/notes/assets/base.html.546a173c.js"><link rel="prefetch" href="/notes/assets/customCli.html.a15c83cc.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.9f16eeaf.js"><link rel="prefetch" href="/notes/assets/adapter.html.9b7fd6b2.js"><link rel="prefetch" href="/notes/assets/amd.html.e675422c.js"><link rel="prefetch" href="/notes/assets/builder.html.c7284f4f.js"><link rel="prefetch" href="/notes/assets/censorJquery.html.279b43b1.js"><link rel="prefetch" href="/notes/assets/combination.html.4651f375.js"><link rel="prefetch" href="/notes/assets/command.html.6b273d60.js"><link rel="prefetch" href="/notes/assets/commonJS.html.4d3889e3.js"><link rel="prefetch" href="/notes/assets/constructor.html.076c347c.js"><link rel="prefetch" href="/notes/assets/decoration.html.8b56a839.js"><link rel="prefetch" href="/notes/assets/esHarmony.html.91b5673b.js"><link rel="prefetch" href="/notes/assets/exposed.html.b22ad7f8.js"><link rel="prefetch" href="/notes/assets/exterior.html.f318771a.js"><link rel="prefetch" href="/notes/assets/factory.html.86802cd3.js"><link rel="prefetch" href="/notes/assets/flyweight.html.d1c1a3db.js"><link rel="prefetch" href="/notes/assets/functionalProgramming.html.20bc5852.js"><link rel="prefetch" href="/notes/assets/intermediary.html.8d717c0a.js"><link rel="prefetch" href="/notes/assets/iterator.html.98730f3b.js"><link rel="prefetch" href="/notes/assets/lazyInitial.html.d175de9f.js"><link rel="prefetch" href="/notes/assets/mixin.html.cfd21b49.js"><link rel="prefetch" href="/notes/assets/module.html.c733f96a.js"><link rel="prefetch" href="/notes/assets/mvc.html.92509703.js"><link rel="prefetch" href="/notes/assets/mvp.html.8ba68eda.js"><link rel="prefetch" href="/notes/assets/mvvm.html.bdc7348f.js"><link rel="prefetch" href="/notes/assets/observer.html.2a40777b.js"><link rel="prefetch" href="/notes/assets/outward.html.c560d197.js"><link rel="prefetch" href="/notes/assets/overview.html.98e27f0a.js"><link rel="prefetch" href="/notes/assets/prototype.html.f403c1a8.js"><link rel="prefetch" href="/notes/assets/proxy.html.68ef1ce7.js"><link rel="prefetch" href="/notes/assets/singleton.html.7d7c87c5.js"><link rel="prefetch" href="/notes/assets/axios.html.dfda8f04.js"><link rel="prefetch" href="/notes/assets/createUnderscore.html.9f75fc81.js"><link rel="prefetch" href="/notes/assets/jquery.html.7a623b1e.js"><link rel="prefetch" href="/notes/assets/lodash.html.2649aa61.js"><link rel="prefetch" href="/notes/assets/sentry.html.eb9a3e9a.js"><link rel="prefetch" href="/notes/assets/underscore.html.7a2a33b7.js"><link rel="prefetch" href="/notes/assets/vuex.html.e8c0523f.js"><link rel="prefetch" href="/notes/assets/customCli.html.1180ccfa.js"><link rel="prefetch" href="/notes/assets/description.html.f3f55d3a.js"><link rel="prefetch" href="/notes/assets/indx.html.1b8f568d.js"><link rel="prefetch" href="/notes/assets/rebase.html.750b9a9c.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.cdb041d5.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.784ea468.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.0bc52fd5.js"><link rel="prefetch" href="/notes/assets/44Questions.html.76c15c5a.js"><link rel="prefetch" href="/notes/assets/asyncAwait.html.03c9a560.js"><link rel="prefetch" href="/notes/assets/babelCompile.html.f8f2cab8.js"><link rel="prefetch" href="/notes/assets/base.html.5f0f32d8.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.263ff16d.js"><link rel="prefetch" href="/notes/assets/baseWebpack.html.da6d5052.js"><link rel="prefetch" href="/notes/assets/codeSeparation.html.0fe827d6.js"><link rel="prefetch" href="/notes/assets/cycle.html.9e270fc8.js"><link rel="prefetch" href="/notes/assets/cycleOtherWay.html.b1995037.js"><link rel="prefetch" href="/notes/assets/executionMechanism.html.712201e9.js"><link rel="prefetch" href="/notes/assets/hybrid.html.8c03ec2f.js"><link rel="prefetch" href="/notes/assets/jsHandwriting.html.28688507.js"><link rel="prefetch" href="/notes/assets/jsonStringify.html.fad11265.js"><link rel="prefetch" href="/notes/assets/largeFileResumableUpload.html.00f92e4d.js"><link rel="prefetch" href="/notes/assets/performance.html.41643289.js"><link rel="prefetch" href="/notes/assets/promise.html.29c5498a.js"><link rel="prefetch" href="/notes/assets/promiseAll.html.19223401.js"><link rel="prefetch" href="/notes/assets/spa.html.4876c936.js"><link rel="prefetch" href="/notes/assets/tsBaseInterview.html.9d172f83.js"><link rel="prefetch" href="/notes/assets/useEs6.html.6285e81c.js"><link rel="prefetch" href="/notes/assets/webAnimations.html.b0e65d0f.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.3f76888c.js"><link rel="prefetch" href="/notes/assets/webpackLoader.html.5e527754.js"><link rel="prefetch" href="/notes/assets/webpackPublic.html.ae2a242a.js"><link rel="prefetch" href="/notes/assets/weird.html.7c14677a.js"><link rel="prefetch" href="/notes/assets/es10News.html.ba88f287.js"><link rel="prefetch" href="/notes/assets/es11News.html.0603c233.js"><link rel="prefetch" href="/notes/assets/es6Interview1.html.042f245d.js"><link rel="prefetch" href="/notes/assets/es6Interview2.html.bb3c8c06.js"><link rel="prefetch" href="/notes/assets/es6Interview3.html.1da7059b.js"><link rel="prefetch" href="/notes/assets/es6News.html.a8f9ffee.js"><link rel="prefetch" href="/notes/assets/es7News.html.bf1518b6.js"><link rel="prefetch" href="/notes/assets/es8News.html.5b331795.js"><link rel="prefetch" href="/notes/assets/es9News.html.b9a1a55b.js"><link rel="prefetch" href="/notes/assets/base.html.64564ef9.js"><link rel="prefetch" href="/notes/assets/nginxComprehensiveScene.html.6f47ce48.js"><link rel="prefetch" href="/notes/assets/commonlyUsed.html.5b5b6d0b.js"><link rel="prefetch" href="/notes/assets/inelegantHook.html.c7fc3249.js"><link rel="prefetch" href="/notes/assets/interview1.html.e40d38c0.js"><link rel="prefetch" href="/notes/assets/interview2.html.0a2730f5.js"><link rel="prefetch" href="/notes/assets/interview3.html.0e7dbc0e.js"><link rel="prefetch" href="/notes/assets/interview4.html.fea337c3.js"><link rel="prefetch" href="/notes/assets/base.html.f50db7a1.js"><link rel="prefetch" href="/notes/assets/introduction.html.1a34d3c4.js"><link rel="prefetch" href="/notes/assets/base.html.f4ca865a.js"><link rel="prefetch" href="/notes/assets/summarize.html.63d19062.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.6c01c952.js"><link rel="prefetch" href="/notes/assets/index.html.18ff6d6e.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.9c1992d7.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.67c292a7.js"><link rel="prefetch" href="/notes/assets/bigDataRender.html.11e69215.js"><link rel="prefetch" href="/notes/assets/progress.html.0cc72861.js"><link rel="prefetch" href="/notes/assets/quirksStandards.html.ab5428ae.js"><link rel="prefetch" href="/notes/assets/redrawReflow.html.fab57e8b.js"><link rel="prefetch" href="/notes/assets/storageSpace.html.9e04962e.js"><link rel="prefetch" href="/notes/assets/webComLink.html.eeb710bf.js"><link rel="prefetch" href="/notes/assets/webUrl.html.444dc6e5.js"><link rel="prefetch" href="/notes/assets/spanWidthHeight.html.8bd77ca7.js"><link rel="prefetch" href="/notes/assets/baseCss.html.ebb01aa7.js"><link rel="prefetch" href="/notes/assets/blockFormattingContext.html.001cd157.js"><link rel="prefetch" href="/notes/assets/containingBlock.html.053dbea5.js"><link rel="prefetch" href="/notes/assets/cssBeforeAfter.html.8f3f3aa8.js"><link rel="prefetch" href="/notes/assets/cssBoxModal.html.2cf173b0.js"><link rel="prefetch" href="/notes/assets/cssCollapsing.html.bd135f28.js"><link rel="prefetch" href="/notes/assets/cssCompatible.html.863f4f7f.js"><link rel="prefetch" href="/notes/assets/cssFlexDemo.html.713e2e6d.js"><link rel="prefetch" href="/notes/assets/cssFlexLayout.html.29646f39.js"><link rel="prefetch" href="/notes/assets/cssGridLayout.html.b38a60ca.js"><link rel="prefetch" href="/notes/assets/cssHack.html.f11b5546.js"><link rel="prefetch" href="/notes/assets/cssInlineBlock.html.4d0142e2.js"><link rel="prefetch" href="/notes/assets/cssPriority.html.d25c37ae.js"><link rel="prefetch" href="/notes/assets/cssPseudo.html.4925055f.js"><link rel="prefetch" href="/notes/assets/cssPseudoClass.html.79317bea.js"><link rel="prefetch" href="/notes/assets/cssSelector.html.22ed218e.js"><link rel="prefetch" href="/notes/assets/cssTutorial.html.2a816001.js"><link rel="prefetch" href="/notes/assets/fieldInvalid.html.8aaf8374.js"><link rel="prefetch" href="/notes/assets/frame.html.c5b78398.js"><link rel="prefetch" href="/notes/assets/knowledgePoints.html.1d3fb9d7.js"><link rel="prefetch" href="/notes/assets/linkImport.html.3d40bb1f.js"><link rel="prefetch" href="/notes/assets/stackingContext.html.919eb557.js"><link rel="prefetch" href="/notes/assets/tools.html.6df3ce88.js"><link rel="prefetch" href="/notes/assets/units.html.9cde3463.js"><link rel="prefetch" href="/notes/assets/transform.html.3d84c112.js"><link rel="prefetch" href="/notes/assets/content.html.69c1e5e0.js"><link rel="prefetch" href="/notes/assets/plugins.html.c0a258d9.js"><link rel="prefetch" href="/notes/assets/accesskey.html.e638be37.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.dc18a8ff.js"><link rel="prefetch" href="/notes/assets/canvasSvg.html.fe89bde8.js"><link rel="prefetch" href="/notes/assets/deviceAPI.html.75bef739.js"><link rel="prefetch" href="/notes/assets/globalAttr.html.4f3994ac.js"><link rel="prefetch" href="/notes/assets/htmlDatalist.html.aa776f97.js"><link rel="prefetch" href="/notes/assets/htmlElement.html.694be7a8.js"><link rel="prefetch" href="/notes/assets/interview10.html.09f09c53.js"><link rel="prefetch" href="/notes/assets/interview11.html.7451e625.js"><link rel="prefetch" href="/notes/assets/interview12.html.57bb2f49.js"><link rel="prefetch" href="/notes/assets/interview13.html.000d91d6.js"><link rel="prefetch" href="/notes/assets/interview14.html.90eaceb5.js"><link rel="prefetch" href="/notes/assets/interview15.html.6d3161d9.js"><link rel="prefetch" href="/notes/assets/interview16.html.5d30dab8.js"><link rel="prefetch" href="/notes/assets/interview17.html.7d57d5ff.js"><link rel="prefetch" href="/notes/assets/interview18.html.970befa2.js"><link rel="prefetch" href="/notes/assets/interview19.html.67cd2721.js"><link rel="prefetch" href="/notes/assets/interview20.html.01b611ee.js"><link rel="prefetch" href="/notes/assets/interview21.html.bd1bcc4e.js"><link rel="prefetch" href="/notes/assets/interview22.html.83fc623d.js"><link rel="prefetch" href="/notes/assets/interview23.html.c4599df2.js"><link rel="prefetch" href="/notes/assets/interview24.html.cae639b1.js"><link rel="prefetch" href="/notes/assets/interview25.html.743c3f96.js"><link rel="prefetch" href="/notes/assets/interview26.html.ef3f466a.js"><link rel="prefetch" href="/notes/assets/interview27.html.5b46eaa2.js"><link rel="prefetch" href="/notes/assets/interview28.html.9e0e5f47.js"><link rel="prefetch" href="/notes/assets/interview29.html.925ee38f.js"><link rel="prefetch" href="/notes/assets/interview30.html.7873e1f7.js"><link rel="prefetch" href="/notes/assets/interview31.html.c0a5b7d6.js"><link rel="prefetch" href="/notes/assets/interview32.html.ac19da01.js"><link rel="prefetch" href="/notes/assets/interview33.html.d1591c30.js"><link rel="prefetch" href="/notes/assets/interview34.html.8443ab10.js"><link rel="prefetch" href="/notes/assets/interview35.html.7092b6eb.js"><link rel="prefetch" href="/notes/assets/interview36.html.cd1391a3.js"><link rel="prefetch" href="/notes/assets/interview37.html.67df34d2.js"><link rel="prefetch" href="/notes/assets/interview38.html.ff1fd1b4.js"><link rel="prefetch" href="/notes/assets/interview39.html.751d0c46.js"><link rel="prefetch" href="/notes/assets/interview40.html.63e77ddc.js"><link rel="prefetch" href="/notes/assets/interview41.html.456bb0bf.js"><link rel="prefetch" href="/notes/assets/interview42.html.ddd498df.js"><link rel="prefetch" href="/notes/assets/interview43.html.3192d09b.js"><link rel="prefetch" href="/notes/assets/interview44.html.2bb6879e.js"><link rel="prefetch" href="/notes/assets/interview45.html.574de178.js"><link rel="prefetch" href="/notes/assets/interview46.html.6b7f2eb6.js"><link rel="prefetch" href="/notes/assets/interview47.html.54b243a4.js"><link rel="prefetch" href="/notes/assets/interview48.html.b9762a15.js"><link rel="prefetch" href="/notes/assets/interview49.html.b829f2a5.js"><link rel="prefetch" href="/notes/assets/interview5.html.9f6f451e.js"><link rel="prefetch" href="/notes/assets/interview50.html.e3f794ae.js"><link rel="prefetch" href="/notes/assets/interview51.html.11cee9fd.js"><link rel="prefetch" href="/notes/assets/interview52.html.c957441a.js"><link rel="prefetch" href="/notes/assets/interview53.html.1a8afb67.js"><link rel="prefetch" href="/notes/assets/interview54.html.45a853b5.js"><link rel="prefetch" href="/notes/assets/interview55.html.3a01aec9.js"><link rel="prefetch" href="/notes/assets/interview56.html.4faec3de.js"><link rel="prefetch" href="/notes/assets/interview57.html.a53011ea.js"><link rel="prefetch" href="/notes/assets/interview58.html.f8dff879.js"><link rel="prefetch" href="/notes/assets/interview59.html.6be5c7cb.js"><link rel="prefetch" href="/notes/assets/interview6.html.7e71acd2.js"><link rel="prefetch" href="/notes/assets/interview7.html.6060fab5.js"><link rel="prefetch" href="/notes/assets/interview8.html.662f4f3d.js"><link rel="prefetch" href="/notes/assets/interview9.html.f5c4a5eb.js"><link rel="prefetch" href="/notes/assets/linkImport.html.5c43fedb.js"><link rel="prefetch" href="/notes/assets/offlineStorage.html.51afad50.js"><link rel="prefetch" href="/notes/assets/regular.html.30ef8499.js"><link rel="prefetch" href="/notes/assets/shake.html.f438ecd2.js"><link rel="prefetch" href="/notes/assets/webWorker.html.81c5454f.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.0a70f58f.js"><link rel="prefetch" href="/notes/assets/cors.html.88078404.js"><link rel="prefetch" href="/notes/assets/crossDomainCookie.html.76eb5642.js"><link rel="prefetch" href="/notes/assets/fetch.html.02767e24.js"><link rel="prefetch" href="/notes/assets/nestAxios.html.183081db.js"><link rel="prefetch" href="/notes/assets/debounce.html.0e741df9.js"><link rel="prefetch" href="/notes/assets/lodashPrinciple.html.fed84d3d.js"><link rel="prefetch" href="/notes/assets/lodashThrottleDebounce.html.b0c47904.js"><link rel="prefetch" href="/notes/assets/throttle.html.5af8cd6c.js"><link rel="prefetch" href="/notes/assets/throttleDebounceReact.html.0f48e78c.js"><link rel="prefetch" href="/notes/assets/cloneIntroduction.html.e094fc49.js"><link rel="prefetch" href="/notes/assets/deepClone.html.0563006a.js"><link rel="prefetch" href="/notes/assets/lodashDeepClone.html.c494241f.js"><link rel="prefetch" href="/notes/assets/objectAssign.html.311609d8.js"><link rel="prefetch" href="/notes/assets/arraySourceCode.html.e1c2aeca.js"><link rel="prefetch" href="/notes/assets/baseHigh.html.b9d6ea4d.js"><link rel="prefetch" href="/notes/assets/currying.html.244cc271.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.4479f99c.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.dd59fa4d.js"><link rel="prefetch" href="/notes/assets/iife.html.e7fd3a36.js"><link rel="prefetch" href="/notes/assets/interview1.html.899728ae.js"><link rel="prefetch" href="/notes/assets/jsCompatible.html.6e3c28ef.js"><link rel="prefetch" href="/notes/assets/baseProyotype.html.d06317d6.js"><link rel="prefetch" href="/notes/assets/functionObjectResource.html.0beefcd9.js"><link rel="prefetch" href="/notes/assets/prototypeInherit.html.a2f1810b.js"><link rel="prefetch" href="/notes/assets/closureInterview.html.faff273d.js"><link rel="prefetch" href="/notes/assets/scopeChain.html.dfa3a8f4.js"><link rel="prefetch" href="/notes/assets/understandingClosures.html.cdb4a397.js"><link rel="prefetch" href="/notes/assets/executionStack.html.65080c12.js"><link rel="prefetch" href="/notes/assets/memoryLeak.html.7c52b75a.js"><link rel="prefetch" href="/notes/assets/memoryMechanism.html.176570e0.js"><link rel="prefetch" href="/notes/assets/memorySpace.html.6155acc0.js"><link rel="prefetch" href="/notes/assets/precompiled.html.aaca9c13.js"><link rel="prefetch" href="/notes/assets/variableObject.html.891241af.js"><link rel="prefetch" href="/notes/assets/arrowFunctionThis.html.d931bb99.js"><link rel="prefetch" href="/notes/assets/bindSimulation.html.905ec84a.js"><link rel="prefetch" href="/notes/assets/callApply.html.58a6e080.js"><link rel="prefetch" href="/notes/assets/newSimulation.html.b3faf2bc.js"><link rel="prefetch" href="/notes/assets/thisBind.html.45d8eba8.js"><link rel="prefetch" href="/notes/assets/interview1.html.8dfa87fe.js"><link rel="prefetch" href="/notes/assets/interview10.html.75cc5e07.js"><link rel="prefetch" href="/notes/assets/interview11.html.0c4f982d.js"><link rel="prefetch" href="/notes/assets/interview12.html.01dee691.js"><link rel="prefetch" href="/notes/assets/interview13.html.2bf72612.js"><link rel="prefetch" href="/notes/assets/interview14.html.dc87e9bf.js"><link rel="prefetch" href="/notes/assets/interview15.html.9b442142.js"><link rel="prefetch" href="/notes/assets/interview16.html.20487da3.js"><link rel="prefetch" href="/notes/assets/interview17.html.61b31436.js"><link rel="prefetch" href="/notes/assets/interview18.html.8758ad27.js"><link rel="prefetch" href="/notes/assets/interview19.html.e755e06e.js"><link rel="prefetch" href="/notes/assets/interview2.html.571913f9.js"><link rel="prefetch" href="/notes/assets/interview20.html.8be53874.js"><link rel="prefetch" href="/notes/assets/interview21.html.7d031a37.js"><link rel="prefetch" href="/notes/assets/interview22.html.9b10aa47.js"><link rel="prefetch" href="/notes/assets/interview23.html.f73dc91f.js"><link rel="prefetch" href="/notes/assets/interview24.html.ab7ad5f9.js"><link rel="prefetch" href="/notes/assets/interview25.html.884dae8b.js"><link rel="prefetch" href="/notes/assets/interview26.html.85e81e0b.js"><link rel="prefetch" href="/notes/assets/interview27.html.0672dea9.js"><link rel="prefetch" href="/notes/assets/interview28.html.495c2a3a.js"><link rel="prefetch" href="/notes/assets/interview29.html.0f0acaa6.js"><link rel="prefetch" href="/notes/assets/interview3.html.675fb640.js"><link rel="prefetch" href="/notes/assets/interview30.html.dfbf8fa7.js"><link rel="prefetch" href="/notes/assets/interview4.html.10ba802f.js"><link rel="prefetch" href="/notes/assets/interview5.html.8cc39933.js"><link rel="prefetch" href="/notes/assets/interview6.html.6e753bf0.js"><link rel="prefetch" href="/notes/assets/interview7.html.c5a4ba45.js"><link rel="prefetch" href="/notes/assets/interview8.html.1ff05252.js"><link rel="prefetch" href="/notes/assets/interview9.html.0b8c8413.js"><link rel="prefetch" href="/notes/assets/adjacentSiblingCombinator.html.03d98a43.js"><link rel="prefetch" href="/notes/assets/attributeSelectors.html.c68474f9.js"><link rel="prefetch" href="/notes/assets/charset.html.cad8b82d.js"><link rel="prefetch" href="/notes/assets/childCombinator.html.5a2c2204.js"><link rel="prefetch" href="/notes/assets/classSelectors.html.151bd104.js"><link rel="prefetch" href="/notes/assets/descendantCombinator.html.d9a40850.js"><link rel="prefetch" href="/notes/assets/generalSiblingCombinator.html.6ccb0384.js"><link rel="prefetch" href="/notes/assets/iDSelectors.html.8ae75816.js"><link rel="prefetch" href="/notes/assets/pseudoClasses.html.e222b82a.js"><link rel="prefetch" href="/notes/assets/pseudoElements.html.0893bfff.js"><link rel="prefetch" href="/notes/assets/selectorList.html.96b02a30.js"><link rel="prefetch" href="/notes/assets/typeSelectors.html.1c6b6353.js"><link rel="prefetch" href="/notes/assets/universalSelectors.html.fbbbfe2f.js"><link rel="prefetch" href="/notes/assets/IterationProtocols.html.7fa98cb2.js"><link rel="prefetch" href="/notes/assets/arrayFlat.html.67d6ab57.js"><link rel="prefetch" href="/notes/assets/asyncHistory.html.600d1e01.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.85fa60db.js"><link rel="prefetch" href="/notes/assets/fileReader.html.ca0c2664.js"><link rel="prefetch" href="/notes/assets/formData.html.6578e826.js"><link rel="prefetch" href="/notes/assets/functionGenerator.html.2b0ec8fc.js"><link rel="prefetch" href="/notes/assets/generator.html.5e21af8a.js"><link rel="prefetch" href="/notes/assets/intersectionObserver.html.ada3cc04.js"><link rel="prefetch" href="/notes/assets/map.html.442b7c8d.js"><link rel="prefetch" href="/notes/assets/promise.html.ddb903e5.js"><link rel="prefetch" href="/notes/assets/set.html.0f9a8793.js"><link rel="prefetch" href="/notes/assets/string.html.d52c7578.js"><link rel="prefetch" href="/notes/assets/symbol.html.49559aa0.js"><link rel="prefetch" href="/notes/assets/xMLHttpRequest.html.7dfb7357.js"><link rel="prefetch" href="/notes/assets/spreadSyntax.html.f86cb3a4.js"><link rel="prefetch" href="/notes/assets/strictMode.html.8a21c49f.js"><link rel="prefetch" href="/notes/assets/cache.html.368a7528.js"><link rel="prefetch" href="/notes/assets/drag1.html.c4e1f968.js"><link rel="prefetch" href="/notes/assets/oneLineCode.html.9b0e0f29.js"><link rel="prefetch" href="/notes/assets/oneLineCodeArray.html.bb1b11db.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDOM.html.1511e4b1.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDateTime.html.80cd9435.js"><link rel="prefetch" href="/notes/assets/oneLineCodeFunction.html.05d84375.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMath.html.4ab68d1b.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMisc.html.a5280aea.js"><link rel="prefetch" href="/notes/assets/oneLineCodeNumber.html.e5b206c7.js"><link rel="prefetch" href="/notes/assets/oneLineCodeObject.html.e4b81ac7.js"><link rel="prefetch" href="/notes/assets/oneLineCodeRandom.html.25c89c47.js"><link rel="prefetch" href="/notes/assets/oneLineCodeString.html.4adc8ab9.js"><link rel="prefetch" href="/notes/assets/oneLineCodeValidator.html.d582414f.js"><link rel="prefetch" href="/notes/assets/typeScriptCache.html.261d41ad.js"><link rel="prefetch" href="/notes/assets/reactBase.html.503ea5fc.js"><link rel="prefetch" href="/notes/assets/reactTypescript.html.2b7f17e0.js"><link rel="prefetch" href="/notes/assets/vue2Base.html.f64821f1.js"><link rel="prefetch" href="/notes/assets/vue2Table.html.e401f53c.js"><link rel="prefetch" href="/notes/assets/vue2offsetTop.html.b90ec92f.js"><link rel="prefetch" href="/notes/assets/componentWillXXX.html.3d3be0c6.js"><link rel="prefetch" href="/notes/assets/disrupt.html.60e9c50b.js"><link rel="prefetch" href="/notes/assets/lane.html.6bdca8ed.js"><link rel="prefetch" href="/notes/assets/prepare.html.a4ff07c1.js"><link rel="prefetch" href="/notes/assets/redux.html.c7dc256c.js"><link rel="prefetch" href="/notes/assets/scheduler.html.6d318b04.js"><link rel="prefetch" href="/notes/assets/multi.html.60702603.js"><link rel="prefetch" href="/notes/assets/one.html.0b04b252.js"><link rel="prefetch" href="/notes/assets/prepare.html.2c0f7716.js"><link rel="prefetch" href="/notes/assets/create.html.c3cc733c.js"><link rel="prefetch" href="/notes/assets/prepare.html.8c7c446e.js"><link rel="prefetch" href="/notes/assets/structure.html.4a4bfb0d.js"><link rel="prefetch" href="/notes/assets/useeffect.html.7afafbd1.js"><link rel="prefetch" href="/notes/assets/usememo.html.5e25a2dc.js"><link rel="prefetch" href="/notes/assets/useref.html.b2450f52.js"><link rel="prefetch" href="/notes/assets/usestate.html.9c0701fb.js"><link rel="prefetch" href="/notes/assets/file.html.409f66f0.js"><link rel="prefetch" href="/notes/assets/idea.html.220d22ad.js"><link rel="prefetch" href="/notes/assets/jsx.html.fec2b7ce.js"><link rel="prefetch" href="/notes/assets/newConstructure.html.48a67b2f.js"><link rel="prefetch" href="/notes/assets/oldConstructure.html.c3f818bf.js"><link rel="prefetch" href="/notes/assets/source.html.826b9e47.js"><link rel="prefetch" href="/notes/assets/summary.html.12445456.js"><link rel="prefetch" href="/notes/assets/basePrinciple.html.3868922a.js"><link rel="prefetch" href="/notes/assets/componentApi.html.0567ec84.js"><link rel="prefetch" href="/notes/assets/domApi.html.d6dd3a45.js"><link rel="prefetch" href="/notes/assets/hoc.html.5144de3a.js"><link rel="prefetch" href="/notes/assets/hookApi.html.4005fe10.js"><link rel="prefetch" href="/notes/assets/hookCustom.html.d3a0b093.js"><link rel="prefetch" href="/notes/assets/hookPrinciple.html.9aacbdf5.js"><link rel="prefetch" href="/notes/assets/hookUse.html.7c80445e.js"><link rel="prefetch" href="/notes/assets/reactKeeplive.html.1846952f.js"><link rel="prefetch" href="/notes/assets/reactRedux.html.05204623.js"><link rel="prefetch" href="/notes/assets/reactRouter.html.533e6d05.js"><link rel="prefetch" href="/notes/assets/toolApi.html.93611800.js"><link rel="prefetch" href="/notes/assets/beginWork.html.f2d2dfc6.js"><link rel="prefetch" href="/notes/assets/completeWork.html.412a9dc0.js"><link rel="prefetch" href="/notes/assets/doubleBuffer.html.dc4d1922.js"><link rel="prefetch" href="/notes/assets/fiber-mental.html.981e31e4.js"><link rel="prefetch" href="/notes/assets/fiber.html.175c6004.js"><link rel="prefetch" href="/notes/assets/reconciler.html.a3218c38.js"><link rel="prefetch" href="/notes/assets/beforeMutation.html.8d4ea20b.js"><link rel="prefetch" href="/notes/assets/layout.html.0f6de580.js"><link rel="prefetch" href="/notes/assets/mutation.html.194fdb03.js"><link rel="prefetch" href="/notes/assets/prepare.html.fb274b42.js"><link rel="prefetch" href="/notes/assets/mental.html.541b303a.js"><link rel="prefetch" href="/notes/assets/prepare.html.5d6ff9cb.js"><link rel="prefetch" href="/notes/assets/priority.html.92db7070.js"><link rel="prefetch" href="/notes/assets/reactdom.html.0c535a57.js"><link rel="prefetch" href="/notes/assets/setstate.html.6b0b459a.js"><link rel="prefetch" href="/notes/assets/update.html.f88219c2.js"><link rel="prefetch" href="/notes/assets/bitfiled.html.e3ce4640.js"><link rel="prefetch" href="/notes/assets/dfs.html.56fdc032.js"><link rel="prefetch" href="/notes/assets/diff.html.232e0a17.js"><link rel="prefetch" href="/notes/assets/heapsort.html.6e054462.js"><link rel="prefetch" href="/notes/assets/linkedlist.html.4e1fb50e.js"><link rel="prefetch" href="/notes/assets/stack.html.581119e1.js"><link rel="prefetch" href="/notes/assets/bootstrap.html.933d4936.js"><link rel="prefetch" href="/notes/assets/context.html.530e5e04.js"><link rel="prefetch" href="/notes/assets/fibertree-commit.html.8b0645c4.js"><link rel="prefetch" href="/notes/assets/fibertree-create.html.66313eb7.js"><link rel="prefetch" href="/notes/assets/fibertree-prepare.html.032402f7.js"><link rel="prefetch" href="/notes/assets/fibertree-update.html.502cf625.js"><link rel="prefetch" href="/notes/assets/hook-effect.html.316f4423.js"><link rel="prefetch" href="/notes/assets/hook-state.html.2f220ceb.js"><link rel="prefetch" href="/notes/assets/hook-summary.html.7f9e9dd3.js"><link rel="prefetch" href="/notes/assets/macro-structure.html.ba481eb2.js"><link rel="prefetch" href="/notes/assets/object-structure.html.ccf5e554.js"><link rel="prefetch" href="/notes/assets/priority.html.d731cb4a.js"><link rel="prefetch" href="/notes/assets/reconciler-workflow.html.474b9761.js"><link rel="prefetch" href="/notes/assets/scheduler.html.4bf5c4af.js"><link rel="prefetch" href="/notes/assets/state-effects.html.7e16b30f.js"><link rel="prefetch" href="/notes/assets/synthetic-event.html.b609d141.js"><link rel="prefetch" href="/notes/assets/workloop.html.4adeffa8.js"><link rel="prefetch" href="/notes/assets/ast.html.9a63ab11.js"><link rel="prefetch" href="/notes/assets/binder.html.a219046c.js"><link rel="prefetch" href="/notes/assets/checker.html.a1e0a2c0.js"><link rel="prefetch" href="/notes/assets/emitter.html.5e3abe0e.js"><link rel="prefetch" href="/notes/assets/overview.html.2d9c501a.js"><link rel="prefetch" href="/notes/assets/parser.html.29d2bad1.js"><link rel="prefetch" href="/notes/assets/program.html.7028845a.js"><link rel="prefetch" href="/notes/assets/scanner.html.5492f92d.js"><link rel="prefetch" href="/notes/assets/common.html.2de17b1e.js"><link rel="prefetch" href="/notes/assets/interpreting.html.8ef2bacd.js"><link rel="prefetch" href="/notes/assets/class.html.71684068.js"><link rel="prefetch" href="/notes/assets/commandline-behavior.html.f48f1deb.js"><link rel="prefetch" href="/notes/assets/comments.html.dbabbb2a.js"><link rel="prefetch" href="/notes/assets/common-bug-not-bugs.html.489a7e46.js"><link rel="prefetch" href="/notes/assets/common-feature-request.html.82fce904.js"><link rel="prefetch" href="/notes/assets/decorators.html.d08d6558.js"><link rel="prefetch" href="/notes/assets/enums.html.e63a9560.js"><link rel="prefetch" href="/notes/assets/function.html.a3b347e9.js"><link rel="prefetch" href="/notes/assets/generics.html.972d6b82.js"><link rel="prefetch" href="/notes/assets/glossary-and-terms.html.cec9a32b.js"><link rel="prefetch" href="/notes/assets/jsx-and-react.html.64aa7ae5.js"><link rel="prefetch" href="/notes/assets/modules.html.9c836d94.js"><link rel="prefetch" href="/notes/assets/thing-that-dont-work.html.63287c47.js"><link rel="prefetch" href="/notes/assets/tsconfig-behavior.html.d7c099bb.js"><link rel="prefetch" href="/notes/assets/type-guards.html.1c6febb3.js"><link rel="prefetch" href="/notes/assets/type-system-behavior.html.3ee9711f.js"><link rel="prefetch" href="/notes/assets/nonReactJSX.html.bc0aeb2c.js"><link rel="prefetch" href="/notes/assets/reactJSX.html.e4779f8a.js"><link rel="prefetch" href="/notes/assets/support.html.8bdc0029.js"><link rel="prefetch" href="/notes/assets/typescript-3.7.html.983cd835.js"><link rel="prefetch" href="/notes/assets/typescript-3.8.html.cb0aec4c.js"><link rel="prefetch" href="/notes/assets/typescript-3.9.html.8d9efaf5.js"><link rel="prefetch" href="/notes/assets/compilationContext.html.0a0ee423.js"><link rel="prefetch" href="/notes/assets/declarationspaces.html.1c1dd8f7.js"><link rel="prefetch" href="/notes/assets/dynamicImportExpressions.html.71478bd3.js"><link rel="prefetch" href="/notes/assets/inDepthTs.html.f6c03688.js"><link rel="prefetch" href="/notes/assets/modules.html.ea84132d.js"><link rel="prefetch" href="/notes/assets/namespaces.html.637fa22c.js"><link rel="prefetch" href="/notes/assets/unknownAny.html.cb741975.js"><link rel="prefetch" href="/notes/assets/avoidExportDefault.html.8d52d0da.js"><link rel="prefetch" href="/notes/assets/barrel.html.8f40c1c7.js"><link rel="prefetch" href="/notes/assets/bind.html.ef153152.js"><link rel="prefetch" href="/notes/assets/buildToggles.html.0f22767a.js"><link rel="prefetch" href="/notes/assets/classAreUseful.html.58e2dabf.js"><link rel="prefetch" href="/notes/assets/covarianceAndContravariance.html.d0d1b035.js"><link rel="prefetch" href="/notes/assets/createArrays.html.0e227c5c.js"><link rel="prefetch" href="/notes/assets/curry.html.1c9a5de3.js"><link rel="prefetch" href="/notes/assets/functionParameters.html.b9a640a4.js"><link rel="prefetch" href="/notes/assets/infer.html.596018ae.js"><link rel="prefetch" href="/notes/assets/lazyObjectLiteralInitialization.html.fdd07bff.js"><link rel="prefetch" href="/notes/assets/limitPropertySetters.html.1720d04e.js"><link rel="prefetch" href="/notes/assets/metadata.html.b22d00aa.js"><link rel="prefetch" href="/notes/assets/nominalTyping.html.beec167d.js"><link rel="prefetch" href="/notes/assets/outFileCaution.html.14061280.js"><link rel="prefetch" href="/notes/assets/singletonPatern.html.f21d254a.js"><link rel="prefetch" href="/notes/assets/statefulFunctions.html.d63c649e.js"><link rel="prefetch" href="/notes/assets/staticConstructors.html.c9c8df45.js"><link rel="prefetch" href="/notes/assets/stringBasedEmuns.html.a305d6ea.js"><link rel="prefetch" href="/notes/assets/truthy.html.7f66eb04.js"><link rel="prefetch" href="/notes/assets/typeInstantiation.html.46ce0962.js"><link rel="prefetch" href="/notes/assets/typesafeEventEmitter.html.daf4733c.js"><link rel="prefetch" href="/notes/assets/ambient.html.48146e03.js"><link rel="prefetch" href="/notes/assets/callable.html.29da55b6.js"><link rel="prefetch" href="/notes/assets/discrominatedUnion.html.d610171f.js"><link rel="prefetch" href="/notes/assets/enums.html.539f215c.js"><link rel="prefetch" href="/notes/assets/exceptionsHanding.html.612fda8b.js"><link rel="prefetch" href="/notes/assets/freshness.html.370f3c06.js"><link rel="prefetch" href="/notes/assets/functions.html.512ad0b1.js"><link rel="prefetch" href="/notes/assets/generices.html.f4aca1e8.js"><link rel="prefetch" href="/notes/assets/indexSignatures.html.8e4e0907.js"><link rel="prefetch" href="/notes/assets/interfaces.html.fde540af.js"><link rel="prefetch" href="/notes/assets/lib.html.9146e7cd.js"><link rel="prefetch" href="/notes/assets/literals.html.21063322.js"><link rel="prefetch" href="/notes/assets/migrating.html.11c1b6a2.js"><link rel="prefetch" href="/notes/assets/mixins.html.d504752f.js"><link rel="prefetch" href="/notes/assets/movingTypes.html.99591e46.js"><link rel="prefetch" href="/notes/assets/neverType.html.cc408da8.js"><link rel="prefetch" href="/notes/assets/overview.html.2eef097c.js"><link rel="prefetch" href="/notes/assets/readonly.html.8488ca14.js"><link rel="prefetch" href="/notes/assets/thisType.html.32380aac.js"><link rel="prefetch" href="/notes/assets/typeAssertion.html.8ca3efbe.js"><link rel="prefetch" href="/notes/assets/typeCompatibility.html.07250fa7.js"><link rel="prefetch" href="/notes/assets/typeGuard.html.c15461ff.js"><link rel="prefetch" href="/notes/assets/typeInference.html.64b555a3.js"><link rel="prefetch" href="/notes/assets/types.html.68c1f8df.js"><link rel="prefetch" href="/notes/assets/pluginDva.html.e15756e5.js"><link rel="prefetch" href="/notes/assets/pluginQiankun.html.b9450b61.js"><link rel="prefetch" href="/notes/assets/codegen.html.d8c0ff69.js"><link rel="prefetch" href="/notes/assets/entrance.html.3ab2a5ef.js"><link rel="prefetch" href="/notes/assets/optimize.html.6b812b85.js"><link rel="prefetch" href="/notes/assets/outline.html.8e15633d.js"><link rel="prefetch" href="/notes/assets/parse.html.ed2bc6c0.js"><link rel="prefetch" href="/notes/assets/async-component.html.abcb5d86.js"><link rel="prefetch" href="/notes/assets/component-register.html.7812b7db.js"><link rel="prefetch" href="/notes/assets/create-component.html.9e32052a.js"><link rel="prefetch" href="/notes/assets/lifecycle.html.0348926b.js"><link rel="prefetch" href="/notes/assets/merge-option.html.e85f9d86.js"><link rel="prefetch" href="/notes/assets/outline.html.fa88e23e.js"><link rel="prefetch" href="/notes/assets/patch.html.70b1ef22.js"><link rel="prefetch" href="/notes/assets/_index.html.8249c732.js"><link rel="prefetch" href="/notes/assets/create-element.html.dbdd47dc.js"><link rel="prefetch" href="/notes/assets/mounted.html.defea20c.js"><link rel="prefetch" href="/notes/assets/new-vue.html.122e5b4e.js"><link rel="prefetch" href="/notes/assets/render.html.bde3561d.js"><link rel="prefetch" href="/notes/assets/update.html.c7eb6a9c.js"><link rel="prefetch" href="/notes/assets/virtual-dom.html.c21a2994.js"><link rel="prefetch" href="/notes/assets/event.html.10e0cb19.js"><link rel="prefetch" href="/notes/assets/keep-alive.html.6cbde32b.js"><link rel="prefetch" href="/notes/assets/outline.html.7240be27.js"><link rel="prefetch" href="/notes/assets/slot.html.d5eb4989.js"><link rel="prefetch" href="/notes/assets/tansition-group.html.46b441c8.js"><link rel="prefetch" href="/notes/assets/tansition.html.62973d99.js"><link rel="prefetch" href="/notes/assets/v-model.html.034f5fba.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.8a0ca8a7.js"><link rel="prefetch" href="/notes/assets/baseInterviewSecond.html.ee86c87a.js"><link rel="prefetch" href="/notes/assets/componentCommunication.html.9d20fea7.js"><link rel="prefetch" href="/notes/assets/detailedResponsiveness.html.db60ce57.js"><link rel="prefetch" href="/notes/assets/diff.html.65d5d3c5.js"><link rel="prefetch" href="/notes/assets/eventBinding.html.1345bfc8.js"><link rel="prefetch" href="/notes/assets/eventMechanism.html.b2904c87.js"><link rel="prefetch" href="/notes/assets/key.html.81ebdde9.js"><link rel="prefetch" href="/notes/assets/knowledgeSystem.html.62a7eac6.js"><link rel="prefetch" href="/notes/assets/slot.html.227982ae.js"><link rel="prefetch" href="/notes/assets/sourceCodeAsyncDomUpdateNextTick.html.be6e27a7.js"><link rel="prefetch" href="/notes/assets/sourceCodeElementBroadcastDispatch.html.12fa2480.js"><link rel="prefetch" href="/notes/assets/sourceCodeKeepAlive.html.a8a2e742.js"><link rel="prefetch" href="/notes/assets/sourceCodeResponsiveness.html.20c1c90d.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateCompilation.html.be7a0276.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateDom.html.a324d87d.js"><link rel="prefetch" href="/notes/assets/sourceCodeVuex.html.60577f70.js"><link rel="prefetch" href="/notes/assets/vNode.html.ef2b522a.js"><link rel="prefetch" href="/notes/assets/vNodeDiff.html.a9a18290.js"><link rel="prefetch" href="/notes/assets/build.html.6566bc89.js"><link rel="prefetch" href="/notes/assets/directory.html.fa4c3471.js"><link rel="prefetch" href="/notes/assets/entrance.html.73626535.js"><link rel="prefetch" href="/notes/assets/flow.html.52f97f44.js"><link rel="prefetch" href="/notes/assets/component-update.html.93bbbb25.js"><link rel="prefetch" href="/notes/assets/computed-watcher.html.18d34055.js"><link rel="prefetch" href="/notes/assets/getters.html.80223268.js"><link rel="prefetch" href="/notes/assets/next-tick.html.90f1173c.js"><link rel="prefetch" href="/notes/assets/outline.html.bf7bfbbd.js"><link rel="prefetch" href="/notes/assets/props.html.c5de9ee5.js"><link rel="prefetch" href="/notes/assets/questions.html.381ddb15.js"><link rel="prefetch" href="/notes/assets/reactive-object.html.3cea2e73.js"><link rel="prefetch" href="/notes/assets/setters.html.e258a9c7.js"><link rel="prefetch" href="/notes/assets/summary.html.0a83da78.js"><link rel="prefetch" href="/notes/assets/install.html.e5406bd6.js"><link rel="prefetch" href="/notes/assets/matcher.html.2de93377.js"><link rel="prefetch" href="/notes/assets/outline.html.c58c28ac.js"><link rel="prefetch" href="/notes/assets/router.html.82fb2dc5.js"><link rel="prefetch" href="/notes/assets/transition-to.html.dc12c7d0.js"><link rel="prefetch" href="/notes/assets/api.html.6f051702.js"><link rel="prefetch" href="/notes/assets/idex.html.de227c36.js"><link rel="prefetch" href="/notes/assets/init.html.180db5a2.js"><link rel="prefetch" href="/notes/assets/plugin.html.cfdb6d17.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.7de7cab4.js"><link rel="prefetch" href="/notes/assets/configuration.html.91dc53a2.js"><link rel="prefetch" href="/notes/assets/entryPoints.html.8e3e855a.js"><link rel="prefetch" href="/notes/assets/loader.html.1dc3c32c.js"><link rel="prefetch" href="/notes/assets/output.html.df7e33e1.js"><link rel="prefetch" href="/notes/assets/plugin.html.6fcb9042.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.683233f1.js"><link rel="prefetch" href="/notes/assets/reactApi.html.bf3c0b76.js"><link rel="prefetch" href="/notes/assets/reactChildren.html.7793bdfb.js"><link rel="prefetch" href="/notes/assets/reactElement.html.6852c9c2.js"><link rel="prefetch" href="/notes/assets/reactFiber.html.9a33a785.js"><link rel="prefetch" href="/notes/assets/commitAllHostEffects.html.46321993.js"><link rel="prefetch" href="/notes/assets/commitAllLifeCycles.html.8b8ea7e6.js"><link rel="prefetch" href="/notes/assets/commitBeforeMutationLifecycles.html.5e861df3.js"><link rel="prefetch" href="/notes/assets/commitDeletion.html.15df04f9.js"><link rel="prefetch" href="/notes/assets/commitPlacement.html.e76d7112.js"><link rel="prefetch" href="/notes/assets/commitRoot.html.706a293c.js"><link rel="prefetch" href="/notes/assets/commitWork.html.c8f6cec3.js"><link rel="prefetch" href="/notes/assets/invokeGuardedCallback.html.cc5a8e61.js"><link rel="prefetch" href="/notes/assets/expirationTime.html.5312cbd7.js"><link rel="prefetch" href="/notes/assets/reactDomRender.html.ca921bd1.js"><link rel="prefetch" href="/notes/assets/setStateForceUpdate.html.b3925da9.js"><link rel="prefetch" href="/notes/assets/context.html.0ea722e5.js"><link rel="prefetch" href="/notes/assets/evenInit.html.65982f9e.js"><link rel="prefetch" href="/notes/assets/eventBind.html.120ea1da.js"><link rel="prefetch" href="/notes/assets/eventCreateEventObject.html.27b6db90.js"><link rel="prefetch" href="/notes/assets/eventDispath.html.f5664ed3.js"><link rel="prefetch" href="/notes/assets/hydrate.html.f727cd7f.js"><link rel="prefetch" href="/notes/assets/ref.html.59cbf1ad.js"><link rel="prefetch" href="/notes/assets/suspense.html.b1f6282d.js"><link rel="prefetch" href="/notes/assets/suspenseLazy.html.c9bdfd12.js"><link rel="prefetch" href="/notes/assets/suspenseWork.html.231134be.js"><link rel="prefetch" href="/notes/assets/hooksCommon.html.dcc7f744.js"><link rel="prefetch" href="/notes/assets/hooksOther.html.965688cc.js"><link rel="prefetch" href="/notes/assets/start.html.27eb157c.js"><link rel="prefetch" href="/notes/assets/useEffect.html.fd6c0769.js"><link rel="prefetch" href="/notes/assets/useState.html.1c535882.js"><link rel="prefetch" href="/notes/assets/base.html.373880b2.js"><link rel="prefetch" href="/notes/assets/commpontDiff.html.5eff054c.js"><link rel="prefetch" href="/notes/assets/componentUpdate.html.f1b4b9f1.js"><link rel="prefetch" href="/notes/assets/renderProcess.html.380a270a.js"><link rel="prefetch" href="/notes/assets/schedulingPrinciple.html.d473671d.js"><link rel="prefetch" href="/notes/assets/beginWork.html.533dc090.js"><link rel="prefetch" href="/notes/assets/globalVariable.html.6c3a8dca.js"><link rel="prefetch" href="/notes/assets/mountIndeterminateComponent.html.26ff6d0d.js"><link rel="prefetch" href="/notes/assets/mountLazyCompont.html.d54b60cf.js"><link rel="prefetch" href="/notes/assets/performUnitOfWork.html.2a7e681e.js"><link rel="prefetch" href="/notes/assets/performWork.html.b8409467.js"><link rel="prefetch" href="/notes/assets/reactScheduler.html.6719feb0.js"><link rel="prefetch" href="/notes/assets/reconcileChildren.html.ef92b0d3.js"><link rel="prefetch" href="/notes/assets/reconcileChildrenArray.html.23c591ad.js"><link rel="prefetch" href="/notes/assets/reconcileSingleElement.html.08397dca.js"><link rel="prefetch" href="/notes/assets/renderRoot.html.20c09e9b.js"><link rel="prefetch" href="/notes/assets/scheduleWork.html.bb4aa8ef.js"><link rel="prefetch" href="/notes/assets/throwException.html.e1c8692a.js"><link rel="prefetch" href="/notes/assets/updateClassComponent.html.6c8d478f.js"><link rel="prefetch" href="/notes/assets/updateContextConsumer.html.fd719a5f.js"><link rel="prefetch" href="/notes/assets/updateContextProvider.html.6378fb0f.js"><link rel="prefetch" href="/notes/assets/updateForwardRef.html.be89c6c6.js"><link rel="prefetch" href="/notes/assets/updateFragment.html.b7878506.js"><link rel="prefetch" href="/notes/assets/updateFunctionalComponent.html.217a9bb2.js"><link rel="prefetch" href="/notes/assets/updateHostComponent.html.9e899033.js"><link rel="prefetch" href="/notes/assets/updateHostRoot.html.006d06eb.js"><link rel="prefetch" href="/notes/assets/updateHostText.html.87da4e1a.js"><link rel="prefetch" href="/notes/assets/updateMode.html.15c739d8.js"><link rel="prefetch" href="/notes/assets/updatePortalComponent.html.b30447ce.js"><link rel="prefetch" href="/notes/assets/updateProfiler.html.e0284500.js"><link rel="prefetch" href="/notes/assets/updateSuspenseComponent.html.94df98c9.js"><link rel="prefetch" href="/notes/assets/interview1.html.edc64764.js"><link rel="prefetch" href="/notes/assets/interview2.html.6c5d6d32.js"><link rel="prefetch" href="/notes/assets/interview3.html.43636370.js"><link rel="prefetch" href="/notes/assets/interview51.html.be85ee8f.js"><link rel="prefetch" href="/notes/assets/interview52.html.a17243bf.js"><link rel="prefetch" href="/notes/assets/interview53.html.f55d39e7.js"><link rel="prefetch" href="/notes/assets/interview54.html.b1577ad7.js"><link rel="prefetch" href="/notes/assets/interview55.html.5964d917.js"><link rel="prefetch" href="/notes/assets/interview56.html.810bbff2.js"><link rel="prefetch" href="/notes/assets/interview57.html.8b784d71.js"><link rel="prefetch" href="/notes/assets/interview1.html.f318f6fb.js"><link rel="prefetch" href="/notes/assets/interview10.html.12078bd6.js"><link rel="prefetch" href="/notes/assets/interview11.html.15f6059b.js"><link rel="prefetch" href="/notes/assets/interview12.html.f0ce3358.js"><link rel="prefetch" href="/notes/assets/interview13.html.779e3f2d.js"><link rel="prefetch" href="/notes/assets/interview14.html.9b1b59e8.js"><link rel="prefetch" href="/notes/assets/interview15.html.29ac1648.js"><link rel="prefetch" href="/notes/assets/interview16.html.a8ae61cb.js"><link rel="prefetch" href="/notes/assets/interview17.html.7d465130.js"><link rel="prefetch" href="/notes/assets/interview18.html.8cd86c17.js"><link rel="prefetch" href="/notes/assets/interview19.html.3995bcba.js"><link rel="prefetch" href="/notes/assets/interview2.html.83a91620.js"><link rel="prefetch" href="/notes/assets/interview20.html.48274523.js"><link rel="prefetch" href="/notes/assets/interview21.html.83b4ab4f.js"><link rel="prefetch" href="/notes/assets/interview22.html.cce479fd.js"><link rel="prefetch" href="/notes/assets/interview23.html.ee9c4db0.js"><link rel="prefetch" href="/notes/assets/interview24.html.8c7608d6.js"><link rel="prefetch" href="/notes/assets/interview25.html.068c224f.js"><link rel="prefetch" href="/notes/assets/interview26.html.c3c4d95b.js"><link rel="prefetch" href="/notes/assets/interview27.html.c36ec185.js"><link rel="prefetch" href="/notes/assets/interview28.html.ac418906.js"><link rel="prefetch" href="/notes/assets/interview29.html.de8bf94d.js"><link rel="prefetch" href="/notes/assets/interview3.html.3c5783ec.js"><link rel="prefetch" href="/notes/assets/interview30.html.fb534b7e.js"><link rel="prefetch" href="/notes/assets/interview31.html.fcd9520e.js"><link rel="prefetch" href="/notes/assets/interview32.html.31b08e5a.js"><link rel="prefetch" href="/notes/assets/interview33.html.2dec6056.js"><link rel="prefetch" href="/notes/assets/interview34.html.c4ec3930.js"><link rel="prefetch" href="/notes/assets/interview35.html.32823b61.js"><link rel="prefetch" href="/notes/assets/interview36.html.88590d4a.js"><link rel="prefetch" href="/notes/assets/interview37.html.a11839d0.js"><link rel="prefetch" href="/notes/assets/interview38.html.209721f3.js"><link rel="prefetch" href="/notes/assets/interview39.html.ed70c55a.js"><link rel="prefetch" href="/notes/assets/interview4.html.e3c493ca.js"><link rel="prefetch" href="/notes/assets/interview40.html.01047eb6.js"><link rel="prefetch" href="/notes/assets/interview41.html.9e9f218a.js"><link rel="prefetch" href="/notes/assets/interview42.html.db84d1eb.js"><link rel="prefetch" href="/notes/assets/interview43.html.e82fc0cf.js"><link rel="prefetch" href="/notes/assets/interview44.html.ae6754da.js"><link rel="prefetch" href="/notes/assets/interview45.html.6ffedb56.js"><link rel="prefetch" href="/notes/assets/interview46.html.8cf91e58.js"><link rel="prefetch" href="/notes/assets/interview47.html.87e099e9.js"><link rel="prefetch" href="/notes/assets/interview48.html.5ec3ce2f.js"><link rel="prefetch" href="/notes/assets/interview49.html.1178b8c8.js"><link rel="prefetch" href="/notes/assets/interview5.html.afd0d5d2.js"><link rel="prefetch" href="/notes/assets/interview50.html.7df846b4.js"><link rel="prefetch" href="/notes/assets/interview6.html.b72624ce.js"><link rel="prefetch" href="/notes/assets/interview7.html.400a1cda.js"><link rel="prefetch" href="/notes/assets/interview8.html.1fa3d768.js"><link rel="prefetch" href="/notes/assets/interview9.html.abbdd212.js"><link rel="prefetch" href="/notes/assets/404.html.8a52f95d.js"><link rel="prefetch" href="/notes/assets/404.490e3686.js"><link rel="prefetch" href="/notes/assets/Layout.bd103d6a.js">
    <link rel="stylesheet" href="/notes/assets/style.742f5b36.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/notes/" class=""><!----><!----></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#vue模板渲染的原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="Vue模板渲染的原理"><!--[--><!--]--> Vue模板渲染的原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#vue-2-0-模板编译原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="vue 2.0 模板编译原理"><!--[--><!--]--> vue 2.0 模板编译原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="概述"><!--[--><!--]--> 概述 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#解析器" class="router-link-active router-link-exact-active sidebar-item" aria-label="解析器"><!--[--><!--]--> 解析器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#stack" class="router-link-active router-link-exact-active sidebar-item" aria-label="Stack"><!--[--><!--]--> Stack <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#开头的几种情况" class="router-link-active router-link-exact-active sidebar-item" aria-label="&lt; 开头的几种情况"><!--[--><!--]--> &lt; 开头的几种情况 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#截取文本" class="router-link-active router-link-exact-active sidebar-item" aria-label="截取文本"><!--[--><!--]--> 截取文本 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#解析文本" class="router-link-active router-link-exact-active sidebar-item" aria-label="解析文本"><!--[--><!--]--> 解析文本 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#结束标签的处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="结束标签的处理"><!--[--><!--]--> 结束标签的处理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#总结一下" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结一下"><!--[--><!--]--> 总结一下 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#优化器" class="router-link-active router-link-exact-active sidebar-item" aria-label="优化器"><!--[--><!--]--> 优化器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#代码生成器" class="router-link-active router-link-exact-active sidebar-item" aria-label="代码生成器"><!--[--><!--]--> 代码生成器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#vue-3-0-模板编译原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="vue 3.0 模板编译原理"><!--[--><!--]--> vue 3.0 模板编译原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#parse" class="router-link-active router-link-exact-active sidebar-item" aria-label="Parse"><!--[--><!--]--> Parse <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#transform" class="router-link-active router-link-exact-active sidebar-item" aria-label="Transform"><!--[--><!--]--> Transform <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/vue/interview/templateCompilation.html#codegen" class="router-link-active router-link-exact-active sidebar-item" aria-label="Codegen"><!--[--><!--]--> Codegen <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h3 id="vue模板渲染的原理" tabindex="-1"><a class="header-anchor" href="#vue模板渲染的原理" aria-hidden="true">#</a> Vue模板渲染的原理</h3><h2 id="vue-2-0-模板编译原理" tabindex="-1"><a class="header-anchor" href="#vue-2-0-模板编译原理" aria-hidden="true">#</a> <strong>vue 2.0 模板编译原理</strong></h2><hr><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> <strong>概述</strong></h2><p>vue中的模板<code>template</code>无法被浏览器解析并渲染，因为这不属于浏览器的标准，不是正确的HTML语法，所有需要将<code>template</code>转化成一个<code>JavaScript</code>函数，这样<strong>浏览器就可以执行这一个函数并渲染出对应的HTML元素</strong>，就可以让视图跑起来了，这一个转化的过程，就成为模板编译。</p><ul><li><p><code>parse阶段</code>：使用大量的正则表达式对template字符串进行解析，将<code>标签</code>、<code>指令</code>、<code>属性</code>等转化为抽象<code>语法树AST</code>。</p><ul><li>将 <code>模板字符串</code> 转换成 <code>element ASTs（解析器）</code></li></ul></li><li><p><code>optimize阶段</code>：<code>遍历AST</code>，找到其中的一些静态节点并进行标记，方便在页面重渲染的时候进行diff比较时，直接跳过这一些静态节点，优化runtime的性能。</p><ul><li>对 <code>AST</code> 进行静态节点标记，主要用来做虚拟DOM的渲染优化（优化器）</li></ul></li><li><p><code>generate阶段</code>：将最终的<code>AST</code>转化为<code>render</code>函数字符串。</p><ul><li>使用 <code>element ASTs</code> 生成 <code>render 函数代码字符串（代码生成器）</code></li></ul></li></ul><h2 id="解析器" tabindex="-1"><a class="header-anchor" href="#解析器" aria-hidden="true">#</a> <strong>解析器</strong></h2><p>解析器主要干的事是将 <code>模板字符串</code> 转换成 <code>element ASTs</code>，例如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这样一个简单的 <code>模板</code> 转换成 <code>element AST</code> 后是这样的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&quot;div&quot;</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">staticRoot</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attrsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&quot;p&quot;</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">staticRoot</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">attrsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">attrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;{{name}}&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">&quot;_s(name)&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>先用这个简单的例子来说明这个解析器的内部究竟发生了什么。</p><p>这段模板字符串会扔到 <code>while</code> 中去循环，然后 <strong>一段一段</strong> 的截取，把截取到的 <strong>每一小段字符串</strong> 进行解析，直到最后截没了，也就解析完了。</p><p>上面这个简单的模板截取的过程是这样的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>只要判断模板字符串是不是以 &lt; 开头就可以知道接下来要截取的这一小段字符串是 <code>标签</code> 还是 <code>文本</code>。</p><p><code>&lt;div&gt;&lt;/div&gt;</code> 这样的一段字符串是以 <code>&lt;</code> 开头的，那么通过正则把 <code>&lt;div&gt;</code> 这一部分 <code>match</code> 出来，就可以拿到这样的数据：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">tagName</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">unarySlash</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">5</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>好奇如何用正则解析出 <code>tagName</code> 和 <code>attrs</code> 等信息的同学可以看下面这个demo代码：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ncname <span class="token operator">=</span> <span class="token string">&#39;[a-zA-Z_][\\w\\-\\.]*&#39;</span>
<span class="token keyword">const</span> qnameCapture <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">((?:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\:)?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> startTagOpen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>qnameCapture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> startTagClose <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s*(\/?)&gt;</span><span class="token regex-delimiter">/</span></span>
<span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> start <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagOpen<span class="token punctuation">)</span>

<span class="token keyword">const</span> match <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">tagName</span><span class="token operator">:</span> start<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>
index <span class="token operator">+=</span> start<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length
<span class="token keyword">let</span> end<span class="token punctuation">,</span> attr
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>end <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagClose<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>attr <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>attr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    index <span class="token operator">+=</span> attr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length
    match<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    match<span class="token punctuation">.</span>unarySlash <span class="token operator">=</span> end<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>end<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    index <span class="token operator">+=</span> end<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length
    match<span class="token punctuation">.</span>end <span class="token operator">=</span> index
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="stack" tabindex="-1"><a class="header-anchor" href="#stack" aria-hidden="true">#</a> <strong>Stack</strong></h2><p>用正则把 <code>开始标签</code> 中包含的数据（<code>attrs</code>, <code>tagName</code> 等）解析出来之后还要做一个很重要的事，就是要维护一个 <code>stack</code>。</p><p>那这个 <code>stack</code> 是用来干什么的呢？</p><p><strong>这个 <code>stack</code> 是用来记录一个层级关系的，用来记录DOM的深度。</strong></p><p>更准确的说，当解析到一个 <code>开始标签</code> 或者 <code>文本</code>，无论是什么， <code>stack</code> 中的最后一项，永远是当前正在被解析的节点的 <code>parentNode</code> 父节点。</p><p>通过 <code>stack</code> 解析器就可以把当前解析到的节点 <code>push</code> 到 父节点的 <code>children</code> 中。</p><p>也可以把当前正在解析的节点的 <code>parent</code> 属性设置为 父节点。</p><p>事实上也确实是这么做的。</p><p>但并不是只要解析到一个标签的开始部分就把当前标签 <code>push</code> 到 <code>stack</code> 中。</p><p>因为在 HTML 中有一种 <code>自闭合标签</code>，比如 <code>input</code>。</p><p><code>&lt;input /&gt;</code> 这种 <code>自闭合的标签</code> 是不需要 <code>push</code> 到 <code>stack</code> 中的，因为 <code>input</code> 并不存在子节点。</p><p>所以当解析到一个标签的开始时，<strong>要判断当前被解析的标签是否是自闭合标签，如果不是自闭合标签才 <code>push</code> 到 <code>stack</code> 中</strong>。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>unary<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentParent <span class="token operator">=</span> element
    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在有了 DOM 的层级关系，也可以解析出DOM的 <code>开始标签</code>，这样每解析一个 <code>开始标签</code> 就生成一个 <code>ASTElement</code> (<strong>存储当前标签的attrs，tagName 等信息的object</strong>）</p><p>并且把当前的 <code>ASTElement</code> push 到 <code>parentNode</code> 的 <code>children</code> 中，同时给当前 <code>ASTElement</code> 的 <code>parent</code> 属性设置为 <code>stack</code> 中的最后一项</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>currentParent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
element<span class="token punctuation">.</span>parent <span class="token operator">=</span> currentParent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="开头的几种情况" tabindex="-1"><a class="header-anchor" href="#开头的几种情况" aria-hidden="true">#</a> <strong><code>&lt;</code> 开头的几种情况</strong></h2><p>但并不是所有以 <code>&lt;</code> 开头的字符串都是 <code>开始标签</code>，以 <code>&lt;</code> 开头的字符串有以下几种情况：</p><ul><li><p>开始标签 <code>&lt;div&gt;</code></p></li><li><p>结束标签 <code>&lt;/div&gt;</code></p></li><li><p>HTML注释 <code>&lt;!-- 是注释 --&gt;</code></p></li><li><p>Doctype <code>&lt;!DOCTYPE html&gt;</code></p></li><li><p>条件注释</p></li></ul><p>当然解析器在解析的过程中遇到的最多的是 <code>开始标签</code> <code>结束标签</code> 和 <code>注释</code></p><h2 id="截取文本" tabindex="-1"><a class="header-anchor" href="#截取文本" aria-hidden="true">#</a> <strong>截取文本</strong></h2><p>继续上面的例子解析，<code>div</code> 的 <code>开始标签</code> 解析之后剩余的模板字符串是下面的样子：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>这一次在解析发现 模板字符串 不是以 &lt; 开头了。</p><p>那么如果模板字符串不是以 &lt; 开头的怎么处理呢？？</p><p>其实如果字符串不是以 &lt; 开头可能会出现这么几种情况：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>是text <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

或者：

是text <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不论是哪种情况都会将标签前面的文本部分解析出来，截取这段文本其实并不难，看下面的例子：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 可以直接将本 demo 放到浏览器 console 中去执行</span>
<span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token string">&#39;是text &lt;/p&gt;&#39;</span>
<span class="token keyword">let</span> textEnd <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> text <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> textEnd<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然 vue 对文本的截取不只是这么简单，vue对文本的截取做了很安全的处理，如果 <code>&lt;</code> 是文本的一部分，那上面 DEMO 中截取的内容就不是想要的，例如这样的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>a <span class="token operator">&lt;</span> b <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果是这样的文本，上面的 demo 肯定就挂了，截取出的文本就会遗漏一部分，而 vue 对这部分是进行了处理的，看下面的代码：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> textEnd <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> text<span class="token punctuation">,</span> rest<span class="token punctuation">,</span> next
<span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rest <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>textEnd<span class="token punctuation">)</span>
    <span class="token comment">// 剩余部分的 HTML 不符合标签的格式那肯定就是文本</span>
    <span class="token comment">// 并且还是以 &lt; 开头的文本</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>
        <span class="token operator">!</span>endTag<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span>startTagOpen<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span>comment<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span>conditionalComment<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &lt; in plain text, be forgiving and treat it as text</span>
        next <span class="token operator">=</span> rest<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span>
        textEnd <span class="token operator">+=</span> next
        rest <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>textEnd<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    text <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> textEnd<span class="token punctuation">)</span>
    html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> textEnd<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码的逻辑是如果文本截取完之后，剩余的 <code>模板字符串</code> 开头不符合标签的格式规则，那么肯定就是有没截取完的文本</p><p>这个时候只需要循环把 <code>textEnd</code> 累加，直到剩余的 <code>模板字符串</code> 符合标签的规则之后在一次性把 <code>text</code> 从 <code>模板字符串</code> 中截取出来就好了。</p><p>继续上面的例子，当前剩余的 <code>模板字符串</code> 是这个样子的：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>截取之后剩余的 <code>模板字符串</code> 是这个样子的：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>被截取出来的文本是这样的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token string">&quot;\n        &quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>截取之后就需要对文本进行解析，不过在解析文本之前需要进行预处理，也就是先简单加工一下文本，vue 是这样做的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> children <span class="token operator">=</span> currentParent<span class="token punctuation">.</span>children
text <span class="token operator">=</span> inPre <span class="token operator">||</span> text<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">isTextTag</span><span class="token punctuation">(</span>currentParent<span class="token punctuation">)</span> <span class="token operator">?</span> text <span class="token operator">:</span> <span class="token function">decodeHTMLCached</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token comment">// only preserve whitespace if its not right after a starting tag</span>
    <span class="token operator">:</span> preserveWhitespace <span class="token operator">&amp;&amp;</span> children<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token string">&#39; &#39;</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码的意思是：</p><ul><li><p>如果文本不为空，判断父标签是不是<code>script</code>或<code>style</code>，</p><ul><li><p>如果是则什么都不管，</p></li><li><p>如果不是需要 <code>decode</code> 一下编码，使用github上的 he 这个类库的 <code>decodeHTML</code> 方法</p></li></ul></li><li><p>如果文本为空，判断有没有兄弟节点，也就是 <code>parent.children.length</code> 是不是为 0</p><ul><li><p>如果大于0 返回 <code>&#39; &#39;</code></p></li><li><p>如果为 0 返回 <code>&#39;&#39;</code></p></li></ul></li></ul><p>结果发现这一次的 text 正好命中最后的那个 <code>&#39;&#39;</code>，所以这一次就什么都不用做继续下一轮解析就好</p><p>继续上面的例子，现在的 <code>模板字符串</code> 变是这个样子：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>接着解析 <code>&lt;p&gt;</code>，解析流程和上面的 <code>&lt;div&gt;</code> 一样就不说了，直接继续：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过上面写的文本的截取方式这一次截取出来的文本是这个样子的 <code>&quot;{{name}}&quot;</code></p><h2 id="解析文本" tabindex="-1"><a class="header-anchor" href="#解析文本" aria-hidden="true">#</a> <strong>解析文本</strong></h2><p>其实解析文本节点并不难，只需要将文本节点 <code>push</code> 到 <code>currentParent.children.push(ast)</code> 就行了。</p><p>但是带变量的文本和不带变量的纯文本是不同的处理方式。</p><p>带变量的文本是指 <code>Hello {{ name }}</code> 这个 <code>name</code> 就是变量。</p><p>不带变量的文本是这样的 <code>Hello Berwin</code> 这种没有访问数据的纯文本。</p><p>纯文本比较简单，直接将 文本节点的ast <code>push</code> 到 <code>parent</code> 节点的 <code>children</code> 中就行了，例如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;是纯文本&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而带变量的文本要多一个解析文本变量的操作：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> expression <span class="token operator">=</span> <span class="token function">parseText</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> delimiters<span class="token punctuation">)</span> <span class="token comment">// 对变量解析 {{name}} =&gt; _s(name)</span>
children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    expression<span class="token punctuation">,</span>
    text
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面例子中 <code>&quot;{{name}}&quot;</code> 是一个带变量的文本，经过 <code>parseText</code> 解析后 <code>expression</code> 是 <code>_s(name)</code>，所以最后 <code>push</code> 到 <code>currentParent.children</code> 中的节点是这个样子的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">&quot;_s(name)&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;{{name}}&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="结束标签的处理" tabindex="-1"><a class="header-anchor" href="#结束标签的处理" aria-hidden="true">#</a> <strong>结束标签的处理</strong></h2><p>现在文本解析完之后，剩余的 <code>模板字符串</code> 变成了这个样子：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>这一次还是用上面说的办法，<code>html.indexOf(&#39;&lt;&#39;) === 0</code>，发现是 <code>&lt;</code> 开头的，然后用正则去 <code>match</code> 发现符合 <code>结束标签的格式</code>，把它截取出来。</p><p>并且还要做一个处理是用当前标签名在 <code>stack</code> 从后往前找，将找到的 <code>stack</code> 中的位置往后的所有标签全部删除（意思是，已经解析到当前的结束标签，那么它的子集肯定都是解析过的，试想一下<strong>当前标签都关闭</strong>了，它的<strong>子集肯定也都关闭</strong>了，所以需要把当前标签位置往后从 <code>stack</code>中都清掉）</p><p>结束标签不需要解析，只需要将 <code>stack</code> 中的当前标签删掉就好。</p><p>虽然不用解析，但 <code>vue</code> 还是做了一个优化处理，<code>children</code> 中的最后一项如果是空格 <code>&quot; &quot;</code>，则删除最后这一项：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>lastNode <span class="token operator">&amp;&amp;</span> lastNode<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> lastNode<span class="token punctuation">.</span>text <span class="token operator">===</span> <span class="token string">&#39; &#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>inPre<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    element<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为最后这一项空格是没有用的，举个例子：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面例子中解析成 <code>element ASTs</code>之后 <code>ul</code> 的结束标签 <code>&lt;/ul&gt;</code> 和 <code>li</code> 的结束标签 <code>&lt;/li&gt;</code> 之间有一个空格，这个空格也属于文本节点在 <code>ul</code> 的 <code>children</code> 中，这个空格是没有用的，把这个空格删掉每次渲染dom都会少渲染一个文本节点，可以节省一定的性能开销。</p><p>现在剩余的 <code>模板字符串</code> 已经不多了，是下面的样子：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后解析文本，就是一个其实就是一个空格的文本节点。</p><p>然后再一次解析结束标签 <code>&lt;/div&gt;</code></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>解析完毕退出 <code>while</code> 循环。</p><p>解析完之后拿到的 <code>element ASTs</code> 就是文章开头写的那样。</p><h2 id="总结一下" tabindex="-1"><a class="header-anchor" href="#总结一下" aria-hidden="true">#</a> <strong>总结一下</strong></h2><p>其实这样一个模板解析器的原理不是特别难，主要就是两部分内容，一部分是 <code>截取</code> 字符串，一部分是对截取之后的字符串做 <code>解析</code></p><p>每截取一段标签的开头就 <code>push</code> 到 <code>stack</code>中，解析到标签的结束就 pop 出来，当所有的字符串都截没了也就解析完了。</p><h2 id="优化器" tabindex="-1"><a class="header-anchor" href="#优化器" aria-hidden="true">#</a> <strong>优化器</strong></h2><p>优化器的目标是找出那些静态节点并打上标记，而静态节点指的是 <code>DOM</code> 不需要发生变化的节点，例如：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>是静态节点，不需要发生变化<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>标记静态节点有两个好处：</p><ol><li><p>每次重新渲染的时候不需要为静态节点创建新节点</p></li><li><p>在 <code>Virtual DOM</code> 中 <code>patching</code> 的过程可以被跳过</p></li></ol><p>优化器的实现原理主要分两步：</p><ul><li><p><code>第一步</code>：用递归的方式将所有节点添加 <code>static</code> 属性，标识是不是静态节点</p></li><li><p><code>第二步</code>：标记所有静态根节点</p></li></ul><p>什么是静态根节点？ 答：子节点全是静态节点的节点就是静态根节点，例如：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>是静态节点，不需要发生变化<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>是静态节点2，不需要发生变化<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>是静态节点3，不需要发生变化<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ul 就是静态根节点。</p><p><strong>如何将所有节点标记 <code>static</code> 属性？</strong></p><p>vue 判断一个节点是不是静态节点的做法其实并不难：</p><ol><li><p>先根据自身是不是静态节点做一个标记 <code>node.static = isStatic(node)</code></p></li><li><p>然后在循环 <code>children</code>，如果 <code>children</code> 中出现了哪怕一个节点不是静态节点，在将当前节点的标记修改成 <code>false</code>： <code>node.static = false</code>。</p></li></ol><p><strong>如何判断一个节点是不是静态节点？</strong></p><p>也就是说 <code>isStatic</code> 这个函数是如何判断静态节点的？</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isStatic</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// expression</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// text</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>pre <span class="token operator">||</span> <span class="token punctuation">(</span>
        <span class="token operator">!</span>node<span class="token punctuation">.</span>hasBindings <span class="token operator">&amp;&amp;</span> <span class="token comment">// no dynamic bindings</span>
        <span class="token operator">!</span>node<span class="token punctuation">.</span>if <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>node<span class="token punctuation">.</span>for <span class="token operator">&amp;&amp;</span> <span class="token comment">// not v-if or v-for or v-else</span>
        <span class="token operator">!</span><span class="token function">isBuiltInTag</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// not a built-in</span>
        <span class="token function">isPlatformReservedTag</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// not a component</span>
        <span class="token operator">!</span><span class="token function">isDirectChildOfTemplateFor</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>isStaticKey<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>先解释一下，在上文讲的解析器中将 <code>模板字符串</code> 解析成 <code>AST</code> 的时候，会根据不同的文本类型设置一个 <code>type</code>：</p><table><thead><tr><th>type</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>元素节点</td></tr><tr><td>2</td><td>带变量的动态文本节点</td></tr><tr><td>3</td><td>不带变量的纯文本节点</td></tr></tbody></table><p>所以上面 <code>isStatic</code> 中的逻辑很明显，如果 <code>type === 2</code> 那肯定不是 <code>静态节点</code> 返回 <code>false</code>，如果 <code>type === 3</code> 那就是静态节点，返回 <code>true</code>。</p><p>那如果 <code>type === 1</code>，就有点复杂了，元素节点判断是不是静态节点的条件很多，咱们先一个个看。</p><p>首先如果 <code>node.pre</code> 为 <code>true</code> 直接认为当前节点是静态节点</p><ul><li><p>v-pre</p><ul><li><p><strong>用法</strong>： 跳过这个元素和它的子元素的编译过程。可以用来显示原始 <code>Mustache</code> 标签。跳过大量没有指令的节点会加快编译。</p></li><li><p><strong>示例</strong>：</p></li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-pre</span><span class="token punctuation">&gt;</span></span>{{ this will not be compiled }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p><strong>其次 <code>node.hasBindings</code> 不能为 <code>true</code>。</strong></p><p><code>node.hasBindings</code> 属性是在解析器转换 <code>AST</code> 时设置的，如果当前节点的 <code>attrs</code> 中，有 <code>v-</code>、<code>@</code>、<code>:</code>开头的 <code>attr</code>，就会把 <code>node.hasBindings</code> 设置为 <code>true</code>。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> dirRE <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^v-|^@|^:</span><span class="token regex-delimiter">/</span></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>dirRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// mark element as dynamic</span>
    el<span class="token punctuation">.</span>hasBindings <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>并且元素节点不能有 <code>if</code> 和 <code>for</code>属性。</strong></p><p><code>node.if</code> 和 <code>node.for</code> 也是在解析器转换 <code>AST</code> 时设置的。</p><p>在解析的时候发现节点使用了 <code>v-if</code>，就会在解析的时候给当前节点设置一个 <code>if</code> 属性。</p><p>就是说元素节点不能使用 <code>v-if</code> <code>v-for</code> <code>v-else</code> 等指令。</p><p><strong>并且元素节点不能是 <code>slot</code> 和 <code>component</code>。</strong></p><p><strong>并且元素节点不能是组件。</strong></p><p>例如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>List<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>不能是上面这样的自定义组件</p><p><strong>并且元素节点的父级节点不能是带 v-for 的 template</strong>不能被认定为静态节点</p><p>**并且元素节点上不能出现额外的属性。**不能被认定为静态节点</p><p>额外的属性指的是不能出现 <code>type</code> <code>tag</code> <code>attrsList</code> <code>attrsMap</code> <code>plain</code> <code>parent</code> <code>children</code> <code>attrs</code> <code>staticClass</code> <code>staticStyle</code> 这几个属性之外的其他属性，如果出现其他属性则认为当前节点不是静态节点。</p><p><strong>如何标记所有节点？</strong></p><p>上面讲如何判断单个节点是否是静态节点，<code>AST</code> 是一棵树，如何把所有的节点都打上标记（<code>static</code>）呢？</p><p>还有一个问题是，判断 <code>元素节点</code>是不是<code>静态节点</code>不能光看它自身是不是<code>静态节点</code>，如果它的<code>子节点</code>不是<code>静态节点</code>，那就算它自身符合上面讲的<code>静态节点</code>的条件，它也不是<code>静态节点</code>。</p><p>所以在 vue 中有这样一行代码：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> child <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token function">markStatic</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">.</span>static<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>markStatic</code> 可以给节点标记，规则上面刚讲过，<code>vue.js</code> 通过循环 <code>children</code> 打标记，然后每个不同的子节点又会走相同的逻辑去循环它的 <code>children</code> 这样递归下来所有的节点都会被打上标记。</p><p>然后在循环中判断，如果某个子节点不是 <code>静态节点</code>，那么讲当前节点的标记改为 <code>false</code>。</p><p>这样一圈下来之后 <code>AST</code> 上的所有节点都被准确的打上了标记。</p><p><strong>如何标记静态根节点？</strong></p><p>标记静态根节点其实也是递归的过程。</p><p>vue 中的实现大概是这样的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">markStaticRoots</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode<span class="token punctuation">,</span> <span class="token literal-property property">isInFor</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// For a node to qualify as a static root, it should have children that</span>
        <span class="token comment">// are not just static text. Otherwise the cost of hoisting out will</span>
        <span class="token comment">// outweigh the benefits and it&#39;s better off to just always render it fresh.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>static <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>
            node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
            node<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            node<span class="token punctuation">.</span>staticRoot <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            node<span class="token punctuation">.</span>staticRoot <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">markStaticRoots</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> isInFor <span class="token operator">||</span> <span class="token operator">!</span><span class="token operator">!</span>node<span class="token punctuation">.</span>for<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当前节点是<code>静态节点</code>，并且有<code>子节点</code>，并且<code>子节点</code>不是单个<code>静态文本节点</code>这种情况会将当前节点标记为<code>根静态节点</code>。</p><p>换句话说是文本节点的频繁和静态性不用作为根静态节点的标识</p><p>上面标记 <code>静态节点</code> 的时候有一段逻辑是只有所有 <code>子节点</code> 都是 <code>静态节点</code>，当前节点才是真正的 <code>静态节点</code>。</p><p>所以这里如果发现一个节点是 <code>静态节点</code>，那就能证明它的所有 <code>子节点</code> 也都是静态节点，而要标记的是 <code>静态根节点</code>，所以如果一个静态节点只包含了<code>一个文本节点</code>那就不会被标记为 <code>静态根节点</code>。</p><p><strong>总结</strong></p><p>整体逻辑其实就是递归 <code>AST</code> 这颗树，然后将 <code>静态节点</code> 和 <code>静态根节点</code> 找到并打上标记。</p><h2 id="代码生成器" tabindex="-1"><a class="header-anchor" href="#代码生成器" aria-hidden="true">#</a> <strong>代码生成器</strong></h2><hr><p>代码生成器的作用是使用 <code>element ASTs</code> 生成 <code>render</code> 函数代码字符串。</p><p>使用本文开头举的例子中的模板生成后的 <code>AST</code> 来生成 <code>render</code> 后是这样的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return _c(&#39;div&#39;,[_c(&#39;p&#39;,[_v(_s(name))])])}</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>格式化后是这样的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span>
        <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
        <span class="token function">_c</span><span class="token punctuation">(</span>
            <span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>
                <span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成后的代码字符串中看到了有几个函数调用 <code>_c</code>，<code>_v</code>，<code>_s</code>。</p><p><code>_c</code> 对应的是 <code>createElement</code>，它的作用是创建一个元素。</p><ol><li><p>第一个参数是一个HTML标签名</p></li><li><p>第二个参数是元素上使用的属性所对应的数据对象，可选项</p></li><li><p>第三个参数是 <code>children</code></p></li></ol><p>例如：</p><p>一个简单的模板：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Berwin<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>生成后的代码字符串是：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return _c(&#39;p&#39;,{attrs:{&quot;title&quot;:&quot;Berwin&quot;},on:{&quot;click&quot;:c}},[_v(&quot;1&quot;)])}</span><span class="token template-punctuation string">`</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>格式化后：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span>
        <span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">attrs</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;Berwin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">on</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;click&quot;</span><span class="token operator">:</span>c<span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>_v</code> 的意思是创建一个文本节点。</p><p><code>_s</code> 是返回参数中的字符串。</p><p>代码生成器的总体逻辑其实就是使用 <code>element ASTs</code> 去递归，然后拼出这样的 <code>_c(&#39;div&#39;,[_c(&#39;p&#39;,[_v(_s(name))])])</code> 字符串。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">genElement</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> el<span class="token punctuation">.</span>plain <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token function">genData</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>inlineTemplate <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
        
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
        data <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token comment">// data</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
        children <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token comment">// children</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
    
    <span class="token keyword">return</span> code
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为 <code>_c</code> 的参数需要 <code>tagName</code>、<code>data</code> 和 <code>children</code>。</p><p>所以上面这段代码的主要逻辑就是用 <code>genData</code> 和 <code>genChildren</code> 获取 <code>data</code> 和 <code>children</code>，然后拼到 <code>_c</code> 中去，拼完后把拼好的 <code>&quot;_c(tagName, data, children)&quot;</code> 返回。</p><p>重点的两个问题:</p><ol><li><p><code>data</code> 如何生成的（<code>genData</code> 的实现逻辑）？</p></li><li><p><code>children</code> 如何生成的（<code>genChildren</code> 的实现逻辑）？</p></li></ol><p>先看 <code>genData</code> 是怎样的实现逻辑：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">genData</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&#39;{&#39;</span>
    <span class="token comment">// key</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">key:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ref</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ref:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>ref<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>refInFor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">refInFor:true,</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token comment">// pre</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>pre<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">pre:true,</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ... 类似的还有很多种情况</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">,$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;}&#39;</span>
    <span class="token keyword">return</span> data
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，就是根据 <code>AST</code> 上当前节点上都有什么属性，然后针对不同的属性做一些不同的处理，最后拼出一个字符串~</p><p>然后在看看 <code>genChildren</code> 是怎样的实现的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">genChildren</span> <span class="token punctuation">(</span>
    <span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span>
    <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span>
<span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>children
    <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token function">genNode</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">genNode</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">genElement</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>isComment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">genComment</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">genText</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从上面代码中可以看出，生成 <code>children</code> 的过程其实就是循环 <code>AST</code> 中当前节点的 <code>children</code>，然后把每一项在重新按不同的节点类型去执行 <code>genElement</code> <code>genComment</code> <code>genText</code>。如果 <code>genElement</code> 中又有 <code>children</code> 在循环生成，如此反复递归，最后一圈跑完之后能拿到一个完整的 <code>render</code> 函数代码字符串，就是类似下面这个样子。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token string">&quot;_c(&#39;div&#39;,[_c(&#39;p&#39;,[_v(_s(name))])])&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>最后把生成的 <code>code</code> 装到 <code>with</code> 里。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generate</span> <span class="token punctuation">(</span>
    <span class="token parameter"><span class="token literal-property property">ast</span><span class="token operator">:</span> ASTElement <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span> CompilerOptions</span>
<span class="token punctuation">)</span><span class="token operator">:</span> CodegenResult <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CodegenState</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token comment">// 如果ast为空，则创建一个空div</span>
    <span class="token keyword">const</span> code <span class="token operator">=</span> ast <span class="token operator">?</span> <span class="token function">genElement</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;_c(&quot;div&quot;)&#39;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> <strong>总结</strong></h2><ul><li><p>解析器（parser）的作用是将 <code>模板字符串</code> 转换成 <code>element ASTs</code>。</p></li><li><p>优化器（optimizer）的作用是找出那些静态节点和静态根节点并打上标记。</p></li><li><p>代码生成器（code generator）的作用是使用 <code>element ASTs</code> 生成 render函数代码（generate render function code from element ASTs）。</p></li></ul><p><img src="https://camo.githubusercontent.com/0920aad6c6ccef524f2cbe808e85729960974f78/687474703a2f2f70332e7168696d672e636f6d2f743031393264303939313237633832396561392e706e67" alt="流程图"></p><p>解析器（parser）的原理是一小段一小段的去截取字符串，然后维护一个 <code>stack</code> 用来保存DOM深度，每截取到一段标签的开始就 <code>push</code> 到 <code>stack</code> 中，当所有字符串都截取完之后也就解析出了一个完整的 <code>AST</code>。</p><p>优化器（optimizer）的原理是用递归的方式将所有节点打标记，表示是否是一个 <code>静态节点</code>，然后再次递归一遍把 <code>静态根节点</code> 也标记出来。</p><p>代码生成器（code generator）的原理也是通过递归去拼一个函数执行代码的字符串，递归的过程根据不同的节点类型调用不同的生成方法，如果发现是一颗元素节点就拼一个 <code>_c(tagName, data, children)</code> 的函数调用字符串，然后 <code>data</code> 和 <code>children</code> 也是使用 <code>AST</code> 中的属性去拼字符串。</p><p>如果 <code>children</code> 中还有 <code>children</code> 则递归去拼。</p><p>最后拼出一个完整的 <code>render</code> 函数代码。</p><h2 id="vue-3-0-模板编译原理" tabindex="-1"><a class="header-anchor" href="#vue-3-0-模板编译原理" aria-hidden="true">#</a> <strong>vue 3.0 模板编译原理</strong></h2><hr><p>Vue 的编译模块包含 4 个目录：</p><p><code>compiler-core</code></p><p><code>compiler-dom</code> // 浏览器</p><p><code>compiler-sfc</code> // 单文件组件</p><p><code>compiler-ssr</code> // 服务端渲染</p><p>其中 <code>compiler-core</code> 模块是 Vue 编译的核心模块，并且是平台无关的。而剩下的三个都是在 <code>compiler-core</code> 的基础上针对不同的平台作了适配处理。</p><h2 id="parse" tabindex="-1"><a class="header-anchor" href="#parse" aria-hidden="true">#</a> <strong>Parse</strong></h2><p>Vue 在解析模板字符串时，可分为两种情况：以 <code>&lt;</code> 开头的字符串和不以 <code>&lt;</code> 开头的字符串。</p><p>不以 <code>&lt;</code> 开头的字符串有两种情况：它是文本节点或 <code>{{ exp }}</code> 插值表达式。</p><p>而以 &lt; 开头的字符串又分为以下几种情况：</p><ol><li><p>元素开始标签 <code>&lt;div&gt;</code></p></li><li><p>元素结束标签 <code>&lt;/div&gt;</code></p></li><li><p>注释节点 <code>&lt;!-- 123 --&gt;</code></p></li><li><p>文档声明 <code>&lt;!DOCTYPE html&gt;</code></p></li></ol><p>用伪代码表示，大概过程如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">while</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">startsWith</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&#39;{{&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果以 &#39;{{&#39; 开头</span>
        node <span class="token operator">=</span> <span class="token function">parseInterpolation</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> mode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;&lt;&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 以 &lt; 标签开头</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;!&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">startsWith</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&#39;&lt;!--&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 注释</span>
                node <span class="token operator">=</span> <span class="token function">parseComment</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">startsWith</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&#39;&lt;!DOCTYPE&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 文档声明，当成注释处理</span>
                node <span class="token operator">=</span> <span class="token function">parseBogusComment</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 结束标签</span>
            <span class="token function">parseTag</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> TagType<span class="token punctuation">.</span>End<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[a-z]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 开始标签</span>
            node <span class="token operator">=</span> <span class="token function">parseElement</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> ancestors<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 普通文本节点</span>
        node <span class="token operator">=</span> <span class="token function">parseText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> mode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在源码中对应的几个函数分别是：</p><ol><li><p><code>parseChildren()</code>，主入口。</p></li><li><p><code>parseInterpolation()</code>，解析双花插值表达式。</p></li><li><p><code>parseComment()</code>，解析注释。</p></li><li><p><code>parseBogusComment()</code>，解析文档声明。</p></li><li><p><code>parseTag()</code>，解析标签。</p></li><li><p><code>parseElement()</code>，解析元素节点，它会在内部执行 <code>parseTag()</code>。</p></li><li><p><code>parseText()</code>，解析普通文本。</p></li><li><p><code>parseAttribute()</code>，解析属性。</p></li></ol><p>每解析完一个标签、文本、注释等节点时，Vue 就会生成对应的 AST 节点，<strong>并且会把已经解析完的字符串给截断</strong>。</p><p>对字符串进行截断使用的是 <code>advanceBy(context, numberOfCharacters)</code> 函数，<code>context</code> 是字符串的上下文对象，<code>numberOfCharacters</code> 是要截断的字符数。</p><p>用一个简单的例子来模拟一下截断操作：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先解析 <code>&lt;div</code>，然后执行 <code>advanceBy(context, 4)</code> 进行截断操作（内部执行的是 <code>s = s.slice(4)</code>），变成：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>name=&quot;test&quot;&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再解析属性，并截断，变成：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

同理，后面的截断情况为：

&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 所有字符串已经解析完 --&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>AST 节点</strong></p><p>所有的 <code>AST</code> 节点定义都在 <code>compiler-core/ast.ts</code> 文件中，下面是一个元素节点的定义：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">BaseElementNode</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">ELEMENT</span> <span class="token comment">// 类型</span>
    <span class="token literal-property property">ns</span><span class="token operator">:</span> Namespace <span class="token comment">// 命名空间 默认为 HTML，即 0</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> string <span class="token comment">// 标签名</span>
    <span class="token literal-property property">tagType</span><span class="token operator">:</span> ElementTypes <span class="token comment">// 元素类型</span>
    <span class="token literal-property property">isSelfClosing</span><span class="token operator">:</span> boolean <span class="token comment">// 是否是自闭合标签 例如 &lt;br/&gt; &lt;hr/&gt;</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>AttributeNode <span class="token operator">|</span> DirectiveNode<span class="token operator">&gt;</span> <span class="token comment">// props 属性，包含 HTML 属性和指令</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> TemplateChildNode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 字节点</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一些简单的要点已经讲完了，下面再从一个比较复杂的例子来详细讲解一下 <code>parse</code> 的处理过程。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 这是注释 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ test }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    一个文本节点
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>good job!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的模板字符串假设为 <code>s</code>，第一个字符 <code>s[0]</code> 是 <code>&lt;</code> 开头，那说明它只能是刚才所说的四种情况之一。</p><p>这时需要再看一下 <code>s[1]</code> 的字符是什么：</p><ol><li><p>如果是 <code>!</code>，则调用字符串原生方法 <code>startsWith()</code> 看看是以 <code>&#39;&lt;!--&#39;</code> 开头还是以 <code>&#39;&lt;!DOCTYPE&#39;</code> 开头。虽然这两者对应的处理函数不一样，但它们最终都是解析为注释节点。</p></li><li><p>如果是 <code>/</code>，则按结束标签处理。</p></li><li><p>如果不是 <code>/</code>，则按开始标签处理。</p></li></ol><p>从的示例来看，这是一个 <code>&lt;div&gt;</code> 开始标签。</p><p>这里还有一点要提一下，Vue 会用一个栈 stack 来保存解析到的元素标签。当它遇到开始标签时，会将这个标签推入栈，遇到结束标签时，将刚才的标签弹出栈。<strong>它的作用是保存当前已经解析了，但还没解析完的元素标签。这个栈还有另一个作用，在解析到某个字节点时，通过 <code>stack[stack.length - 1]</code> 可以获取它的父元素。</strong></p><p>从的示例来看，它的出入栈顺序是这样的：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1. [div] // div 入栈
2. [div, p] // p 入栈
3. [div] // p 出栈
4. [div, div] // div 入栈
5. [div] // div 出栈
6. [] // 最后一个 div 出栈，模板字符串已解析完，这时栈为空
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着上文继续分析的示例，这时已经知道是 <code>div</code> 标签了，接下来会把已经解析完的 <code>&lt;div</code> 字符串截断，然后解析它的属性。</p><p><code>Vue</code> 的属性有两种情况：</p><ol><li><p><code>HTML</code> 普通属性</p></li><li><p><code>Vue</code> 指令</p></li></ol><p>根据属性的不同生成的节点不同，HTML 普通属性节点 type 为 6，Vue 指令节点 type 为 7。</p><p>所有的节点类型值如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">ROOT</span><span class="token punctuation">,</span>  <span class="token comment">// 根节点 0</span>
<span class="token constant">ELEMENT</span><span class="token punctuation">,</span> <span class="token comment">// 元素节点 1</span>
<span class="token constant">TEXT</span><span class="token punctuation">,</span> <span class="token comment">// 文本节点 2</span>
<span class="token constant">COMMENT</span><span class="token punctuation">,</span> <span class="token comment">// 注释节点 3</span>
<span class="token constant">SIMPLE_EXPRESSION</span><span class="token punctuation">,</span> <span class="token comment">// 表达式 4</span>
<span class="token constant">INTERPOLATION</span><span class="token punctuation">,</span> <span class="token comment">// 双花插值 {{ }} 5</span>
<span class="token constant">ATTRIBUTE</span><span class="token punctuation">,</span> <span class="token comment">// 属性 6</span>
<span class="token constant">DIRECTIVE</span><span class="token punctuation">,</span> <span class="token comment">// 指令 7</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性解析完后，<code>div</code> 开始标签也就解析完了，<code>&lt;div name=&quot;test&quot;&gt;</code> 这一行字符串已经被截断。现在剩下的字符串如下：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>    <span class="token comment">&lt;!-- 这是注释 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ test }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    一个文本节点
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>good job!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注释文本和普通文本节点解析规则都很简单，直接截断，生成节点。注释文本调用 <code>parseComment()</code> 函数处理，文本节点调用 <code>parseText()</code> 处理。</p><p>双花插值的字符串处理逻辑稍微复杂点，例如示例中的 <code>{{ test }}</code>：</p><ol><li><p>先将双花括号中的内容提取出来，即 <code>test</code>，再对它执行 <code>trim()</code>，去除空格。</p></li><li><p>然后会生成两个节点，一个节点是 <code>INTERPOLATION</code>，type 为 5，表示它是双花插值。</p></li><li><p>第二个节点是它的内容，即 <code>test</code>，它会生成一个 <code>SIMPLE_EXPRESSION</code> 节点，type 为 4。</p></li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">INTERPOLATION</span><span class="token punctuation">,</span> <span class="token comment">// 双花插值类型</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">SIMPLE_EXPRESSION</span><span class="token punctuation">,</span>
        <span class="token literal-property property">isStatic</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 非静态节点</span>
        <span class="token literal-property property">isConstant</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        content<span class="token punctuation">,</span>
        <span class="token literal-property property">loc</span><span class="token operator">:</span> <span class="token function">getSelection</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> innerStart<span class="token punctuation">,</span> innerEnd<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loc</span><span class="token operator">:</span> <span class="token function">getSelection</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> start<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>剩下的字符串解析逻辑和上文的差不多，就不解释了，最后这个示例解析出来的 AST 如下所示：</p><p><img src="https://camo.githubusercontent.com/e7c48876b208e006024c399586e31981d92d8183/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f63343764383037663062396434333037393631306635343162316139633934637e74706c762d6b3375316662706663702d7a6f6f6d2d312e696d616765" alt="示例图"></p><p>从 AST 上，还能看到某些节点上有一些别的属性：</p><ol><li><p><code>ns</code>，<code>命名空间</code>，一般为 HTML，值为 0。</p></li><li><p><code>loc</code>，它是一个<code>位置信息</code>，表明这个节点在源 HTML 字符串中的位置，包含行，列，偏移量等信息。</p></li><li><p><code>{{ test }}</code> 解析出来的节点会有一个 <code>isStatic</code> 属性，值为 false，表示这是一个动态节点。如果是静态节点，则只会生成一次，并且在后面的阶段一直复用同一个，不用进行 <code>diff</code> 比较。</p></li></ol><p>另外还有一个 tagType 属性，它有 4 个值：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> ElementTypes <span class="token punctuation">{</span>
    <span class="token constant">ELEMENT</span><span class="token punctuation">,</span> <span class="token comment">// 0 元素节点</span>
    <span class="token constant">COMPONENT</span><span class="token punctuation">,</span> <span class="token comment">// 1 组件</span>
    <span class="token constant">SLOT</span><span class="token punctuation">,</span> <span class="token comment">// 2 插槽</span>
    <span class="token constant">TEMPLATE</span> <span class="token comment">// 3 模板</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主要用于区分上述四种类型节点。</p><h2 id="transform" tabindex="-1"><a class="header-anchor" href="#transform" aria-hidden="true">#</a> <strong>Transform</strong></h2><p>在 <code>transform</code> 阶段，Vue 会对 <code>AST</code> 进行一些转换操作，主要是根据不同的 <code>AST</code> 节点添加不同的选项参数，这些参数在 <code>codegen</code> 阶段会用到。下面列举一些比较重要的选项：</p><p><strong>cacheHandlers</strong></p><p>如果 <code>cacheHandlers</code> 的值为 <code>true</code>，则表示开启事件函数缓存。例如 <code>@click=&quot;foo&quot;</code> 默认编译为 <code>{ onClick: foo }</code>，如果开启了这个选项，则编译为</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span> <span class="token literal-property property">onClick</span><span class="token operator">:</span> _cache<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_cache<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> _ctx<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>hoistStatic</strong></p><p><strong>hoistStatic 是一个标识符，表示要不要开启静态节点提升</strong>。如果值为 true，静态节点将被提升到 <code>render()</code> 函数外面生成，并被命名为 <code>_hoisted_x</code> 变量。</p><p>例如 <code>一个文本节点</code> 生成的代码为 <code>const _hoisted_2 = /*#__PURE__*/_createTextVNode(&quot; 一个文本节点 &quot;)</code>。</p><p>下面两张图，前者是 <code>hoistStatic = false</code>，后面是 <code>hoistStatic = true</code></p><p><a href="https://vue-next-template-explorer.netlify.app/#%7B%22src%22%3A%22%5Cr%5Cn%22%2C%22options%22%3A%7B%22mode%22%3A%22module%22%2C%22prefixIdentifiers%22%3Afalse%2C%22optimizeImports%22%3Afalse%2C%22hoistStatic%22%3Afalse%2C%22cacheHandlers%22%3Afalse%2C%22scopeId%22%3Anull%2C%22ssrCssVars%22%3A%22%7B%20color%20%7D%22%2C%22bindingMetadata%22%3A%7B%22TestComponent%22%3A%22setup%22%2C%22foo%22%3A%22setup%22%2C%22bar%22%3A%22props%22%7D%7D%7D" target="_blank" rel="noopener noreferrer">网站地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://camo.githubusercontent.com/d81b9663a841909b491a49d5e66e41666e64f660/68747470733a2f2f70392d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f35626466386535656130643734306236393765376233653864643031316565657e74706c762d6b3375316662706663702d7a6f6f6d2d312e696d616765" alt="示例图1"></p><p><img src="https://camo.githubusercontent.com/f7bc66fd01b821fbdd718ef2036251736af996aa/68747470733a2f2f70332d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f34363137396236396338396334346334393966613062393530343963656264317e74706c762d6b3375316662706663702d7a6f6f6d2d312e696d616765" alt="示例图2"></p><p><strong>prefixIdentifiers</strong></p><p>这个参数的作用是用于代码生成。例如 <code>{{ foo }}</code> 在 module 模式下生成的代码为 <code>_ctx.foo</code>，而在 function 模式下是 <code>with (this) { ... }</code>。因为在 module 模式下，默认为严格模式，不能使用 <code>with</code> 语句。</p><p><strong>PatchFlags</strong></p><p><code>transform</code> 在对 <code>AST</code> 节点进行转换时，会打上 <code>patchflag</code> 参数，这个参数主要用于 <code>diff</code> 比较过程。当 <code>DOM</code> 节点有这个标志并且大于 0，就代表要更新，没有就跳过。</p><p>来看一下 patchflag 的取值范围：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> PatchFlags <span class="token punctuation">{</span>
    <span class="token comment">// 动态文本节点</span>
    <span class="token constant">TEXT</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>

    <span class="token comment">// 动态 class</span>
    <span class="token constant">CLASS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 2</span>

    <span class="token comment">// 动态 style</span>
    <span class="token constant">STYLE</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 4</span>

    <span class="token comment">// 动态属性，但不包含类名和样式</span>
    <span class="token comment">// 如果是组件，则可以包含类名和样式</span>
    <span class="token constant">PROPS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 8</span>

    <span class="token comment">// 具有动态 key 属性，当 key 改变时，需要进行完整的 diff 比较。</span>
    <span class="token constant">FULL_PROPS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// 16</span>

    <span class="token comment">// 带有监听事件的节点</span>
    <span class="token constant">HYDRATE_EVENTS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 32</span>

    <span class="token comment">// 一个不会改变子节点顺序的 fragment</span>
    <span class="token constant">STABLE_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// 64</span>

    <span class="token comment">// 带有 key 属性的 fragment 或部分子字节有 key</span>
    <span class="token constant">KEYED_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">// 128</span>

    <span class="token comment">// 子节点没有 key 的 fragment</span>
    <span class="token constant">UNKEYED_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">// 256</span>

    <span class="token comment">// 一个节点只会进行非 props 比较</span>
    <span class="token constant">NEED_PATCH</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token comment">// 512</span>

    <span class="token comment">// 动态 slot</span>
    <span class="token constant">DYNAMIC_SLOTS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 1024</span>

    <span class="token comment">// 静态节点</span>
    <span class="token constant">HOISTED</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>

    <span class="token comment">// 指示在 diff 过程应该要退出优化模式</span>
    <span class="token constant">BAIL</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从上述代码可以看出 <code>patchflag</code> 使用一个 11 位的位图来表示不同的值，每个值都有不同的含义。Vue 在 <code>diff</code> 过程会根据不同的 <code>patchflag</code> 使用不同的 <code>patch</code> 方法。</p><p>下图是经过 <code>transform</code> 后的 <code>AST</code>：</p><p><img src="https://camo.githubusercontent.com/966c1e5e051d6afcd506c8c8cf25d14b46cd4c88/68747470733a2f2f70392d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f36626163383830323465616434636363613161396265356533323236303836617e74706c762d6b3375316662706663702d7a6f6f6d2d312e696d616765" alt="示例图"></p><p>可以看到 <code>codegenNode</code>、<code>helpers</code> 和 <code>hoists</code> 已经被填充上了相应的值。<strong><code>codegenNode</code> 是生成代码要用到的数据</strong>，<strong><code>hoists</code> 存储的是静态节点</strong>，<strong><code>helpers</code> 存储的是创建 VNode 的函数名称（其实是 Symbol）</strong>。</p><p>在正式开始 <code>transform</code> 前，需要创建一个 <code>transformContext</code>，即 <code>transform</code> 上下文。和这三个属性有关的数据和方法如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">helpers</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token literal-property property">hoists</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token comment">// methods</span>
<span class="token function">helper</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">return</span> name
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">helperString</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>helperNameMap<span class="token punctuation">[</span>context<span class="token punctuation">.</span><span class="token function">helper</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">hoist</span><span class="token punctuation">(</span><span class="token parameter">exp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span>hoists<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span>
    <span class="token keyword">const</span> identifier <span class="token operator">=</span> <span class="token function">createSimpleExpression</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_hoisted_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>context<span class="token punctuation">.</span>hoists<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token boolean">false</span><span class="token punctuation">,</span>
        exp<span class="token punctuation">.</span>loc<span class="token punctuation">,</span>
        <span class="token boolean">true</span>
    <span class="token punctuation">)</span>
    identifier<span class="token punctuation">.</span>hoisted <span class="token operator">=</span> exp
    <span class="token keyword">return</span> identifier
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>来看一下具体的 <code>transform</code> 过程是怎样的，用 <code>&lt;p&gt;{{ test }}&lt;/p&gt;</code> 来做示例。</p><p>这个节点对应的是 <code>transformElement()</code> 转换函数，由于 <code>p</code> 没有绑定动态属性，没有绑定指令，所以重点不在它，而是在 <code>{{ test }}</code> 上。<code>{{ test }}</code> 是一个双花插值表达式，所以将它的 <code>patchFlag</code> 设为 1（动态文本节点），对应的执行代码是 <code>patchFlag |= 1</code>。然后再执行 <code>createVNodeCall()</code> 函数，它的返回值就是这个节点的 <code>codegenNode</code> 值。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>node<span class="token punctuation">.</span>codegenNode <span class="token operator">=</span> <span class="token function">createVNodeCall</span><span class="token punctuation">(</span>
    context<span class="token punctuation">,</span>
    vnodeTag<span class="token punctuation">,</span>
    vnodeProps<span class="token punctuation">,</span>
    vnodeChildren<span class="token punctuation">,</span>
    vnodePatchFlag<span class="token punctuation">,</span>
    vnodeDynamicProps<span class="token punctuation">,</span>
    vnodeDirectives<span class="token punctuation">,</span>
    <span class="token operator">!</span><span class="token operator">!</span>shouldUseBlock<span class="token punctuation">,</span>
    <span class="token boolean">false</span> <span class="token comment">/* disableTracking */</span><span class="token punctuation">,</span>
    node<span class="token punctuation">.</span>loc
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>createVNodeCall()</code> 根据这个节点添加了一个 <code>createVNode</code> <code>Symbol</code> 符号，它放在 <code>helpers</code> 里。其实就是要在代码生成阶段引入的帮助函数。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// createVNodeCall() 内部执行过程，已删除多余的代码</span>
context<span class="token punctuation">.</span><span class="token function">helper</span><span class="token punctuation">(</span><span class="token constant">CREATE_VNODE</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">VNODE_CALL</span><span class="token punctuation">,</span>
    tag<span class="token punctuation">,</span>
    props<span class="token punctuation">,</span>
    children<span class="token punctuation">,</span>
    patchFlag<span class="token punctuation">,</span>
    dynamicProps<span class="token punctuation">,</span>
    directives<span class="token punctuation">,</span>
    isBlock<span class="token punctuation">,</span>
    disableTracking<span class="token punctuation">,</span>
    loc
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>hoists</strong></p><p>一个节点是否添加到 <code>hoists</code> 中，主要看它是不是静态节点，并且需要将 <code>hoistStatic</code> 设为 <code>true</code>。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> // 属性静态节点
    <span class="token comment">&lt;!-- 这是注释 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ test }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    一个文本节点 // 静态节点
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>good job!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> // 静态节点
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，上面有三个静态节点，所以 <code>hoists</code> 数组有 3 个值。并且无论静态节点嵌套有多深，都会被提升到 <code>hoists</code> 中。</p><p><strong>type 变化</strong></p><p>从上图可以看到，最外层的 <code>div</code> 的 <code>type</code> 原来为 1，经过 <code>transform</code> 生成的 <code>codegenNode</code> 中的 <code>type</code> 变成了 13。 这个 13 是代码生成对应的类型 <code>VNODE_CALL</code>。另外还有:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// codegen</span>
<span class="token constant">VNODE_CALL</span><span class="token punctuation">,</span> <span class="token comment">// 13</span>
<span class="token constant">JS_CALL_EXPRESSION</span><span class="token punctuation">,</span> <span class="token comment">// 14</span>
<span class="token constant">JS_OBJECT_EXPRESSION</span><span class="token punctuation">,</span> <span class="token comment">// 15</span>
<span class="token constant">JS_PROPERTY</span><span class="token punctuation">,</span> <span class="token comment">// 16</span>
<span class="token constant">JS_ARRAY_EXPRESSION</span><span class="token punctuation">,</span> <span class="token comment">// 17</span>
<span class="token constant">JS_FUNCTION_EXPRESSION</span><span class="token punctuation">,</span> <span class="token comment">// 18</span>
<span class="token constant">JS_CONDITIONAL_EXPRESSION</span><span class="token punctuation">,</span> <span class="token comment">// 19</span>
<span class="token constant">JS_CACHE_EXPRESSION</span><span class="token punctuation">,</span> <span class="token comment">// 20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>刚才提到的例子 <code>{{ test }}</code>，它的 <code>codegenNode</code> 就是通过调用 <code>createVNodeCall()</code> 生成的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> NodeTypes<span class="token punctuation">.</span><span class="token constant">VNODE_CALL</span><span class="token punctuation">,</span>
    tag<span class="token punctuation">,</span>
    props<span class="token punctuation">,</span>
    children<span class="token punctuation">,</span>
    patchFlag<span class="token punctuation">,</span>
    dynamicProps<span class="token punctuation">,</span>
    directives<span class="token punctuation">,</span>
    isBlock<span class="token punctuation">,</span>
    disableTracking<span class="token punctuation">,</span>
    loc
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以从上述代码看到，<code>type</code> 被设置为 <code>NodeTypes.VNODE_CALL</code>，即 13。</p><p>每个不同的节点都由不同的 <code>transform</code> 函数来处理，由于篇幅有限，具体代码请自行查阅。</p><h2 id="codegen" tabindex="-1"><a class="header-anchor" href="#codegen" aria-hidden="true">#</a> <strong>Codegen</strong></h2><p>代码生成阶段最后生成了一个字符串，把字符串的双引号去掉，看一下具体的内容是什么：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> _Vue <span class="token operator">=</span> Vue
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">createVNode</span><span class="token operator">:</span> _createVNode<span class="token punctuation">,</span> <span class="token literal-property property">createCommentVNode</span><span class="token operator">:</span> _createCommentVNode<span class="token punctuation">,</span> <span class="token literal-property property">createTextVNode</span><span class="token operator">:</span> _createTextVNode <span class="token punctuation">}</span> <span class="token operator">=</span> _Vue

<span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> _hoisted_2 <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_createTextVNode</span><span class="token punctuation">(</span><span class="token string">&quot; 一个文本节点 &quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> _hoisted_3 <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;good job!&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">/* HOISTED */</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">with</span> <span class="token punctuation">(</span>_ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">createCommentVNode</span><span class="token operator">:</span> _createCommentVNode<span class="token punctuation">,</span> <span class="token literal-property property">toDisplayString</span><span class="token operator">:</span> _toDisplayString<span class="token punctuation">,</span> <span class="token literal-property property">createVNode</span><span class="token operator">:</span> _createVNode<span class="token punctuation">,</span> <span class="token literal-property property">createTextVNode</span><span class="token operator">:</span> _createTextVNode<span class="token punctuation">,</span> <span class="token literal-property property">openBlock</span><span class="token operator">:</span> _openBlock<span class="token punctuation">,</span> <span class="token literal-property property">createBlock</span><span class="token operator">:</span> _createBlock <span class="token punctuation">}</span> <span class="token operator">=</span> _Vue

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> _hoisted_1<span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token function">_createCommentVNode</span><span class="token punctuation">(</span><span class="token string">&quot; 这是注释 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            _hoisted_2<span class="token punctuation">,</span>
            _hoisted_3
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>代码生成模式</strong></p><p>可以看到上述代码最后返回一个 <code>render()</code> 函数，作用是生成对应的 <code>VNode</code>。</p><p>其实代码生成有两种模式：<code>module</code> 和 <code>function</code>，由标识符 <code>prefixIdentifiers</code> 决定使用哪种模式。</p><p><code>function</code> 模式的特点是：使用 <code>const { helpers... } = Vue</code> 的方式来引入帮助函数，也就是是 <code>createVode()</code> <code>createCommentVNode()</code> 这些函数。向外导出使用 <code>return</code> 返回整个 <code>render()</code> 函数。</p><p><code>module</code> 模式的特点是：使用 <code>es6</code> 模块来导入导出函数，也就是使用 <code>import</code> 和 <code>export</code>。</p><p><strong>静态节点</strong></p><p>另外还有三个变量是用 <code>_hoisted_</code> 命名的，后面跟着数字，代表这是第几个静态变量。</p><p>再看一下 parse 阶段的 HTML 模板字符串：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 这是注释 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ test }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    一个文本节点
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>good job!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个示例只有一个动态节点，即 <code>{{ test }}</code>，剩下的全是静态节点。从生成的代码中也可以看出，生成的节点和模板中的代码是一一对应的。静态节点的作用就是只生成一次，以后直接复用。</p><p>细心的网友可能发现了 <code>_hoisted_2</code> 和 <code>_hoisted_3</code> 变量中都有一个 <code>/*#__PURE__*/</code> 注释。</p><p>这个注释的作用是表示这个函数是纯函数，没有副作用，主要用于 <code>tree-shaking</code>。压缩工具在打包时会将未被使用的代码直接删除（shaking 摇掉）。</p><p>再来看一下生成动态节点 <code>{{ test }}</code> 的代码： <code>_createVNode(&quot;p&quot;, null, _toDisplayString(test), 1 /* TEXT */)</code>。</p><p>其中 <code>_toDisplayString(test)</code> 的内部实现是：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">return</span> val <span class="token operator">==</span> <span class="token keyword">null</span>
    <span class="token operator">?</span> <span class="token string">&#39;&#39;</span>
    <span class="token operator">:</span> <span class="token function">isObject</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
        <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> replacer<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码很简单，就是转成字符串输出。</p><p>而 <code>_createVNode(&quot;p&quot;, null, _toDisplayString(test), 1 /* TEXT */)</code> 最后一个参数 1 就是 <code>transform</code> 添加的 <code>patchflag</code> 了。</p><p><strong>帮助函数 helpers</strong></p><p>在 <code>transform</code>、<code>codegen</code> 这两个阶段，都能看到 <code>helpers</code> 的影子，到底 <code>helpers</code> 是干什么用的？</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Name mapping for runtime helpers that need to be imported from &#39;vue&#39; in</span>
<span class="token comment">// generated code. Make sure these are correctly exported in the runtime!</span>
<span class="token comment">// Using `any` here because TS doesn&#39;t allow symbols as index type.</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token literal-property property">helperNameMap</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token constant">FRAGMENT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Fragment</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">TELEPORT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Teleport</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">SUSPENSE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Suspense</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">KEEP_ALIVE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">KeepAlive</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">BASE_TRANSITION</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">BaseTransition</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">OPEN_BLOCK</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">openBlock</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">CREATE_BLOCK</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">createBlock</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">CREATE_VNODE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">createVNode</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">CREATE_COMMENT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">createCommentVNode</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">CREATE_TEXT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">createTextVNode</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">CREATE_STATIC</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">createStaticVNode</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">RESOLVE_COMPONENT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">resolveComponent</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">RESOLVE_DYNAMIC_COMPONENT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">resolveDynamicComponent</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">RESOLVE_DIRECTIVE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">resolveDirective</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">WITH_DIRECTIVES</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">withDirectives</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">RENDER_LIST</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">renderList</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">RENDER_SLOT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">renderSlot</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">CREATE_SLOTS</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">createSlots</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">TO_DISPLAY_STRING</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">toDisplayString</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">MERGE_PROPS</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mergeProps</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">TO_HANDLERS</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">toHandlers</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">CAMELIZE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">camelize</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">CAPITALIZE</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">capitalize</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">SET_BLOCK_TRACKING</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">setBlockTracking</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">PUSH_SCOPE_ID</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">pushScopeId</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">POP_SCOPE_ID</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">popScopeId</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">WITH_SCOPE_ID</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">withScopeId</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">WITH_CTX</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">withCtx</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">registerRuntimeHelpers</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">helpers</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>helpers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">s</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        helperNameMap<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> helpers<span class="token punctuation">[</span>s<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其实帮助函数就是在代码生成时从 <code>Vue</code> 引入的一些函数，以便让程序正常执行，从上面生成的代码中就可以看出来。而 <code>helperNameMap</code> 是默认的映射表名称，这些名称就是要从 <code>Vue</code> 引入的函数名称。</p><p>另外，还能看到一个注册函数 <code>registerRuntimeHelpers(helpers: any())</code>，它是干什么用的呢？</p><p>知道编译模块 <code>compiler-core</code> 是平台无关的，而 <code>compiler-dom</code> 是浏览器相关的编译模块。为了能在浏览器正常运行 <code>Vue</code> 程序，就得把浏览器相关的 <code>Vue 数据和函数导入进来</code>。 <code>registerRuntimeHelpers(helpers: any()</code> 正是用来做这件事的，从 compiler-dom 的 runtimeHelpers.ts 文件就能看出来：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">registerRuntimeHelpers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token constant">V_MODEL_RADIO</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vModelRadio</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">V_MODEL_CHECKBOX</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vModelCheckbox</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">V_MODEL_TEXT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vModelText</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">V_MODEL_SELECT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vModelSelect</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">V_MODEL_DYNAMIC</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vModelDynamic</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">V_ON_WITH_MODIFIERS</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">withModifiers</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">V_ON_WITH_KEYS</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">withKeys</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">V_SHOW</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vShow</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">TRANSITION</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Transition</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">TRANSITION_GROUP</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">TransitionGroup</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>它运行 <code>registerRuntimeHelpers(helpers: any()</code>，往映射表注入了浏览器相关的部分函数。</p><p><strong>helpers 是怎么使用的呢?</strong></p><p>在 parse 阶段，解析到不同节点时会生成对应的 type。</p><p>在 <code>transform</code> 阶段，会生成一个 <code>helpers</code>，它是一个 <code>set</code> 数据结构。每当它转换 <code>AST</code> 时，都会根据 <code>AST</code> 节点的 <code>type</code> 添加不同的 <code>helper</code> 函数。</p><p>例如，假设它现在正在转换的是一个注释节点，它会执行 <code>context.helper(CREATE_COMMENT)</code>，内部实现相当于 <code>helpers.add(&#39;createCommentVNode&#39;)</code>。然后在 <code>codegen</code> 阶段，遍历 <code>helpers</code>，将程序需要的函数从 <code>Vue</code> 里导入，代码实现如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 这是 module 模式</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import { </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ast<span class="token punctuation">.</span>helpers
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">s</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>helperNameMap<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> as _</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>helperNameMap<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;, &#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> } from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>runtimeModuleName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>如何生成代码？</strong></p><p>从 codegen.ts 文件中，可以看到很多代码生成函数：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 代码生成入口文件</span>
<span class="token function">genFunctionExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 生成函数表达式</span>
<span class="token function">genNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 生成 Vnode 节点</span>
<span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成代码则是根据不同的 AST 节点调用不同的代码生成函数，最终将代码字符串拼在一起，输出一个完整的代码字符串。</p><p>老规矩，还是看一个例子：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> _hoisted_2 <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_createTextVNode</span><span class="token punctuation">(</span><span class="token string">&quot; 一个文本节点 &quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> _hoisted_3 <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;good job!&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">/* HOISTED */</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看一下这段代码是怎么生成的，首先执行 <code>genHoists(ast.hoists, context)</code>，将 <code>transform</code> 生成的静态节点数组 <code>hoists</code> 作为第一个参数。<code>genHoists()</code> 内部实现：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>hoists<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">exp<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>exp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const _hoisted_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">genNode</span><span class="token punctuation">(</span>exp<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">newline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从上述代码可以看到，遍历 <code>hoists</code> 数组，调用 <code>genNode(exp, context)</code>。<code>genNode()</code> 根据不同的 <code>type</code> 执行不同的函数。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这一行代码中的 <code>const _hoisted_1 =</code> 由 <code>genHoists()</code> 生成，<code>{ name: &quot;test&quot; }</code> 由 <code>genObjectExpression()</code> 生成。 同理，剩下的两行代码生成过程也是如此，只是最终调用的函数不同。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: dean@57blocks.com">DeanSui</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/notes/assets/app.e9fd9ffa.js" defer></script>
  </body>
</html>
