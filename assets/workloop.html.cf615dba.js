import{_ as t}from"./plugin-vue_export-helper.21dcd24c.js";import{r as l,o as a,c as s,b as e,d,e as o,a as i}from"./app.285b12f0.js";const n={},h=e("h1",{id:"react-\u5DE5\u4F5C\u5FAA\u73AF-workloop",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#react-\u5DE5\u4F5C\u5FAA\u73AF-workloop","aria-hidden":"true"},"#"),o(" React \u5DE5\u4F5C\u5FAA\u73AF (workLoop)")],-1),_=e("p",null,[o("\u5728\u524D\u6587("),e("a",{href:"./macro-structure"},"React \u5E94\u7528\u7684\u5B8F\u89C2\u5305\u7ED3\u6784"),o(")\u4E2D, \u4ECB\u7ECD\u4E86"),e("code",null,"react"),o("\u6838\u5FC3\u5305\u4E4B\u95F4\u7684\u4F9D\u8D56\u548C\u8C03\u7528\u5173\u7CFB, \u5E76\u7ED8\u5236\u51FA\u4E86\u6982\u89C8\u56FE. \u5728\u6982\u89C8\u56FE\u4E2D, \u53EF\u4EE5\u770B\u5230\u6709\u4E24\u4E2A\u5927\u7684\u5FAA\u73AF, \u5B83\u4EEC\u5206\u522B\u4F4D\u4E8E"),e("code",null,"scheduler"),o("\u548C"),e("code",null,"react-reconciler"),o("\u5305\u4E2D:")],-1),u=["src"],p=e("p",null,[o("\u672C\u6587\u5C06\u8FD9\u4E24\u4E2A\u5FAA\u73AF\u5206\u522B\u8868\u8FF0\u4E3A"),e("code",null,"\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF"),o("\u548C"),e("code",null,"fiber\u6784\u9020\u5FAA\u73AF"),o(". \u63A5\u4E0B\u6765\u4ECE\u5B8F\u89C2\u89D2\u5EA6\u9610\u8FF0\u8FD9\u4E24\u5927\u5FAA\u73AF\u7684\u4F5C\u7528, \u4EE5\u53CA\u5B83\u4EEC\u4E4B\u95F4\u7684\u533A\u522B\u548C\u8054\u7CFB. \u66F4\u6DF1\u5165\u7684\u6E90\u7801\u5206\u6790\u5206\u522B\u5728"),e("code",null,"scheduler \u8C03\u5EA6\u673A\u5236"),o("\u548C"),e("code",null,"fiber \u6811\u6784\u9020"),o("\u7AE0\u8282\u4E2D\u8BE6\u7EC6\u89E3\u8BFB.")],-1),f=e("ol",null,[e("li",null,[e("code",null,"\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF")])],-1),k=o("\u6E90\u7801\u4F4D\u4E8E"),b={href:"https://github.com/facebook/react/blob/v17.0.2/packages/scheduler/src/Scheduler.js",target:"_blank",rel:"noopener noreferrer"},m=e("code",null,"Scheduler.js",-1),g=o(", \u5B83\u662F"),x=e("code",null,"react",-1),R=o("\u5E94\u7528\u5F97\u4EE5\u8FD0\u884C\u7684\u4FDD\u8BC1, \u5B83\u9700\u8981\u5FAA\u73AF\u8C03\u7528, \u63A7\u5236\u6240\u6709\u4EFB\u52A1("),w=e("code",null,"task",-1),v=o(")\u7684\u8C03\u5EA6."),S=e("ol",{start:"2"},[e("li",null,[e("code",null,"fiber\u6784\u9020\u5FAA\u73AF")])],-1),j=o("\u6E90\u7801\u4F4D\u4E8E"),L={href:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js",target:"_blank",rel:"noopener noreferrer"},O=e("code",null,"ReactFiberWorkLoop.js",-1),W=o(", \u63A7\u5236 fiber \u6811\u7684\u6784\u9020, \u6574\u4E2A\u8FC7\u7A0B\u662F\u4E00\u4E2A"),B=e("a",{href:"../algorithm/dfs"},"\u6DF1\u5EA6\u4F18\u5148\u904D\u5386",-1),N=o("."),V=i('<p>\u8FD9\u4E24\u4E2A\u5FAA\u73AF\u5BF9\u5E94\u7684 js \u6E90\u7801\u4E0D\u540C\u4E8E\u5176\u4ED6\u95ED\u5305(\u8FD0\u884C\u65F6\u5C31\u662F\u95ED\u5305), \u5176\u4E2D\u5B9A\u4E49\u7684\u5168\u5C40\u53D8\u91CF, \u4E0D\u4EC5\u662F\u8BE5\u4F5C\u7528\u57DF\u7684\u79C1\u6709\u53D8\u91CF, \u66F4\u7528\u4E8E<code>\u63A7\u5236react\u5E94\u7528\u7684\u6267\u884C\u8FC7\u7A0B</code>.</p><h2 id="\u533A\u522B\u4E0E\u8054\u7CFB" tabindex="-1"><a class="header-anchor" href="#\u533A\u522B\u4E0E\u8054\u7CFB" aria-hidden="true">#</a> \u533A\u522B\u4E0E\u8054\u7CFB</h2><ol><li><p>\u533A\u522B</p><ul><li><code>\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF</code>\u662F\u4EE5<code>\u4E8C\u53C9\u5806</code>\u4E3A\u6570\u636E\u7ED3\u6784(\u8BE6\u89C1<a href="../algorithm/heapsort">react \u7B97\u6CD5\u4E4B\u5806\u6392\u5E8F</a>), \u5FAA\u73AF\u6267\u884C<code>\u5806</code>\u7684\u9876\u70B9, \u76F4\u5230<code>\u5806</code>\u88AB\u6E05\u7A7A.</li><li><code>\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF</code>\u7684\u903B\u8F91\u504F\u5411\u5B8F\u89C2, \u5B83\u8C03\u5EA6\u7684\u662F\u6BCF\u4E00\u4E2A\u4EFB\u52A1(<code>task</code>), \u800C\u4E0D\u5173\u5FC3\u8FD9\u4E2A\u4EFB\u52A1\u5177\u4F53\u662F\u5E72\u4EC0\u4E48\u7684(\u751A\u81F3\u53EF\u4EE5\u5C06<code>Scheduler</code>\u5305\u8131\u79BB<code>react</code>\u4F7F\u7528), \u5177\u4F53\u4EFB\u52A1\u5176\u5B9E\u5C31\u662F\u6267\u884C\u56DE\u8C03\u51FD\u6570<code>performSyncWorkOnRoot</code>\u6216<code>performConcurrentWorkOnRoot</code>.</li><li><code>fiber\u6784\u9020\u5FAA\u73AF</code>\u662F\u4EE5<code>\u6811</code>\u4E3A\u6570\u636E\u7ED3\u6784, \u4ECE\u4E0A\u81F3\u4E0B\u6267\u884C\u6DF1\u5EA6\u4F18\u5148\u904D\u5386(\u8BE6\u89C1<a href="../algorithm/dfs">react \u7B97\u6CD5\u4E4B\u6DF1\u5EA6\u4F18\u5148\u904D\u5386</a>).</li><li><code>fiber\u6784\u9020\u5FAA\u73AF</code>\u7684\u903B\u8F91\u504F\u5411\u5177\u4F53\u5B9E\u73B0, \u5B83\u53EA\u662F\u4EFB\u52A1(<code>task</code>)\u7684\u4E00\u90E8\u5206(\u5982<code>performSyncWorkOnRoot</code>\u5305\u62EC: <code>fiber</code>\u6811\u7684\u6784\u9020, <code>DOM</code>\u6E32\u67D3, \u8C03\u5EA6\u68C0\u6D4B), \u53EA\u8D1F\u8D23<code>fiber</code>\u6811\u7684\u6784\u9020.</li></ul></li><li><p>\u8054\u7CFB</p><ul><li><code>fiber\u6784\u9020\u5FAA\u73AF</code>\u662F<code>\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF</code>\u4E2D\u7684\u4EFB\u52A1(<code>task</code>)\u7684\u4E00\u90E8\u5206. \u5B83\u4EEC\u662F\u4ECE\u5C5E\u5173\u7CFB, \u6BCF\u4E2A\u4EFB\u52A1\u90FD\u4F1A\u91CD\u65B0\u6784\u9020\u4E00\u4E2A<code>fiber</code>\u6811.</li></ul></li></ol><h2 id="\u4E3B\u5E72\u903B\u8F91" tabindex="-1"><a class="header-anchor" href="#\u4E3B\u5E72\u903B\u8F91" aria-hidden="true">#</a> \u4E3B\u5E72\u903B\u8F91</h2><p>\u901A\u8FC7\u4E0A\u6587\u7684\u63CF\u8FF0, \u4E24\u5927\u5FAA\u73AF\u7684\u5206\u5DE5\u53EF\u4EE5\u603B\u7ED3\u4E3A: \u5927\u5FAA\u73AF(\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF)\u8D1F\u8D23\u8C03\u5EA6<code>task</code>, \u5C0F\u5FAA\u73AF(fiber \u6784\u9020\u5FAA\u73AF)\u8D1F\u8D23\u5B9E\u73B0<code>task</code> .</p><p>react \u8FD0\u884C\u7684\u4E3B\u5E72\u903B\u8F91, \u5373\u5C06<code>\u8F93\u5165\u8F6C\u6362\u4E3A\u8F93\u51FA</code>\u7684\u6838\u5FC3\u6B65\u9AA4, \u5B9E\u9645\u4E0A\u5C31\u662F\u56F4\u7ED5\u8FD9\u4E24\u5927\u5DE5\u4F5C\u5FAA\u73AF\u8FDB\u884C\u5C55\u5F00.</p><p>\u7ED3\u5408\u4E0A\u6587\u7684\u5B8F\u89C2\u6982\u89C8\u56FE(\u5C55\u793A\u6838\u5FC3\u5305\u4E4B\u95F4\u7684\u8C03\u7528\u5173\u7CFB), \u53EF\u4EE5\u5C06 react \u8FD0\u884C\u7684\u4E3B\u5E72\u903B\u8F91\u8FDB\u884C\u6982\u62EC:</p><ol><li>\u8F93\u5165: \u5C06\u6BCF\u4E00\u6B21\u66F4\u65B0(\u5982: \u65B0\u589E, \u5220\u9664, \u4FEE\u6539\u8282\u70B9\u4E4B\u540E)\u89C6\u4E3A\u4E00\u6B21<code>\u66F4\u65B0\u9700\u6C42</code>(\u76EE\u7684\u662F\u8981\u66F4\u65B0<code>DOM</code>\u8282\u70B9).</li><li>\u6CE8\u518C\u8C03\u5EA6\u4EFB\u52A1: <code>react-reconciler</code>\u6536\u5230<code>\u66F4\u65B0\u9700\u6C42</code>\u4E4B\u540E, \u5E76\u4E0D\u4F1A\u7ACB\u5373\u6784\u9020<code>fiber\u6811</code>, \u800C\u662F\u53BB\u8C03\u5EA6\u4E2D\u5FC3<code>scheduler</code>\u6CE8\u518C\u4E00\u4E2A\u65B0\u4EFB\u52A1<code>task</code>, \u5373\u628A<code>\u66F4\u65B0\u9700\u6C42</code>\u8F6C\u6362\u6210\u4E00\u4E2A<code>task</code>.</li><li>\u6267\u884C\u8C03\u5EA6\u4EFB\u52A1(\u8F93\u51FA): \u8C03\u5EA6\u4E2D\u5FC3<code>scheduler</code>\u901A\u8FC7<code>\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF</code>\u6765\u6267\u884C<code>task</code>(<code>task</code>\u7684\u6267\u884C\u8FC7\u7A0B\u53C8\u56DE\u5230\u4E86<code>react-reconciler</code>\u5305\u4E2D). <ul><li><code>fiber\u6784\u9020\u5FAA\u73AF</code>\u662F<code>task</code>\u7684\u5B9E\u73B0\u73AF\u8282\u4E4B\u4E00, \u5FAA\u73AF\u5B8C\u6210\u4E4B\u540E\u4F1A\u6784\u9020\u51FA\u6700\u65B0\u7684 fiber \u6811.</li><li><code>commitRoot</code>\u662F<code>task</code>\u7684\u5B9E\u73B0\u73AF\u8282\u4E4B\u4E8C, \u628A\u6700\u65B0\u7684 fiber \u6811\u6700\u7EC8\u6E32\u67D3\u5230\u9875\u9762\u4E0A, <code>task</code>\u5B8C\u6210.</li></ul></li></ol><p>\u4E3B\u5E72\u903B\u8F91\u5C31\u662F<code>\u8F93\u5165\u5230\u8F93\u51FA</code>\u8FD9\u4E00\u6761\u94FE\u8DEF, \u4E3A\u4E86\u66F4\u597D\u7684\u6027\u80FD(\u5982<code>\u6279\u91CF\u66F4\u65B0</code>, <code>\u53EF\u4E2D\u65AD\u6E32\u67D3</code>\u7B49\u529F\u80FD), <code>react</code>\u5728\u8F93\u5165\u5230\u8F93\u51FA\u7684\u94FE\u8DEF\u4E0A\u505A\u4E86\u5F88\u591A\u4F18\u5316\u7B56\u7565, \u6BD4\u5982\u672C\u6587\u8BB2\u8FF0\u7684<code>\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF</code>\u548C<code>fiber\u6784\u9020\u5FAA\u73AF</code>\u76F8\u4E92\u914D\u5408\u5C31\u53EF\u4EE5\u5B9E\u73B0<code>\u53EF\u4E2D\u65AD\u6E32\u67D3</code>.</p>',9);function E(r,y){const c=l("ExternalLinkIcon");return a(),s("div",null,[h,_,e("img",{src:r.$withBase("/assets/react-illustration-series/workloop.png"),alt:"demo"},null,8,u),p,f,e("p",null,[k,e("a",b,[m,d(c)]),g,x,R,w,v]),S,e("p",null,[j,e("a",L,[O,d(c)]),W,B,N]),V])}var F=t(n,[["render",E],["__file","workloop.html.vue"]]);export{F as default};
