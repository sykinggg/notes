(window.webpackJsonp=window.webpackJsonp||[]).push([[311],{659:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"fixed失效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fixed失效"}},[t._v("#")]),t._v(" fixed失效")]),t._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[t._v("在css中，我们常常需要用到定位"),a("code",[t._v("position")]),t._v("，它的属性设置值有"),a("code",[t._v("static")]),t._v("、"),a("code",[t._v("relative")]),t._v("，"),a("code",[t._v("absolute")]),t._v("，"),a("code",[t._v("fixed")]),t._v("。其中，当元素设置了"),a("code",[t._v("absolute")]),t._v("，"),a("code",[t._v("fixed")]),t._v("后，元素会脱离文档流，这两个属性的主要区别就是偏移位置的设置的参照元素，"),a("code",[t._v("absolute")]),t._v("是相对于"),a("strong",[t._v("最近的非 "),a("code",[t._v("static")]),t._v(" 祖先元素")]),t._v("定位，当这样的祖先元素不存在时，则相对于初始包含块（html）。"),a("code",[t._v("fixed")]),t._v("与"),a("code",[t._v("absolute")]),t._v("相似，但元素的包含块为 viewport 视口。问题来了，"),a("code",[t._v("fixed")]),t._v("一定会相对于viewport 视口定位吗？")]),t._v(" "),a("h2",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[t._v("#")]),t._v(" 例子")]),t._v(" "),a("p",[t._v("我们在项目的开发中常常会用到第三方UI组件库，如element UI等等，可以发现基本上这些UI组件关于messageBox，toast等这一类的弹窗是一般都是挂载在外层节点。这是为什么呢？我想我们接下来可以得到一些答案。")]),t._v(" "),a("blockquote",[a("p",[t._v("html部分：")])]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("fixed-wrapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("fixed-box"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("btn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("点击弹出层"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("style")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token style"}},[a("span",{pre:!0,attrs:{class:"token language-css"}},[t._v("\n    "),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".fixed-wrapper")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100vw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 50vh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("background-color")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rgb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("245"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 241"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 241"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("overflow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hidden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("text-align")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" center"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".fixed-box")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("position")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" fixed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100vw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100px"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("bottom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("background-color")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rgb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("204"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 204"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 247"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".btn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("margin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10px"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("style")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"/notes/assets/css/875d485529a8485a9e4e727c2e8ddda4_tplv-k3u1fbpfcp-watermark.webp",alt:""}})]),t._v(" "),a("p",[t._v("如图所示这个效果就是我们想要的底部弹出效果，这个时候，另一个需求来了，我们需要父级可以相对于垂直居中，这个时候我们使用了"),a("code",[t._v("absolute")]),t._v("结合"),a("code",[t._v("transform")]),t._v("实现了垂直居中，但当我们再点击按钮，弹窗的位置不对了。")]),t._v(" "),a("div",{staticClass:"language-css extra-class"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".fixed-wrapper")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("position")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" absolute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("transform")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("translateY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("-50%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("top")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 50%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100vw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 50vh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("background-color")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rgb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("245"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 241"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 241"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("overflow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hidden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("text-align")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" center"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"/notes/assets/css/1a2af30721df4f29b210d5a284066894_tplv-k3u1fbpfcp-watermark.webp",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"探究"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#探究"}},[t._v("#")]),t._v(" 探究")]),t._v(" "),a("p",[t._v("出现这个问题的时候，我查看了很多很文章，网上有些文章说是层叠上下文对fixed的影响，对此，我们先存疑，我们可以先看看哪些属性是会形成层叠上下文的，并一一试验一下：")]),t._v(" "),a("p",[t._v("层叠上下文由满足以下任意一个条件的元素形成：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("文档根元素（"),a("code",[t._v("<html>")]),t._v("）；")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("position")]),t._v("值为 "),a("code",[t._v("absolute")]),t._v("（绝对定位）或  "),a("code",[t._v("relative")]),t._v("（相对定位）且 "),a("code",[t._v("z-index")]),t._v(" 值不为 "),a("code",[t._v("auto")]),t._v(" 的元素；")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("position")]),t._v("值为 "),a("code",[t._v("fixed")]),t._v("（固定定位）；")])]),t._v(" "),a("li",[a("p",[t._v("flex 、grid容器的子元素，且 "),a("code",[t._v("z-index")]),t._v(" 值不为 "),a("code",[t._v("auto")]),t._v("；")])]),t._v(" "),a("li",[a("p",[t._v("元素的"),a("code",[t._v("opacity")]),t._v("值不是"),a("code",[t._v("1")]),t._v(".")])]),t._v(" "),a("li",[a("p",[t._v("元素的"),a("code",[t._v("transform")]),t._v("值不是"),a("code",[t._v("none")]),t._v(".")])]),t._v(" "),a("li",[a("p",[t._v("元素"),a("code",[t._v("mix-blend-mode")]),t._v("值不是"),a("code",[t._v("normal")]),t._v(".")])]),t._v(" "),a("li",[a("p",[t._v("元素的"),a("code",[t._v("filter")]),t._v("值不是"),a("code",[t._v("none")]),t._v(".")])]),t._v(" "),a("li",[a("p",[t._v("元素的"),a("code",[t._v("isolation")]),t._v("值是"),a("code",[t._v("isolate")]),t._v(".")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("will-change")]),t._v("指定的属性值为上面任意一个。")])]),t._v(" "),a("li",[a("p",[t._v("元素的"),a("code",[t._v("-webkit-overflow-scrolling")]),t._v("设为"),a("code",[t._v("touch")])])])]),t._v(" "),a("p",[t._v("层叠上下文确实会对子元素层级的显示有影响，换句话说，是影响了对元素的层级参考元素。在试验过程中发现：有些属性如"),a("code",[t._v("transform")]),t._v("、"),a("code",[t._v("filter")]),t._v("、"),a("code",[t._v("perspective")]),t._v("、"),a("code",[t._v("will-change")]),t._v("设为"),a("code",[t._v("transform")]),t._v("、"),a("code",[t._v("filter")]),t._v("、"),a("code",[t._v("perspective")]),t._v("会使"),a("code",[t._v("fixed")]),t._v("不是相对于视觉窗口定位。")]),t._v(" "),a("p",[t._v("但在这里，我不同意说这是因为层叠上下文致使"),a("code",[t._v("fixed")]),t._v("相对于视觉窗口定位失效了，我更倾向于说，是这些属性本身的特质影响了"),a("code",[t._v("fixed")]),t._v("的参考包含块。为此，我查了这些属性的w3c文档，于是发现了：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.w3.org/TR/css-transforms-1/#transform-box",target:"_blank",rel:"noopener noreferrer"}},[t._v("关于transform的有"),a("OutboundLink")],1),t._v("：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/notes/assets/css/63632154744141ebbeeffd42d01231a9_tplv-k3u1fbpfcp-watermark.webp",alt:""}})]),t._v(" "),a("p",[a("a",{attrs:{href:"https://drafts.fxtf.org/filter-effects/#FilterProperty",target:"_blank",rel:"noopener noreferrer"}},[t._v("关于filter的有"),a("OutboundLink")],1),t._v("：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/notes/assets/css/22ae7a8612594818a17609f1859671f9_tplv-k3u1fbpfcp-watermark.webp",alt:""}})]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.w3.org/TR/css-transforms-2/#perspective",target:"_blank",rel:"noopener noreferrer"}},[t._v("关于perspective的有"),a("OutboundLink")],1),t._v("：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/notes/assets/css/9f2463459caf4cd383861eebc3cf1903_tplv-k3u1fbpfcp-watermark.webp",alt:""}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("意思就是：\n"),a("strong",[t._v("transform或filter不为none时")]),t._v("，"),a("code",[t._v("fixed")]),t._v("会相对于设置了transform或filter不为none的父元素相对定位，"),a("code",[t._v("absolute")]),t._v("是相对于最近的非 "),a("code",[t._v("static")]),t._v(" 祖先元素定位，当这样的祖先元素不存在时，则相对于设置了transform或filter不为none的父元素， "),a("strong",[t._v("perspective属性对元素的影响与transform一样")])])]),t._v(" "),a("p",[a("code",[t._v("will-change")]),t._v("设置了transform、filter、perspective，也会形成一个包含块，影响着"),a("code",[t._v("fixed")]),t._v("，"),a("code",[t._v("absolute")]),t._v("的定位")]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("在css中，有些属性设置会修改"),a("code",[t._v("absolute")]),t._v("、 "),a("code",[t._v("fixed")]),t._v("的定位位置的参考元素，如"),a("code",[t._v("transform")]),t._v("、"),a("code",[t._v("filter")]),t._v("、"),a("code",[t._v("perspective")]),t._v("等等。所以在使用过程中，我们可以利用这些属性，来改变定位位置的参考元素，而当我们需要保证元素的固定定位位置时，则应尽量避免这些属性对于定位位置的影响，即我们开头提到的，为何Element UI的messageBox，toast的html标签一般都是挂载在外层标签，我想这样也是为了避免用户在使用过程中，设置了"),a("code",[t._v("transform")]),t._v("、"),a("code",[t._v("filter")]),t._v("、"),a("code",[t._v("perspective")]),t._v("等影响了弹窗位置，以保证位置的固定。")])])}),[],!1,null,null,null);s.default=e.exports}}]);