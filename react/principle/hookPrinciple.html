<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title></title><meta name="description" content="å›å­è—å™¨äºèº« å¾…æ—¶è€ŒåŠ¨ å¤©ä¸‹æœ‰é“åˆ™è§ æ— é“åˆ™éš">
    <link rel="modulepreload" href="/notes/assets/app.9719f74c.js"><link rel="modulepreload" href="/notes/assets/hookPrinciple.html.8085f032.js"><link rel="modulepreload" href="/notes/assets/hookPrinciple.html.d151038d.js">
    <link rel="stylesheet" href="/notes/assets/style.3c840394.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/notes/" class=""><img class="logo" src="https://vuejs.org/images/logo.png" alt><!----></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="æŠ€æœ¯"><span class="title">æŠ€æœ¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="æŠ€æœ¯"><span class="title">æŠ€æœ¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/technology/base.md" class="" aria-label="æŠ€æœ¯å‰ç»"><!--[--><!--]--> æŠ€æœ¯å‰ç» <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="js"><span class="title">js</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="js"><span class="title">js</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/mozillajs/baseObject/symbol.md" class="" aria-label="mozillaï¼šåŸºæœ¬å¯¹è±¡"><!--[--><!--]--> mozillaï¼šåŸºæœ¬å¯¹è±¡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/jsInterview/baseInterview.md" class="" aria-label="åŸºç¡€é¢è¯•é¢˜"><!--[--><!--]--> åŸºç¡€é¢è¯•é¢˜ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/js/stack/executionStack.md" class="" aria-label="js æ¦‚å¿µ"><!--[--><!--]--> js æ¦‚å¿µ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/ts/jsx/support" class="" aria-label="JSX"><!--[--><!--]--> JSX <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/ts/project/inDepthTs.md" class="" aria-label="TypeScript é¡¹ç›®"><!--[--><!--]--> TypeScript é¡¹ç›® <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/jsNews/es6News.md" class="" aria-label="js æ–°æ¦‚å¿µ"><!--[--><!--]--> js æ–°æ¦‚å¿µ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/mozillaCss/reference/universalSelectors.md" class="" aria-label="ç¬¬ 1 æœŸï¼šCSS API"><!--[--><!--]--> ç¬¬ 1 æœŸï¼šCSS API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/css/interview/baseCss.md" class="" aria-label="é›¶æ•£è®°å½•"><!--[--><!--]--> é›¶æ•£è®°å½• <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="html"><span class="title">html</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="html"><span class="title">html</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/html/interview/linkImport.md" class="" aria-label="é›¶æ•£è®°å½•"><!--[--><!--]--> é›¶æ•£è®°å½• <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ç«¯"><span class="title">ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ç«¯"><span class="title">ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/browser/interview/baseInterview.md" class="" aria-label="åŸºç¡€æµè§ˆå™¨"><!--[--><!--]--> åŸºç¡€æµè§ˆå™¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/http/interview/baseInterview.md" class="" aria-label="åŸºç¡€http"><!--[--><!--]--> åŸºç¡€http <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å·¥å…·"><span class="title">å·¥å…·</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å·¥å…·"><span class="title">å·¥å…·</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/webpack/interview/webpackInterview.md" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/esbuild/description.md" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/rollup/introduction.md" class="" aria-label="rollup"><!--[--><!--]--> rollup <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/git/indx.md" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/nginx/base.md" class="" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/cli/base.md" class="" aria-label="cli"><!--[--><!--]--> cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/npm/commonlyUsed.md" class="" aria-label="npm"><!--[--><!--]--> npm <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="æŠ€æœ¯"><span class="title">æŠ€æœ¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="æŠ€æœ¯"><span class="title">æŠ€æœ¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/technology/base.md" class="" aria-label="æŠ€æœ¯å‰ç»"><!--[--><!--]--> æŠ€æœ¯å‰ç» <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="js"><span class="title">js</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="js"><span class="title">js</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/mozillajs/baseObject/symbol.md" class="" aria-label="mozillaï¼šåŸºæœ¬å¯¹è±¡"><!--[--><!--]--> mozillaï¼šåŸºæœ¬å¯¹è±¡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/jsInterview/baseInterview.md" class="" aria-label="åŸºç¡€é¢è¯•é¢˜"><!--[--><!--]--> åŸºç¡€é¢è¯•é¢˜ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/js/stack/executionStack.md" class="" aria-label="js æ¦‚å¿µ"><!--[--><!--]--> js æ¦‚å¿µ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/ts/jsx/support" class="" aria-label="JSX"><!--[--><!--]--> JSX <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/ts/project/inDepthTs.md" class="" aria-label="TypeScript é¡¹ç›®"><!--[--><!--]--> TypeScript é¡¹ç›® <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/jsNews/es6News.md" class="" aria-label="js æ–°æ¦‚å¿µ"><!--[--><!--]--> js æ–°æ¦‚å¿µ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/mozillaCss/reference/universalSelectors.md" class="" aria-label="ç¬¬ 1 æœŸï¼šCSS API"><!--[--><!--]--> ç¬¬ 1 æœŸï¼šCSS API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/css/interview/baseCss.md" class="" aria-label="é›¶æ•£è®°å½•"><!--[--><!--]--> é›¶æ•£è®°å½• <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="html"><span class="title">html</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="html"><span class="title">html</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/html/interview/linkImport.md" class="" aria-label="é›¶æ•£è®°å½•"><!--[--><!--]--> é›¶æ•£è®°å½• <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ç«¯"><span class="title">ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ç«¯"><span class="title">ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/browser/interview/baseInterview.md" class="" aria-label="åŸºç¡€æµè§ˆå™¨"><!--[--><!--]--> åŸºç¡€æµè§ˆå™¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/http/interview/baseInterview.md" class="" aria-label="åŸºç¡€http"><!--[--><!--]--> åŸºç¡€http <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å·¥å…·"><span class="title">å·¥å…·</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å·¥å…·"><span class="title">å·¥å…·</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notes/webpack/interview/webpackInterview.md" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/esbuild/description.md" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/rollup/introduction.md" class="" aria-label="rollup"><!--[--><!--]--> rollup <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/git/indx.md" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/nginx/base.md" class="" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/cli/base.md" class="" aria-label="cli"><!--[--><!--]--> cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notes/npm/commonlyUsed.md" class="" aria-label="npm"><!--[--><!--]--> npm <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">ç¬¬ 1 æœŸï¼šReactç†å¿µ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/preparation/idea.md" class="sidebar-item" aria-label="Reactç†å¿µ"><!--[--><!--]--> Reactç†å¿µ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/preparation/oldConstructure.md" class="sidebar-item" aria-label="è€çš„Reactæ¶æ„"><!--[--><!--]--> è€çš„Reactæ¶æ„ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/preparation/newConstructure.md" class="sidebar-item" aria-label="æ–°çš„Reactæ¶æ„"><!--[--><!--]--> æ–°çš„Reactæ¶æ„ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/process/fiber-mental.md" class="sidebar-item" aria-label="Fiberæ¶æ„çš„å¿ƒæ™ºæ¨¡å‹"><!--[--><!--]--> Fiberæ¶æ„çš„å¿ƒæ™ºæ¨¡å‹ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/process/fiber.md" class="sidebar-item" aria-label="Fiberæ¶æ„çš„å®ç°åŸç†"><!--[--><!--]--> Fiberæ¶æ„çš„å®ç°åŸç† <!--[--><!--]--></a><!----></li><li><a href="/notes/react/process/doubleBuffer.md" class="sidebar-item" aria-label="Fiberæ¶æ„çš„å·¥ä½œåŸç†"><!--[--><!--]--> Fiberæ¶æ„çš„å·¥ä½œåŸç† <!--[--><!--]--></a><!----></li><li><a href="/notes/react/preparation/summary.md" class="sidebar-item" aria-label="æ€»ç»“"><!--[--><!--]--> æ€»ç»“ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ç¬¬2æœŸï¼šå‰ç½®çŸ¥è¯† <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/preparation/file.md" class="sidebar-item" aria-label="æºç çš„æ–‡ä»¶ç»“æ„"><!--[--><!--]--> æºç çš„æ–‡ä»¶ç»“æ„ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/preparation/source.md" class="sidebar-item" aria-label="è°ƒè¯•æºç "><!--[--><!--]--> è°ƒè¯•æºç  <!--[--><!--]--></a><!----></li><li><a href="/notes/react/preparation/jsx.md" class="sidebar-item" aria-label="æ·±å…¥ç†è§£JSX"><!--[--><!--]--> æ·±å…¥ç†è§£JSX <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ç¬¬3æœŸï¼šrenderé˜¶æ®µ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/process/reconciler.md" class="sidebar-item" aria-label="æµç¨‹æ¦‚è§ˆ"><!--[--><!--]--> æµç¨‹æ¦‚è§ˆ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/process/beginWork.md" class="sidebar-item" aria-label="beginWork"><!--[--><!--]--> beginWork <!--[--><!--]--></a><!----></li><li><a href="/notes/react/process/completeWork.md" class="sidebar-item" aria-label="completeWork"><!--[--><!--]--> completeWork <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ç¬¬4æœŸï¼šcommité˜¶æ®µ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/renderer/prepare.md" class="sidebar-item" aria-label="æµç¨‹æ¦‚è§ˆ"><!--[--><!--]--> æµç¨‹æ¦‚è§ˆ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/renderer/beforeMutation.md" class="sidebar-item" aria-label="beforemutationé˜¶æ®µ"><!--[--><!--]--> beforemutationé˜¶æ®µ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/renderer/mutation.md" class="sidebar-item" aria-label="mutationé˜¶æ®µ"><!--[--><!--]--> mutationé˜¶æ®µ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/renderer/layout.md" class="sidebar-item" aria-label="layouté˜¶æ®µ"><!--[--><!--]--> layouté˜¶æ®µ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ç¬¬5æœŸï¼šDiffç®—æ³• <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/diff/prepare.md" class="sidebar-item" aria-label="æ¦‚è§ˆ"><!--[--><!--]--> æ¦‚è§ˆ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/diff/one.md" class="sidebar-item" aria-label="å•èŠ‚ç‚¹Diff"><!--[--><!--]--> å•èŠ‚ç‚¹Diff <!--[--><!--]--></a><!----></li><li><a href="/notes/react/diff/multi.md" class="sidebar-item" aria-label="å¤šèŠ‚ç‚¹Diff"><!--[--><!--]--> å¤šèŠ‚ç‚¹Diff <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ç¬¬6æœŸï¼šçŠ¶æ€æ›´æ–° <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/state/prepare.md" class="sidebar-item" aria-label="æµç¨‹æ¦‚è§ˆ"><!--[--><!--]--> æµç¨‹æ¦‚è§ˆ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/state/mental.md" class="sidebar-item" aria-label="å¿ƒæ™ºæ¨¡å‹"><!--[--><!--]--> å¿ƒæ™ºæ¨¡å‹ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/state/update.md" class="sidebar-item" aria-label="Update"><!--[--><!--]--> Update <!--[--><!--]--></a><!----></li><li><a href="/notes/react/state/priority.md" class="sidebar-item" aria-label="æ·±å…¥ç†è§£ä¼˜å…ˆçº§"><!--[--><!--]--> æ·±å…¥ç†è§£ä¼˜å…ˆçº§ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/state/reactdom.md" class="sidebar-item" aria-label="ReactDOM.render"><!--[--><!--]--> ReactDOM.render <!--[--><!--]--></a><!----></li><li><a href="/notes/react/state/setstate.md" class="sidebar-item" aria-label="this.setState"><!--[--><!--]--> this.setState <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ç¬¬7æœŸï¼šHooks <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/hooks/prepare.md" class="sidebar-item" aria-label="Hooksç†å¿µ"><!--[--><!--]--> Hooksç†å¿µ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/hooks/create.md" class="sidebar-item" aria-label="æç®€Hookså®ç°"><!--[--><!--]--> æç®€Hookså®ç° <!--[--><!--]--></a><!----></li><li><a href="/notes/react/hooks/structure.md" class="sidebar-item" aria-label="Hooksæ•°æ®ç»“æ„"><!--[--><!--]--> Hooksæ•°æ®ç»“æ„ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/hooks/usestate.md" class="sidebar-item" aria-label="useStateä¸useReducer"><!--[--><!--]--> useStateä¸useReducer <!--[--><!--]--></a><!----></li><li><a href="/notes/react/hooks/useeffect.md" class="sidebar-item" aria-label="useEffect"><!--[--><!--]--> useEffect <!--[--><!--]--></a><!----></li><li><a href="/notes/react/hooks/useref.md" class="sidebar-item" aria-label="useRef"><!--[--><!--]--> useRef <!--[--><!--]--></a><!----></li><li><a href="/notes/react/hooks/usememo.md" class="sidebar-item" aria-label="useMemoä¸useCallback"><!--[--><!--]--> useMemoä¸useCallback <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ç¬¬8æœŸï¼šConcurrentMode <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/concurrent/prepare.md" class="sidebar-item" aria-label="æ¦‚è§ˆ"><!--[--><!--]--> æ¦‚è§ˆ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/concurrent/scheduler.md" class="sidebar-item" aria-label="Schedulerçš„åŸç†ä¸å®ç°"><!--[--><!--]--> Schedulerçš„åŸç†ä¸å®ç° <!--[--><!--]--></a><!----></li><li><a href="/notes/react/concurrent/lane.md" class="sidebar-item" aria-label="laneæ¨¡å‹"><!--[--><!--]--> laneæ¨¡å‹ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/concurrent/componentWillXXX.md" class="sidebar-item" aria-label="æ·±å…¥æºç å‰–æcomponentWillXXXä¸ºä»€ä¹ˆUNSAFE"><!--[--><!--]--> æ·±å…¥æºç å‰–æcomponentWillXXXä¸ºä»€ä¹ˆUNSAFE <!--[--><!--]--></a><!----></li><li><a href="/notes/react/concurrent/redux.html" class="sidebar-item" aria-label="redux æºç è§£è¯»"><!--[--><!--]--> redux æºç è§£è¯» <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">ç¬¬9æœŸï¼šåŸºç¡€æ¦‚å¿µ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/principle/basePrinciple.md" class="sidebar-item" aria-label="æ¦‚è¿°"><!--[--><!--]--> æ¦‚è¿° <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/componentApi.md" class="sidebar-item" aria-label="ç»„ä»¶ç±»-api"><!--[--><!--]--> ç»„ä»¶ç±»-api <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/toolApi.md" class="sidebar-item" aria-label="å·¥å…·ç±»-api"><!--[--><!--]--> å·¥å…·ç±»-api <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/hookApi.md" class="sidebar-item" aria-label="hooks-api"><!--[--><!--]--> hooks-api <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/domApi.md" class="sidebar-item" aria-label="react-dom-api"><!--[--><!--]--> react-dom-api <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/hookUse.md" class="sidebar-item" aria-label="react-hookä½¿ç”¨"><!--[--><!--]--> react-hookä½¿ç”¨ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/hookCustom.md" class="sidebar-item" aria-label="react-hookè‡ªå®šä¹‰"><!--[--><!--]--> react-hookè‡ªå®šä¹‰ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/hookPrinciple.md" class="sidebar-item active" aria-label="react-hookåŸç†"><!--[--><!--]--> react-hookåŸç† <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/hoc.md" class="sidebar-item" aria-label="æ·±å…¥hoc"><!--[--><!--]--> æ·±å…¥hoc <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/reactRedux.md" class="sidebar-item" aria-label="React-reduxæºç "><!--[--><!--]--> React-reduxæºç  <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/reactKeeplive.md" class="sidebar-item" aria-label="reactç¼“å­˜é¡µé¢"><!--[--><!--]--> reactç¼“å­˜é¡µé¢ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/principle/reactRouter.md" class="sidebar-item" aria-label="react-routerè·¯ç”±åŸç†"><!--[--><!--]--> react-routerè·¯ç”±åŸç† <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ç¬¬10æœŸï¼šåŸºç¡€é¢è¯•é¢˜ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notes/react/interview/50/interview1.md" class="sidebar-item" aria-label="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çŠ¶æ€ç®¡ç†å™¨?"><!--[--><!--]--> ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çŠ¶æ€ç®¡ç†å™¨? <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview2.md" class="sidebar-item" aria-label="renderå‡½æ•°ä¸­returnå¦‚æœæ²¡æœ‰ä½¿ç”¨()ä¼šæœ‰ä»€ä¹ˆé—®é¢˜?"><!--[--><!--]--> renderå‡½æ•°ä¸­returnå¦‚æœæ²¡æœ‰ä½¿ç”¨()ä¼šæœ‰ä»€ä¹ˆé—®é¢˜? <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview3.md" class="sidebar-item" aria-label="componentWillUpdateå¯ä»¥ç›´æ¥ä¿®æ”¹stateçš„å€¼å—?"><!--[--><!--]--> componentWillUpdateå¯ä»¥ç›´æ¥ä¿®æ”¹stateçš„å€¼å—? <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview4.md" class="sidebar-item" aria-label="è¯´è¯´å¯¹Reactçš„æ¸²æŸ“åŸç†çš„ç†è§£?"><!--[--><!--]--> è¯´è¯´å¯¹Reactçš„æ¸²æŸ“åŸç†çš„ç†è§£? <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview5.md" class="sidebar-item" aria-label="ä»€ä¹ˆæ¸²æŸ“åŠ«æŒï¼Ÿ"><!--[--><!--]--> ä»€ä¹ˆæ¸²æŸ“åŠ«æŒï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview6.md" class="sidebar-item" aria-label="ReactIntlï¼Ÿ"><!--[--><!--]--> ReactIntlï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview7.md" class="sidebar-item" aria-label="Contextï¼Ÿ"><!--[--><!--]--> Contextï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview12.md" class="sidebar-item" aria-label="Contextå®ä¾‹ï¼Ÿ"><!--[--><!--]--> Contextå®ä¾‹ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview8.md" class="sidebar-item" aria-label="RenderPropsï¼Ÿ"><!--[--><!--]--> RenderPropsï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview9.md" class="sidebar-item" aria-label="é«˜é˜¶ç»„ä»¶ï¼Ÿ"><!--[--><!--]--> é«˜é˜¶ç»„ä»¶ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview10.md" class="sidebar-item" aria-label="Refsè½¬å‘ï¼Ÿ"><!--[--><!--]--> Refsè½¬å‘ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview11.md" class="sidebar-item" aria-label="Reacté¡¶å±‚APIï¼Ÿ"><!--[--><!--]--> Reacté¡¶å±‚APIï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview13.md" class="sidebar-item" aria-label="contextTypeï¼Ÿ"><!--[--><!--]--> contextTypeï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview14.md" class="sidebar-item" aria-label="é™¤äº†å®ä¾‹çš„å±æ€§å¯ä»¥è·å–Contextå¤–å“ªäº›åœ°æ–¹è¿˜èƒ½ç›´æ¥è·å–Contextï¼Ÿ"><!--[--><!--]--> é™¤äº†å®ä¾‹çš„å±æ€§å¯ä»¥è·å–Contextå¤–å“ªäº›åœ°æ–¹è¿˜èƒ½ç›´æ¥è·å–Contextï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview15.md" class="sidebar-item" aria-label="Consumerï¼Ÿ"><!--[--><!--]--> Consumerï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview16.md" class="sidebar-item" aria-label="windowingï¼Ÿ"><!--[--><!--]--> windowingï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview17.md" class="sidebar-item" aria-label="ReactDOM-Reactçš„æ’æ§½(Portals)ï¼Ÿ"><!--[--><!--]--> ReactDOM-Reactçš„æ’æ§½(Portals)ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview18.md" class="sidebar-item" aria-label="Reactçš„æ’æ§½(Portals)ï¼Ÿ"><!--[--><!--]--> Reactçš„æ’æ§½(Portals)ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview19.md" class="sidebar-item" aria-label="æ„é€ å‡½æ•°ï¼Ÿ"><!--[--><!--]--> æ„é€ å‡½æ•°ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview20.md" class="sidebar-item" aria-label="Reactæ‹†åˆ†ç»„ä»¶ï¼Ÿ"><!--[--><!--]--> Reactæ‹†åˆ†ç»„ä»¶ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview21.md" class="sidebar-item" aria-label="Reactçš„ä¸¥æ ¼æ¨¡å¼ï¼Ÿ"><!--[--><!--]--> Reactçš„ä¸¥æ ¼æ¨¡å¼ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview22.md" class="sidebar-item" aria-label="relayï¼Ÿ"><!--[--><!--]--> relayï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview23.md" class="sidebar-item" aria-label="æ•è·é”™è¯¯ï¼Ÿ"><!--[--><!--]--> æ•è·é”™è¯¯ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview24" class="sidebar-item" aria-label="å¦‚æœç»„ä»¶çš„å±æ€§æ²¡æœ‰ä¼ å€¼ï¼Œé‚£ä¹ˆå®ƒçš„é»˜è®¤å€¼æ˜¯ä»€ä¹ˆï¼Ÿ"><!--[--><!--]--> å¦‚æœç»„ä»¶çš„å±æ€§æ²¡æœ‰ä¼ å€¼ï¼Œé‚£ä¹ˆå®ƒçš„é»˜è®¤å€¼æ˜¯ä»€ä¹ˆï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview25.md" class="sidebar-item" aria-label="Reactçš„è¡¨å•åº“ï¼Ÿ"><!--[--><!--]--> Reactçš„è¡¨å•åº“ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview26.md" class="sidebar-item" aria-label="suspenseç»„ä»¶ï¼Ÿ"><!--[--><!--]--> suspenseç»„ä»¶ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview27.md" class="sidebar-item" aria-label="`super()`å’Œ`super(props)`ï¼Ÿ"><!--[--><!--]--> `super()`å’Œ`super(props)`ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview28.md" class="sidebar-item" aria-label="åŠ¨æ€å¯¼å…¥ç»„ä»¶ï¼Ÿ"><!--[--><!--]--> åŠ¨æ€å¯¼å…¥ç»„ä»¶ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview29.md" class="sidebar-item" aria-label="ç»™éæ§ç»„ä»¶è®¾ç½®é»˜è®¤çš„å€¼ï¼Ÿ"><!--[--><!--]--> ç»™éæ§ç»„ä»¶è®¾ç½®é»˜è®¤çš„å€¼ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview30.md" class="sidebar-item" aria-label="ä½¿ç”¨Hooksè·å–æœåŠ¡ç«¯æ•°æ®ï¼Ÿ"><!--[--><!--]--> ä½¿ç”¨Hooksè·å–æœåŠ¡ç«¯æ•°æ®ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview31.md" class="sidebar-item" aria-label="renderæ–¹æ³•çš„åŸç†ï¼Ÿ"><!--[--><!--]--> renderæ–¹æ³•çš„åŸç†ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview32.md" class="sidebar-item" aria-label="ä½¿ç”¨Hooksï¼Ÿ"><!--[--><!--]--> ä½¿ç”¨Hooksï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview33.md" class="sidebar-item" aria-label="useEffectå’ŒuseLayoutEffectï¼Ÿ"><!--[--><!--]--> useEffectå’ŒuseLayoutEffectï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview34.md" class="sidebar-item" aria-label="è‡ªå®šä¹‰ç»„ä»¶æ—¶renderæ˜¯å¦ä¸ºå¯é€‰çš„ï¼Ÿ"><!--[--><!--]--> è‡ªå®šä¹‰ç»„ä»¶æ—¶renderæ˜¯å¦ä¸ºå¯é€‰çš„ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview35.md" class="sidebar-item" aria-label="Reactå¿…é¡»ä½¿ç”¨JSXï¼Ÿ"><!--[--><!--]--> Reactå¿…é¡»ä½¿ç”¨JSXï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview36.md" class="sidebar-item" aria-label="éœ€è¦æŠŠkeysè®¾ç½®ä¸ºå…¨å±€å”¯ä¸€ï¼Ÿ"><!--[--><!--]--> éœ€è¦æŠŠkeysè®¾ç½®ä¸ºå…¨å±€å”¯ä¸€ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview37.md" class="sidebar-item" aria-label="æ€ä¹ˆå®šæ—¶æ›´æ–°ä¸€ä¸ªç»„ä»¶ï¼Ÿ"><!--[--><!--]--> æ€ä¹ˆå®šæ—¶æ›´æ–°ä¸€ä¸ªç»„ä»¶ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview38.md" class="sidebar-item" aria-label="ä½¿ç”¨webpackæ‰“åŒ…Reacté¡¹ç›®ä¼˜åŒ–ï¼Ÿ"><!--[--><!--]--> ä½¿ç”¨webpackæ‰“åŒ…Reacté¡¹ç›®ä¼˜åŒ–ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview39.md" class="sidebar-item" aria-label="Reactæ ¹æ®ä¸åŒçš„ç¯å¢ƒæ‰“åŒ…ï¼Ÿ"><!--[--><!--]--> Reactæ ¹æ®ä¸åŒçš„ç¯å¢ƒæ‰“åŒ…ï¼Ÿ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview40.md" class="sidebar-item" aria-label="éReactçš„æºç "><!--[--><!--]--> éReactçš„æºç  <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview41.md" class="sidebar-item" aria-label="React.forwardRef"><!--[--><!--]--> React.forwardRef <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview42.md" class="sidebar-item" aria-label="Reactäº‹ä»¶"><!--[--><!--]--> Reactäº‹ä»¶ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview43.md" class="sidebar-item" aria-label="Reactçš„reconciliationï¼ˆä¸€è‡´åŒ–ç®—æ³•ï¼‰"><!--[--><!--]--> Reactçš„reconciliationï¼ˆä¸€è‡´åŒ–ç®—æ³•ï¼‰ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview44.md" class="sidebar-item" aria-label="Fragment|DOMå…ƒç´ |å®‰å…¨æ³¨å…¥"><!--[--><!--]--> Fragment|DOMå…ƒç´ |å®‰å…¨æ³¨å…¥ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview45.md" class="sidebar-item" aria-label="Reactä¸­å¦‚ä½•ç›‘å¬state"><!--[--><!--]--> Reactä¸­å¦‚ä½•ç›‘å¬state <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview46.md" class="sidebar-item" aria-label="ä¸ºä»€ä¹ˆpropså¤åˆ¶ç»™stateä¼šäº§ç”Ÿbug"><!--[--><!--]--> ä¸ºä»€ä¹ˆpropså¤åˆ¶ç»™stateä¼šäº§ç”Ÿbug <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview47.md" class="sidebar-item" aria-label="Reactä¸ºä»€ä¹ˆä¸è¦ç›´æ¥ä¿®æ”¹state|ReactFiber"><!--[--><!--]--> Reactä¸ºä»€ä¹ˆä¸è¦ç›´æ¥ä¿®æ”¹state|ReactFiber <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview48.md" class="sidebar-item" aria-label="è£…é¥°å™¨(Decorator)React"><!--[--><!--]--> è£…é¥°å™¨(Decorator)React <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview49.md" class="sidebar-item" aria-label="reactæ‰‹åŠ¨æ¸…é™¤|forå’ŒhtmlFor"><!--[--><!--]--> reactæ‰‹åŠ¨æ¸…é™¤|forå’ŒhtmlFor <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/50/interview50.md" class="sidebar-item" aria-label="ReactçŠ¶æ€ç®¡ç†"><!--[--><!--]--> ReactçŠ¶æ€ç®¡ç† <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/100/interview51.md" class="sidebar-item" aria-label="Reactæ–°ç‰¹æ€§"><!--[--><!--]--> Reactæ–°ç‰¹æ€§ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/100/interview52.md" class="sidebar-item" aria-label="Reactäº‹ä»¶å¼•ç”¨"><!--[--><!--]--> Reactäº‹ä»¶å¼•ç”¨ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/100/interview53.md" class="sidebar-item" aria-label="constructorå’ŒgetInitialState|å¼•å…¥æœ¬åœ°å›¾ç‰‡"><!--[--><!--]--> constructorå’ŒgetInitialState|å¼•å…¥æœ¬åœ°å›¾ç‰‡ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/100/interview54.md" class="sidebar-item" aria-label="ImmutableData"><!--[--><!--]--> ImmutableData <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/100/interview55.md" class="sidebar-item" aria-label="æé«˜ç»„ä»¶çš„æ¸²æŸ“æ•ˆç‡"><!--[--><!--]--> æé«˜ç»„ä»¶çš„æ¸²æŸ“æ•ˆç‡ <!--[--><!--]--></a><!----></li><li><a href="/notes/react/interview/100/interview56.md" class="sidebar-item" aria-label="reactæ¨è¡Œå‡½æ•°å¼ç»„ä»¶"><!--[--><!--]--> reactæ¨è¡Œå‡½æ•°å¼ç»„ä»¶ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h1><h1 id="react-hooksåŸç†" tabindex="-1"><a class="header-anchor" href="#react-hooksåŸç†" aria-hidden="true">#</a> react-hooksåŸç†</h1><h2 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°" aria-hidden="true">#</a> æ¦‚è¿°</h2><hr><ol><li><p>åœ¨æ— çŠ¶æ€ç»„ä»¶æ¯ä¸€æ¬¡å‡½æ•°ä¸Šä¸‹æ–‡æ‰§è¡Œçš„æ—¶å€™ï¼Œ<code>react</code>ç”¨ä»€ä¹ˆæ–¹å¼è®°å½•äº†<code>hooks</code>çš„çŠ¶æ€ï¼Ÿ</p></li><li><p>å¤šä¸ª<code>react-hooks</code>ç”¨ä»€ä¹ˆæ¥è®°å½•æ¯ä¸€ä¸ª<code>hooks</code>çš„é¡ºåºçš„ ï¼Ÿ æ¢ä¸ªé—®æ³•ï¼ä¸ºä»€ä¹ˆä¸èƒ½æ¡ä»¶è¯­å¥ä¸­ï¼Œå£°æ˜<code>hooks</code>? <code>hooks</code>å£°æ˜ä¸ºä»€ä¹ˆåœ¨ç»„ä»¶çš„æœ€é¡¶éƒ¨ï¼Ÿ</p></li><li><p><code>function</code>å‡½æ•°ç»„ä»¶ä¸­çš„<code>useState</code>ï¼Œå’Œ <code>class</code>ç±»ç»„ä»¶ <code>setState</code>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></li><li><p><code>react</code> æ˜¯æ€ä¹ˆæ•è·åˆ°<code>hooks</code>çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ˜¯åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨çš„ï¼Ÿ</p></li><li><p><code>useEffect</code>,<code>useMemo</code> ä¸­ï¼Œä¸ºä»€ä¹ˆ<code>useRef</code>ä¸éœ€è¦ä¾èµ–æ³¨å…¥ï¼Œå°±èƒ½è®¿é—®åˆ°æœ€æ–°çš„æ”¹å˜å€¼ï¼Ÿ</p></li><li><p><code>useMemo</code>æ˜¯æ€ä¹ˆå¯¹å€¼åšç¼“å­˜çš„ï¼Ÿå¦‚ä½•åº”ç”¨å®ƒä¼˜åŒ–æ€§èƒ½ï¼Ÿ</p></li><li><p>ä¸ºä»€ä¹ˆä¸¤æ¬¡ä¼ å…¥<code>useState</code>çš„å€¼ç›¸åŒï¼Œå‡½æ•°ç»„ä»¶ä¸æ›´æ–°?</p></li></ol><img src="/notes/assets/react/d99a12ad708647d4bfd075a59d518c8b_tplv-k3u1fbpfcp-watermark.image" alt="demo"><h2 id="functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«" aria-hidden="true">#</a> functionç»„ä»¶å’Œclassç»„ä»¶æœ¬è´¨çš„åŒºåˆ«</h2><hr><p>åœ¨è§£é‡Š<code>react-hooks</code>åŸç†çš„ä¹‹å‰ï¼Œè¦åŠ æ·±ç†è§£ä¸€ä¸‹ï¼Œ <strong>å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹ ä¸¤ä¸ªä»£ç ç‰‡æ®µã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token operator">&lt;</span>any<span class="token punctuation">,</span>any<span class="token operator">&gt;</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token literal-property property">number</span><span class="token operator">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">handerClick</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
               console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handerClick <span class="token punctuation">}</span> <span class="token operator">&gt;</span>num<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>å‡½æ•°ç»„ä»¶ä¸­ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> num <span class="token punctuation">,</span>setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handerClick</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">setNumber</span><span class="token punctuation">(</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> handerClick <span class="token punctuation">}</span> <span class="token operator">&gt;</span><span class="token punctuation">{</span> num <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>------------å…¬å¸ƒç­”æ¡ˆ-------------</p><p>åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ğŸŒ°æ‰“å°ç»“æœï¼š 1 2 3 4 5</p><p>åœ¨ç¬¬äºŒä¸ªä¾‹å­ğŸŒ°æ‰“å°ç»“æœï¼š 0 0 0 0 0</p><p><strong>åˆ†æ</strong></p><p>ç¬¬ä¸€ä¸ªç±»ç»„ä»¶ä¸­ï¼Œç”±äºæ‰§è¡Œä¸Š<code>setState</code>æ²¡æœ‰åœ¨<code>react</code>æ­£å¸¸çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸Šæ‰§è¡Œï¼Œè€Œæ˜¯<code>setTimeout</code>ä¸­æ‰§è¡Œçš„ï¼Œ<strong>æ‰¹é‡æ›´æ–°</strong>æ¡ä»¶è¢«ç ´åã€‚åŸç†è¿™é‡Œå°±ä¸è®²äº†,æ‰€ä»¥å¯ä»¥ç›´æ¥è·å–åˆ°å˜åŒ–åçš„<code>state</code>ã€‚</p><p>ç¬¬äºŒä¸ªå‡½æ•°ç»„ä»¶ç§ï¼Œä½†æ˜¯åœ¨æ— çŠ¶æ€ç»„ä»¶ä¸­ï¼Œä¼¼ä¹æ²¡æœ‰ç”Ÿæ•ˆã€‚åŸå› å¾ˆç®€å•ï¼Œåœ¨<code>class</code>çŠ¶æ€ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªå®ä¾‹åŒ–çš„<code>class</code>ï¼Œå»ç»´æŠ¤ç»„ä»¶ä¸­çš„å„ç§çŠ¶æ€ï¼›ä½†æ˜¯åœ¨<code>function</code>ç»„ä»¶ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ªçŠ¶æ€å»ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œæ¯ä¸€æ¬¡å‡½æ•°ä¸Šä¸‹æ–‡æ‰§è¡Œï¼Œæ‰€æœ‰å˜é‡ï¼Œå¸¸é‡éƒ½é‡æ–°å£°æ˜ï¼Œæ‰§è¡Œå®Œæ¯•ï¼Œå†è¢«åƒåœ¾æœºåˆ¶å›æ”¶ã€‚æ‰€ä»¥å¦‚ä¸Šï¼Œæ— è®º<code>setTimeout</code>æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œéƒ½æ˜¯åœ¨å½“å‰å‡½æ•°ä¸Šä¸‹æ–‡æ‰§è¡Œ,æ­¤æ—¶<code>num = 0</code>ä¸ä¼šå˜ï¼Œä¹‹å<code>setNumber</code>æ‰§è¡Œï¼Œå‡½æ•°ç»„ä»¶é‡æ–°æ‰§è¡Œä¹‹åï¼Œ<code>num</code>æ‰å˜åŒ–ã€‚</p><p>æ‰€ä»¥ï¼Œ å¯¹äº<code>class</code>ç»„ä»¶ï¼Œåªéœ€è¦å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå®ä¾‹ä¸­ä¿å­˜äº†ç»„ä»¶çš„<code>state</code>ç­‰çŠ¶æ€ã€‚å¯¹äºæ¯ä¸€æ¬¡æ›´æ–°åªéœ€è¦è°ƒç”¨<code>render</code>æ–¹æ³•å°±å¯ä»¥ã€‚ä½†æ˜¯åœ¨<code>function</code>ç»„ä»¶ä¸­ï¼Œæ¯ä¸€æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€æ¬¡æ–°çš„å‡½æ•°æ‰§è¡Œ,ä¸ºäº†ä¿å­˜ä¸€äº›çŠ¶æ€,æ‰§è¡Œä¸€äº›å‰¯ä½œç”¨é’©å­,<code>react-hooks</code>åº”è¿è€Œç”Ÿï¼Œå»å¸®åŠ©è®°å½•ç»„ä»¶çš„çŠ¶æ€ï¼Œå¤„ç†ä¸€äº›é¢å¤–çš„å‰¯ä½œç”¨ã€‚</p><h2 id="å¼•å…¥hooks" tabindex="-1"><a class="header-anchor" href="#å¼•å…¥hooks" aria-hidden="true">#</a> å¼•å…¥hooks</h2><p>ä»å¼•å…¥ <code>hooks</code>å¼€å§‹ï¼Œä»¥<code>useState</code>ä¸ºä¾‹å­ï¼Œå½“ä»é¡¹ç›®ä¸­è¿™ä¹ˆå†™ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>react/src/ReactHooks.js</p></blockquote><p><strong>useState</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> dispatcher <span class="token operator">=</span> <span class="token function">resolveDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dispatcher<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>useState()</code> çš„æ‰§è¡Œç­‰äº <code>dispatcher.useState(initialState)</code> è¿™é‡Œé¢å¼•å…¥äº†ä¸€ä¸ª<code>dispatcher</code>ï¼Œçœ‹ä¸€ä¸‹<code>resolveDispatcher</code>åšäº†äº›ä»€ä¹ˆï¼Ÿ</p><p><strong>resolveDispatcher</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolveDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dispatcher <span class="token operator">=</span> ReactCurrentDispatcher<span class="token punctuation">.</span>current
    <span class="token keyword">return</span> dispatcher
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ReactCurrentDispatcher</strong></p><blockquote><p>react/src/ReactCurrentDispatcher.js</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ReactCurrentDispatcher <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">current</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>çœ‹åˆ°<code>ReactCurrentDispatcher.current</code>åˆå§‹åŒ–çš„æ—¶å€™ä¸º<code>null</code>ï¼Œç„¶åå°±æ²¡ä»»ä½•ä¸‹æ–‡äº†ã€‚æš‚ä¸”åªèƒ½æŠŠ<code>**ReactCurrentDispatcher**</code>è®°ä¸‹æ¥ã€‚çœ‹çœ‹<code>ReactCurrentDispatcher</code>ä»€ä¹ˆæ—¶å€™ç”¨åˆ°çš„ ï¼Ÿ</p><h2 id="renderwithhooks-æ‰§è¡Œå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#renderwithhooks-æ‰§è¡Œå‡½æ•°" aria-hidden="true">#</a> renderWithHooks æ‰§è¡Œå‡½æ•°</h2><p>å¯¹äº<code>function</code>ç»„ä»¶æ‰§è¡Œ</p><blockquote><p>react-reconciler/src/ReactFiberBeginWork.js</p></blockquote><p><code>function</code>ç»„ä»¶åˆå§‹åŒ–ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">renderWithHooks</span><span class="token punctuation">(</span>
    <span class="token keyword">null</span><span class="token punctuation">,</span>                <span class="token comment">// current Fiber</span>
    workInProgress<span class="token punctuation">,</span>      <span class="token comment">// workInProgress Fiber</span>
    Component<span class="token punctuation">,</span>           <span class="token comment">// å‡½æ•°ç»„ä»¶æœ¬èº«</span>
    props<span class="token punctuation">,</span>               <span class="token comment">// props</span>
    context<span class="token punctuation">,</span>             <span class="token comment">// ä¸Šä¸‹æ–‡</span>
    renderExpirationTime<span class="token punctuation">,</span><span class="token comment">// æ¸²æŸ“ ExpirationTime</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å¯¹äºåˆå§‹åŒ–æ˜¯æ²¡æœ‰<code>current</code>æ ‘çš„ï¼Œä¹‹åå®Œæˆä¸€æ¬¡ç»„ä»¶æ›´æ–°åï¼Œä¼šæŠŠå½“å‰<code>workInProgress</code>æ ‘èµ‹å€¼ç»™<code>current</code>æ ‘ã€‚</p><p><code>function</code>ç»„ä»¶æ›´æ–°ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">renderWithHooks</span><span class="token punctuation">(</span>
    current<span class="token punctuation">,</span>
    workInProgress<span class="token punctuation">,</span>
    render<span class="token punctuation">,</span>
    nextProps<span class="token punctuation">,</span>
    context<span class="token punctuation">,</span>
    renderExpirationTime<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä»ä¸Šè¾¹å¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>renderWithHooks</code>å‡½æ•°ä½œç”¨æ˜¯<strong>è°ƒç”¨</strong><code>function</code><strong>ç»„ä»¶å‡½æ•°</strong>çš„ä¸»è¦å‡½æ•°ã€‚</p><p><strong>renderWithHooks</strong></p><blockquote><p>react-reconciler/src/ReactFiberHooks.js</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">renderWithHooks</span><span class="token punctuation">(</span>
    <span class="token parameter">current<span class="token punctuation">,</span>
    workInProgress<span class="token punctuation">,</span>
    Component<span class="token punctuation">,</span>
    props<span class="token punctuation">,</span>
    secondArg<span class="token punctuation">,</span>
    nextRenderExpirationTime<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    renderExpirationTime <span class="token operator">=</span> nextRenderExpirationTime<span class="token punctuation">;</span>
    currentlyRenderingFiber <span class="token operator">=</span> workInProgress<span class="token punctuation">;</span>

    workInProgress<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    workInProgress<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    workInProgress<span class="token punctuation">.</span>expirationTime <span class="token operator">=</span> NoWork<span class="token punctuation">;</span>

    ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span>
        current <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> current<span class="token punctuation">.</span>memoizedState <span class="token operator">===</span> <span class="token keyword">null</span>
            <span class="token operator">?</span> HooksDispatcherOnMount
            <span class="token operator">:</span> HooksDispatcherOnUpdate<span class="token punctuation">;</span>

    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token function">Component</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> secondArg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>expirationTime <span class="token operator">===</span> renderExpirationTime<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment">// ....è¿™é‡Œçš„é€»è¾‘å…ˆæ”¾ä¸€æ”¾</span>
    <span class="token punctuation">}</span>

    ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> ContextOnlyDispatcher<span class="token punctuation">;</span>

    renderExpirationTime <span class="token operator">=</span> NoWork<span class="token punctuation">;</span>
    currentlyRenderingFiber <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    currentHook <span class="token operator">=</span> <span class="token keyword">null</span>
    workInProgressHook <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    didScheduleRenderPhaseUpdate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> children<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><strong>æ‰€æœ‰çš„å‡½æ•°ç»„ä»¶æ‰§è¡Œï¼Œéƒ½æ˜¯åœ¨è¿™é‡Œæ–¹æ³•ä¸­</strong>,é¦–å…ˆåº”è¯¥æ˜ç™½å‡ ä¸ªæ„Ÿå¿µï¼Œè¿™å¯¹äºåç»­ç†è§£<code>useState</code>æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚</p><p><code>current fiberæ ‘</code>: å½“å®Œæˆä¸€æ¬¡æ¸²æŸ“ä¹‹åï¼Œä¼šäº§ç”Ÿä¸€ä¸ª<code>current</code>æ ‘,<code>current</code>ä¼šåœ¨<code>commit</code>é˜¶æ®µæ›¿æ¢æˆçœŸå®çš„<code>Dom</code>æ ‘ã€‚</p><p><code>workInProgress fiberæ ‘</code>: å³å°†è°ƒå’Œæ¸²æŸ“çš„ <code>fiber</code> æ ‘ã€‚å†ä¸€æ¬¡æ–°çš„ç»„ä»¶æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œä¼šä»<code>current</code>å¤åˆ¶ä¸€ä»½ä½œä¸º<code>workInProgress</code>,æ›´æ–°å®Œæ¯•åï¼Œå°†å½“å‰çš„<code>workInProgress</code>æ ‘èµ‹å€¼ç»™<code>current</code>æ ‘ã€‚</p><p><code>workInProgress.memoizedState</code>: åœ¨<code>class</code>ç»„ä»¶ä¸­ï¼Œ<code>memoizedState</code>å­˜æ”¾<code>state</code>ä¿¡æ¯ï¼Œåœ¨<code>function</code>ç»„ä»¶ä¸­ï¼Œ<strong>è¿™é‡Œå¯ä»¥æå‰é€æ¼ä¸€ä¸‹ï¼Œ<code>memoizedState</code>åœ¨ä¸€æ¬¡è°ƒå’Œæ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œä»¥é“¾è¡¨çš„å½¢å¼å­˜æ”¾<code>hooks</code>ä¿¡æ¯ã€‚</strong></p><p><code>workInProgress.expirationTime</code>: <code>react</code>ç”¨ä¸åŒçš„<code>expirationTime</code>,æ¥ç¡®å®šæ›´æ–°çš„ä¼˜å…ˆçº§ã€‚</p><p><code>currentHook</code> : å¯ä»¥ç†è§£ <code>current</code>æ ‘ä¸Šçš„æŒ‡å‘çš„å½“å‰è°ƒåº¦çš„ <code>hooks</code>èŠ‚ç‚¹ã€‚</p><p><code>workInProgressHook</code> : å¯ä»¥ç†è§£ <code>workInProgress</code>æ ‘ä¸ŠæŒ‡å‘çš„å½“å‰è°ƒåº¦çš„ <code>hooks</code>èŠ‚ç‚¹ã€‚</p><p><code>renderWithHooks</code><strong>å‡½æ•°ä¸»è¦ä½œç”¨:</strong></p><p>é¦–å…ˆå…ˆç½®ç©ºå³å°†è°ƒå’Œæ¸²æŸ“çš„<code>workInProgress</code>æ ‘çš„<code>memoizedState</code>å’Œ<code>updateQueue</code>ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Œå› ä¸ºåœ¨æ¥ä¸‹æ¥çš„å‡½æ•°ç»„ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¦æŠŠæ–°çš„<code>hooks</code>ä¿¡æ¯æŒ‚è½½åˆ°è¿™ä¸¤ä¸ªå±æ€§ä¸Šï¼Œç„¶ååœ¨ç»„ä»¶<code>commit</code>é˜¶æ®µï¼Œå°†<code>workInProgress</code>æ ‘æ›¿æ¢æˆ<code>current</code>æ ‘ï¼Œæ›¿æ¢çœŸå®çš„<code>DOM</code>å…ƒç´ èŠ‚ç‚¹ã€‚å¹¶åœ¨<code>current</code>æ ‘ä¿å­˜<code>hooks</code>ä¿¡æ¯ã€‚</p><p>ç„¶åæ ¹æ®å½“å‰å‡½æ•°ç»„ä»¶æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œèµ‹äºˆ<code>ReactCurrentDispatcher.current</code>ä¸åŒçš„<code>hooks</code>,ç»ˆäºå’Œä¸Šé¢è®²åˆ°çš„<code>ReactCurrentDispatcher</code>è”ç³»åˆ°ä¸€èµ·ã€‚å¯¹äºç¬¬ä¸€æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œé‚£ä¹ˆç”¨çš„æ˜¯<code>HooksDispatcherOnMount</code> <strong>hooks</strong>å¯¹è±¡ã€‚</p><p>å¯¹äºæ¸²æŸ“åï¼Œéœ€è¦æ›´æ–°çš„å‡½æ•°ç»„ä»¶ï¼Œåˆ™æ˜¯<code>HooksDispatcherOnUpdate</code>å¯¹è±¡ï¼Œé‚£ä¹ˆä¸¤ä¸ªä¸åŒå°±æ˜¯é€šè¿‡<code>current</code>æ ‘ä¸Šæ˜¯å¦<code>memoizedState</code>ï¼ˆ<code>hook</code>ä¿¡æ¯ï¼‰æ¥åˆ¤æ–­çš„ã€‚å¦‚æœ<code>current</code>ä¸å­˜åœ¨ï¼Œè¯æ˜æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“å‡½æ•°ç»„ä»¶ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œ<strong>è°ƒç”¨<code>Component(props, secondArg);</code>æ‰§è¡Œçš„å‡½æ•°ç»„ä»¶ï¼Œçš„å‡½æ•°ç»„ä»¶åœ¨è¿™é‡ŒçœŸæ­£çš„è¢«æ‰§è¡Œäº†ï¼Œç„¶åï¼Œå†™çš„<code>hooks</code>è¢«ä¾æ¬¡æ‰§è¡Œï¼ŒæŠŠ<code>hooks</code>ä¿¡æ¯ä¾æ¬¡ä¿å­˜åˆ°<code>workInProgress</code>æ ‘ä¸Šã€‚</strong> è‡³äºå®ƒæ˜¯æ€ä¹ˆä¿å­˜çš„ï¼Œé©¬ä¸Šä¼šè®²åˆ°ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¹Ÿå¾ˆé‡è¦ï¼Œå°†<code>ContextOnlyDispatcher</code>èµ‹å€¼ç»™ <code>ReactCurrentDispatcher.current</code>ï¼Œç”±äº<code>js</code>æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œè°ƒç”¨çš„<code>hooks</code>ï¼Œéƒ½æ˜¯<code>ContextOnlyDispatcher</code>å¯¹è±¡ä¸Š<code>hooks</code>,çœ‹çœ‹<code>ContextOnlyDispatcherhooks</code>ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ContextOnlyDispatcher <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">useState</span><span class="token operator">:</span>throwInvalidHookError
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">throwInvalidHookError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">invariant</span><span class="token punctuation">(</span>
        <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token string">&#39;Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for&#39;</span> <span class="token operator">+</span>
        <span class="token string">&#39; one of the following reasons:\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&#39;1. You might have mismatching versions of React and the renderer (such as React DOM)\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&#39;2. You might be breaking the Rules of Hooks\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&#39;3. You might have more than one copy of React in the same app\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&#39;See https://fb.me/react-invalid-hook-call for tips about how to debug and fix this problem.&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>åŸæ¥å¦‚æ­¤ï¼Œ<code>react-hooks</code>å°±æ˜¯é€šè¿‡è¿™ç§å‡½æ•°ç»„ä»¶æ‰§è¡Œèµ‹å€¼ä¸åŒçš„<code>hooks</code>å¯¹è±¡æ–¹å¼ï¼Œåˆ¤æ–­åœ¨<code>hooks</code>æ‰§è¡Œæ˜¯å¦åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨ï¼Œæ•è·å¹¶æŠ›å‡ºå¼‚å¸¸çš„ã€‚</p><p>æœ€åï¼Œé‡æ–°ç½®ç©ºä¸€äº›å˜é‡æ¯”å¦‚<code>currentHook</code>ï¼Œ<code>currentlyRenderingFiber</code>, <code>workInProgressHook</code>ç­‰ã€‚</p><h2 id="ä¸åŒçš„hookså¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#ä¸åŒçš„hookså¯¹è±¡" aria-hidden="true">#</a> ä¸åŒçš„hookså¯¹è±¡</h2><p>ä¸Šè¿°è®²åˆ°åœ¨å‡½æ•°ç¬¬ä¸€æ¬¡æ¸²æŸ“ç»„ä»¶å’Œæ›´æ–°ç»„ä»¶åˆ†åˆ«è°ƒç”¨ä¸åŒçš„<code>hooks</code>å¯¹è±¡ï¼Œç°åœ¨å°±æ¥çœ‹çœ‹<code>HooksDispatcherOnMount</code> å’Œ <code>HooksDispatcherOnUpdate</code>ã€‚</p><p><strong>ç¬¬ä¸€æ¬¡æ¸²æŸ“(è¿™é‡Œåªå±•ç¤ºäº†å¸¸ç”¨çš„<code>hooks</code>)ï¼š</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> HooksDispatcherOnMount <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">useCallback</span><span class="token operator">:</span> mountCallback<span class="token punctuation">,</span>
    <span class="token literal-property property">useEffect</span><span class="token operator">:</span> mountEffect<span class="token punctuation">,</span>
    <span class="token literal-property property">useLayoutEffect</span><span class="token operator">:</span> mountLayoutEffect<span class="token punctuation">,</span>
    <span class="token literal-property property">useMemo</span><span class="token operator">:</span> mountMemo<span class="token punctuation">,</span>
    <span class="token literal-property property">useReducer</span><span class="token operator">:</span> mountReducer<span class="token punctuation">,</span>
    <span class="token literal-property property">useRef</span><span class="token operator">:</span> mountRef<span class="token punctuation">,</span>
    <span class="token literal-property property">useState</span><span class="token operator">:</span> mountState<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>æ›´æ–°ç»„ä»¶ï¼š</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> HooksDispatcherOnUpdate <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">useCallback</span><span class="token operator">:</span> updateCallback<span class="token punctuation">,</span>
    <span class="token literal-property property">useEffect</span><span class="token operator">:</span> updateEffect<span class="token punctuation">,</span>
    <span class="token literal-property property">useLayoutEffect</span><span class="token operator">:</span> updateLayoutEffect<span class="token punctuation">,</span>
    <span class="token literal-property property">useMemo</span><span class="token operator">:</span> updateMemo<span class="token punctuation">,</span>
    <span class="token literal-property property">useReducer</span><span class="token operator">:</span> updateReducer<span class="token punctuation">,</span>
    <span class="token literal-property property">useRef</span><span class="token operator">:</span> updateRef<span class="token punctuation">,</span>
    <span class="token literal-property property">useState</span><span class="token operator">:</span> updateState
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>çœ‹æ¥å¯¹äºç¬¬ä¸€æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œå’Œæ›´æ–°ç»„ä»¶ï¼Œ<code>react-hooks</code>é‡‡ç”¨äº†ä¸¤å¥—<code>Api</code>ï¼Œæœ¬æ–‡çš„ç¬¬äºŒéƒ¨åˆ†å’Œç¬¬ä¸‰éƒ¨åˆ†ï¼Œå°†é‡ç‚¹ä¸¤è€…çš„è”ç³»ã€‚</p><p>ç”¨æµç¨‹å›¾æ¥æè¿°æ•´ä¸ªè¿‡ç¨‹ï¼š</p><img src="/notes/assets/react/adcbd09984f84d0d97a15df124e83c09_tplv-k3u1fbpfcp-watermark.image" alt="demo"><h1 id="hooksåˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#hooksåˆå§‹åŒ–" aria-hidden="true">#</a> hooksåˆå§‹åŒ–</h1><p>å››ä¸ªä¸­é‡ç‚¹<code>hooks</code>å±•å¼€ï¼Œåˆ†åˆ«æ˜¯è´Ÿè´£ç»„ä»¶æ›´æ–°çš„<code>useState</code>ï¼Œè´Ÿè´£æ‰§è¡Œå‰¯ä½œç”¨<code>useEffect</code> ,è´Ÿè´£ä¿å­˜æ•°æ®çš„<code>useRef</code>,è´Ÿè´£ç¼“å­˜ä¼˜åŒ–çš„<code>useMemo</code>ï¼Œ è‡³äº<code>useCallback</code>,<code>useReducer</code>,<code>useLayoutEffect</code>åŸç†å’Œé‚£å››ä¸ªé‡ç‚¹<code>hooks</code>æ¯”è¾ƒç›¸è¿‘ï¼Œå°±ä¸ä¸€ä¸€è§£é‡Šäº†ã€‚</p><p>å…ˆå†™ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”ç”¨åˆ°ä¸Šè¿°å››ä¸ªä¸»è¦<code>hooks</code>ï¼š</p><p><strong>è¯·è®°ä½å¦‚ä¸‹ä»£ç ç‰‡æ®µï¼Œåé¢è®²è§£å°†ä»¥å¦‚ä¸‹ä»£ç æ®µå±•å¼€</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">,</span> useState <span class="token punctuation">,</span> useRef <span class="token punctuation">,</span> useMemo  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>
<span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> number <span class="token punctuation">,</span> setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> DivDemo <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello <span class="token punctuation">,</span> i am useMemo <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> curRef  <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>curRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span> curRef <span class="token punctuation">}</span> <span class="token operator">&gt;</span>
        hello<span class="token punctuation">,</span>world <span class="token punctuation">{</span> number <span class="token punctuation">}</span> 
        <span class="token punctuation">{</span> DivDemo <span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>number<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="mountworkinprogresshook" tabindex="-1"><a class="header-anchor" href="#mountworkinprogresshook" aria-hidden="true">#</a> mountWorkInProgressHook</h2><p>åœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™,æ¯ä¸€æ¬¡<code>hooks</code>æ‰§è¡Œï¼Œå¦‚<code>useState()</code>,<code>useRef()</code>,éƒ½ä¼šè°ƒç”¨<code>mountWorkInProgressHook</code>,<code>mountWorkInProgressHook</code>åˆ°åº•åšäº†å†™ä»€ä¹ˆï¼Œè®©ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ï¼š</p><blockquote><p>react-reconciler/src/ReactFiberHooks.js -&gt; <code>mountWorkInProgressHook</code></p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">hook</span><span class="token operator">:</span> Hook <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">memoizedState</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token comment">// useStateä¸­ ä¿å­˜ stateä¿¡æ¯ ï½œ useEffect ä¸­ ä¿å­˜ç€ effect å¯¹è±¡ ï½œ useMemo ä¸­ ä¿å­˜çš„æ˜¯ç¼“å­˜çš„å€¼å’Œdeps ï½œ useRefä¸­ä¿å­˜çš„æ˜¯ref å¯¹è±¡</span>
        <span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">baseQueue</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">queue</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ä¾‹å­ä¸­çš„ç¬¬ä¸€ä¸ª`hooks`-&gt; useState(0) èµ°çš„å°±æ˜¯è¿™æ ·ã€‚</span>
        currentlyRenderingFiber<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> workInProgressHook <span class="token operator">=</span> hook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> hook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> workInProgressHook<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>mountWorkInProgressHook</code>è¿™ä¸ªå‡½æ•°åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œé¦–å…ˆæ¯æ¬¡æ‰§è¡Œä¸€ä¸ª<code>hooks</code>å‡½æ•°ï¼Œéƒ½äº§ç”Ÿä¸€ä¸ª<code>hook</code>å¯¹è±¡ï¼Œé‡Œé¢ä¿å­˜äº†å½“å‰<code>hook</code>ä¿¡æ¯,ç„¶åå°†æ¯ä¸ª<code>hooks</code>ä»¥é“¾è¡¨å½¢å¼ä¸²è”èµ·æ¥ï¼Œå¹¶èµ‹å€¼ç»™<code>workInProgress</code>çš„<code>memoizedState</code>ã€‚ä¹Ÿå°±è¯å®äº†ä¸Šè¿°æ‰€è¯´çš„ï¼Œå‡½æ•°ç»„ä»¶ç”¨<code>memoizedState</code>å­˜æ”¾<code>hooks</code>é“¾è¡¨ã€‚</p><p>è‡³äº<code>hook</code>å¯¹è±¡ä¸­éƒ½ä¿ç•™äº†é‚£äº›ä¿¡æ¯ï¼Ÿè¿™é‡Œå…ˆåˆ†åˆ«ä»‹ç»ä¸€ä¸‹:</p><ul><li><p><code>memoizedState</code>ï¼š <code>useState</code>ä¸­ ä¿å­˜ <code>state</code> ä¿¡æ¯ ï½œ <code>useEffect</code> ä¸­ ä¿å­˜ç€ <code>effect</code> å¯¹è±¡ ï½œ <code>useMemo</code> ä¸­ ä¿å­˜çš„æ˜¯ç¼“å­˜çš„å€¼å’Œ <code>deps</code> ï½œ <code>useRef</code> ä¸­ä¿å­˜çš„æ˜¯ <code>ref</code> å¯¹è±¡ã€‚</p></li><li><p><code>baseQueue</code> : <code>usestate</code>å’Œ<code>useReducer</code>ä¸­ ä¿å­˜æœ€æ–°çš„æ›´æ–°é˜Ÿåˆ—ã€‚</p></li><li><p><code>baseState</code> ï¼š <code>usestate</code>å’Œ<code>useReducer</code>ä¸­,ä¸€æ¬¡æ›´æ–°ä¸­ ï¼Œäº§ç”Ÿçš„æœ€æ–°<code>state</code>å€¼ã€‚</p></li><li><p><code>queue</code> ï¼š ä¿å­˜å¾…æ›´æ–°é˜Ÿåˆ— <code>pendingQueue</code> ï¼Œæ›´æ–°å‡½æ•° <code>dispatch</code> ç­‰ä¿¡æ¯ã€‚</p></li><li><p><code>next</code>: æŒ‡å‘ä¸‹ä¸€ä¸ª <code>hooks</code>å¯¹è±¡ã€‚</p></li></ul><p>é‚£ä¹ˆå½“å‡½æ•°ç»„ä»¶æ‰§è¡Œä¹‹åï¼Œå››ä¸ª<code>hooks</code>å’Œ<code>workInProgress</code>å°†æ˜¯å¦‚å›¾çš„å…³ç³»ã€‚</p><img src="/notes/assets/react/5660f1be680140239a8cf4e34cfccc90_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p>çŸ¥é“æ¯ä¸ª<code>hooks</code>å…³ç³»ä¹‹åï¼Œåº”è¯¥ç†è§£äº†ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ¡ä»¶è¯­å¥ä¸­ï¼Œå£°æ˜<code>hooks</code>ã€‚</p><p>ç”¨ä¸€å¹…å›¾è¡¨ç¤ºå¦‚æœåœ¨æ¡ä»¶è¯­å¥ä¸­å£°æ˜ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘ç”Ÿã€‚</p><p>å¦‚æœå°†ä¸Šè¿°<code>demo</code>å…¶ä¸­çš„ä¸€ä¸ª <code>useRef</code> æ”¾å…¥æ¡ä»¶è¯­å¥ä¸­ï¼Œ</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> curRef  <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>isFisrt<span class="token punctuation">)</span><span class="token punctuation">{</span>
    curRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><img src="/notes/assets/react/54a38675154a483885a3c5c9a80f360e_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p><strong>å› ä¸ºä¸€æ—¦åœ¨æ¡ä»¶è¯­å¥ä¸­å£°æ˜<code>hooks</code>ï¼Œåœ¨ä¸‹ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ›´æ–°ï¼Œ<code>hooks</code>é“¾è¡¨ç»“æ„ï¼Œå°†ä¼šè¢«ç ´åï¼Œ<code>current</code>æ ‘çš„<code>memoizedState</code>ç¼“å­˜<code>hooks</code>ä¿¡æ¯ï¼Œå’Œå½“å‰<code>workInProgress</code>ä¸ä¸€è‡´ï¼Œå¦‚æœæ¶‰åŠåˆ°è¯»å–<code>state</code>ç­‰æ“ä½œï¼Œå°±ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</strong></p><p>ä¸Šè¿°ä»‹ç»äº† <code>hooks</code>é€šè¿‡ä»€ä¹ˆæ¥è¯æ˜å”¯ä¸€æ€§çš„ï¼Œç­”æ¡ˆ ï¼Œé€šè¿‡<code>hooks</code>é“¾è¡¨é¡ºåºã€‚å’Œä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œå£°æ˜<code>hooks</code>ï¼Œæ¥ä¸‹æ¥æŒ‰ç…§å››ä¸ªæ–¹å‘ï¼Œåˆ†åˆ«ä»‹ç»åˆå§‹åŒ–çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><h2 id="åˆå§‹åŒ–usestate-mountstate" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–usestate-mountstate" aria-hidden="true">#</a> åˆå§‹åŒ–useState -&gt; mountState</h2><hr><h2 id="mountstate" tabindex="-1"><a class="header-anchor" href="#mountstate" aria-hidden="true">#</a> mountState</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountState</span><span class="token punctuation">(</span>
    <span class="token parameter">initialState</span>
<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> initialState <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœ useState ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‡½æ•°ï¼Œæ‰§è¡Œå‡½æ•°å¾—åˆ°state</span>
        initialState <span class="token operator">=</span> <span class="token function">initialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> hook<span class="token punctuation">.</span>baseState <span class="token operator">=</span> initialState<span class="token punctuation">;</span>
    <span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token punctuation">(</span>hook<span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">pending</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token comment">// å¸¦æ›´æ–°çš„</span>
        <span class="token literal-property property">dispatch</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// è´Ÿè´£æ›´æ–°å‡½æ•°</span>
        <span class="token literal-property property">lastRenderedReducer</span><span class="token operator">:</span> basicStateReducer<span class="token punctuation">,</span> <span class="token comment">//ç”¨äºå¾—åˆ°æœ€æ–°çš„ state ,</span>
        <span class="token literal-property property">lastRenderedState</span><span class="token operator">:</span> initialState<span class="token punctuation">,</span> <span class="token comment">// æœ€åä¸€æ¬¡å¾—åˆ°çš„ state</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>dispatch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">dispatchAction</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span> <span class="token comment">// è´Ÿè´£æ›´æ–°çš„å‡½æ•°</span>
        <span class="token keyword">null</span><span class="token punctuation">,</span>
        currentlyRenderingFiber<span class="token punctuation">,</span>
        queue<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><code>mountState</code>åˆ°åº•åšäº†äº›ä»€ä¹ˆï¼Œé¦–å…ˆä¼šå¾—åˆ°åˆå§‹åŒ–çš„<code>state</code>ï¼Œå°†å®ƒèµ‹å€¼ç»™<code>mountWorkInProgressHook</code>äº§ç”Ÿçš„<code>hook</code>å¯¹è±¡çš„<code>memoizedState</code>å’Œ<code>baseState</code>å±æ€§ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª<code>queue</code>å¯¹è±¡ï¼Œé‡Œé¢ä¿å­˜äº†è´Ÿè´£æ›´æ–°çš„ä¿¡æ¯ã€‚</p><p>è¿™é‡Œå…ˆè¯´ä¸€ä¸‹ï¼Œåœ¨æ— çŠ¶æ€ç»„ä»¶ä¸­ï¼Œ<code>useState</code>å’Œ<code>useReducer</code>è§¦å‘å‡½æ•°æ›´æ–°çš„æ–¹æ³•éƒ½æ˜¯<code>dispatchAction</code>,<code>useState</code>ï¼Œå¯ä»¥çœ‹æˆä¸€ä¸ªç®€åŒ–ç‰ˆçš„<code>useReducer</code>,è‡³äº<code>dispatchAction</code>æ€ä¹ˆæ›´æ–°<code>state</code>ï¼Œæ›´æ–°ç»„ä»¶çš„ï¼Œæ¥ç€å¾€ä¸‹ç ”ç©¶<code>dispatchAction</code>ã€‚</p><p>åœ¨ç ”ç©¶ä¹‹å‰ <strong>å…ˆè¦å¼„æ˜ç™½<code>dispatchAction</code>æ˜¯ä»€ä¹ˆ?</strong></p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">dispatchAction</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  fiber<span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
  queue<span class="token operator">:</span> UpdateQueue<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  action<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span> number <span class="token punctuation">,</span> setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>dispatchAction</code> å°±æ˜¯ <code>setNumber</code> , <code>dispatchAction</code> ç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°ï¼Œå·²ç»è¢«<code>bind</code>ç»™æ”¹æˆ<code>currentlyRenderingFiber</code>å’Œ <code>queue</code>,ä¼ å…¥çš„å‚æ•°æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°<code>action</code></p><h2 id="dispatchaction-æ— çŠ¶æ€ç»„ä»¶æ›´æ–°æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#dispatchaction-æ— çŠ¶æ€ç»„ä»¶æ›´æ–°æœºåˆ¶" aria-hidden="true">#</a> dispatchAction æ— çŠ¶æ€ç»„ä»¶æ›´æ–°æœºåˆ¶</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dispatchAction</span><span class="token punctuation">(</span><span class="token parameter">fiber<span class="token punctuation">,</span> queue<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// è®¡ç®— expirationTime è¿‡ç¨‹ç•¥è¿‡ã€‚</span>
    <span class="token comment">/* åˆ›å»ºä¸€ä¸ªupdate */</span>
    <span class="token keyword">const</span> update<span class="token operator">=</span> <span class="token punctuation">{</span>
        expirationTime<span class="token punctuation">,</span>
        suspenseConfig<span class="token punctuation">,</span>
        action<span class="token punctuation">,</span>
        <span class="token literal-property property">eagerReducer</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">eagerState</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* æŠŠåˆ›å»ºçš„update */</span>
    <span class="token keyword">const</span> pending <span class="token operator">=</span> queue<span class="token punctuation">.</span>pending<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pending <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// è¯æ˜ç¬¬ä¸€æ¬¡æ›´æ–°</span>
        update<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// ä¸æ˜¯ç¬¬ä¸€æ¬¡æ›´æ–°</span>
        update<span class="token punctuation">.</span>next <span class="token operator">=</span> pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        pending<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> update<span class="token punctuation">;</span>
    <span class="token keyword">const</span> alternate <span class="token operator">=</span> fiber<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span>
    <span class="token comment">/* åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨æ¸²æŸ“é˜¶æ®µ */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> fiber <span class="token operator">===</span> currentlyRenderingFiber <span class="token operator">||</span> <span class="token punctuation">(</span>alternate <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> alternate <span class="token operator">===</span> currentlyRenderingFiber<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        didScheduleRenderPhaseUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        update<span class="token punctuation">.</span>expirationTime <span class="token operator">=</span> renderExpirationTime<span class="token punctuation">;</span>
        currentlyRenderingFiber<span class="token punctuation">.</span>expirationTime <span class="token operator">=</span> renderExpirationTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">/* å½“å‰å‡½æ•°ç»„ä»¶å¯¹åº”fiberæ²¡æœ‰å¤„äºè°ƒå’Œæ¸²æŸ“é˜¶æ®µ ï¼Œé‚£ä¹ˆè·å–æœ€æ–°state , æ‰§è¡Œæ›´æ–° */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fiber<span class="token punctuation">.</span>expirationTime <span class="token operator">===</span> NoWork <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>alternate <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> alternate<span class="token punctuation">.</span>expirationTime <span class="token operator">===</span> NoWork<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> lastRenderedReducer <span class="token operator">=</span> queue<span class="token punctuation">.</span>lastRenderedReducer<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastRenderedReducer <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> prevDispatcher<span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> currentState <span class="token operator">=</span> queue<span class="token punctuation">.</span>lastRenderedState<span class="token punctuation">;</span> <span class="token comment">/* ä¸Šä¸€æ¬¡çš„state */</span>
                    <span class="token keyword">const</span> eagerState <span class="token operator">=</span> <span class="token function">lastRenderedReducer</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/**/</span>
                    update<span class="token punctuation">.</span>eagerReducer <span class="token operator">=</span> lastRenderedReducer<span class="token punctuation">;</span>
                    update<span class="token punctuation">.</span>eagerState <span class="token operator">=</span> eagerState<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is</span><span class="token punctuation">(</span>eagerState<span class="token punctuation">,</span> currentState<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                        <span class="token keyword">return</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> expirationTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>æ— è®ºæ˜¯ç±»ç»„ä»¶è°ƒç”¨<code>setState</code>,è¿˜æ˜¯å‡½æ•°ç»„ä»¶çš„<code>dispatchAction</code> ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª <code>update</code>å¯¹è±¡ï¼Œé‡Œé¢è®°å½•äº†æ­¤æ¬¡æ›´æ–°çš„ä¿¡æ¯ï¼Œç„¶åå°†æ­¤<code>update</code>æ”¾å…¥å¾…æ›´æ–°çš„<code>pending</code>é˜Ÿåˆ—ä¸­ï¼Œ<code>dispatchAction</code>ç¬¬äºŒæ­¥å°±æ˜¯åˆ¤æ–­å½“å‰å‡½æ•°ç»„ä»¶çš„<code>fiber</code>å¯¹è±¡æ˜¯å¦å¤„äºæ¸²æŸ“é˜¶æ®µï¼Œå¦‚æœå¤„äºæ¸²æŸ“é˜¶æ®µï¼Œé‚£ä¹ˆä¸éœ€è¦åœ¨æ›´æ–°å½“å‰å‡½æ•°ç»„ä»¶ï¼Œåªéœ€è¦æ›´æ–°ä¸€ä¸‹å½“å‰<code>update</code>çš„<code>expirationTime</code>å³å¯ã€‚</p><p>å¦‚æœå½“å‰<code>fiber</code>æ²¡æœ‰å¤„äºæ›´æ–°é˜¶æ®µã€‚é‚£ä¹ˆé€šè¿‡è°ƒç”¨<code>lastRenderedReducer</code>è·å–æœ€æ–°çš„<code>state</code>,å’Œä¸Šä¸€æ¬¡çš„<code>currentState</code>ï¼Œè¿›è¡Œæµ…æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œé‚£ä¹ˆå°±é€€å‡ºï¼Œè¿™å°±è¯å®äº†ä¸ºä»€ä¹ˆ<code>useState</code>ï¼Œä¸¤æ¬¡å€¼ç›¸ç­‰çš„æ—¶å€™ï¼Œç»„ä»¶ä¸æ¸²æŸ“çš„åŸå› äº†ï¼Œè¿™ä¸ªæœºåˆ¶å’Œ<code>Component</code>æ¨¡å¼ä¸‹çš„<code>setState</code>æœ‰ä¸€å®šçš„åŒºåˆ«ã€‚</p><p>å¦‚æœä¸¤æ¬¡<code>state</code>ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆè°ƒç”¨<code>scheduleUpdateOnFiber</code>è°ƒåº¦æ¸²æŸ“å½“å‰fiberï¼Œ<code>scheduleUpdateOnFiber</code>æ˜¯<code>react</code>æ¸²æŸ“æ›´æ–°çš„ä¸»è¦å‡½æ•°ã€‚</p><p>æŠŠ<strong>åˆå§‹åŒ–<code>mountState</code>å’Œæ— çŠ¶æ€ç»„ä»¶æ›´æ–°æœºåˆ¶</strong>è®²æ˜ç™½äº†ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å…¶ä»–çš„<strong>hooks</strong>åˆå§‹åŒ–åšäº†äº›ä»€ä¹ˆæ“ä½œï¼Ÿ</p><h2 id="åˆå§‹åŒ–useeffect-mounteffect" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–useeffect-mounteffect" aria-hidden="true">#</a> åˆå§‹åŒ–useEffect -&gt; mountEffect</h2><hr><p>ä¸Šè¿°è®²åˆ°äº†æ— çŠ¶æ€ç»„ä»¶ä¸­<code>fiber</code>å¯¹è±¡<code>memoizedState</code>ä¿å­˜å½“å‰çš„<code>hooks</code>å½¢æˆçš„é“¾è¡¨ã€‚é‚£ä¹ˆ<code>updateQueue</code>ä¿å­˜äº†ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Œä¼šåœ¨æ¥ä¸‹æ¥æ¢ç´¢<code>useEffect</code>è¿‡ç¨‹ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚å½“è°ƒç”¨<code>useEffect</code>çš„æ—¶å€™ï¼Œåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ä¼šè°ƒç”¨<code>mountEffect</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åˆ°åº•åšäº†äº›ä»€ä¹ˆï¼Ÿ</p><p><strong>mountEffect</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountEffect</span><span class="token punctuation">(</span>
    <span class="token parameter">create<span class="token punctuation">,</span>
    deps<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> nextDeps <span class="token operator">=</span> deps <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> deps<span class="token punctuation">;</span>
    hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token function">pushEffect</span><span class="token punctuation">(</span>
        HookHasEffect <span class="token operator">|</span> hookEffectTag<span class="token punctuation">,</span> 
        create<span class="token punctuation">,</span> <span class="token comment">// useEffect ç¬¬ä¸€æ¬¡å‚æ•°ï¼Œå°±æ˜¯å‰¯ä½œç”¨å‡½æ•°</span>
        <span class="token keyword">undefined</span><span class="token punctuation">,</span>
        nextDeps<span class="token punctuation">,</span> <span class="token comment">// useEffect ç¬¬äºŒæ¬¡å‚æ•°ï¼Œdeps</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>æ¯ä¸ª<code>hooks</code>åˆå§‹åŒ–éƒ½ä¼šåˆ›å»ºä¸€ä¸ª<code>hook</code>å¯¹è±¡ï¼Œç„¶åå°†<code>hook</code>çš„<code>memoizedState</code>ä¿å­˜å½“å‰<code>effect hook</code>ä¿¡æ¯ã€‚</p><p><strong>æœ‰ä¸¤ä¸ª<code>memoizedState</code>å¤§å®¶åƒä¸‡åˆ«æ··æ·†äº†ï¼Œè¿™é‡Œå†å‹æƒ…æç¤ºä¸€é</strong></p><ul><li><p><code>workInProgress / current</code> æ ‘ä¸Šçš„ <code>memoizedState</code> ä¿å­˜çš„æ˜¯å½“å‰å‡½æ•°ç»„ä»¶æ¯ä¸ª<code>hooks</code>å½¢æˆçš„é“¾è¡¨ã€‚</p></li><li><p>æ¯ä¸ª<code>hooks</code>ä¸Šçš„<code>memoizedState</code> ä¿å­˜äº†å½“å‰<code>hooks</code>ä¿¡æ¯ï¼Œä¸åŒç§ç±»çš„<code>hooks</code>çš„<code>memoizedState</code>å†…å®¹ä¸åŒã€‚ä¸Šè¿°çš„æ–¹æ³•æœ€åæ‰§è¡Œäº†ä¸€ä¸ª<code>pushEffect</code>ï¼Œä¸€èµ·çœ‹çœ‹<code>pushEffect</code>åšäº†äº›ä»€ä¹ˆï¼Ÿ</p></li></ul><p><strong><code>pushEffect</code> åˆ›å»º<code>effect</code>å¯¹è±¡ï¼ŒæŒ‚è½½<code>updateQueue</code></strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">pushEffect</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> create<span class="token punctuation">,</span> destroy<span class="token punctuation">,</span> deps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> effect <span class="token operator">=</span> <span class="token punctuation">{</span>
        tag<span class="token punctuation">,</span>
        create<span class="token punctuation">,</span>
        destroy<span class="token punctuation">,</span>
        deps<span class="token punctuation">,</span>
        <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> componentUpdateQueue <span class="token operator">=</span> currentlyRenderingFiber<span class="token punctuation">.</span>updateQueue
    <span class="token keyword">if</span> <span class="token punctuation">(</span>componentUpdateQueue <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ˜¯ç¬¬ä¸€ä¸ª useEffect</span>
        componentUpdateQueue <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token literal-property property">lastEffect</span><span class="token operator">:</span> <span class="token keyword">null</span>  <span class="token punctuation">}</span>
        currentlyRenderingFiber<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> componentUpdateQueue
        componentUpdateQueue<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> effect<span class="token punctuation">.</span>next <span class="token operator">=</span> effect<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// å­˜åœ¨å¤šä¸ªeffect</span>
        <span class="token keyword">const</span> lastEffect <span class="token operator">=</span> componentUpdateQueue<span class="token punctuation">.</span>lastEffect<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lastEffect <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            componentUpdateQueue<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> effect<span class="token punctuation">.</span>next <span class="token operator">=</span> effect<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> firstEffect <span class="token operator">=</span> lastEffect<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
            lastEffect<span class="token punctuation">.</span>next <span class="token operator">=</span> effect<span class="token punctuation">;</span>
            effect<span class="token punctuation">.</span>next <span class="token operator">=</span> firstEffect<span class="token punctuation">;</span>
            componentUpdateQueue<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> effect<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> effect<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>è¿™ä¸€æ®µå®é™…å¾ˆç®€å•ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>effect</code> ï¼Œåˆ¤æ–­ç»„ä»¶å¦‚æœç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œé‚£ä¹ˆåˆ›å»º <code>componentUpdateQueue</code> ï¼Œå°±æ˜¯<code>workInProgress</code>çš„<code>updateQueue</code>ã€‚ç„¶åå°†<code>effect</code>æ”¾å…¥<code>updateQueue</code>ä¸­ã€‚</p><p>å‡è®¾åœ¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ä¸­è¿™ä¹ˆå†™ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span> props<span class="token punctuation">.</span>a <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>æœ€å<code>workInProgress.updateQueue</code>ä¼šä»¥è¿™æ ·çš„å½¢å¼ä¿å­˜ï¼š</p><img src="/notes/assets/react/14ac9e04c10e45e5b93fc76d47a5fdd5_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p><strong>æ‹“å±•:<code>effectList</code></strong></p><ul><li><p><code>effect list</code> å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå­˜å‚¨ <code>effectTag</code> å‰¯ä½œç”¨åˆ—è¡¨å®¹å™¨ã€‚å®ƒæ˜¯ç”± <code>fiber</code> èŠ‚ç‚¹å’ŒæŒ‡é’ˆ <code>nextEffect</code> æ„æˆçš„å•é“¾è¡¨ç»“æ„ï¼Œè¿™å…¶ä¸­è¿˜åŒ…æ‹¬ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ <code>firstEffect</code> ï¼Œå’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹ <code>lastEffect</code>ã€‚</p></li><li><p><code>React</code> é‡‡ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼Œåœ¨ <code>render</code> é˜¶æ®µéå† <code>fiber</code> æ ‘æ—¶ï¼ŒæŠŠæ¯ä¸€ä¸ªæœ‰å‰¯ä½œç”¨çš„ <code>fiber</code> ç­›é€‰å‡ºæ¥ï¼Œæœ€åæ„å»ºç”Ÿæˆä¸€ä¸ªåªå¸¦å‰¯ä½œç”¨çš„ <code>effect list</code> é“¾è¡¨ã€‚</p></li><li><p>åœ¨ <code>commit</code> é˜¶æ®µï¼Œ<code>React</code> æ‹¿åˆ° <code>effect list</code> æ•°æ®åï¼Œé€šè¿‡éå† <code>effect list</code>ï¼Œå¹¶æ ¹æ®æ¯ä¸€ä¸ª <code>effect</code> èŠ‚ç‚¹çš„ <code>effectTag</code> ç±»å‹ï¼Œæ‰§è¡Œæ¯ä¸ª<code>effect</code>ï¼Œä»è€Œå¯¹ç›¸åº”çš„ <code>DOM</code> æ ‘æ‰§è¡Œæ›´æ”¹ã€‚</p></li></ul><h2 id="åˆå§‹åŒ–usememo-mountmemo" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–usememo-mountmemo" aria-hidden="true">#</a> åˆå§‹åŒ–useMemo -&gt; mountMemo</h2><hr><p>ä¸çŸ¥é“å¤§å®¶æ˜¯å¦æŠŠ <code>useMemo</code> æƒ³è±¡çš„è¿‡äºå¤æ‚äº†ï¼Œå®é™…ç›¸æ¯”å…¶ä»– <code>useState</code> , <code>useEffect</code>ç­‰ï¼Œå®ƒçš„é€»è¾‘å®é™…ç®€å•çš„å¾ˆã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountMemo</span><span class="token punctuation">(</span><span class="token parameter">nextCreate<span class="token punctuation">,</span>deps</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> nextDeps <span class="token operator">=</span> deps <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> deps<span class="token punctuation">;</span>
    <span class="token keyword">const</span> nextValue <span class="token operator">=</span> <span class="token function">nextCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token punctuation">[</span>nextValue<span class="token punctuation">,</span> nextDeps<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> nextValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åˆå§‹åŒ–<code>useMemo</code>ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª<code>hook</code>ï¼Œç„¶åæ‰§è¡Œ<code>useMemo</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°,å¾—åˆ°éœ€è¦ç¼“å­˜çš„å€¼ï¼Œç„¶åå°†å€¼å’Œ<code>deps</code>è®°å½•ä¸‹æ¥ï¼Œèµ‹å€¼ç»™å½“å‰<code>hook</code>çš„<code>memoizedState</code>ã€‚æ•´ä½“ä¸Šå¹¶æ²¡æœ‰å¤æ‚çš„é€»è¾‘ã€‚</p><h2 id="åˆå§‹åŒ–useref-mountref" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–useref-mountref" aria-hidden="true">#</a> åˆå§‹åŒ–useRef -&gt; mountRef</h2><hr><p>å¯¹äº<code>useRef</code>åˆå§‹åŒ–å¤„ç†ï¼Œä¼¼ä¹æ›´æ˜¯ç®€å•ï¼Œä¸€èµ·æ¥çœ‹ä¸€ä¸‹ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountRef</span><span class="token punctuation">(</span><span class="token parameter">initialValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">current</span><span class="token operator">:</span> initialValue<span class="token punctuation">}</span><span class="token punctuation">;</span>
    hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> ref<span class="token punctuation">;</span>
    <span class="token keyword">return</span> ref<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>mountRef</code>åˆå§‹åŒ–å¾ˆç®€å•, åˆ›å»ºä¸€ä¸ª<code>ref</code>å¯¹è±¡ï¼Œ å¯¹è±¡çš„<code>current</code> å±æ€§æ¥ä¿å­˜åˆå§‹åŒ–çš„å€¼ï¼Œæœ€åç”¨<code>memoizedState</code>ä¿å­˜<code>ref</code>ï¼Œå®Œæˆæ•´ä¸ªæ“ä½œã€‚</p><h2 id="mounted-é˜¶æ®µ-hooks-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#mounted-é˜¶æ®µ-hooks-æ€»ç»“" aria-hidden="true">#</a> mounted é˜¶æ®µ hooks æ€»ç»“</h2><p>æ¥æ€»ç»“ä¸€ä¸‹åˆå§‹åŒ–é˜¶æ®µ,<code>react-hooks</code>åšçš„äº‹æƒ…ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰§è¡Œä¸Šä¸‹æ–‡è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ª<code>react-hooks</code>æ‰§è¡Œï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª<code>hook</code>å¯¹è±¡ï¼Œå¹¶å½¢æˆé“¾è¡¨ç»“æ„ï¼Œç»‘å®šåœ¨<code>workInProgress</code>çš„<code>memoizedState</code>å±æ€§ä¸Šï¼Œç„¶å<code>react-hooks</code>ä¸Šçš„çŠ¶æ€ï¼Œç»‘å®šåœ¨å½“å‰<code>hooks</code>å¯¹è±¡çš„<code>memoizedState</code>å±æ€§ä¸Šã€‚å¯¹äº<code>effect</code>å‰¯ä½œç”¨é’©å­ï¼Œä¼šç»‘å®šåœ¨<code>workInProgress.updateQueue</code>ä¸Šï¼Œç­‰åˆ°<code>commit</code>é˜¶æ®µï¼Œ<code>dom</code>æ ‘æ„å»ºå®Œæˆï¼Œåœ¨æ‰§è¡Œæ¯ä¸ª <code>effect</code> å‰¯ä½œç”¨é’©å­ã€‚</p><h1 id="hooksæ›´æ–°é˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#hooksæ›´æ–°é˜¶æ®µ" aria-hidden="true">#</a> hooksæ›´æ–°é˜¶æ®µ</h1><p>ä¸Šè¿°ä»‹ç»äº†ç¬¬ä¸€æ¬¡æ¸²æŸ“å‡½æ•°ç»„ä»¶ï¼Œ<code>react-hooks</code>åˆå§‹åŒ–éƒ½åšäº›ä»€ä¹ˆï¼Œæ¥ä¸‹æ¥ï¼Œåˆ†æä¸€ä¸‹ï¼Œ</p><p>å¯¹äºæ›´æ–°é˜¶æ®µï¼Œè¯´æ˜ä¸Šä¸€æ¬¡ <code>workInProgress</code> æ ‘å·²ç»èµ‹å€¼ç»™äº† <code>current</code> æ ‘ã€‚å­˜æ”¾<code>hooks</code>ä¿¡æ¯çš„<code>memoizedState</code>ï¼Œæ­¤æ—¶å·²ç»å­˜åœ¨<code>current</code>æ ‘ä¸Šï¼Œ<code>react</code>å¯¹äº<code>hooks</code>çš„å¤„ç†é€»è¾‘å’Œ<code>fiber</code>æ ‘é€»è¾‘ç±»ä¼¼ã€‚</p><p>å¯¹äºä¸€æ¬¡å‡½æ•°ç»„ä»¶æ›´æ–°ï¼Œå½“å†æ¬¡æ‰§è¡Œ<code>hooks</code>å‡½æ•°çš„æ—¶å€™ï¼Œæ¯”å¦‚ <code>useState(0)</code> ï¼Œé¦–å…ˆè¦ä»<code>current</code>çš„<code>hooks</code>ä¸­æ‰¾åˆ°ä¸å½“å‰<code>workInProgressHook</code>ï¼Œå¯¹åº”çš„<code>currentHooks</code>ï¼Œç„¶åå¤åˆ¶ä¸€ä»½<code>currentHooks</code>ç»™<code>workInProgressHook</code>,æ¥ä¸‹æ¥<code>hooks</code>å‡½æ•°æ‰§è¡Œçš„æ—¶å€™,æŠŠæœ€æ–°çš„çŠ¶æ€æ›´æ–°åˆ°<code>workInProgressHook</code>ï¼Œä¿è¯<code>hooks</code>çŠ¶æ€ä¸ä¸¢å¤±ã€‚</p><p>æ‰€ä»¥å‡½æ•°ç»„ä»¶æ¯æ¬¡æ›´æ–°ï¼Œæ¯ä¸€æ¬¡<code>react-hooks</code>å‡½æ•°æ‰§è¡Œï¼Œéƒ½éœ€è¦æœ‰ä¸€ä¸ªå‡½æ•°å»åšä¸Šé¢çš„æ“ä½œï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯<code>updateWorkInProgressHook</code>,æ¥ä¸‹æ¥ä¸€èµ·çœ‹è¿™ä¸ª<code>updateWorkInProgressHook</code>ã€‚</p><h2 id="_1-updateworkinprogresshook" tabindex="-1"><a class="header-anchor" href="#_1-updateworkinprogresshook" aria-hidden="true">#</a> 1. updateWorkInProgressHook</h2><hr><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> nextCurrentHook<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">/* å¦‚æœ currentHook = null è¯æ˜å®ƒæ˜¯ç¬¬ä¸€ä¸ªhooks */</span>
        <span class="token keyword">const</span> current <span class="token operator">=</span> currentlyRenderingFiber<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            nextCurrentHook <span class="token operator">=</span> current<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            nextCurrentHook <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">/* ä¸æ˜¯ç¬¬ä¸€ä¸ªhooksï¼Œé‚£ä¹ˆæŒ‡å‘ä¸‹ä¸€ä¸ª hooks */</span>
        nextCurrentHook <span class="token operator">=</span> currentHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> nextWorkInProgressHook
    <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//ç¬¬ä¸€æ¬¡æ‰§è¡Œhooks</span>
        <span class="token comment">// è¿™é‡Œåº”è¯¥æ³¨æ„ä¸€ä¸‹ï¼Œå½“å‡½æ•°ç»„ä»¶æ›´æ–°ä¹Ÿæ˜¯è°ƒç”¨ renderWithHooks ,memoizedStateå±æ€§æ˜¯ç½®ç©ºçš„</span>
        nextWorkInProgressHook <span class="token operator">=</span> currentlyRenderingFiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
        nextWorkInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextWorkInProgressHook <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment">/* è¿™ä¸ªæƒ…å†µè¯´æ˜ renderWithHooks æ‰§è¡Œ è¿‡ç¨‹å‘ç”Ÿå¤šæ¬¡å‡½æ•°ç»„ä»¶çš„æ‰§è¡Œ ï¼Œæš‚æ—¶å…ˆä¸è€ƒè™‘ */</span>
        workInProgressHook <span class="token operator">=</span> nextWorkInProgressHook<span class="token punctuation">;</span>
        nextWorkInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        currentHook <span class="token operator">=</span> nextCurrentHook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">invariant</span><span class="token punctuation">(</span>
            nextCurrentHook <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">&#39;Rendered more hooks than during the previous render.&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        currentHook <span class="token operator">=</span> nextCurrentHook<span class="token punctuation">;</span>
        <span class="token keyword">const</span> newHook <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„hook</span>
            <span class="token literal-property property">memoizedState</span><span class="token operator">:</span> currentHook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span>
            <span class="token literal-property property">baseState</span><span class="token operator">:</span> currentHook<span class="token punctuation">.</span>baseState<span class="token punctuation">,</span>
            <span class="token literal-property property">baseQueue</span><span class="token operator">:</span> currentHook<span class="token punctuation">.</span>baseQueue<span class="token punctuation">,</span>
            <span class="token literal-property property">queue</span><span class="token operator">:</span> currentHook<span class="token punctuation">.</span>queue<span class="token punctuation">,</span>
            <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªhooks</span>
            currentlyRenderingFiber<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> workInProgressHook <span class="token operator">=</span> newHook<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// é‡æ–°æ›´æ–° hook</span>
            workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> newHook<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> workInProgressHook<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>è¿™ä¸€æ®µçš„é€»è¾‘å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>é¦–å…ˆå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œ<code>hooks</code>å‡½æ•°ï¼Œé‚£ä¹ˆä»<code>current</code>æ ‘ä¸Šå–å‡º<code>memoizedState</code> ï¼Œä¹Ÿå°±æ˜¯æ—§çš„<code>hooks</code>ã€‚</p></li><li><p>ç„¶åå£°æ˜å˜é‡<code>nextWorkInProgressHook</code>ï¼Œè¿™é‡Œåº”è¯¥å€¼å¾—æ³¨æ„ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€æ¬¡<code>renderWithHooks</code>æ‰§è¡Œï¼Œ<code>workInProgress</code>ä¸Šçš„<code>memoizedState</code>ä¼šè¢«ç½®ç©ºï¼Œ<code>hooks</code>å‡½æ•°é¡ºåºæ‰§è¡Œï¼Œ<code>nextWorkInProgressHook</code>åº”è¯¥ä¸€ç›´ä¸º<code>null</code>ï¼Œé‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹<code>nextWorkInProgressHook</code>ä¸ä¸º<code>null</code>,ä¹Ÿå°±æ˜¯å½“ä¸€æ¬¡<code>renderWithHooks</code>æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†å¤šæ¬¡å‡½æ•°ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯åœ¨<code>renderWithHooks</code>ä¸­è¿™æ®µé€»è¾‘ã€‚</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>expirationTime <span class="token operator">===</span> renderExpirationTime<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// ....è¿™é‡Œçš„é€»è¾‘å…ˆæ”¾ä¸€æ”¾</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¿™é‡Œé¢çš„é€»è¾‘ï¼Œå®é™…å°±æ˜¯åˆ¤å®šï¼Œå¦‚æœå½“å‰å‡½æ•°ç»„ä»¶æ‰§è¡Œåï¼Œå½“å‰å‡½æ•°ç»„ä»¶çš„è¿˜æ˜¯å¤„äºæ¸²æŸ“ä¼˜å…ˆçº§ï¼Œè¯´æ˜å‡½æ•°ç»„ä»¶åˆæœ‰äº†æ–°çš„æ›´æ–°ä»»åŠ¡ï¼Œé‚£ä¹ˆå¾ªåæ‰§è¡Œå‡½æ•°ç»„ä»¶ã€‚è¿™å°±é€ æˆäº†ä¸Šè¿°çš„ï¼Œ<code>nextWorkInProgressHook</code>ä¸ä¸º <code>null</code> çš„æƒ…å†µã€‚</p><ul><li>æœ€åå¤åˆ¶<code>current</code>çš„<code>hooks</code>ï¼ŒæŠŠå®ƒèµ‹å€¼ç»™<code>workInProgressHook</code>,ç”¨äºæ›´æ–°æ–°çš„ä¸€è½®<code>hooks</code>çŠ¶æ€ã€‚</li></ul><h2 id="_2-updatestate" tabindex="-1"><a class="header-anchor" href="#_2-updatestate" aria-hidden="true">#</a> 2. updateState</h2><hr><p><strong>useState</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateReducer</span><span class="token punctuation">(</span>
    <span class="token parameter">reducer<span class="token punctuation">,</span>
    initialArg<span class="token punctuation">,</span>
    init<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> queue <span class="token operator">=</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">;</span>
    queue<span class="token punctuation">.</span>lastRenderedReducer <span class="token operator">=</span> reducer<span class="token punctuation">;</span>
    <span class="token keyword">const</span> current <span class="token operator">=</span> currentHook<span class="token punctuation">;</span>
    <span class="token keyword">let</span> baseQueue <span class="token operator">=</span> current<span class="token punctuation">.</span>baseQueue<span class="token punctuation">;</span>
    <span class="token keyword">const</span> pendingQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span>pending<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingQueue <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿™é‡Œçœç•¥... ç¬¬ä¸€æ­¥ï¼šå°† pending  queue åˆå¹¶åˆ° basequeue</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>baseQueue <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> first <span class="token operator">=</span> baseQueue<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        <span class="token keyword">let</span> newState <span class="token operator">=</span> current<span class="token punctuation">.</span>baseState<span class="token punctuation">;</span>
        <span class="token keyword">let</span> newBaseState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> newBaseQueueFirst <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> newBaseQueueLast <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> update <span class="token operator">=</span> first<span class="token punctuation">;</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> updateExpirationTime <span class="token operator">=</span> update<span class="token punctuation">.</span>expirationTime<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>updateExpirationTime <span class="token operator">&lt;</span> renderExpirationTime<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//ä¼˜å…ˆçº§ä¸è¶³</span>
            <span class="token keyword">const</span> clone  <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">expirationTime</span><span class="token operator">:</span> update<span class="token punctuation">.</span>expirationTime<span class="token punctuation">,</span>
                <span class="token operator">...</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>newBaseQueueLast <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newBaseQueueFirst <span class="token operator">=</span> newBaseQueueLast <span class="token operator">=</span> clone<span class="token punctuation">;</span>
                newBaseState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                newBaseQueueLast <span class="token operator">=</span> newBaseQueueLast<span class="token punctuation">.</span>next <span class="token operator">=</span> clone<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">//æ­¤æ›´æ–°ç¡®å®å…·æœ‰è¶³å¤Ÿçš„ä¼˜å…ˆçº§ã€‚</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>newBaseQueueLast <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> clone<span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">expirationTime</span><span class="token operator">:</span> Sync<span class="token punctuation">,</span> 
                    <span class="token operator">...</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                newBaseQueueLast <span class="token operator">=</span> newBaseQueueLast<span class="token punctuation">.</span>next <span class="token operator">=</span> clone<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">/* å¾—åˆ°æ–°çš„ state */</span>
            newState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>newState<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        update <span class="token operator">=</span> update<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>update <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> update <span class="token operator">!==</span> first<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>newBaseQueueLast <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newBaseState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            newBaseQueueLast<span class="token punctuation">.</span>next <span class="token operator">=</span> newBaseQueueFirst<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
        hook<span class="token punctuation">.</span>baseState <span class="token operator">=</span> newBaseState<span class="token punctuation">;</span>
        hook<span class="token punctuation">.</span>baseQueue <span class="token operator">=</span> newBaseQueueLast<span class="token punctuation">;</span>
        queue<span class="token punctuation">.</span>lastRenderedState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> dispatch <span class="token operator">=</span> queue<span class="token punctuation">.</span>dispatch
    <span class="token keyword">return</span> <span class="token punctuation">[</span>hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p>è¿™ä¸€æ®µçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œè®©æ…¢æ…¢åƒé€ï¼Œé¦–å…ˆå°†ä¸Šä¸€æ¬¡æ›´æ–°çš„<code>pending queue</code> åˆå¹¶åˆ° <code>basequeue</code>ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œæ¯”å¦‚å†ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ä¸­è¿™ä¹ˆå†™ï¼Œ</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">const</span> <span class="token punctuation">[</span> number <span class="token punctuation">,</span>setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
   <span class="token keyword">const</span> <span class="token function-variable function">handerClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//    setNumber(1)</span>
    <span class="token comment">//    setNumber(2)</span>
    <span class="token comment">//    setNumber(3)</span>
       <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token comment">// è·å–ä¸Šæ¬¡ state = 1 </span>
       <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token comment">// è·å–ä¸Šæ¬¡ state = 2</span>
       <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token comment">// 3 </span>
   <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span> number <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token function">handerClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>ç‚¹å‡»<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>ç‚¹å‡»æŒ‰é’®ï¼Œ æ‰“å° 3</strong></p><p>ä¸‰æ¬¡<code>setNumber</code>äº§ç”Ÿçš„<code>update</code>ä¼šæš‚ä¸”æ”¾å…¥<code>pending queue</code>ï¼Œåœ¨ä¸‹ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ‰§è¡Œæ—¶å€™ï¼Œä¸‰æ¬¡ <code>update</code>è¢«åˆå¹¶åˆ° <code>baseQueue</code>ã€‚ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><img src="/notes/assets/react/52ed6118238d412aa20044ad33f25827_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p>æ¥ä¸‹æ¥ä¼šæŠŠå½“å‰<code>useState</code>æˆ–æ˜¯<code>useReduer</code>å¯¹åº”çš„<code>hooks</code>ä¸Šçš„<code>baseState</code>å’Œ<code>baseQueue</code>æ›´æ–°åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚ä¼šå¾ªç¯<code>baseQueue</code>çš„<code>update</code>ï¼Œå¤åˆ¶ä¸€ä»½<code>update</code>,æ›´æ–°<code>expirationTime</code>ï¼Œå¯¹äºæœ‰è¶³å¤Ÿä¼˜å…ˆçº§çš„<code>update</code>ï¼ˆä¸Šè¿°ä¸‰ä¸ª<code>setNumber</code>äº§ç”Ÿçš„<code>update</code>éƒ½å…·æœ‰è¶³å¤Ÿçš„ä¼˜å…ˆçº§ï¼‰ï¼Œè¦è·å–æœ€æ–°çš„<code>state</code>çŠ¶æ€ã€‚ï¼Œä¼šä¸€æ¬¡æ‰§è¡Œ<code>useState</code>ä¸Šçš„æ¯ä¸€ä¸ª<code>action</code>ã€‚å¾—åˆ°æœ€æ–°çš„<code>state</code>ã€‚</p><p><strong>æ›´æ–°state</strong></p><img src="/notes/assets/react/6d78fac49ce648ea89bce06a25e1128d_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p>è¿™é‡Œæœ‰ä¼šæœ‰ä¸¤ä¸ªç–‘é—®ğŸ¤”ï¸:</p><ul><li>é—®é¢˜ä¸€ï¼šè¿™é‡Œä¸æ˜¯æ‰§è¡Œæœ€åä¸€ä¸ª<code>action</code>ä¸å°±å¯ä»¥äº†å˜›?</li></ul><p>ç­”æ¡ˆï¼š åŸå› å¾ˆç®€å•ï¼Œä¸Šé¢è¯´äº† <code>useState</code>é€»è¾‘å’Œ<code>useReducer</code>å·®ä¸å¤šã€‚å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šå¼•ç”¨ä¸Šä¸€æ¬¡ <code>update</code>äº§ç”Ÿçš„ <code>state</code>, æ‰€ä»¥éœ€è¦<strong>å¾ªç¯è°ƒç”¨ï¼Œæ¯ä¸€ä¸ª<code>update</code>çš„<code>reducer</code></strong>ï¼Œå¦‚æœ<code>setNumber(2)</code>æ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆåªç”¨æ›´æ–°å€¼ï¼Œå¦‚æœæ˜¯<code>setNumber(state=&gt;state+1)</code>,é‚£ä¹ˆä¼ å…¥ä¸Šä¸€æ¬¡çš„ <code>state</code> å¾—åˆ°æœ€æ–°<code>state</code>ã€‚</p><ul><li>é—®é¢˜äºŒï¼šä»€ä¹ˆæƒ…å†µä¸‹ä¼šæœ‰ä¼˜å…ˆçº§ä¸è¶³çš„æƒ…å†µ(<code>updateExpirationTime &lt; renderExpirationTime</code>)ï¼Ÿ</li></ul><p>ç­”æ¡ˆï¼š è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬ä¼šå‘ç”Ÿåœ¨ï¼Œå½“è°ƒç”¨<code>setNumber</code>æ—¶å€™ï¼Œè°ƒç”¨<code>scheduleUpdateOnFiber</code>æ¸²æŸ“å½“å‰ç»„ä»¶æ—¶ï¼Œåˆäº§ç”Ÿäº†ä¸€æ¬¡æ–°çš„æ›´æ–°ï¼Œæ‰€ä»¥æŠŠæœ€ç»ˆæ‰§è¡Œ<code>reducer</code>æ›´æ–°<code>state</code>ä»»åŠ¡äº¤ç»™ä¸‹ä¸€æ¬¡æ›´æ–°ã€‚</p><h2 id="_3-updateeffect" tabindex="-1"><a class="header-anchor" href="#_3-updateeffect" aria-hidden="true">#</a> 3 updateEffect</h2><hr><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateEffect</span><span class="token punctuation">(</span><span class="token parameter">create<span class="token punctuation">,</span> deps</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> nextDeps <span class="token operator">=</span> deps <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> deps<span class="token punctuation">;</span>
    <span class="token keyword">let</span> destroy <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentHook <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> prevEffect <span class="token operator">=</span> currentHook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>
        destroy <span class="token operator">=</span> prevEffect<span class="token punctuation">.</span>destroy<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextDeps <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> prevDeps <span class="token operator">=</span> prevEffect<span class="token punctuation">.</span>deps<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">areHookInputsEqual</span><span class="token punctuation">(</span>nextDeps<span class="token punctuation">,</span> prevDeps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">pushEffect</span><span class="token punctuation">(</span>hookEffectTag<span class="token punctuation">,</span> create<span class="token punctuation">,</span> destroy<span class="token punctuation">,</span> nextDeps<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    currentlyRenderingFiber<span class="token punctuation">.</span>effectTag <span class="token operator">|=</span> fiberEffectTag
    hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token function">pushEffect</span><span class="token punctuation">(</span>
        HookHasEffect <span class="token operator">|</span> hookEffectTag<span class="token punctuation">,</span>
        create<span class="token punctuation">,</span>
        destroy<span class="token punctuation">,</span>
        nextDeps<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><code>useEffect</code> åšçš„äº‹å¾ˆç®€å•ï¼Œåˆ¤æ–­ä¸¤æ¬¡<code>deps</code> ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰è¯´æ˜æ­¤æ¬¡æ›´æ–°ä¸éœ€è¦æ‰§è¡Œï¼Œåˆ™ç›´æ¥è°ƒç”¨ <code>pushEffect</code>,è¿™é‡Œæ³¨æ„ <code>effect</code>çš„æ ‡ç­¾ï¼Œ<code>hookEffectTag</code>,å¦‚æœä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆæ›´æ–° <code>effect</code> ,å¹¶ä¸”èµ‹å€¼ç»™<code>hook.memoizedState</code>ï¼Œè¿™é‡Œæ ‡ç­¾æ˜¯ <code>HookHasEffect | hookEffectTag</code>,ç„¶ååœ¨<code>commit</code>é˜¶æ®µï¼Œ<code>react</code>ä¼šé€šè¿‡æ ‡ç­¾æ¥åˆ¤æ–­ï¼Œæ˜¯å¦æ‰§è¡Œå½“å‰çš„ <code>effect</code> å‡½æ•°ã€‚</p><h2 id="_4-updatememo" tabindex="-1"><a class="header-anchor" href="#_4-updatememo" aria-hidden="true">#</a> 4 updateMemo</h2><hr><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateMemo</span><span class="token punctuation">(</span>
    <span class="token parameter">nextCreate<span class="token punctuation">,</span>
    deps<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> nextDeps <span class="token operator">=</span> deps <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> deps<span class="token punctuation">;</span> <span class="token comment">// æ–°çš„ deps å€¼</span>
    <span class="token keyword">const</span> prevState <span class="token operator">=</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevState <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextDeps <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> prevDeps <span class="token operator">=</span> prevState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// ä¹‹å‰ä¿å­˜çš„ deps å€¼</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">areHookInputsEqual</span><span class="token punctuation">(</span>nextDeps<span class="token punctuation">,</span> prevDeps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//åˆ¤æ–­ä¸¤æ¬¡ deps å€¼</span>
            <span class="token keyword">return</span> prevState<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> nextValue <span class="token operator">=</span> <span class="token function">nextCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token punctuation">[</span>nextValue<span class="token punctuation">,</span> nextDeps<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> nextValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>åœ¨ç»„ä»¶æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œ<code>useMemo</code>å‡½æ•°ï¼Œåšçš„äº‹æƒ…å®é™…å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­ä¸¤æ¬¡ <code>deps</code>æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸æƒ³ç­‰ï¼Œè¯æ˜ä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆæ‰§è¡Œ <code>useMemo</code>çš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œå¾—åˆ°æ–°çš„å€¼ï¼Œç„¶åé‡æ–°èµ‹å€¼ç»™<code>hook.memoizedState</code>,å¦‚æœç›¸ç­‰ è¯æ˜æ²¡æœ‰ä¾èµ–é¡¹æ”¹å˜ï¼Œé‚£ä¹ˆç›´æ¥è·å–ç¼“å­˜çš„å€¼ã€‚</p><p>ä¸è¿‡è¿™é‡Œæœ‰ä¸€ç‚¹ï¼Œå€¼å¾—æ³¨æ„ï¼Œ<code>nextCreate()</code>æ‰§è¡Œï¼Œå¦‚æœé‡Œé¢å¼•ç”¨äº†<code>usestate</code>ç­‰ä¿¡æ¯ï¼Œå˜é‡ä¼šè¢«å¼•ç”¨ï¼Œæ— æ³•è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ï¼Œå°±æ˜¯é—­åŒ…åŸç†ï¼Œé‚£ä¹ˆè®¿é—®çš„å±æ€§æœ‰å¯èƒ½ä¸æ˜¯æœ€æ–°çš„å€¼ï¼Œæ‰€ä»¥éœ€è¦æŠŠå¼•ç”¨çš„å€¼ï¼Œæ·»åŠ åˆ°ä¾èµ–é¡¹ <code>dep</code> æ•°ç»„ä¸­ã€‚æ¯ä¸€æ¬¡<code>dep</code>æ”¹å˜ï¼Œé‡æ–°æ‰§è¡Œï¼Œå°±ä¸ä¼šå‡ºç°é—®é¢˜äº†ã€‚</p><p><strong>æ¸©é¦¨å°æç¤ºï¼š æœ‰å¾ˆå¤šåŒå­¦è¯´ <code>useMemo</code>æ€ä¹ˆç”¨ï¼Œåˆ°åº•ä»€ä¹ˆåœºæ™¯ç”¨ï¼Œç”¨äº†ä¼šä¸ä¼šèµ·åˆ°åä½œç”¨ï¼Œé€šè¿‡å¯¹æºç åŸç†è§£æï¼Œå¯ä»¥æ˜ç¡®çš„è¯´ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥æ”¾å¿ƒä½¿ç”¨ï¼Œè¯´ç™½äº†å°±æ˜¯å¯ä»¥å®šåˆ¶åŒ–ç¼“å­˜ï¼Œå­˜å€¼å–å€¼è€Œå·²ã€‚</strong></p><h2 id="_5-updateref" tabindex="-1"><a class="header-anchor" href="#_5-updateref" aria-hidden="true">#</a> 5 updateRef</h2><hr><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateRef</span><span class="token punctuation">(</span><span class="token parameter">initialValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> hook<span class="token punctuation">.</span>memoizedState
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å‡½æ•°ç»„ä»¶æ›´æ–°<code>useRef</code>åšçš„äº‹æƒ…æ›´ç®€å•ï¼Œå°±æ˜¯è¿”å›äº†ç¼“å­˜ä¸‹æ¥çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æ— è®ºå‡½æ•°ç»„ä»¶æ€ä¹ˆæ‰§è¡Œï¼Œæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œ<code>hook.memoizedState</code>å†…å­˜ä¸­éƒ½æŒ‡å‘äº†ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è§£é‡Šäº†<code>useEffect</code>,<code>useMemo</code> ä¸­ï¼Œä¸ºä»€ä¹ˆ<code>useRef</code>ä¸éœ€è¦ä¾èµ–æ³¨å…¥ï¼Œå°±èƒ½è®¿é—®åˆ°æœ€æ–°çš„æ”¹å˜å€¼ã€‚</p><p><strong>ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶æ›´æ–°</strong></p><img src="/notes/assets/react/a02c58be8c6f455f96c2e691b2ac6f7b_tplv-k3u1fbpfcp-watermark.image" alt="demo"><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: dean@57blocks.com">DeanSui</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/notes/assets/app.9719f74c.js" defer></script>
  </body>
</html>
