<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>fiber 树构造(基础准备) | </title><meta name="description" content="君子藏器于身 待时而动 天下有道则见 无道则隐">
    <link rel="modulepreload" href="/notes/assets/app.013e756e.js"><link rel="modulepreload" href="/notes/assets/fibertree-prepare.html.d7c62d4b.js"><link rel="modulepreload" href="/notes/assets/fibertree-prepare.html.7e65d454.js"><link rel="prefetch" href="/notes/assets/index.html.3634373a.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.3ba9ec24.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.c28c3f3c.js"><link rel="prefetch" href="/notes/assets/base.html.1093b531.js"><link rel="prefetch" href="/notes/assets/customCli.html.bd95fbb6.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.7df24b52.js"><link rel="prefetch" href="/notes/assets/adapter.html.228754b3.js"><link rel="prefetch" href="/notes/assets/amd.html.374db1f8.js"><link rel="prefetch" href="/notes/assets/builder.html.4ab18b18.js"><link rel="prefetch" href="/notes/assets/censorJquery.html.8cb430d5.js"><link rel="prefetch" href="/notes/assets/combination.html.9e0e20cf.js"><link rel="prefetch" href="/notes/assets/command.html.2a7e3e32.js"><link rel="prefetch" href="/notes/assets/commonJS.html.335e912d.js"><link rel="prefetch" href="/notes/assets/constructor.html.0b23ee40.js"><link rel="prefetch" href="/notes/assets/decoration.html.0520d7ca.js"><link rel="prefetch" href="/notes/assets/esHarmony.html.f9b6c6b0.js"><link rel="prefetch" href="/notes/assets/exposed.html.8436d4f7.js"><link rel="prefetch" href="/notes/assets/exterior.html.637510d7.js"><link rel="prefetch" href="/notes/assets/factory.html.cee24005.js"><link rel="prefetch" href="/notes/assets/flyweight.html.77af5a34.js"><link rel="prefetch" href="/notes/assets/functionalProgramming.html.826201d8.js"><link rel="prefetch" href="/notes/assets/intermediary.html.017a62d8.js"><link rel="prefetch" href="/notes/assets/iterator.html.9879f57a.js"><link rel="prefetch" href="/notes/assets/lazyInitial.html.a662b8a9.js"><link rel="prefetch" href="/notes/assets/mixin.html.8e083c8c.js"><link rel="prefetch" href="/notes/assets/module.html.ccbf7e1e.js"><link rel="prefetch" href="/notes/assets/mvc.html.7c775a82.js"><link rel="prefetch" href="/notes/assets/mvp.html.1ab68755.js"><link rel="prefetch" href="/notes/assets/mvvm.html.31bbe5fa.js"><link rel="prefetch" href="/notes/assets/observer.html.f28c60ea.js"><link rel="prefetch" href="/notes/assets/outward.html.c9113669.js"><link rel="prefetch" href="/notes/assets/overview.html.fd9ac12c.js"><link rel="prefetch" href="/notes/assets/prototype.html.17eb0ec7.js"><link rel="prefetch" href="/notes/assets/proxy.html.4a69fa28.js"><link rel="prefetch" href="/notes/assets/singleton.html.ac8326eb.js"><link rel="prefetch" href="/notes/assets/axios.html.894c36f5.js"><link rel="prefetch" href="/notes/assets/createUnderscore.html.086e63d6.js"><link rel="prefetch" href="/notes/assets/jquery.html.800f2d11.js"><link rel="prefetch" href="/notes/assets/lodash.html.a1c5d14b.js"><link rel="prefetch" href="/notes/assets/sentry.html.3380eab9.js"><link rel="prefetch" href="/notes/assets/underscore.html.408b3621.js"><link rel="prefetch" href="/notes/assets/vuex.html.5a13be39.js"><link rel="prefetch" href="/notes/assets/customCli.html.5fea6892.js"><link rel="prefetch" href="/notes/assets/description.html.ee95e973.js"><link rel="prefetch" href="/notes/assets/indx.html.fb991811.js"><link rel="prefetch" href="/notes/assets/rebase.html.315da41b.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.8d5399c2.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.49333970.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.fd446871.js"><link rel="prefetch" href="/notes/assets/44Questions.html.e09b9e77.js"><link rel="prefetch" href="/notes/assets/asyncAwait.html.8fcdbc04.js"><link rel="prefetch" href="/notes/assets/babelCompile.html.373d5380.js"><link rel="prefetch" href="/notes/assets/base.html.96ef6e10.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.4822e1da.js"><link rel="prefetch" href="/notes/assets/baseWebpack.html.1c0b1ad6.js"><link rel="prefetch" href="/notes/assets/codeSeparation.html.917a63a3.js"><link rel="prefetch" href="/notes/assets/cycle.html.340b3610.js"><link rel="prefetch" href="/notes/assets/cycleOtherWay.html.034fe39b.js"><link rel="prefetch" href="/notes/assets/executionMechanism.html.67387e19.js"><link rel="prefetch" href="/notes/assets/hybrid.html.a54f648d.js"><link rel="prefetch" href="/notes/assets/jsHandwriting.html.91b44994.js"><link rel="prefetch" href="/notes/assets/jsonStringify.html.4c9735e2.js"><link rel="prefetch" href="/notes/assets/largeFileResumableUpload.html.d860ce97.js"><link rel="prefetch" href="/notes/assets/performance.html.95200270.js"><link rel="prefetch" href="/notes/assets/promise.html.34412d36.js"><link rel="prefetch" href="/notes/assets/promiseAll.html.82f50799.js"><link rel="prefetch" href="/notes/assets/spa.html.f9a327ec.js"><link rel="prefetch" href="/notes/assets/tsBaseInterview.html.1adc8582.js"><link rel="prefetch" href="/notes/assets/useEs6.html.d9c2b1c5.js"><link rel="prefetch" href="/notes/assets/webAnimations.html.4f59d2fe.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.11c71b4f.js"><link rel="prefetch" href="/notes/assets/webpackLoader.html.e137d628.js"><link rel="prefetch" href="/notes/assets/webpackPublic.html.22c85b9e.js"><link rel="prefetch" href="/notes/assets/weird.html.5b8c02b0.js"><link rel="prefetch" href="/notes/assets/es10News.html.5f65989d.js"><link rel="prefetch" href="/notes/assets/es11News.html.62ff1633.js"><link rel="prefetch" href="/notes/assets/es6Interview1.html.33c84747.js"><link rel="prefetch" href="/notes/assets/es6Interview2.html.3da1892a.js"><link rel="prefetch" href="/notes/assets/es6Interview3.html.7eb30dbe.js"><link rel="prefetch" href="/notes/assets/es6News.html.9548af96.js"><link rel="prefetch" href="/notes/assets/es7News.html.a6a0fa9a.js"><link rel="prefetch" href="/notes/assets/es8News.html.abebd8e3.js"><link rel="prefetch" href="/notes/assets/es9News.html.2544d57f.js"><link rel="prefetch" href="/notes/assets/base.html.abd02c91.js"><link rel="prefetch" href="/notes/assets/nginxComprehensiveScene.html.eefe1e40.js"><link rel="prefetch" href="/notes/assets/commonlyUsed.html.3d56cebb.js"><link rel="prefetch" href="/notes/assets/inelegantHook.html.6acf2a38.js"><link rel="prefetch" href="/notes/assets/interview1.html.f22b3b85.js"><link rel="prefetch" href="/notes/assets/interview2.html.b0c3bb67.js"><link rel="prefetch" href="/notes/assets/interview3.html.77f72812.js"><link rel="prefetch" href="/notes/assets/interview4.html.bf5749b9.js"><link rel="prefetch" href="/notes/assets/base.html.5c694567.js"><link rel="prefetch" href="/notes/assets/introduction.html.4ae01b9b.js"><link rel="prefetch" href="/notes/assets/base.html.4b98657a.js"><link rel="prefetch" href="/notes/assets/summarize.html.0e390eb4.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.fb56a9de.js"><link rel="prefetch" href="/notes/assets/index.html.6cadf120.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.5f455e90.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.70945f28.js"><link rel="prefetch" href="/notes/assets/bigDataRender.html.16fc9dd9.js"><link rel="prefetch" href="/notes/assets/progress.html.32b74572.js"><link rel="prefetch" href="/notes/assets/quirksStandards.html.d59cf821.js"><link rel="prefetch" href="/notes/assets/redrawReflow.html.8aa659c4.js"><link rel="prefetch" href="/notes/assets/storageSpace.html.dcc11060.js"><link rel="prefetch" href="/notes/assets/webComLink.html.aa29f7e7.js"><link rel="prefetch" href="/notes/assets/webUrl.html.c5ea3916.js"><link rel="prefetch" href="/notes/assets/spanWidthHeight.html.3678c09c.js"><link rel="prefetch" href="/notes/assets/baseCss.html.1b3854fa.js"><link rel="prefetch" href="/notes/assets/blockFormattingContext.html.77b718c0.js"><link rel="prefetch" href="/notes/assets/containingBlock.html.8e433b42.js"><link rel="prefetch" href="/notes/assets/cssBeforeAfter.html.eb9b03ee.js"><link rel="prefetch" href="/notes/assets/cssBoxModal.html.80f3eb90.js"><link rel="prefetch" href="/notes/assets/cssCollapsing.html.0e35aa83.js"><link rel="prefetch" href="/notes/assets/cssCompatible.html.f171139f.js"><link rel="prefetch" href="/notes/assets/cssFlexDemo.html.167a483f.js"><link rel="prefetch" href="/notes/assets/cssFlexLayout.html.196b26b8.js"><link rel="prefetch" href="/notes/assets/cssGridLayout.html.1cad8452.js"><link rel="prefetch" href="/notes/assets/cssHack.html.396ee0f0.js"><link rel="prefetch" href="/notes/assets/cssInlineBlock.html.a6923bf7.js"><link rel="prefetch" href="/notes/assets/cssPriority.html.c4772a9a.js"><link rel="prefetch" href="/notes/assets/cssPseudo.html.43d0dd35.js"><link rel="prefetch" href="/notes/assets/cssPseudoClass.html.43db38dd.js"><link rel="prefetch" href="/notes/assets/cssSelector.html.2b368cc7.js"><link rel="prefetch" href="/notes/assets/cssTutorial.html.c16444ba.js"><link rel="prefetch" href="/notes/assets/fieldInvalid.html.1fcb2558.js"><link rel="prefetch" href="/notes/assets/frame.html.fda09f9b.js"><link rel="prefetch" href="/notes/assets/knowledgePoints.html.844ecbe9.js"><link rel="prefetch" href="/notes/assets/linkImport.html.8e3fbbf4.js"><link rel="prefetch" href="/notes/assets/stackingContext.html.84ce02ee.js"><link rel="prefetch" href="/notes/assets/tools.html.3370ac55.js"><link rel="prefetch" href="/notes/assets/units.html.a8ce632a.js"><link rel="prefetch" href="/notes/assets/transform.html.c584daae.js"><link rel="prefetch" href="/notes/assets/content.html.6e1fa151.js"><link rel="prefetch" href="/notes/assets/plugins.html.6e17ba17.js"><link rel="prefetch" href="/notes/assets/accesskey.html.cc77cd1e.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.417bda6c.js"><link rel="prefetch" href="/notes/assets/canvasSvg.html.56545180.js"><link rel="prefetch" href="/notes/assets/deviceAPI.html.d0af0732.js"><link rel="prefetch" href="/notes/assets/globalAttr.html.312d06e6.js"><link rel="prefetch" href="/notes/assets/htmlDatalist.html.2a3a0833.js"><link rel="prefetch" href="/notes/assets/htmlElement.html.5e1b1f69.js"><link rel="prefetch" href="/notes/assets/interview10.html.57058a90.js"><link rel="prefetch" href="/notes/assets/interview11.html.ebb261a8.js"><link rel="prefetch" href="/notes/assets/interview12.html.2e022b4e.js"><link rel="prefetch" href="/notes/assets/interview13.html.5adf2646.js"><link rel="prefetch" href="/notes/assets/interview14.html.69021bf6.js"><link rel="prefetch" href="/notes/assets/interview15.html.6fa214b3.js"><link rel="prefetch" href="/notes/assets/interview16.html.5977700c.js"><link rel="prefetch" href="/notes/assets/interview17.html.ade3757d.js"><link rel="prefetch" href="/notes/assets/interview18.html.cb8e09c0.js"><link rel="prefetch" href="/notes/assets/interview19.html.698b83d0.js"><link rel="prefetch" href="/notes/assets/interview20.html.518d535f.js"><link rel="prefetch" href="/notes/assets/interview21.html.48008fc2.js"><link rel="prefetch" href="/notes/assets/interview22.html.45a1d5a7.js"><link rel="prefetch" href="/notes/assets/interview23.html.74da7576.js"><link rel="prefetch" href="/notes/assets/interview24.html.417cd5f3.js"><link rel="prefetch" href="/notes/assets/interview25.html.4e8b4df3.js"><link rel="prefetch" href="/notes/assets/interview26.html.0bb23540.js"><link rel="prefetch" href="/notes/assets/interview27.html.f55bdf74.js"><link rel="prefetch" href="/notes/assets/interview28.html.89a195cc.js"><link rel="prefetch" href="/notes/assets/interview29.html.75ed487e.js"><link rel="prefetch" href="/notes/assets/interview30.html.3ee6174e.js"><link rel="prefetch" href="/notes/assets/interview31.html.eec2c665.js"><link rel="prefetch" href="/notes/assets/interview32.html.ded26d9b.js"><link rel="prefetch" href="/notes/assets/interview33.html.bec603c5.js"><link rel="prefetch" href="/notes/assets/interview34.html.ce8f1f2b.js"><link rel="prefetch" href="/notes/assets/interview35.html.7fe9d232.js"><link rel="prefetch" href="/notes/assets/interview36.html.f7fee400.js"><link rel="prefetch" href="/notes/assets/interview37.html.358d81ef.js"><link rel="prefetch" href="/notes/assets/interview38.html.ceaba854.js"><link rel="prefetch" href="/notes/assets/interview39.html.17669b12.js"><link rel="prefetch" href="/notes/assets/interview40.html.15d2b768.js"><link rel="prefetch" href="/notes/assets/interview41.html.42d648d3.js"><link rel="prefetch" href="/notes/assets/interview42.html.3eb38913.js"><link rel="prefetch" href="/notes/assets/interview43.html.26053012.js"><link rel="prefetch" href="/notes/assets/interview44.html.3f94ae6d.js"><link rel="prefetch" href="/notes/assets/interview45.html.0f1d944a.js"><link rel="prefetch" href="/notes/assets/interview46.html.18a1fb80.js"><link rel="prefetch" href="/notes/assets/interview47.html.ef24f77c.js"><link rel="prefetch" href="/notes/assets/interview48.html.cf96e72c.js"><link rel="prefetch" href="/notes/assets/interview49.html.ec4c15a0.js"><link rel="prefetch" href="/notes/assets/interview5.html.d97befa1.js"><link rel="prefetch" href="/notes/assets/interview50.html.13c54965.js"><link rel="prefetch" href="/notes/assets/interview51.html.5ae12de0.js"><link rel="prefetch" href="/notes/assets/interview52.html.0987028e.js"><link rel="prefetch" href="/notes/assets/interview53.html.435860a0.js"><link rel="prefetch" href="/notes/assets/interview54.html.ace84b23.js"><link rel="prefetch" href="/notes/assets/interview55.html.e61ea5db.js"><link rel="prefetch" href="/notes/assets/interview56.html.a03aa17c.js"><link rel="prefetch" href="/notes/assets/interview57.html.3f370b24.js"><link rel="prefetch" href="/notes/assets/interview58.html.8d506b26.js"><link rel="prefetch" href="/notes/assets/interview59.html.ec25e0b8.js"><link rel="prefetch" href="/notes/assets/interview6.html.91ab47ae.js"><link rel="prefetch" href="/notes/assets/interview7.html.6e7ad964.js"><link rel="prefetch" href="/notes/assets/interview8.html.8f88b421.js"><link rel="prefetch" href="/notes/assets/interview9.html.661af964.js"><link rel="prefetch" href="/notes/assets/linkImport.html.3ad74614.js"><link rel="prefetch" href="/notes/assets/offlineStorage.html.b7194813.js"><link rel="prefetch" href="/notes/assets/regular.html.b564d981.js"><link rel="prefetch" href="/notes/assets/shake.html.34c879f6.js"><link rel="prefetch" href="/notes/assets/webWorker.html.67aabe71.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.e13f29fe.js"><link rel="prefetch" href="/notes/assets/cors.html.ec497b42.js"><link rel="prefetch" href="/notes/assets/crossDomainCookie.html.e2651e8e.js"><link rel="prefetch" href="/notes/assets/fetch.html.df3586ee.js"><link rel="prefetch" href="/notes/assets/nestAxios.html.34d301c5.js"><link rel="prefetch" href="/notes/assets/debounce.html.246f1249.js"><link rel="prefetch" href="/notes/assets/lodashPrinciple.html.a1224740.js"><link rel="prefetch" href="/notes/assets/lodashThrottleDebounce.html.cf17f742.js"><link rel="prefetch" href="/notes/assets/throttle.html.b65a9a84.js"><link rel="prefetch" href="/notes/assets/throttleDebounceReact.html.b4708828.js"><link rel="prefetch" href="/notes/assets/cloneIntroduction.html.279c2e37.js"><link rel="prefetch" href="/notes/assets/deepClone.html.40e86fdc.js"><link rel="prefetch" href="/notes/assets/lodashDeepClone.html.6de4b699.js"><link rel="prefetch" href="/notes/assets/objectAssign.html.edde2fe8.js"><link rel="prefetch" href="/notes/assets/arraySourceCode.html.550282f0.js"><link rel="prefetch" href="/notes/assets/baseHigh.html.5baf3feb.js"><link rel="prefetch" href="/notes/assets/currying.html.a50e541b.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.556732a6.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.6c87e5bf.js"><link rel="prefetch" href="/notes/assets/iife.html.cbc4ac9e.js"><link rel="prefetch" href="/notes/assets/interview1.html.adb99297.js"><link rel="prefetch" href="/notes/assets/jsCompatible.html.0485a376.js"><link rel="prefetch" href="/notes/assets/baseProyotype.html.fa37ab8f.js"><link rel="prefetch" href="/notes/assets/functionObjectResource.html.9f7987a9.js"><link rel="prefetch" href="/notes/assets/prototypeInherit.html.e9b74bbb.js"><link rel="prefetch" href="/notes/assets/closureInterview.html.fe63ce7a.js"><link rel="prefetch" href="/notes/assets/scopeChain.html.02cc51bb.js"><link rel="prefetch" href="/notes/assets/understandingClosures.html.dd45842c.js"><link rel="prefetch" href="/notes/assets/executionStack.html.a5ec7982.js"><link rel="prefetch" href="/notes/assets/memoryLeak.html.f89480f2.js"><link rel="prefetch" href="/notes/assets/memoryMechanism.html.68458b9b.js"><link rel="prefetch" href="/notes/assets/memorySpace.html.f646fb9c.js"><link rel="prefetch" href="/notes/assets/precompiled.html.b9bd0775.js"><link rel="prefetch" href="/notes/assets/variableObject.html.24584172.js"><link rel="prefetch" href="/notes/assets/arrowFunctionThis.html.0d4f2a11.js"><link rel="prefetch" href="/notes/assets/bindSimulation.html.b10f47ed.js"><link rel="prefetch" href="/notes/assets/callApply.html.bb89fb6d.js"><link rel="prefetch" href="/notes/assets/newSimulation.html.e9a46a2d.js"><link rel="prefetch" href="/notes/assets/thisBind.html.9b29966c.js"><link rel="prefetch" href="/notes/assets/interview1.html.60905fd0.js"><link rel="prefetch" href="/notes/assets/interview10.html.c3710a54.js"><link rel="prefetch" href="/notes/assets/interview11.html.72a1479f.js"><link rel="prefetch" href="/notes/assets/interview12.html.b52c7cd4.js"><link rel="prefetch" href="/notes/assets/interview13.html.31129e17.js"><link rel="prefetch" href="/notes/assets/interview14.html.065c83de.js"><link rel="prefetch" href="/notes/assets/interview15.html.7cd64175.js"><link rel="prefetch" href="/notes/assets/interview16.html.e0705a9e.js"><link rel="prefetch" href="/notes/assets/interview17.html.7ac28e03.js"><link rel="prefetch" href="/notes/assets/interview18.html.4b581106.js"><link rel="prefetch" href="/notes/assets/interview19.html.b1e228df.js"><link rel="prefetch" href="/notes/assets/interview2.html.1a08035a.js"><link rel="prefetch" href="/notes/assets/interview20.html.d60b849e.js"><link rel="prefetch" href="/notes/assets/interview21.html.916434ab.js"><link rel="prefetch" href="/notes/assets/interview22.html.43654bce.js"><link rel="prefetch" href="/notes/assets/interview23.html.4ab3b65f.js"><link rel="prefetch" href="/notes/assets/interview24.html.f5c28f46.js"><link rel="prefetch" href="/notes/assets/interview25.html.1f6b3711.js"><link rel="prefetch" href="/notes/assets/interview26.html.5dd408ce.js"><link rel="prefetch" href="/notes/assets/interview27.html.613b78e8.js"><link rel="prefetch" href="/notes/assets/interview28.html.9d583e49.js"><link rel="prefetch" href="/notes/assets/interview29.html.e3e91794.js"><link rel="prefetch" href="/notes/assets/interview3.html.d91e6cbc.js"><link rel="prefetch" href="/notes/assets/interview30.html.fd59a335.js"><link rel="prefetch" href="/notes/assets/interview4.html.f7c40889.js"><link rel="prefetch" href="/notes/assets/interview5.html.8d50dce4.js"><link rel="prefetch" href="/notes/assets/interview6.html.713e0433.js"><link rel="prefetch" href="/notes/assets/interview7.html.5fabb993.js"><link rel="prefetch" href="/notes/assets/interview8.html.319a0a05.js"><link rel="prefetch" href="/notes/assets/interview9.html.02e24993.js"><link rel="prefetch" href="/notes/assets/adjacentSiblingCombinator.html.5096394b.js"><link rel="prefetch" href="/notes/assets/attributeSelectors.html.812746a2.js"><link rel="prefetch" href="/notes/assets/charset.html.df6a0eed.js"><link rel="prefetch" href="/notes/assets/childCombinator.html.99556bf0.js"><link rel="prefetch" href="/notes/assets/classSelectors.html.2a670a32.js"><link rel="prefetch" href="/notes/assets/descendantCombinator.html.4d112c8d.js"><link rel="prefetch" href="/notes/assets/generalSiblingCombinator.html.e88b3fee.js"><link rel="prefetch" href="/notes/assets/iDSelectors.html.3659c9ca.js"><link rel="prefetch" href="/notes/assets/pseudoClasses.html.44095e63.js"><link rel="prefetch" href="/notes/assets/pseudoElements.html.06764528.js"><link rel="prefetch" href="/notes/assets/selectorList.html.9de86fc9.js"><link rel="prefetch" href="/notes/assets/typeSelectors.html.28e08301.js"><link rel="prefetch" href="/notes/assets/universalSelectors.html.1613dad4.js"><link rel="prefetch" href="/notes/assets/IterationProtocols.html.fdbf21f1.js"><link rel="prefetch" href="/notes/assets/arrayFlat.html.8964f69e.js"><link rel="prefetch" href="/notes/assets/asyncHistory.html.319b8c8e.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.57f3c860.js"><link rel="prefetch" href="/notes/assets/fileReader.html.8ebcd641.js"><link rel="prefetch" href="/notes/assets/formData.html.673df4bf.js"><link rel="prefetch" href="/notes/assets/functionGenerator.html.5108df41.js"><link rel="prefetch" href="/notes/assets/generator.html.4457b02b.js"><link rel="prefetch" href="/notes/assets/intersectionObserver.html.316627dd.js"><link rel="prefetch" href="/notes/assets/map.html.377533ac.js"><link rel="prefetch" href="/notes/assets/promise.html.c87a1c96.js"><link rel="prefetch" href="/notes/assets/set.html.3087e56d.js"><link rel="prefetch" href="/notes/assets/string.html.389091af.js"><link rel="prefetch" href="/notes/assets/symbol.html.d8beaf5c.js"><link rel="prefetch" href="/notes/assets/xMLHttpRequest.html.81e366c7.js"><link rel="prefetch" href="/notes/assets/spreadSyntax.html.b08766c2.js"><link rel="prefetch" href="/notes/assets/strictMode.html.042eb95e.js"><link rel="prefetch" href="/notes/assets/cache.html.9563af31.js"><link rel="prefetch" href="/notes/assets/drag1.html.39006ee1.js"><link rel="prefetch" href="/notes/assets/oneLineCode.html.8b3de338.js"><link rel="prefetch" href="/notes/assets/oneLineCodeArray.html.63d3aa5c.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDOM.html.0e67c5a4.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDateTime.html.cb3221f3.js"><link rel="prefetch" href="/notes/assets/oneLineCodeFunction.html.2ed6695d.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMath.html.53d81b83.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMisc.html.d40e1885.js"><link rel="prefetch" href="/notes/assets/oneLineCodeNumber.html.a4616ae4.js"><link rel="prefetch" href="/notes/assets/oneLineCodeObject.html.e5769f7b.js"><link rel="prefetch" href="/notes/assets/oneLineCodeRandom.html.7290419e.js"><link rel="prefetch" href="/notes/assets/oneLineCodeString.html.f7f0a5a0.js"><link rel="prefetch" href="/notes/assets/oneLineCodeValidator.html.222bcd1b.js"><link rel="prefetch" href="/notes/assets/typeScriptCache.html.e7b19746.js"><link rel="prefetch" href="/notes/assets/reactBase.html.da9d3bf4.js"><link rel="prefetch" href="/notes/assets/reactTypescript.html.bdd4fc1d.js"><link rel="prefetch" href="/notes/assets/vue2Base.html.125b96a2.js"><link rel="prefetch" href="/notes/assets/vue2Table.html.ecf755fb.js"><link rel="prefetch" href="/notes/assets/vue2offsetTop.html.398a0620.js"><link rel="prefetch" href="/notes/assets/componentWillXXX.html.dfd83436.js"><link rel="prefetch" href="/notes/assets/disrupt.html.edb0a123.js"><link rel="prefetch" href="/notes/assets/lane.html.7c9f1076.js"><link rel="prefetch" href="/notes/assets/prepare.html.a6149102.js"><link rel="prefetch" href="/notes/assets/redux.html.c414d064.js"><link rel="prefetch" href="/notes/assets/scheduler.html.ab84b9f7.js"><link rel="prefetch" href="/notes/assets/multi.html.68bbb70d.js"><link rel="prefetch" href="/notes/assets/one.html.1d4214e3.js"><link rel="prefetch" href="/notes/assets/prepare.html.6a50b601.js"><link rel="prefetch" href="/notes/assets/create.html.95bc14c0.js"><link rel="prefetch" href="/notes/assets/prepare.html.64d54e96.js"><link rel="prefetch" href="/notes/assets/structure.html.f10da85a.js"><link rel="prefetch" href="/notes/assets/useeffect.html.d41c0552.js"><link rel="prefetch" href="/notes/assets/usememo.html.e6724780.js"><link rel="prefetch" href="/notes/assets/useref.html.7de6ef18.js"><link rel="prefetch" href="/notes/assets/usestate.html.bff28972.js"><link rel="prefetch" href="/notes/assets/file.html.452cd6b4.js"><link rel="prefetch" href="/notes/assets/idea.html.23d82840.js"><link rel="prefetch" href="/notes/assets/jsx.html.7ea04643.js"><link rel="prefetch" href="/notes/assets/newConstructure.html.ec2955b8.js"><link rel="prefetch" href="/notes/assets/oldConstructure.html.01c900e4.js"><link rel="prefetch" href="/notes/assets/source.html.6d4002ce.js"><link rel="prefetch" href="/notes/assets/summary.html.70509c01.js"><link rel="prefetch" href="/notes/assets/basePrinciple.html.3ac69798.js"><link rel="prefetch" href="/notes/assets/componentApi.html.68272ea6.js"><link rel="prefetch" href="/notes/assets/domApi.html.ea575506.js"><link rel="prefetch" href="/notes/assets/hoc.html.218fa21d.js"><link rel="prefetch" href="/notes/assets/hookApi.html.e8deb339.js"><link rel="prefetch" href="/notes/assets/hookCustom.html.03859cf3.js"><link rel="prefetch" href="/notes/assets/hookPrinciple.html.69d4a4f4.js"><link rel="prefetch" href="/notes/assets/hookUse.html.4a37cf6a.js"><link rel="prefetch" href="/notes/assets/reactKeeplive.html.43b24141.js"><link rel="prefetch" href="/notes/assets/reactRedux.html.862bc529.js"><link rel="prefetch" href="/notes/assets/reactRouter.html.249d9c56.js"><link rel="prefetch" href="/notes/assets/toolApi.html.930ef809.js"><link rel="prefetch" href="/notes/assets/beginWork.html.72f45750.js"><link rel="prefetch" href="/notes/assets/completeWork.html.4586a4fb.js"><link rel="prefetch" href="/notes/assets/doubleBuffer.html.a11c81e0.js"><link rel="prefetch" href="/notes/assets/fiber-mental.html.cafca097.js"><link rel="prefetch" href="/notes/assets/fiber.html.20635461.js"><link rel="prefetch" href="/notes/assets/reconciler.html.75f26a38.js"><link rel="prefetch" href="/notes/assets/beforeMutation.html.18c3d418.js"><link rel="prefetch" href="/notes/assets/layout.html.82f6a8bd.js"><link rel="prefetch" href="/notes/assets/mutation.html.4c44b4e0.js"><link rel="prefetch" href="/notes/assets/prepare.html.6c2c7865.js"><link rel="prefetch" href="/notes/assets/mental.html.d5611145.js"><link rel="prefetch" href="/notes/assets/prepare.html.e04c1cef.js"><link rel="prefetch" href="/notes/assets/priority.html.dc54c5f2.js"><link rel="prefetch" href="/notes/assets/reactdom.html.f9746c8b.js"><link rel="prefetch" href="/notes/assets/setstate.html.76380815.js"><link rel="prefetch" href="/notes/assets/update.html.75d61392.js"><link rel="prefetch" href="/notes/assets/bitfiled.html.4497a4ee.js"><link rel="prefetch" href="/notes/assets/dfs.html.f4981d5e.js"><link rel="prefetch" href="/notes/assets/diff.html.b5dc691e.js"><link rel="prefetch" href="/notes/assets/heapsort.html.c98a34da.js"><link rel="prefetch" href="/notes/assets/linkedlist.html.6b38e462.js"><link rel="prefetch" href="/notes/assets/stack.html.f38e01d1.js"><link rel="prefetch" href="/notes/assets/bootstrap.html.b68a1fba.js"><link rel="prefetch" href="/notes/assets/context.html.47334994.js"><link rel="prefetch" href="/notes/assets/fibertree-commit.html.2c50b45f.js"><link rel="prefetch" href="/notes/assets/fibertree-create.html.3774a8fc.js"><link rel="prefetch" href="/notes/assets/fibertree-update.html.0743e8f1.js"><link rel="prefetch" href="/notes/assets/hook-effect.html.65ac138b.js"><link rel="prefetch" href="/notes/assets/hook-state.html.5a1d0b94.js"><link rel="prefetch" href="/notes/assets/hook-summary.html.80ca5f24.js"><link rel="prefetch" href="/notes/assets/macro-structure.html.42a05b10.js"><link rel="prefetch" href="/notes/assets/object-structure.html.0e9cc867.js"><link rel="prefetch" href="/notes/assets/priority.html.9dcaa721.js"><link rel="prefetch" href="/notes/assets/reconciler-workflow.html.2f14fc74.js"><link rel="prefetch" href="/notes/assets/scheduler.html.8de0ba69.js"><link rel="prefetch" href="/notes/assets/state-effects.html.f98ea9dd.js"><link rel="prefetch" href="/notes/assets/synthetic-event.html.83a97757.js"><link rel="prefetch" href="/notes/assets/workloop.html.6b1b49b2.js"><link rel="prefetch" href="/notes/assets/ast.html.4e3d26f1.js"><link rel="prefetch" href="/notes/assets/binder.html.10191d6e.js"><link rel="prefetch" href="/notes/assets/checker.html.d97fb222.js"><link rel="prefetch" href="/notes/assets/emitter.html.afaf9c6d.js"><link rel="prefetch" href="/notes/assets/overview.html.66f5058a.js"><link rel="prefetch" href="/notes/assets/parser.html.66cd1f14.js"><link rel="prefetch" href="/notes/assets/program.html.6a13a6b5.js"><link rel="prefetch" href="/notes/assets/scanner.html.26547aa8.js"><link rel="prefetch" href="/notes/assets/common.html.0a779e9c.js"><link rel="prefetch" href="/notes/assets/interpreting.html.33bcd6ff.js"><link rel="prefetch" href="/notes/assets/class.html.ee2a16b9.js"><link rel="prefetch" href="/notes/assets/commandline-behavior.html.33efaddf.js"><link rel="prefetch" href="/notes/assets/comments.html.3c6ae00f.js"><link rel="prefetch" href="/notes/assets/common-bug-not-bugs.html.23cbd94f.js"><link rel="prefetch" href="/notes/assets/common-feature-request.html.f7f3c2f2.js"><link rel="prefetch" href="/notes/assets/decorators.html.ffdbfbdc.js"><link rel="prefetch" href="/notes/assets/enums.html.8ffc0bd2.js"><link rel="prefetch" href="/notes/assets/function.html.8390b605.js"><link rel="prefetch" href="/notes/assets/generics.html.2e81ad12.js"><link rel="prefetch" href="/notes/assets/glossary-and-terms.html.8bf2a811.js"><link rel="prefetch" href="/notes/assets/jsx-and-react.html.5c92d149.js"><link rel="prefetch" href="/notes/assets/modules.html.fba886a8.js"><link rel="prefetch" href="/notes/assets/thing-that-dont-work.html.b2be08f7.js"><link rel="prefetch" href="/notes/assets/tsconfig-behavior.html.0465ebff.js"><link rel="prefetch" href="/notes/assets/type-guards.html.33119345.js"><link rel="prefetch" href="/notes/assets/type-system-behavior.html.652cd8cc.js"><link rel="prefetch" href="/notes/assets/nonReactJSX.html.696b295e.js"><link rel="prefetch" href="/notes/assets/reactJSX.html.910a510e.js"><link rel="prefetch" href="/notes/assets/support.html.356c6692.js"><link rel="prefetch" href="/notes/assets/typescript-3.7.html.89c9611c.js"><link rel="prefetch" href="/notes/assets/typescript-3.8.html.910b71ac.js"><link rel="prefetch" href="/notes/assets/typescript-3.9.html.4b57f15d.js"><link rel="prefetch" href="/notes/assets/compilationContext.html.fa6f0430.js"><link rel="prefetch" href="/notes/assets/declarationspaces.html.822aa053.js"><link rel="prefetch" href="/notes/assets/dynamicImportExpressions.html.f98b7968.js"><link rel="prefetch" href="/notes/assets/inDepthTs.html.fa9bfe2b.js"><link rel="prefetch" href="/notes/assets/modules.html.c15f7d6a.js"><link rel="prefetch" href="/notes/assets/namespaces.html.93f801cd.js"><link rel="prefetch" href="/notes/assets/unknownAny.html.976849b1.js"><link rel="prefetch" href="/notes/assets/avoidExportDefault.html.ac6d87c9.js"><link rel="prefetch" href="/notes/assets/barrel.html.6794741a.js"><link rel="prefetch" href="/notes/assets/bind.html.f54a6e02.js"><link rel="prefetch" href="/notes/assets/buildToggles.html.13aaaf55.js"><link rel="prefetch" href="/notes/assets/classAreUseful.html.7c972e3f.js"><link rel="prefetch" href="/notes/assets/covarianceAndContravariance.html.5fefb500.js"><link rel="prefetch" href="/notes/assets/createArrays.html.6c7ea302.js"><link rel="prefetch" href="/notes/assets/curry.html.1361bd2a.js"><link rel="prefetch" href="/notes/assets/functionParameters.html.31251d8f.js"><link rel="prefetch" href="/notes/assets/infer.html.c23e7680.js"><link rel="prefetch" href="/notes/assets/lazyObjectLiteralInitialization.html.3edf1c57.js"><link rel="prefetch" href="/notes/assets/limitPropertySetters.html.d57bcdef.js"><link rel="prefetch" href="/notes/assets/metadata.html.a34b2ffd.js"><link rel="prefetch" href="/notes/assets/nominalTyping.html.f74a704c.js"><link rel="prefetch" href="/notes/assets/outFileCaution.html.038c22ae.js"><link rel="prefetch" href="/notes/assets/singletonPatern.html.f5d23140.js"><link rel="prefetch" href="/notes/assets/statefulFunctions.html.d77e2c58.js"><link rel="prefetch" href="/notes/assets/staticConstructors.html.582de6d2.js"><link rel="prefetch" href="/notes/assets/stringBasedEmuns.html.2ad937f3.js"><link rel="prefetch" href="/notes/assets/truthy.html.799693b4.js"><link rel="prefetch" href="/notes/assets/typeInstantiation.html.53b5a743.js"><link rel="prefetch" href="/notes/assets/typesafeEventEmitter.html.02b7fcad.js"><link rel="prefetch" href="/notes/assets/ambient.html.033b359d.js"><link rel="prefetch" href="/notes/assets/callable.html.00bc7bc4.js"><link rel="prefetch" href="/notes/assets/discrominatedUnion.html.839cc7ec.js"><link rel="prefetch" href="/notes/assets/enums.html.8430345c.js"><link rel="prefetch" href="/notes/assets/exceptionsHanding.html.2cb5ec21.js"><link rel="prefetch" href="/notes/assets/freshness.html.35bc8ec4.js"><link rel="prefetch" href="/notes/assets/functions.html.b220682d.js"><link rel="prefetch" href="/notes/assets/generices.html.0533796e.js"><link rel="prefetch" href="/notes/assets/indexSignatures.html.844fee69.js"><link rel="prefetch" href="/notes/assets/interfaces.html.4a90ac39.js"><link rel="prefetch" href="/notes/assets/lib.html.566eeeaa.js"><link rel="prefetch" href="/notes/assets/literals.html.0144ad55.js"><link rel="prefetch" href="/notes/assets/migrating.html.dd93c00e.js"><link rel="prefetch" href="/notes/assets/mixins.html.17f144ed.js"><link rel="prefetch" href="/notes/assets/movingTypes.html.4e2561e1.js"><link rel="prefetch" href="/notes/assets/neverType.html.b7432023.js"><link rel="prefetch" href="/notes/assets/overview.html.6028da03.js"><link rel="prefetch" href="/notes/assets/readonly.html.4d2e164c.js"><link rel="prefetch" href="/notes/assets/thisType.html.861f262b.js"><link rel="prefetch" href="/notes/assets/typeAssertion.html.bd054af5.js"><link rel="prefetch" href="/notes/assets/typeCompatibility.html.ec0e4fe0.js"><link rel="prefetch" href="/notes/assets/typeGuard.html.0b235f49.js"><link rel="prefetch" href="/notes/assets/typeInference.html.695b9714.js"><link rel="prefetch" href="/notes/assets/types.html.9c3c304d.js"><link rel="prefetch" href="/notes/assets/pluginDva.html.58086bbe.js"><link rel="prefetch" href="/notes/assets/pluginQiankun.html.b619d471.js"><link rel="prefetch" href="/notes/assets/codegen.html.8a25084a.js"><link rel="prefetch" href="/notes/assets/entrance.html.d6a6c262.js"><link rel="prefetch" href="/notes/assets/optimize.html.ecfbaafd.js"><link rel="prefetch" href="/notes/assets/outline.html.8bd18a41.js"><link rel="prefetch" href="/notes/assets/parse.html.207ccc62.js"><link rel="prefetch" href="/notes/assets/async-component.html.4e6fd3d0.js"><link rel="prefetch" href="/notes/assets/component-register.html.567b3d22.js"><link rel="prefetch" href="/notes/assets/create-component.html.d2ad96a5.js"><link rel="prefetch" href="/notes/assets/lifecycle.html.a7341a2d.js"><link rel="prefetch" href="/notes/assets/merge-option.html.33e38550.js"><link rel="prefetch" href="/notes/assets/outline.html.3bd8050f.js"><link rel="prefetch" href="/notes/assets/patch.html.a23c1430.js"><link rel="prefetch" href="/notes/assets/_index.html.5e0c2ad2.js"><link rel="prefetch" href="/notes/assets/create-element.html.b2749a32.js"><link rel="prefetch" href="/notes/assets/mounted.html.88367ff4.js"><link rel="prefetch" href="/notes/assets/new-vue.html.e80f61b5.js"><link rel="prefetch" href="/notes/assets/render.html.ede2cd1a.js"><link rel="prefetch" href="/notes/assets/update.html.629be0db.js"><link rel="prefetch" href="/notes/assets/virtual-dom.html.f89e76a9.js"><link rel="prefetch" href="/notes/assets/event.html.f781d591.js"><link rel="prefetch" href="/notes/assets/keep-alive.html.3654aec6.js"><link rel="prefetch" href="/notes/assets/outline.html.b464ad9c.js"><link rel="prefetch" href="/notes/assets/slot.html.98186991.js"><link rel="prefetch" href="/notes/assets/tansition-group.html.49dda1e9.js"><link rel="prefetch" href="/notes/assets/tansition.html.cd19b645.js"><link rel="prefetch" href="/notes/assets/v-model.html.78547e74.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.ff5c2dc8.js"><link rel="prefetch" href="/notes/assets/baseInterviewSecond.html.9a83fd95.js"><link rel="prefetch" href="/notes/assets/componentCommunication.html.3e63ecf8.js"><link rel="prefetch" href="/notes/assets/detailedResponsiveness.html.3baff8fa.js"><link rel="prefetch" href="/notes/assets/diff.html.4a6b9b04.js"><link rel="prefetch" href="/notes/assets/eventBinding.html.98834559.js"><link rel="prefetch" href="/notes/assets/eventMechanism.html.273c84e6.js"><link rel="prefetch" href="/notes/assets/key.html.d1e7b2c7.js"><link rel="prefetch" href="/notes/assets/knowledgeSystem.html.ac648a3f.js"><link rel="prefetch" href="/notes/assets/slot.html.3739495c.js"><link rel="prefetch" href="/notes/assets/sourceCodeAsyncDomUpdateNextTick.html.408a7dfd.js"><link rel="prefetch" href="/notes/assets/sourceCodeElementBroadcastDispatch.html.0dbe791e.js"><link rel="prefetch" href="/notes/assets/sourceCodeKeepAlive.html.c5329a90.js"><link rel="prefetch" href="/notes/assets/sourceCodeResponsiveness.html.d92486b7.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateCompilation.html.5eb389f6.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateDom.html.2e821c78.js"><link rel="prefetch" href="/notes/assets/sourceCodeVuex.html.ec58ed75.js"><link rel="prefetch" href="/notes/assets/templateCompilation.html.2de196a3.js"><link rel="prefetch" href="/notes/assets/vNode.html.f3a66151.js"><link rel="prefetch" href="/notes/assets/vNodeDiff.html.eff1b477.js"><link rel="prefetch" href="/notes/assets/build.html.f7ff4d7c.js"><link rel="prefetch" href="/notes/assets/directory.html.7c9650ca.js"><link rel="prefetch" href="/notes/assets/entrance.html.8db62399.js"><link rel="prefetch" href="/notes/assets/flow.html.86c95575.js"><link rel="prefetch" href="/notes/assets/component-update.html.4ed4b9b0.js"><link rel="prefetch" href="/notes/assets/computed-watcher.html.10ec4873.js"><link rel="prefetch" href="/notes/assets/getters.html.961157cb.js"><link rel="prefetch" href="/notes/assets/next-tick.html.45966cac.js"><link rel="prefetch" href="/notes/assets/outline.html.c1c53cb5.js"><link rel="prefetch" href="/notes/assets/props.html.ee05e609.js"><link rel="prefetch" href="/notes/assets/questions.html.e2183e14.js"><link rel="prefetch" href="/notes/assets/reactive-object.html.97ee8915.js"><link rel="prefetch" href="/notes/assets/setters.html.21d89da6.js"><link rel="prefetch" href="/notes/assets/summary.html.dd1d8bc9.js"><link rel="prefetch" href="/notes/assets/install.html.0230a0da.js"><link rel="prefetch" href="/notes/assets/matcher.html.25ca848d.js"><link rel="prefetch" href="/notes/assets/outline.html.ea733f14.js"><link rel="prefetch" href="/notes/assets/router.html.f8ecf748.js"><link rel="prefetch" href="/notes/assets/transition-to.html.d7c1785b.js"><link rel="prefetch" href="/notes/assets/api.html.0c764efb.js"><link rel="prefetch" href="/notes/assets/idex.html.00a33403.js"><link rel="prefetch" href="/notes/assets/init.html.2bb7927a.js"><link rel="prefetch" href="/notes/assets/plugin.html.89e6dcbd.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.81b34fee.js"><link rel="prefetch" href="/notes/assets/configuration.html.11907dd4.js"><link rel="prefetch" href="/notes/assets/entryPoints.html.b3492578.js"><link rel="prefetch" href="/notes/assets/loader.html.2d3c2488.js"><link rel="prefetch" href="/notes/assets/output.html.33466c9c.js"><link rel="prefetch" href="/notes/assets/plugin.html.7b1fc668.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.ae24d5df.js"><link rel="prefetch" href="/notes/assets/reactApi.html.e27c9c81.js"><link rel="prefetch" href="/notes/assets/reactChildren.html.f03f41a5.js"><link rel="prefetch" href="/notes/assets/reactElement.html.507c3fac.js"><link rel="prefetch" href="/notes/assets/reactFiber.html.e4b8886f.js"><link rel="prefetch" href="/notes/assets/commitAllHostEffects.html.c54c88a4.js"><link rel="prefetch" href="/notes/assets/commitAllLifeCycles.html.a9f9e3e3.js"><link rel="prefetch" href="/notes/assets/commitBeforeMutationLifecycles.html.9e252799.js"><link rel="prefetch" href="/notes/assets/commitDeletion.html.1aadc4a7.js"><link rel="prefetch" href="/notes/assets/commitPlacement.html.b0c82218.js"><link rel="prefetch" href="/notes/assets/commitRoot.html.fc87e11a.js"><link rel="prefetch" href="/notes/assets/commitWork.html.98be50bf.js"><link rel="prefetch" href="/notes/assets/invokeGuardedCallback.html.95a15db2.js"><link rel="prefetch" href="/notes/assets/expirationTime.html.7c625a26.js"><link rel="prefetch" href="/notes/assets/reactDomRender.html.c49d921a.js"><link rel="prefetch" href="/notes/assets/setStateForceUpdate.html.a495477a.js"><link rel="prefetch" href="/notes/assets/context.html.3041834a.js"><link rel="prefetch" href="/notes/assets/evenInit.html.b949b8f6.js"><link rel="prefetch" href="/notes/assets/eventBind.html.9d39cf36.js"><link rel="prefetch" href="/notes/assets/eventCreateEventObject.html.22578639.js"><link rel="prefetch" href="/notes/assets/eventDispath.html.a2ed0b3b.js"><link rel="prefetch" href="/notes/assets/hydrate.html.ccddb779.js"><link rel="prefetch" href="/notes/assets/ref.html.c54fc786.js"><link rel="prefetch" href="/notes/assets/suspense.html.61f7fd70.js"><link rel="prefetch" href="/notes/assets/suspenseLazy.html.9b65aba3.js"><link rel="prefetch" href="/notes/assets/suspenseWork.html.9fff5d2a.js"><link rel="prefetch" href="/notes/assets/hooksCommon.html.39fc3c3d.js"><link rel="prefetch" href="/notes/assets/hooksOther.html.af4fc03b.js"><link rel="prefetch" href="/notes/assets/start.html.9b89c182.js"><link rel="prefetch" href="/notes/assets/useEffect.html.95d1a1bf.js"><link rel="prefetch" href="/notes/assets/useState.html.e0ce9b91.js"><link rel="prefetch" href="/notes/assets/base.html.d6050cd8.js"><link rel="prefetch" href="/notes/assets/commpontDiff.html.f9c99166.js"><link rel="prefetch" href="/notes/assets/componentUpdate.html.a5bf7a34.js"><link rel="prefetch" href="/notes/assets/renderProcess.html.b36be742.js"><link rel="prefetch" href="/notes/assets/schedulingPrinciple.html.796f1238.js"><link rel="prefetch" href="/notes/assets/beginWork.html.a0a0ab63.js"><link rel="prefetch" href="/notes/assets/globalVariable.html.c883bfed.js"><link rel="prefetch" href="/notes/assets/mountIndeterminateComponent.html.fac0d48f.js"><link rel="prefetch" href="/notes/assets/mountLazyCompont.html.62cd6c46.js"><link rel="prefetch" href="/notes/assets/performUnitOfWork.html.070bbadc.js"><link rel="prefetch" href="/notes/assets/performWork.html.733f7291.js"><link rel="prefetch" href="/notes/assets/reactScheduler.html.1f778c02.js"><link rel="prefetch" href="/notes/assets/reconcileChildren.html.2b860d71.js"><link rel="prefetch" href="/notes/assets/reconcileChildrenArray.html.381b105d.js"><link rel="prefetch" href="/notes/assets/reconcileSingleElement.html.44fad5a0.js"><link rel="prefetch" href="/notes/assets/renderRoot.html.fb25ae42.js"><link rel="prefetch" href="/notes/assets/scheduleWork.html.7a558025.js"><link rel="prefetch" href="/notes/assets/throwException.html.f22c6a0f.js"><link rel="prefetch" href="/notes/assets/updateClassComponent.html.725e93cc.js"><link rel="prefetch" href="/notes/assets/updateContextConsumer.html.d2656620.js"><link rel="prefetch" href="/notes/assets/updateContextProvider.html.d9d47bfb.js"><link rel="prefetch" href="/notes/assets/updateForwardRef.html.3c86c539.js"><link rel="prefetch" href="/notes/assets/updateFragment.html.96f0a888.js"><link rel="prefetch" href="/notes/assets/updateFunctionalComponent.html.63af40cc.js"><link rel="prefetch" href="/notes/assets/updateHostComponent.html.8e3ff9b5.js"><link rel="prefetch" href="/notes/assets/updateHostRoot.html.d24ba535.js"><link rel="prefetch" href="/notes/assets/updateHostText.html.f84848da.js"><link rel="prefetch" href="/notes/assets/updateMode.html.cb525529.js"><link rel="prefetch" href="/notes/assets/updatePortalComponent.html.a767215b.js"><link rel="prefetch" href="/notes/assets/updateProfiler.html.e314f177.js"><link rel="prefetch" href="/notes/assets/updateSuspenseComponent.html.589fa689.js"><link rel="prefetch" href="/notes/assets/interview1.html.41bc9376.js"><link rel="prefetch" href="/notes/assets/interview2.html.47645b5c.js"><link rel="prefetch" href="/notes/assets/interview3.html.fbd751ea.js"><link rel="prefetch" href="/notes/assets/interview51.html.deda2164.js"><link rel="prefetch" href="/notes/assets/interview52.html.b1b59a06.js"><link rel="prefetch" href="/notes/assets/interview53.html.0e2f12c3.js"><link rel="prefetch" href="/notes/assets/interview54.html.81fd2641.js"><link rel="prefetch" href="/notes/assets/interview55.html.dd644a77.js"><link rel="prefetch" href="/notes/assets/interview56.html.8622c49c.js"><link rel="prefetch" href="/notes/assets/interview57.html.ae17d31c.js"><link rel="prefetch" href="/notes/assets/interview1.html.a10d9f41.js"><link rel="prefetch" href="/notes/assets/interview10.html.a5473eb4.js"><link rel="prefetch" href="/notes/assets/interview11.html.4ec338d4.js"><link rel="prefetch" href="/notes/assets/interview12.html.7e541841.js"><link rel="prefetch" href="/notes/assets/interview13.html.5f4314d9.js"><link rel="prefetch" href="/notes/assets/interview14.html.b8b47a9d.js"><link rel="prefetch" href="/notes/assets/interview15.html.b05f6140.js"><link rel="prefetch" href="/notes/assets/interview16.html.4f9641bb.js"><link rel="prefetch" href="/notes/assets/interview17.html.f1139a52.js"><link rel="prefetch" href="/notes/assets/interview18.html.52eafe00.js"><link rel="prefetch" href="/notes/assets/interview19.html.2da89b87.js"><link rel="prefetch" href="/notes/assets/interview2.html.b3fc7674.js"><link rel="prefetch" href="/notes/assets/interview20.html.434e7ebc.js"><link rel="prefetch" href="/notes/assets/interview21.html.be155c93.js"><link rel="prefetch" href="/notes/assets/interview22.html.3fcfe936.js"><link rel="prefetch" href="/notes/assets/interview23.html.58585208.js"><link rel="prefetch" href="/notes/assets/interview24.html.da156180.js"><link rel="prefetch" href="/notes/assets/interview25.html.a72f5e5f.js"><link rel="prefetch" href="/notes/assets/interview26.html.1176ff2d.js"><link rel="prefetch" href="/notes/assets/interview27.html.04571a63.js"><link rel="prefetch" href="/notes/assets/interview28.html.aed56fc9.js"><link rel="prefetch" href="/notes/assets/interview29.html.fdea7c1a.js"><link rel="prefetch" href="/notes/assets/interview3.html.4f17acbd.js"><link rel="prefetch" href="/notes/assets/interview30.html.c201b7b5.js"><link rel="prefetch" href="/notes/assets/interview31.html.070110ac.js"><link rel="prefetch" href="/notes/assets/interview32.html.e7ca88ff.js"><link rel="prefetch" href="/notes/assets/interview33.html.b9a5cd87.js"><link rel="prefetch" href="/notes/assets/interview34.html.5bb792e0.js"><link rel="prefetch" href="/notes/assets/interview35.html.d058e78e.js"><link rel="prefetch" href="/notes/assets/interview36.html.63cc043e.js"><link rel="prefetch" href="/notes/assets/interview37.html.06886248.js"><link rel="prefetch" href="/notes/assets/interview38.html.92e03ed4.js"><link rel="prefetch" href="/notes/assets/interview39.html.04b1e4bf.js"><link rel="prefetch" href="/notes/assets/interview4.html.47fcc3f2.js"><link rel="prefetch" href="/notes/assets/interview40.html.588d78ee.js"><link rel="prefetch" href="/notes/assets/interview41.html.af8003ff.js"><link rel="prefetch" href="/notes/assets/interview42.html.f46006e0.js"><link rel="prefetch" href="/notes/assets/interview43.html.2ade31c7.js"><link rel="prefetch" href="/notes/assets/interview44.html.63ef8a1f.js"><link rel="prefetch" href="/notes/assets/interview45.html.f81226f1.js"><link rel="prefetch" href="/notes/assets/interview46.html.416c1c5c.js"><link rel="prefetch" href="/notes/assets/interview47.html.ec144a20.js"><link rel="prefetch" href="/notes/assets/interview48.html.3f72e1fd.js"><link rel="prefetch" href="/notes/assets/interview49.html.35802761.js"><link rel="prefetch" href="/notes/assets/interview5.html.38a98bab.js"><link rel="prefetch" href="/notes/assets/interview50.html.7c376d2a.js"><link rel="prefetch" href="/notes/assets/interview6.html.b04e1f18.js"><link rel="prefetch" href="/notes/assets/interview7.html.75fded6e.js"><link rel="prefetch" href="/notes/assets/interview8.html.d1c6af7e.js"><link rel="prefetch" href="/notes/assets/interview9.html.989fd897.js"><link rel="prefetch" href="/notes/assets/404.html.265028f6.js"><link rel="prefetch" href="/notes/assets/index.html.2bc919d1.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.53ddd914.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.8a3b1187.js"><link rel="prefetch" href="/notes/assets/base.html.e10ecb31.js"><link rel="prefetch" href="/notes/assets/customCli.html.e65c81f4.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.60b6cbdc.js"><link rel="prefetch" href="/notes/assets/adapter.html.4d7b63ce.js"><link rel="prefetch" href="/notes/assets/amd.html.87b2a486.js"><link rel="prefetch" href="/notes/assets/builder.html.7466b17b.js"><link rel="prefetch" href="/notes/assets/censorJquery.html.8217cef4.js"><link rel="prefetch" href="/notes/assets/combination.html.d3748258.js"><link rel="prefetch" href="/notes/assets/command.html.15cf4f1a.js"><link rel="prefetch" href="/notes/assets/commonJS.html.2b9b573a.js"><link rel="prefetch" href="/notes/assets/constructor.html.35bef683.js"><link rel="prefetch" href="/notes/assets/decoration.html.4b1093c7.js"><link rel="prefetch" href="/notes/assets/esHarmony.html.9b197e48.js"><link rel="prefetch" href="/notes/assets/exposed.html.d37915f1.js"><link rel="prefetch" href="/notes/assets/exterior.html.9e995435.js"><link rel="prefetch" href="/notes/assets/factory.html.ec25fa71.js"><link rel="prefetch" href="/notes/assets/flyweight.html.20202362.js"><link rel="prefetch" href="/notes/assets/functionalProgramming.html.e6db6781.js"><link rel="prefetch" href="/notes/assets/intermediary.html.24808e26.js"><link rel="prefetch" href="/notes/assets/iterator.html.9dfdb73e.js"><link rel="prefetch" href="/notes/assets/lazyInitial.html.776f553f.js"><link rel="prefetch" href="/notes/assets/mixin.html.5110d82b.js"><link rel="prefetch" href="/notes/assets/module.html.a659bcf4.js"><link rel="prefetch" href="/notes/assets/mvc.html.1f1d2bd2.js"><link rel="prefetch" href="/notes/assets/mvp.html.aa22786f.js"><link rel="prefetch" href="/notes/assets/mvvm.html.8c35bd9c.js"><link rel="prefetch" href="/notes/assets/observer.html.b525adfa.js"><link rel="prefetch" href="/notes/assets/outward.html.e7be3323.js"><link rel="prefetch" href="/notes/assets/overview.html.3ba437b9.js"><link rel="prefetch" href="/notes/assets/prototype.html.139fbc4b.js"><link rel="prefetch" href="/notes/assets/proxy.html.6b609222.js"><link rel="prefetch" href="/notes/assets/singleton.html.2349f962.js"><link rel="prefetch" href="/notes/assets/axios.html.f4b6061f.js"><link rel="prefetch" href="/notes/assets/createUnderscore.html.b72c5809.js"><link rel="prefetch" href="/notes/assets/jquery.html.5fe64ac3.js"><link rel="prefetch" href="/notes/assets/lodash.html.7946392d.js"><link rel="prefetch" href="/notes/assets/sentry.html.912e7447.js"><link rel="prefetch" href="/notes/assets/underscore.html.a51dfb33.js"><link rel="prefetch" href="/notes/assets/vuex.html.83651dfd.js"><link rel="prefetch" href="/notes/assets/customCli.html.0aa387c0.js"><link rel="prefetch" href="/notes/assets/description.html.34352d72.js"><link rel="prefetch" href="/notes/assets/indx.html.fe859500.js"><link rel="prefetch" href="/notes/assets/rebase.html.8c07abac.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.3ff074dd.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.f49f8318.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.ebe4f40a.js"><link rel="prefetch" href="/notes/assets/44Questions.html.d64a67bd.js"><link rel="prefetch" href="/notes/assets/asyncAwait.html.bccb0d25.js"><link rel="prefetch" href="/notes/assets/babelCompile.html.1e553c05.js"><link rel="prefetch" href="/notes/assets/base.html.12ae8217.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.7593d268.js"><link rel="prefetch" href="/notes/assets/baseWebpack.html.29aba1ab.js"><link rel="prefetch" href="/notes/assets/codeSeparation.html.7bab3aaf.js"><link rel="prefetch" href="/notes/assets/cycle.html.6ee7b34a.js"><link rel="prefetch" href="/notes/assets/cycleOtherWay.html.d1518074.js"><link rel="prefetch" href="/notes/assets/executionMechanism.html.ab7b08bf.js"><link rel="prefetch" href="/notes/assets/hybrid.html.8eb3040d.js"><link rel="prefetch" href="/notes/assets/jsHandwriting.html.09092caf.js"><link rel="prefetch" href="/notes/assets/jsonStringify.html.c6635772.js"><link rel="prefetch" href="/notes/assets/largeFileResumableUpload.html.bd5dcd0c.js"><link rel="prefetch" href="/notes/assets/performance.html.219fc204.js"><link rel="prefetch" href="/notes/assets/promise.html.1160aa4d.js"><link rel="prefetch" href="/notes/assets/promiseAll.html.7d80dcc7.js"><link rel="prefetch" href="/notes/assets/spa.html.52db0c16.js"><link rel="prefetch" href="/notes/assets/tsBaseInterview.html.ab09fd0b.js"><link rel="prefetch" href="/notes/assets/useEs6.html.3edbfb3c.js"><link rel="prefetch" href="/notes/assets/webAnimations.html.955ac76b.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.c97c14cd.js"><link rel="prefetch" href="/notes/assets/webpackLoader.html.bc2bf76d.js"><link rel="prefetch" href="/notes/assets/webpackPublic.html.7d7548ec.js"><link rel="prefetch" href="/notes/assets/weird.html.401e9e2d.js"><link rel="prefetch" href="/notes/assets/es10News.html.26f9cfd4.js"><link rel="prefetch" href="/notes/assets/es11News.html.ac9818fb.js"><link rel="prefetch" href="/notes/assets/es6Interview1.html.9d443454.js"><link rel="prefetch" href="/notes/assets/es6Interview2.html.d5516ae1.js"><link rel="prefetch" href="/notes/assets/es6Interview3.html.644e0656.js"><link rel="prefetch" href="/notes/assets/es6News.html.c417ec7b.js"><link rel="prefetch" href="/notes/assets/es7News.html.723625b3.js"><link rel="prefetch" href="/notes/assets/es8News.html.a2bfcacf.js"><link rel="prefetch" href="/notes/assets/es9News.html.902277e2.js"><link rel="prefetch" href="/notes/assets/base.html.6c344670.js"><link rel="prefetch" href="/notes/assets/nginxComprehensiveScene.html.fd78a225.js"><link rel="prefetch" href="/notes/assets/commonlyUsed.html.7532abb4.js"><link rel="prefetch" href="/notes/assets/inelegantHook.html.78e8df89.js"><link rel="prefetch" href="/notes/assets/interview1.html.b2ac7e5e.js"><link rel="prefetch" href="/notes/assets/interview2.html.9f67e548.js"><link rel="prefetch" href="/notes/assets/interview3.html.0b1748b7.js"><link rel="prefetch" href="/notes/assets/interview4.html.dcc40224.js"><link rel="prefetch" href="/notes/assets/base.html.962e7f7b.js"><link rel="prefetch" href="/notes/assets/introduction.html.b18bc7ec.js"><link rel="prefetch" href="/notes/assets/base.html.9ef3d613.js"><link rel="prefetch" href="/notes/assets/summarize.html.d2e41e94.js"><link rel="prefetch" href="/notes/assets/_sidebar.html.075bbf63.js"><link rel="prefetch" href="/notes/assets/index.html.16137b61.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.308a97a4.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.60d1a94c.js"><link rel="prefetch" href="/notes/assets/bigDataRender.html.09f473d3.js"><link rel="prefetch" href="/notes/assets/progress.html.11cbac36.js"><link rel="prefetch" href="/notes/assets/quirksStandards.html.054e376d.js"><link rel="prefetch" href="/notes/assets/redrawReflow.html.6e93d9cd.js"><link rel="prefetch" href="/notes/assets/storageSpace.html.868a8aa5.js"><link rel="prefetch" href="/notes/assets/webComLink.html.77f5a109.js"><link rel="prefetch" href="/notes/assets/webUrl.html.12929f94.js"><link rel="prefetch" href="/notes/assets/spanWidthHeight.html.474fb276.js"><link rel="prefetch" href="/notes/assets/baseCss.html.531424bb.js"><link rel="prefetch" href="/notes/assets/blockFormattingContext.html.fcee83bd.js"><link rel="prefetch" href="/notes/assets/containingBlock.html.b2bd4c0e.js"><link rel="prefetch" href="/notes/assets/cssBeforeAfter.html.8cc50c97.js"><link rel="prefetch" href="/notes/assets/cssBoxModal.html.8863f69f.js"><link rel="prefetch" href="/notes/assets/cssCollapsing.html.e096dba2.js"><link rel="prefetch" href="/notes/assets/cssCompatible.html.fc886e35.js"><link rel="prefetch" href="/notes/assets/cssFlexDemo.html.3ab61c9a.js"><link rel="prefetch" href="/notes/assets/cssFlexLayout.html.9d974529.js"><link rel="prefetch" href="/notes/assets/cssGridLayout.html.ebdea580.js"><link rel="prefetch" href="/notes/assets/cssHack.html.764a95b0.js"><link rel="prefetch" href="/notes/assets/cssInlineBlock.html.647aff5c.js"><link rel="prefetch" href="/notes/assets/cssPriority.html.22192bac.js"><link rel="prefetch" href="/notes/assets/cssPseudo.html.bef0d565.js"><link rel="prefetch" href="/notes/assets/cssPseudoClass.html.d1fa4bca.js"><link rel="prefetch" href="/notes/assets/cssSelector.html.4d6504fc.js"><link rel="prefetch" href="/notes/assets/cssTutorial.html.f4f9f615.js"><link rel="prefetch" href="/notes/assets/fieldInvalid.html.504ebd60.js"><link rel="prefetch" href="/notes/assets/frame.html.4313443d.js"><link rel="prefetch" href="/notes/assets/knowledgePoints.html.4cb6c7df.js"><link rel="prefetch" href="/notes/assets/linkImport.html.3c856a14.js"><link rel="prefetch" href="/notes/assets/stackingContext.html.0c64900f.js"><link rel="prefetch" href="/notes/assets/tools.html.7531a8aa.js"><link rel="prefetch" href="/notes/assets/units.html.cf3e10f8.js"><link rel="prefetch" href="/notes/assets/transform.html.622d774f.js"><link rel="prefetch" href="/notes/assets/content.html.119cd871.js"><link rel="prefetch" href="/notes/assets/plugins.html.c141e9eb.js"><link rel="prefetch" href="/notes/assets/accesskey.html.aebd3895.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.abd75c89.js"><link rel="prefetch" href="/notes/assets/canvasSvg.html.6ba8b8a7.js"><link rel="prefetch" href="/notes/assets/deviceAPI.html.228879ec.js"><link rel="prefetch" href="/notes/assets/globalAttr.html.2c9b5878.js"><link rel="prefetch" href="/notes/assets/htmlDatalist.html.f443d738.js"><link rel="prefetch" href="/notes/assets/htmlElement.html.be5d633b.js"><link rel="prefetch" href="/notes/assets/interview10.html.58ef0b51.js"><link rel="prefetch" href="/notes/assets/interview11.html.245e8707.js"><link rel="prefetch" href="/notes/assets/interview12.html.a0ffc46d.js"><link rel="prefetch" href="/notes/assets/interview13.html.50a7e94d.js"><link rel="prefetch" href="/notes/assets/interview14.html.fe819996.js"><link rel="prefetch" href="/notes/assets/interview15.html.75e3e018.js"><link rel="prefetch" href="/notes/assets/interview16.html.8804d3cf.js"><link rel="prefetch" href="/notes/assets/interview17.html.a5dde44b.js"><link rel="prefetch" href="/notes/assets/interview18.html.64908e2c.js"><link rel="prefetch" href="/notes/assets/interview19.html.e2d2f639.js"><link rel="prefetch" href="/notes/assets/interview20.html.a8b035ee.js"><link rel="prefetch" href="/notes/assets/interview21.html.c23621b3.js"><link rel="prefetch" href="/notes/assets/interview22.html.0955c07e.js"><link rel="prefetch" href="/notes/assets/interview23.html.fce24471.js"><link rel="prefetch" href="/notes/assets/interview24.html.8da51007.js"><link rel="prefetch" href="/notes/assets/interview25.html.f3c8c1f2.js"><link rel="prefetch" href="/notes/assets/interview26.html.dc7856f5.js"><link rel="prefetch" href="/notes/assets/interview27.html.9cbf4039.js"><link rel="prefetch" href="/notes/assets/interview28.html.048685f1.js"><link rel="prefetch" href="/notes/assets/interview29.html.aba09531.js"><link rel="prefetch" href="/notes/assets/interview30.html.c25142cc.js"><link rel="prefetch" href="/notes/assets/interview31.html.4bb0ea59.js"><link rel="prefetch" href="/notes/assets/interview32.html.39ac0919.js"><link rel="prefetch" href="/notes/assets/interview33.html.29a66e90.js"><link rel="prefetch" href="/notes/assets/interview34.html.c46064e6.js"><link rel="prefetch" href="/notes/assets/interview35.html.254730f2.js"><link rel="prefetch" href="/notes/assets/interview36.html.cb5abc32.js"><link rel="prefetch" href="/notes/assets/interview37.html.f0f05a76.js"><link rel="prefetch" href="/notes/assets/interview38.html.4517da61.js"><link rel="prefetch" href="/notes/assets/interview39.html.eaedf0d4.js"><link rel="prefetch" href="/notes/assets/interview40.html.b1e31d2f.js"><link rel="prefetch" href="/notes/assets/interview41.html.880073ff.js"><link rel="prefetch" href="/notes/assets/interview42.html.68d95d99.js"><link rel="prefetch" href="/notes/assets/interview43.html.fb14f3b3.js"><link rel="prefetch" href="/notes/assets/interview44.html.8b54f99b.js"><link rel="prefetch" href="/notes/assets/interview45.html.8ed67fe8.js"><link rel="prefetch" href="/notes/assets/interview46.html.ed2b7812.js"><link rel="prefetch" href="/notes/assets/interview47.html.091dc360.js"><link rel="prefetch" href="/notes/assets/interview48.html.6dbaf4e8.js"><link rel="prefetch" href="/notes/assets/interview49.html.cb2b402f.js"><link rel="prefetch" href="/notes/assets/interview5.html.637bbee5.js"><link rel="prefetch" href="/notes/assets/interview50.html.daaf7f5d.js"><link rel="prefetch" href="/notes/assets/interview51.html.3aab31b0.js"><link rel="prefetch" href="/notes/assets/interview52.html.14331410.js"><link rel="prefetch" href="/notes/assets/interview53.html.24dddb37.js"><link rel="prefetch" href="/notes/assets/interview54.html.a2179093.js"><link rel="prefetch" href="/notes/assets/interview55.html.4f09e99d.js"><link rel="prefetch" href="/notes/assets/interview56.html.ef1b59a5.js"><link rel="prefetch" href="/notes/assets/interview57.html.8b99f632.js"><link rel="prefetch" href="/notes/assets/interview58.html.087e08c5.js"><link rel="prefetch" href="/notes/assets/interview59.html.a798022e.js"><link rel="prefetch" href="/notes/assets/interview6.html.4e51556c.js"><link rel="prefetch" href="/notes/assets/interview7.html.75a9c971.js"><link rel="prefetch" href="/notes/assets/interview8.html.91097031.js"><link rel="prefetch" href="/notes/assets/interview9.html.d91aef32.js"><link rel="prefetch" href="/notes/assets/linkImport.html.3d260333.js"><link rel="prefetch" href="/notes/assets/offlineStorage.html.ebc0c9e1.js"><link rel="prefetch" href="/notes/assets/regular.html.f1456fe9.js"><link rel="prefetch" href="/notes/assets/shake.html.425040dc.js"><link rel="prefetch" href="/notes/assets/webWorker.html.73f2decf.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.de786ffc.js"><link rel="prefetch" href="/notes/assets/cors.html.f972de8c.js"><link rel="prefetch" href="/notes/assets/crossDomainCookie.html.568a7762.js"><link rel="prefetch" href="/notes/assets/fetch.html.47f081d4.js"><link rel="prefetch" href="/notes/assets/nestAxios.html.ffa01685.js"><link rel="prefetch" href="/notes/assets/debounce.html.a9765c71.js"><link rel="prefetch" href="/notes/assets/lodashPrinciple.html.33d86b6c.js"><link rel="prefetch" href="/notes/assets/lodashThrottleDebounce.html.ac89ffc3.js"><link rel="prefetch" href="/notes/assets/throttle.html.3f27380b.js"><link rel="prefetch" href="/notes/assets/throttleDebounceReact.html.95252c4b.js"><link rel="prefetch" href="/notes/assets/cloneIntroduction.html.5f0aad33.js"><link rel="prefetch" href="/notes/assets/deepClone.html.3d6fdf4b.js"><link rel="prefetch" href="/notes/assets/lodashDeepClone.html.e46bd18e.js"><link rel="prefetch" href="/notes/assets/objectAssign.html.cc45057f.js"><link rel="prefetch" href="/notes/assets/arraySourceCode.html.bd7ef8eb.js"><link rel="prefetch" href="/notes/assets/baseHigh.html.8b5c9ca3.js"><link rel="prefetch" href="/notes/assets/currying.html.79aba5be.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.d3029f05.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.4f9292f1.js"><link rel="prefetch" href="/notes/assets/iife.html.8c6ed048.js"><link rel="prefetch" href="/notes/assets/interview1.html.0358e564.js"><link rel="prefetch" href="/notes/assets/jsCompatible.html.28afe903.js"><link rel="prefetch" href="/notes/assets/baseProyotype.html.a2353573.js"><link rel="prefetch" href="/notes/assets/functionObjectResource.html.b06d7dd4.js"><link rel="prefetch" href="/notes/assets/prototypeInherit.html.5af39f98.js"><link rel="prefetch" href="/notes/assets/closureInterview.html.ae8e7860.js"><link rel="prefetch" href="/notes/assets/scopeChain.html.28002029.js"><link rel="prefetch" href="/notes/assets/understandingClosures.html.20fe42d3.js"><link rel="prefetch" href="/notes/assets/executionStack.html.1d1a1fb5.js"><link rel="prefetch" href="/notes/assets/memoryLeak.html.70c915cb.js"><link rel="prefetch" href="/notes/assets/memoryMechanism.html.9c04cd74.js"><link rel="prefetch" href="/notes/assets/memorySpace.html.5aec4afd.js"><link rel="prefetch" href="/notes/assets/precompiled.html.9001c280.js"><link rel="prefetch" href="/notes/assets/variableObject.html.50547e4a.js"><link rel="prefetch" href="/notes/assets/arrowFunctionThis.html.9dce3d78.js"><link rel="prefetch" href="/notes/assets/bindSimulation.html.58ef3bd0.js"><link rel="prefetch" href="/notes/assets/callApply.html.0a3f2779.js"><link rel="prefetch" href="/notes/assets/newSimulation.html.9c170eb2.js"><link rel="prefetch" href="/notes/assets/thisBind.html.b1f69be3.js"><link rel="prefetch" href="/notes/assets/interview1.html.e5fcd053.js"><link rel="prefetch" href="/notes/assets/interview10.html.5c4c895a.js"><link rel="prefetch" href="/notes/assets/interview11.html.b6fb7d14.js"><link rel="prefetch" href="/notes/assets/interview12.html.abaad215.js"><link rel="prefetch" href="/notes/assets/interview13.html.442918f1.js"><link rel="prefetch" href="/notes/assets/interview14.html.3b7e3ca7.js"><link rel="prefetch" href="/notes/assets/interview15.html.8dc91059.js"><link rel="prefetch" href="/notes/assets/interview16.html.cf538a1c.js"><link rel="prefetch" href="/notes/assets/interview17.html.a32abbc8.js"><link rel="prefetch" href="/notes/assets/interview18.html.0fa2efef.js"><link rel="prefetch" href="/notes/assets/interview19.html.b4e27e0a.js"><link rel="prefetch" href="/notes/assets/interview2.html.95463e7d.js"><link rel="prefetch" href="/notes/assets/interview20.html.4d5fae90.js"><link rel="prefetch" href="/notes/assets/interview21.html.0882cf96.js"><link rel="prefetch" href="/notes/assets/interview22.html.e31ca229.js"><link rel="prefetch" href="/notes/assets/interview23.html.a74f7426.js"><link rel="prefetch" href="/notes/assets/interview24.html.27ebb542.js"><link rel="prefetch" href="/notes/assets/interview25.html.33cb142b.js"><link rel="prefetch" href="/notes/assets/interview26.html.b3b58f4f.js"><link rel="prefetch" href="/notes/assets/interview27.html.8e27aa06.js"><link rel="prefetch" href="/notes/assets/interview28.html.49e6df7e.js"><link rel="prefetch" href="/notes/assets/interview29.html.7ce852fd.js"><link rel="prefetch" href="/notes/assets/interview3.html.5f77b1cd.js"><link rel="prefetch" href="/notes/assets/interview30.html.9979403c.js"><link rel="prefetch" href="/notes/assets/interview4.html.b462ca7f.js"><link rel="prefetch" href="/notes/assets/interview5.html.a5a38165.js"><link rel="prefetch" href="/notes/assets/interview6.html.fa4e533e.js"><link rel="prefetch" href="/notes/assets/interview7.html.6ad76192.js"><link rel="prefetch" href="/notes/assets/interview8.html.4420f599.js"><link rel="prefetch" href="/notes/assets/interview9.html.d936486e.js"><link rel="prefetch" href="/notes/assets/adjacentSiblingCombinator.html.4678ef29.js"><link rel="prefetch" href="/notes/assets/attributeSelectors.html.26ba4611.js"><link rel="prefetch" href="/notes/assets/charset.html.d2c457ea.js"><link rel="prefetch" href="/notes/assets/childCombinator.html.3141043e.js"><link rel="prefetch" href="/notes/assets/classSelectors.html.12522638.js"><link rel="prefetch" href="/notes/assets/descendantCombinator.html.fab8f35d.js"><link rel="prefetch" href="/notes/assets/generalSiblingCombinator.html.b4c4cbae.js"><link rel="prefetch" href="/notes/assets/iDSelectors.html.8c4c70d3.js"><link rel="prefetch" href="/notes/assets/pseudoClasses.html.a3601830.js"><link rel="prefetch" href="/notes/assets/pseudoElements.html.4f98065a.js"><link rel="prefetch" href="/notes/assets/selectorList.html.24e96ba6.js"><link rel="prefetch" href="/notes/assets/typeSelectors.html.b26b0828.js"><link rel="prefetch" href="/notes/assets/universalSelectors.html.eccbf364.js"><link rel="prefetch" href="/notes/assets/IterationProtocols.html.51c4e03d.js"><link rel="prefetch" href="/notes/assets/arrayFlat.html.b8cb5aed.js"><link rel="prefetch" href="/notes/assets/asyncHistory.html.aa784c29.js"><link rel="prefetch" href="/notes/assets/eventLoop.html.ecc7202d.js"><link rel="prefetch" href="/notes/assets/fileReader.html.531b6b74.js"><link rel="prefetch" href="/notes/assets/formData.html.15fdfb84.js"><link rel="prefetch" href="/notes/assets/functionGenerator.html.19d1dbd5.js"><link rel="prefetch" href="/notes/assets/generator.html.b0314375.js"><link rel="prefetch" href="/notes/assets/intersectionObserver.html.b0ed8797.js"><link rel="prefetch" href="/notes/assets/map.html.13056768.js"><link rel="prefetch" href="/notes/assets/promise.html.0205a234.js"><link rel="prefetch" href="/notes/assets/set.html.5065a76a.js"><link rel="prefetch" href="/notes/assets/string.html.315b17c9.js"><link rel="prefetch" href="/notes/assets/symbol.html.2cc4e5e6.js"><link rel="prefetch" href="/notes/assets/xMLHttpRequest.html.c899cb52.js"><link rel="prefetch" href="/notes/assets/spreadSyntax.html.e2d75338.js"><link rel="prefetch" href="/notes/assets/strictMode.html.3cff9f18.js"><link rel="prefetch" href="/notes/assets/cache.html.5ab9ab96.js"><link rel="prefetch" href="/notes/assets/drag1.html.5eee75e6.js"><link rel="prefetch" href="/notes/assets/oneLineCode.html.8ced55da.js"><link rel="prefetch" href="/notes/assets/oneLineCodeArray.html.2a6deae0.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDOM.html.e3420bc3.js"><link rel="prefetch" href="/notes/assets/oneLineCodeDateTime.html.371ec1ec.js"><link rel="prefetch" href="/notes/assets/oneLineCodeFunction.html.9b5afa57.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMath.html.c4c84b27.js"><link rel="prefetch" href="/notes/assets/oneLineCodeMisc.html.607580cb.js"><link rel="prefetch" href="/notes/assets/oneLineCodeNumber.html.0c24a0dc.js"><link rel="prefetch" href="/notes/assets/oneLineCodeObject.html.5ad38b80.js"><link rel="prefetch" href="/notes/assets/oneLineCodeRandom.html.6f54ca72.js"><link rel="prefetch" href="/notes/assets/oneLineCodeString.html.6836187a.js"><link rel="prefetch" href="/notes/assets/oneLineCodeValidator.html.6f3faa87.js"><link rel="prefetch" href="/notes/assets/typeScriptCache.html.cf83e89c.js"><link rel="prefetch" href="/notes/assets/reactBase.html.34722524.js"><link rel="prefetch" href="/notes/assets/reactTypescript.html.ee954354.js"><link rel="prefetch" href="/notes/assets/vue2Base.html.5e4d06d2.js"><link rel="prefetch" href="/notes/assets/vue2Table.html.5bb59922.js"><link rel="prefetch" href="/notes/assets/vue2offsetTop.html.3083a997.js"><link rel="prefetch" href="/notes/assets/componentWillXXX.html.febd278d.js"><link rel="prefetch" href="/notes/assets/disrupt.html.b6c0351f.js"><link rel="prefetch" href="/notes/assets/lane.html.72f390d4.js"><link rel="prefetch" href="/notes/assets/prepare.html.d81b7442.js"><link rel="prefetch" href="/notes/assets/redux.html.86a12e77.js"><link rel="prefetch" href="/notes/assets/scheduler.html.8c339c02.js"><link rel="prefetch" href="/notes/assets/multi.html.0739ede4.js"><link rel="prefetch" href="/notes/assets/one.html.f797fb2f.js"><link rel="prefetch" href="/notes/assets/prepare.html.6449d220.js"><link rel="prefetch" href="/notes/assets/create.html.2c1770d7.js"><link rel="prefetch" href="/notes/assets/prepare.html.19a0c63a.js"><link rel="prefetch" href="/notes/assets/structure.html.4af4a93a.js"><link rel="prefetch" href="/notes/assets/useeffect.html.cb0836a6.js"><link rel="prefetch" href="/notes/assets/usememo.html.7c201360.js"><link rel="prefetch" href="/notes/assets/useref.html.bad9c523.js"><link rel="prefetch" href="/notes/assets/usestate.html.ac4c6a0c.js"><link rel="prefetch" href="/notes/assets/file.html.30b2a472.js"><link rel="prefetch" href="/notes/assets/idea.html.9c212512.js"><link rel="prefetch" href="/notes/assets/jsx.html.ad8d5832.js"><link rel="prefetch" href="/notes/assets/newConstructure.html.810f09a4.js"><link rel="prefetch" href="/notes/assets/oldConstructure.html.891dc0ee.js"><link rel="prefetch" href="/notes/assets/source.html.d63d9625.js"><link rel="prefetch" href="/notes/assets/summary.html.8616e021.js"><link rel="prefetch" href="/notes/assets/basePrinciple.html.8885dd7f.js"><link rel="prefetch" href="/notes/assets/componentApi.html.40834033.js"><link rel="prefetch" href="/notes/assets/domApi.html.22e55c76.js"><link rel="prefetch" href="/notes/assets/hoc.html.91d90706.js"><link rel="prefetch" href="/notes/assets/hookApi.html.818a01de.js"><link rel="prefetch" href="/notes/assets/hookCustom.html.32a36dfb.js"><link rel="prefetch" href="/notes/assets/hookPrinciple.html.56d6f673.js"><link rel="prefetch" href="/notes/assets/hookUse.html.00a61215.js"><link rel="prefetch" href="/notes/assets/reactKeeplive.html.44eaf288.js"><link rel="prefetch" href="/notes/assets/reactRedux.html.a420779a.js"><link rel="prefetch" href="/notes/assets/reactRouter.html.ca1881e7.js"><link rel="prefetch" href="/notes/assets/toolApi.html.e9d4c75a.js"><link rel="prefetch" href="/notes/assets/beginWork.html.16f412a1.js"><link rel="prefetch" href="/notes/assets/completeWork.html.9ff3db0d.js"><link rel="prefetch" href="/notes/assets/doubleBuffer.html.2567847d.js"><link rel="prefetch" href="/notes/assets/fiber-mental.html.20df01fb.js"><link rel="prefetch" href="/notes/assets/fiber.html.8a441b3e.js"><link rel="prefetch" href="/notes/assets/reconciler.html.04c2e687.js"><link rel="prefetch" href="/notes/assets/beforeMutation.html.3c5603ea.js"><link rel="prefetch" href="/notes/assets/layout.html.4658d427.js"><link rel="prefetch" href="/notes/assets/mutation.html.dcc1b732.js"><link rel="prefetch" href="/notes/assets/prepare.html.68c8bf56.js"><link rel="prefetch" href="/notes/assets/mental.html.03393ba5.js"><link rel="prefetch" href="/notes/assets/prepare.html.ee2c080f.js"><link rel="prefetch" href="/notes/assets/priority.html.913dca70.js"><link rel="prefetch" href="/notes/assets/reactdom.html.373713ad.js"><link rel="prefetch" href="/notes/assets/setstate.html.4ed38489.js"><link rel="prefetch" href="/notes/assets/update.html.2d0f9ee0.js"><link rel="prefetch" href="/notes/assets/bitfiled.html.8eca7f28.js"><link rel="prefetch" href="/notes/assets/dfs.html.8a40d17e.js"><link rel="prefetch" href="/notes/assets/diff.html.19c98a3c.js"><link rel="prefetch" href="/notes/assets/heapsort.html.4eaf85a8.js"><link rel="prefetch" href="/notes/assets/linkedlist.html.17aee4ad.js"><link rel="prefetch" href="/notes/assets/stack.html.fe3b2471.js"><link rel="prefetch" href="/notes/assets/bootstrap.html.bd305359.js"><link rel="prefetch" href="/notes/assets/context.html.b92a2241.js"><link rel="prefetch" href="/notes/assets/fibertree-commit.html.6cb97cdb.js"><link rel="prefetch" href="/notes/assets/fibertree-create.html.5d944821.js"><link rel="prefetch" href="/notes/assets/fibertree-update.html.d18efe4d.js"><link rel="prefetch" href="/notes/assets/hook-effect.html.0862838e.js"><link rel="prefetch" href="/notes/assets/hook-state.html.5552f208.js"><link rel="prefetch" href="/notes/assets/hook-summary.html.38ae18b1.js"><link rel="prefetch" href="/notes/assets/macro-structure.html.08c0b408.js"><link rel="prefetch" href="/notes/assets/object-structure.html.1899253b.js"><link rel="prefetch" href="/notes/assets/priority.html.24f4fd27.js"><link rel="prefetch" href="/notes/assets/reconciler-workflow.html.51a79eb6.js"><link rel="prefetch" href="/notes/assets/scheduler.html.701a1c65.js"><link rel="prefetch" href="/notes/assets/state-effects.html.f67a9fd1.js"><link rel="prefetch" href="/notes/assets/synthetic-event.html.f75a320b.js"><link rel="prefetch" href="/notes/assets/workloop.html.281d6eba.js"><link rel="prefetch" href="/notes/assets/ast.html.4722246c.js"><link rel="prefetch" href="/notes/assets/binder.html.bed71a48.js"><link rel="prefetch" href="/notes/assets/checker.html.ca8111ef.js"><link rel="prefetch" href="/notes/assets/emitter.html.af546fcd.js"><link rel="prefetch" href="/notes/assets/overview.html.4a519291.js"><link rel="prefetch" href="/notes/assets/parser.html.02c420d4.js"><link rel="prefetch" href="/notes/assets/program.html.941d3fd0.js"><link rel="prefetch" href="/notes/assets/scanner.html.06598dca.js"><link rel="prefetch" href="/notes/assets/common.html.2840c671.js"><link rel="prefetch" href="/notes/assets/interpreting.html.9d0247dd.js"><link rel="prefetch" href="/notes/assets/class.html.176b10c4.js"><link rel="prefetch" href="/notes/assets/commandline-behavior.html.9c679556.js"><link rel="prefetch" href="/notes/assets/comments.html.8840c294.js"><link rel="prefetch" href="/notes/assets/common-bug-not-bugs.html.1c50db4c.js"><link rel="prefetch" href="/notes/assets/common-feature-request.html.cbdc85e0.js"><link rel="prefetch" href="/notes/assets/decorators.html.e685ca45.js"><link rel="prefetch" href="/notes/assets/enums.html.e3d4bed0.js"><link rel="prefetch" href="/notes/assets/function.html.2f3827b6.js"><link rel="prefetch" href="/notes/assets/generics.html.ef35fef5.js"><link rel="prefetch" href="/notes/assets/glossary-and-terms.html.ff76a163.js"><link rel="prefetch" href="/notes/assets/jsx-and-react.html.af6a3ed5.js"><link rel="prefetch" href="/notes/assets/modules.html.fca96b11.js"><link rel="prefetch" href="/notes/assets/thing-that-dont-work.html.0798ae85.js"><link rel="prefetch" href="/notes/assets/tsconfig-behavior.html.7186d572.js"><link rel="prefetch" href="/notes/assets/type-guards.html.338be1fc.js"><link rel="prefetch" href="/notes/assets/type-system-behavior.html.b3d484fb.js"><link rel="prefetch" href="/notes/assets/nonReactJSX.html.6224d2f0.js"><link rel="prefetch" href="/notes/assets/reactJSX.html.2ab93f4e.js"><link rel="prefetch" href="/notes/assets/support.html.38d65ad9.js"><link rel="prefetch" href="/notes/assets/typescript-3.7.html.22fbc5c7.js"><link rel="prefetch" href="/notes/assets/typescript-3.8.html.7e45b554.js"><link rel="prefetch" href="/notes/assets/typescript-3.9.html.d3535b93.js"><link rel="prefetch" href="/notes/assets/compilationContext.html.42cc41f0.js"><link rel="prefetch" href="/notes/assets/declarationspaces.html.5e8d853d.js"><link rel="prefetch" href="/notes/assets/dynamicImportExpressions.html.2351b7f3.js"><link rel="prefetch" href="/notes/assets/inDepthTs.html.23b9ed3c.js"><link rel="prefetch" href="/notes/assets/modules.html.a267ca3f.js"><link rel="prefetch" href="/notes/assets/namespaces.html.e9e0a691.js"><link rel="prefetch" href="/notes/assets/unknownAny.html.130e4df1.js"><link rel="prefetch" href="/notes/assets/avoidExportDefault.html.e6bf98c9.js"><link rel="prefetch" href="/notes/assets/barrel.html.4784a045.js"><link rel="prefetch" href="/notes/assets/bind.html.4a0d2947.js"><link rel="prefetch" href="/notes/assets/buildToggles.html.73cc1fff.js"><link rel="prefetch" href="/notes/assets/classAreUseful.html.2ef5f86f.js"><link rel="prefetch" href="/notes/assets/covarianceAndContravariance.html.cceeb4e4.js"><link rel="prefetch" href="/notes/assets/createArrays.html.6ba7a0e7.js"><link rel="prefetch" href="/notes/assets/curry.html.9bed419f.js"><link rel="prefetch" href="/notes/assets/functionParameters.html.bdb6bd3d.js"><link rel="prefetch" href="/notes/assets/infer.html.205651e2.js"><link rel="prefetch" href="/notes/assets/lazyObjectLiteralInitialization.html.5f61d58a.js"><link rel="prefetch" href="/notes/assets/limitPropertySetters.html.7c772ffe.js"><link rel="prefetch" href="/notes/assets/metadata.html.e9eb3a03.js"><link rel="prefetch" href="/notes/assets/nominalTyping.html.530eea23.js"><link rel="prefetch" href="/notes/assets/outFileCaution.html.36b23ec7.js"><link rel="prefetch" href="/notes/assets/singletonPatern.html.3a72448b.js"><link rel="prefetch" href="/notes/assets/statefulFunctions.html.8ec60826.js"><link rel="prefetch" href="/notes/assets/staticConstructors.html.5a25406b.js"><link rel="prefetch" href="/notes/assets/stringBasedEmuns.html.b4519990.js"><link rel="prefetch" href="/notes/assets/truthy.html.6496d11c.js"><link rel="prefetch" href="/notes/assets/typeInstantiation.html.8e59e083.js"><link rel="prefetch" href="/notes/assets/typesafeEventEmitter.html.6300f4fa.js"><link rel="prefetch" href="/notes/assets/ambient.html.c822fd90.js"><link rel="prefetch" href="/notes/assets/callable.html.d0c0bbad.js"><link rel="prefetch" href="/notes/assets/discrominatedUnion.html.a172d541.js"><link rel="prefetch" href="/notes/assets/enums.html.76032376.js"><link rel="prefetch" href="/notes/assets/exceptionsHanding.html.3090d295.js"><link rel="prefetch" href="/notes/assets/freshness.html.07d033ad.js"><link rel="prefetch" href="/notes/assets/functions.html.1702d26f.js"><link rel="prefetch" href="/notes/assets/generices.html.c2df4cac.js"><link rel="prefetch" href="/notes/assets/indexSignatures.html.85f6577d.js"><link rel="prefetch" href="/notes/assets/interfaces.html.2e1c0ca0.js"><link rel="prefetch" href="/notes/assets/lib.html.8e150cb1.js"><link rel="prefetch" href="/notes/assets/literals.html.3cd9a741.js"><link rel="prefetch" href="/notes/assets/migrating.html.53df00fb.js"><link rel="prefetch" href="/notes/assets/mixins.html.62e5f0fd.js"><link rel="prefetch" href="/notes/assets/movingTypes.html.9d36cd6f.js"><link rel="prefetch" href="/notes/assets/neverType.html.16150149.js"><link rel="prefetch" href="/notes/assets/overview.html.85bcab3e.js"><link rel="prefetch" href="/notes/assets/readonly.html.66f74561.js"><link rel="prefetch" href="/notes/assets/thisType.html.638f1d8d.js"><link rel="prefetch" href="/notes/assets/typeAssertion.html.cedb905a.js"><link rel="prefetch" href="/notes/assets/typeCompatibility.html.f314b22e.js"><link rel="prefetch" href="/notes/assets/typeGuard.html.2ff8201d.js"><link rel="prefetch" href="/notes/assets/typeInference.html.1fae7266.js"><link rel="prefetch" href="/notes/assets/types.html.67883b92.js"><link rel="prefetch" href="/notes/assets/pluginDva.html.b68c212d.js"><link rel="prefetch" href="/notes/assets/pluginQiankun.html.7f956b9b.js"><link rel="prefetch" href="/notes/assets/codegen.html.decbe76e.js"><link rel="prefetch" href="/notes/assets/entrance.html.78975e1d.js"><link rel="prefetch" href="/notes/assets/optimize.html.9f58b1dc.js"><link rel="prefetch" href="/notes/assets/outline.html.b228ff98.js"><link rel="prefetch" href="/notes/assets/parse.html.cf87e83c.js"><link rel="prefetch" href="/notes/assets/async-component.html.f2fce7a4.js"><link rel="prefetch" href="/notes/assets/component-register.html.ec777791.js"><link rel="prefetch" href="/notes/assets/create-component.html.b7ea7d86.js"><link rel="prefetch" href="/notes/assets/lifecycle.html.6dfe8f3c.js"><link rel="prefetch" href="/notes/assets/merge-option.html.fda33cc2.js"><link rel="prefetch" href="/notes/assets/outline.html.ef6eb680.js"><link rel="prefetch" href="/notes/assets/patch.html.984b33c4.js"><link rel="prefetch" href="/notes/assets/_index.html.0917df2e.js"><link rel="prefetch" href="/notes/assets/create-element.html.64d36854.js"><link rel="prefetch" href="/notes/assets/mounted.html.17638664.js"><link rel="prefetch" href="/notes/assets/new-vue.html.52de603e.js"><link rel="prefetch" href="/notes/assets/render.html.5cf78daa.js"><link rel="prefetch" href="/notes/assets/update.html.2e285d46.js"><link rel="prefetch" href="/notes/assets/virtual-dom.html.ebbd5cff.js"><link rel="prefetch" href="/notes/assets/event.html.2885b882.js"><link rel="prefetch" href="/notes/assets/keep-alive.html.91309197.js"><link rel="prefetch" href="/notes/assets/outline.html.dc94c30d.js"><link rel="prefetch" href="/notes/assets/slot.html.ca1e313b.js"><link rel="prefetch" href="/notes/assets/tansition-group.html.109ceff3.js"><link rel="prefetch" href="/notes/assets/tansition.html.2cb870c6.js"><link rel="prefetch" href="/notes/assets/v-model.html.4cd30505.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.3eae277e.js"><link rel="prefetch" href="/notes/assets/baseInterviewSecond.html.d6cde389.js"><link rel="prefetch" href="/notes/assets/componentCommunication.html.ecbe72e8.js"><link rel="prefetch" href="/notes/assets/detailedResponsiveness.html.483c396e.js"><link rel="prefetch" href="/notes/assets/diff.html.07197252.js"><link rel="prefetch" href="/notes/assets/eventBinding.html.f9c13bf1.js"><link rel="prefetch" href="/notes/assets/eventMechanism.html.435fbd64.js"><link rel="prefetch" href="/notes/assets/key.html.e1b89141.js"><link rel="prefetch" href="/notes/assets/knowledgeSystem.html.2967f0fb.js"><link rel="prefetch" href="/notes/assets/slot.html.b6cff939.js"><link rel="prefetch" href="/notes/assets/sourceCodeAsyncDomUpdateNextTick.html.987a85c5.js"><link rel="prefetch" href="/notes/assets/sourceCodeElementBroadcastDispatch.html.51b7b968.js"><link rel="prefetch" href="/notes/assets/sourceCodeKeepAlive.html.d20fe26a.js"><link rel="prefetch" href="/notes/assets/sourceCodeResponsiveness.html.5dc22fc3.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateCompilation.html.f7a1dd87.js"><link rel="prefetch" href="/notes/assets/sourceCodeTemplateDom.html.d20c743f.js"><link rel="prefetch" href="/notes/assets/sourceCodeVuex.html.b2c2f6d7.js"><link rel="prefetch" href="/notes/assets/templateCompilation.html.7c059f34.js"><link rel="prefetch" href="/notes/assets/vNode.html.8be72310.js"><link rel="prefetch" href="/notes/assets/vNodeDiff.html.52f30892.js"><link rel="prefetch" href="/notes/assets/build.html.df2322c4.js"><link rel="prefetch" href="/notes/assets/directory.html.c1bf8102.js"><link rel="prefetch" href="/notes/assets/entrance.html.d8a98236.js"><link rel="prefetch" href="/notes/assets/flow.html.e4f444d4.js"><link rel="prefetch" href="/notes/assets/component-update.html.784b890d.js"><link rel="prefetch" href="/notes/assets/computed-watcher.html.28270353.js"><link rel="prefetch" href="/notes/assets/getters.html.a2e7d109.js"><link rel="prefetch" href="/notes/assets/next-tick.html.9c857394.js"><link rel="prefetch" href="/notes/assets/outline.html.76b6ab45.js"><link rel="prefetch" href="/notes/assets/props.html.ad58cf0f.js"><link rel="prefetch" href="/notes/assets/questions.html.127aeab2.js"><link rel="prefetch" href="/notes/assets/reactive-object.html.64466fea.js"><link rel="prefetch" href="/notes/assets/setters.html.0dca9440.js"><link rel="prefetch" href="/notes/assets/summary.html.c18427a9.js"><link rel="prefetch" href="/notes/assets/install.html.7de46a8b.js"><link rel="prefetch" href="/notes/assets/matcher.html.d080fc07.js"><link rel="prefetch" href="/notes/assets/outline.html.607a3a2d.js"><link rel="prefetch" href="/notes/assets/router.html.a6fa1e47.js"><link rel="prefetch" href="/notes/assets/transition-to.html.5c90d737.js"><link rel="prefetch" href="/notes/assets/api.html.39f6da24.js"><link rel="prefetch" href="/notes/assets/idex.html.e1c16a01.js"><link rel="prefetch" href="/notes/assets/init.html.462c5cf9.js"><link rel="prefetch" href="/notes/assets/plugin.html.ca8bed91.js"><link rel="prefetch" href="/notes/assets/baseInterview.html.866c3c06.js"><link rel="prefetch" href="/notes/assets/configuration.html.9e58a0fa.js"><link rel="prefetch" href="/notes/assets/entryPoints.html.09ad4a83.js"><link rel="prefetch" href="/notes/assets/loader.html.4cf291fa.js"><link rel="prefetch" href="/notes/assets/output.html.8cf664a5.js"><link rel="prefetch" href="/notes/assets/plugin.html.a5428135.js"><link rel="prefetch" href="/notes/assets/webpackInterview.html.9adadcaf.js"><link rel="prefetch" href="/notes/assets/reactApi.html.6cb8a5bd.js"><link rel="prefetch" href="/notes/assets/reactChildren.html.96c46a9a.js"><link rel="prefetch" href="/notes/assets/reactElement.html.b4f8352a.js"><link rel="prefetch" href="/notes/assets/reactFiber.html.4b137f5f.js"><link rel="prefetch" href="/notes/assets/commitAllHostEffects.html.68a9a0ef.js"><link rel="prefetch" href="/notes/assets/commitAllLifeCycles.html.06ba456b.js"><link rel="prefetch" href="/notes/assets/commitBeforeMutationLifecycles.html.2ce9b59b.js"><link rel="prefetch" href="/notes/assets/commitDeletion.html.a9d92fcf.js"><link rel="prefetch" href="/notes/assets/commitPlacement.html.a7b8b479.js"><link rel="prefetch" href="/notes/assets/commitRoot.html.28d39b32.js"><link rel="prefetch" href="/notes/assets/commitWork.html.03ce0c1e.js"><link rel="prefetch" href="/notes/assets/invokeGuardedCallback.html.bffcf147.js"><link rel="prefetch" href="/notes/assets/expirationTime.html.b50e0cc1.js"><link rel="prefetch" href="/notes/assets/reactDomRender.html.a52e57c1.js"><link rel="prefetch" href="/notes/assets/setStateForceUpdate.html.97a36dcc.js"><link rel="prefetch" href="/notes/assets/context.html.16ea2e60.js"><link rel="prefetch" href="/notes/assets/evenInit.html.30c2727f.js"><link rel="prefetch" href="/notes/assets/eventBind.html.26edb394.js"><link rel="prefetch" href="/notes/assets/eventCreateEventObject.html.986a4a58.js"><link rel="prefetch" href="/notes/assets/eventDispath.html.66c4062e.js"><link rel="prefetch" href="/notes/assets/hydrate.html.17e9bdee.js"><link rel="prefetch" href="/notes/assets/ref.html.52737b61.js"><link rel="prefetch" href="/notes/assets/suspense.html.214d4f5e.js"><link rel="prefetch" href="/notes/assets/suspenseLazy.html.fe491204.js"><link rel="prefetch" href="/notes/assets/suspenseWork.html.556b0edf.js"><link rel="prefetch" href="/notes/assets/hooksCommon.html.379b077c.js"><link rel="prefetch" href="/notes/assets/hooksOther.html.22aa738b.js"><link rel="prefetch" href="/notes/assets/start.html.7311ac86.js"><link rel="prefetch" href="/notes/assets/useEffect.html.6574b772.js"><link rel="prefetch" href="/notes/assets/useState.html.cbcfa61c.js"><link rel="prefetch" href="/notes/assets/base.html.25bf7666.js"><link rel="prefetch" href="/notes/assets/commpontDiff.html.a1e53d65.js"><link rel="prefetch" href="/notes/assets/componentUpdate.html.644e4b07.js"><link rel="prefetch" href="/notes/assets/renderProcess.html.2666f6c0.js"><link rel="prefetch" href="/notes/assets/schedulingPrinciple.html.ccbcd29b.js"><link rel="prefetch" href="/notes/assets/beginWork.html.655d69f7.js"><link rel="prefetch" href="/notes/assets/globalVariable.html.31502402.js"><link rel="prefetch" href="/notes/assets/mountIndeterminateComponent.html.04a5f30e.js"><link rel="prefetch" href="/notes/assets/mountLazyCompont.html.2fe93bfc.js"><link rel="prefetch" href="/notes/assets/performUnitOfWork.html.ace3ee26.js"><link rel="prefetch" href="/notes/assets/performWork.html.2497511d.js"><link rel="prefetch" href="/notes/assets/reactScheduler.html.d0ac2d54.js"><link rel="prefetch" href="/notes/assets/reconcileChildren.html.3c846629.js"><link rel="prefetch" href="/notes/assets/reconcileChildrenArray.html.97182f29.js"><link rel="prefetch" href="/notes/assets/reconcileSingleElement.html.bfa84cf2.js"><link rel="prefetch" href="/notes/assets/renderRoot.html.ba5288e4.js"><link rel="prefetch" href="/notes/assets/scheduleWork.html.c90062e5.js"><link rel="prefetch" href="/notes/assets/throwException.html.c51288e7.js"><link rel="prefetch" href="/notes/assets/updateClassComponent.html.7cc962b4.js"><link rel="prefetch" href="/notes/assets/updateContextConsumer.html.403bc04b.js"><link rel="prefetch" href="/notes/assets/updateContextProvider.html.b19839fa.js"><link rel="prefetch" href="/notes/assets/updateForwardRef.html.0b6c16ba.js"><link rel="prefetch" href="/notes/assets/updateFragment.html.3be4ca6a.js"><link rel="prefetch" href="/notes/assets/updateFunctionalComponent.html.63214472.js"><link rel="prefetch" href="/notes/assets/updateHostComponent.html.855bd285.js"><link rel="prefetch" href="/notes/assets/updateHostRoot.html.a008bdc7.js"><link rel="prefetch" href="/notes/assets/updateHostText.html.778f20ec.js"><link rel="prefetch" href="/notes/assets/updateMode.html.72e7cae7.js"><link rel="prefetch" href="/notes/assets/updatePortalComponent.html.ee67a0b1.js"><link rel="prefetch" href="/notes/assets/updateProfiler.html.eb313acf.js"><link rel="prefetch" href="/notes/assets/updateSuspenseComponent.html.ac4368be.js"><link rel="prefetch" href="/notes/assets/interview1.html.233c8a55.js"><link rel="prefetch" href="/notes/assets/interview2.html.ad211fb1.js"><link rel="prefetch" href="/notes/assets/interview3.html.ff6c200b.js"><link rel="prefetch" href="/notes/assets/interview51.html.332896a2.js"><link rel="prefetch" href="/notes/assets/interview52.html.c9e9a740.js"><link rel="prefetch" href="/notes/assets/interview53.html.bb2200fc.js"><link rel="prefetch" href="/notes/assets/interview54.html.31c68b7d.js"><link rel="prefetch" href="/notes/assets/interview55.html.9de26700.js"><link rel="prefetch" href="/notes/assets/interview56.html.f54f5c68.js"><link rel="prefetch" href="/notes/assets/interview57.html.e990ca13.js"><link rel="prefetch" href="/notes/assets/interview1.html.fec6abfb.js"><link rel="prefetch" href="/notes/assets/interview10.html.cc9cc0ff.js"><link rel="prefetch" href="/notes/assets/interview11.html.c9c43373.js"><link rel="prefetch" href="/notes/assets/interview12.html.3c7c219b.js"><link rel="prefetch" href="/notes/assets/interview13.html.df11d69d.js"><link rel="prefetch" href="/notes/assets/interview14.html.064ab175.js"><link rel="prefetch" href="/notes/assets/interview15.html.aaaf13f8.js"><link rel="prefetch" href="/notes/assets/interview16.html.b917ebad.js"><link rel="prefetch" href="/notes/assets/interview17.html.89fe2b4e.js"><link rel="prefetch" href="/notes/assets/interview18.html.5945983b.js"><link rel="prefetch" href="/notes/assets/interview19.html.af91505c.js"><link rel="prefetch" href="/notes/assets/interview2.html.7eba2145.js"><link rel="prefetch" href="/notes/assets/interview20.html.bbc39973.js"><link rel="prefetch" href="/notes/assets/interview21.html.3135e99c.js"><link rel="prefetch" href="/notes/assets/interview22.html.517fb777.js"><link rel="prefetch" href="/notes/assets/interview23.html.e85e7c30.js"><link rel="prefetch" href="/notes/assets/interview24.html.2ec0e247.js"><link rel="prefetch" href="/notes/assets/interview25.html.896a5d9e.js"><link rel="prefetch" href="/notes/assets/interview26.html.c9099ff6.js"><link rel="prefetch" href="/notes/assets/interview27.html.e0d813df.js"><link rel="prefetch" href="/notes/assets/interview28.html.98ae23f7.js"><link rel="prefetch" href="/notes/assets/interview29.html.bfc17d61.js"><link rel="prefetch" href="/notes/assets/interview3.html.123f8330.js"><link rel="prefetch" href="/notes/assets/interview30.html.556a950e.js"><link rel="prefetch" href="/notes/assets/interview31.html.03ba5989.js"><link rel="prefetch" href="/notes/assets/interview32.html.8ac251f8.js"><link rel="prefetch" href="/notes/assets/interview33.html.ebc204c1.js"><link rel="prefetch" href="/notes/assets/interview34.html.0e51800a.js"><link rel="prefetch" href="/notes/assets/interview35.html.f6e32ab4.js"><link rel="prefetch" href="/notes/assets/interview36.html.18a99299.js"><link rel="prefetch" href="/notes/assets/interview37.html.be5f0d27.js"><link rel="prefetch" href="/notes/assets/interview38.html.d77a4503.js"><link rel="prefetch" href="/notes/assets/interview39.html.ddc70590.js"><link rel="prefetch" href="/notes/assets/interview4.html.22d72ffa.js"><link rel="prefetch" href="/notes/assets/interview40.html.5f53c675.js"><link rel="prefetch" href="/notes/assets/interview41.html.6cb0baa4.js"><link rel="prefetch" href="/notes/assets/interview42.html.801d18f8.js"><link rel="prefetch" href="/notes/assets/interview43.html.0a26e65b.js"><link rel="prefetch" href="/notes/assets/interview44.html.4f99e5a6.js"><link rel="prefetch" href="/notes/assets/interview45.html.7eabfa3e.js"><link rel="prefetch" href="/notes/assets/interview46.html.e625d4a6.js"><link rel="prefetch" href="/notes/assets/interview47.html.496b56ef.js"><link rel="prefetch" href="/notes/assets/interview48.html.62ce9ca7.js"><link rel="prefetch" href="/notes/assets/interview49.html.c8a9b27d.js"><link rel="prefetch" href="/notes/assets/interview5.html.e5b8b894.js"><link rel="prefetch" href="/notes/assets/interview50.html.192b7d23.js"><link rel="prefetch" href="/notes/assets/interview6.html.64688c44.js"><link rel="prefetch" href="/notes/assets/interview7.html.20d70ae4.js"><link rel="prefetch" href="/notes/assets/interview8.html.b2cfde5b.js"><link rel="prefetch" href="/notes/assets/interview9.html.05d43054.js"><link rel="prefetch" href="/notes/assets/404.html.a80f367c.js"><link rel="prefetch" href="/notes/assets/404.cd38f2df.js"><link rel="prefetch" href="/notes/assets/Layout.f13adff3.js">
    <link rel="stylesheet" href="/notes/assets/style.d23a4eb9.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/notes/" class=""><!----><!----></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">fiber 树构造(基础准备) <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/react-illustration-series/main/fibertree-prepare.html#reactelement-fiber-dom-三者的关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="ReactElement, Fiber, DOM 三者的关系"><!--[--><!--]--> ReactElement, Fiber, DOM 三者的关系 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/react-illustration-series/main/fibertree-prepare.html#全局变量" class="router-link-active router-link-exact-active sidebar-item" aria-label="全局变量"><!--[--><!--]--> 全局变量 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notes/react-illustration-series/main/fibertree-prepare.html#执行上下文" class="router-link-active router-link-exact-active sidebar-item" aria-label="执行上下文"><!--[--><!--]--> 执行上下文 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/react-illustration-series/main/fibertree-prepare.html#双缓冲技术-double-buffering" class="router-link-active router-link-exact-active sidebar-item" aria-label="双缓冲技术(double buffering)"><!--[--><!--]--> 双缓冲技术(double buffering) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/react-illustration-series/main/fibertree-prepare.html#优先级-lanes" class="router-link-active router-link-exact-active sidebar-item" aria-label="优先级 {#lanes}"><!--[--><!--]--> 优先级 {#lanes} <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notes/react-illustration-series/main/fibertree-prepare.html#栈帧管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="栈帧管理"><!--[--><!--]--> 栈帧管理 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/notes/react-illustration-series/main/fibertree-prepare.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="fiber-树构造-基础准备" tabindex="-1"><a class="header-anchor" href="#fiber-树构造-基础准备" aria-hidden="true">#</a> fiber 树构造(基础准备)</h1><p>在 React 运行时中, <code>fiber树构造</code>位于<code>react-reconciler</code>包.</p><p>在正式解读<code>fiber树构造</code>之前, 再次回顾一下<a href="/notes/react-illustration-series/main/reconciler-workflow.html" class="">reconciler 运作流程</a>的 4 个阶段:</p><img src="/notes/assets/react-illustration-series/reactfiberworkloop.png" alt="demo"><ol><li>输入阶段: 衔接<code>react-dom</code>包, 承接<code>fiber更新</code>请求(可以参考<a href="/notes/react-illustration-series/main/bootstrap.html" class="">React 应用的启动过程</a>).</li><li>注册调度任务: 与调度中心(<code>scheduler</code>包)交互, 注册调度任务<code>task</code>, 等待任务回调(可以参考<a href="/notes/react-illustration-series/main/scheduler.html" class="">React 调度原理(scheduler)</a>).</li><li>执行任务回调: 在内存中构造出<code>fiber树</code>和<code>DOM</code>对象, 也是<strong>fiber 树构造的重点内容</strong>.</li><li>输出: 与渲染器(<code>react-dom</code>)交互, 渲染<code>DOM</code>节点.</li></ol><p><code>fiber树构造</code>处于上述第 3 个阶段, 可以通过不同的视角来理解<code>fiber树构造</code>在<code>React</code>运行时中所处的位置:</p><ul><li>从<code>scheduler</code>调度中心的角度来看, 它是任务队列<code>taskQueue</code>中的一个具体的任务回调(<code>task.callback</code>).</li><li>从<a href="/notes/react-illustration-series/main/workloop.html" class="">React 工作循环</a>的角度来看, 它属于<code>fiber树构造循环</code>.</li></ul><p>由于<code>fiber 树构造</code>源码量比较大, 本系列根据<code>React</code>运行的<code>内存状态</code>, 分为 2 种情况来说明:</p><ol><li>初次创建: 在<code>React</code>应用首次启动时, 界面还没有渲染, 此时并不会进入对比过程, 相当于直接构造一棵全新的树.</li><li>对比更新: <code>React</code>应用启动后, 界面已经渲染. 如果再次发生更新, 创建<code>新fiber</code>之前需要和<code>旧fiber</code>进行对比. 最后构造的 fiber 树有可能是全新的, 也可能是部分更新的.</li></ol><p>无论是<code>初次创建</code>还是<code>对比更新</code>, 基础概念都是通用的, 本节将介绍这些基础知识, 为正式进入<code>fiber树构造</code>做准备.</p><h2 id="reactelement-fiber-dom-三者的关系" tabindex="-1"><a class="header-anchor" href="#reactelement-fiber-dom-三者的关系" aria-hidden="true">#</a> ReactElement, Fiber, DOM 三者的关系</h2><p>在<a href="/notes/react-illustration-series/main/object-structure.html" class="">React 应用中的高频对象</a>一文中, 已经介绍了<code>ReactElement</code>和<code>Fiber</code>对象的数据结构. 这里我们梳理出<code>ReactElement, Fiber, DOM</code>这 3 种对象的关系</p><ol><li><p><a href="https://github.com/facebook/react/blob/v17.0.2/packages/react/src/ReactElement.js#L126-L146" target="_blank" rel="noopener noreferrer">ReactElement 对象<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>(type 定义在<a href="https://github.com/facebook/react/blob/v17.0.2/packages/shared/ReactElementType.js#L15" target="_blank" rel="noopener noreferrer">shared 包中<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p><ul><li>所有采用<code>jsx</code>语法书写的节点, 都会被编译器转换, 最终会以<code>React.createElement(...)</code>的方式, 创建出来一个与之对应的<code>ReactElement</code>对象</li></ul></li><li><p><a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiber.old.js#L116-L155" target="_blank" rel="noopener noreferrer">fiber 对象<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>(type 类型的定义在<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactInternalTypes.js#L47-L174" target="_blank" rel="noopener noreferrer">ReactInternalTypes.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中)</p><ul><li><code>fiber对象</code>是通过<code>ReactElement</code>对象进行创建的, 多个<code>fiber对象</code>构成了一棵<code>fiber树</code>, <code>fiber树</code>是构造<code>DOM树</code>的数据模型, <code>fiber树</code>的任何改动, 最后都体现到<code>DOM树</code>.</li></ul></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model" target="_blank" rel="noopener noreferrer">DOM 对象<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: 文档对象模型</p><ul><li><code>DOM</code>将文档解析为一个由节点和对象（包含属性和方法的对象）组成的结构集合, 也就是常说的<code>DOM树</code>.</li><li><code>JavaScript</code>可以访问和操作存储在 DOM 中的内容, 也就是操作<code>DOM对象</code>, 进而触发 UI 渲染.</li></ul></li></ol><p>它们之间的关系反映了我们书写的 JSX 代码到 DOM 节点的转换过程:</p><img src="/notes/assets/react-illustration-series/code2dom.png" alt="demo"><p>注意:</p><ul><li>开发人员能够控制的是<code>JSX</code>, 也就是<code>ReactElement</code>对象.</li><li><code>fiber树</code>是通过<code>ReactElement</code>生成的, 如果脱离了<code>ReactElement</code>,<code>fiber树</code>也无从谈起. 所以是<code>ReactElement</code>树(不是严格的树结构, 为了方便也称为树)驱动<code>fiber树</code>.</li><li><code>fiber树</code>是<code>DOM树</code>的数据模型, <code>fiber树</code>驱动<code>DOM树</code></li></ul><p>开发人员通过编程只能控制<code>ReactElement</code>树的结构, <code>ReactElement树</code>驱动<code>fiber树</code>, <code>fiber树</code>再驱动<code>DOM树</code>, 最后展现到页面上. 所以<code>fiber树</code>的构造过程, 实际上就是<code>ReactElement</code>对象到<code>fiber</code>对象的转换过程.</p><h2 id="全局变量" tabindex="-1"><a class="header-anchor" href="#全局变量" aria-hidden="true">#</a> 全局变量</h2><p>从<a href="/notes/react-illustration-series/main/workloop.html" class="">React 工作循环</a>的角度来看, 整个构造过程被包裹在<code>fiber树构造循环</code>中(对应源码位于<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js" target="_blank" rel="noopener noreferrer">ReactFiberWorkLoop.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>).</p><p>在<code>React</code>运行时, <code>ReactFiberWorkLoop.js</code>闭包中的<code>全局变量</code>会随着<code>fiber树构造循环</code>的进行而变化, 现在查看其中重要的全局变量(<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L247-L367" target="_blank" rel="noopener noreferrer">源码链接<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>):</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 当前React的执行栈(执行上下文)</span>
<span class="token keyword">let</span> <span class="token literal-property property">executionContext</span><span class="token operator">:</span> ExecutionContext <span class="token operator">=</span> NoContext<span class="token punctuation">;</span>

<span class="token comment">// 当前root节点</span>
<span class="token keyword">let</span> <span class="token literal-property property">workInProgressRoot</span><span class="token operator">:</span> FiberRoot <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token comment">// 正在处理中的fiber节点</span>
<span class="token keyword">let</span> <span class="token literal-property property">workInProgress</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token comment">// 正在渲染的车道(复数)</span>
<span class="token keyword">let</span> <span class="token literal-property property">workInProgressRootRenderLanes</span><span class="token operator">:</span> Lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>

<span class="token comment">// 包含所有子节点的优先级, 是workInProgressRootRenderLanes的超集</span>
<span class="token comment">// 大多数情况下: 在工作循环整体层面会使用workInProgressRootRenderLanes, 在begin/complete阶段层面会使用 subtreeRenderLanes</span>
<span class="token keyword">let</span> <span class="token literal-property property">subtreeRenderLanes</span><span class="token operator">:</span> Lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
<span class="token comment">// 一个栈结构: 专门存储当前节点的 subtreeRenderLanes</span>
<span class="token keyword">const</span> <span class="token literal-property property">subtreeRenderLanesCursor</span><span class="token operator">:</span> StackCursor<span class="token operator">&lt;</span>Lanes<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">createCursor</span><span class="token punctuation">(</span>NoLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fiber构造完后, root节点的状态: completed, errored, suspended等</span>
<span class="token keyword">let</span> <span class="token literal-property property">workInProgressRootExitStatus</span><span class="token operator">:</span> RootExitStatus <span class="token operator">=</span> RootIncomplete<span class="token punctuation">;</span>
<span class="token comment">// 重大错误</span>
<span class="token keyword">let</span> <span class="token literal-property property">workInProgressRootFatalError</span><span class="token operator">:</span> mixed <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token comment">// 整个render期间所使用到的所有lanes</span>
<span class="token keyword">let</span> <span class="token literal-property property">workInProgressRootIncludedLanes</span><span class="token operator">:</span> Lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
<span class="token comment">// 在render期间被跳过(由于优先级不够)的lanes: 只包括未处理的updates, 不包括被复用的fiber节点</span>
<span class="token keyword">let</span> <span class="token literal-property property">workInProgressRootSkippedLanes</span><span class="token operator">:</span> Lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
<span class="token comment">// 在render期间被修改过的lanes</span>
<span class="token keyword">let</span> <span class="token literal-property property">workInProgressRootUpdatedLanes</span><span class="token operator">:</span> Lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>

<span class="token comment">// 防止无限循环和嵌套更新</span>
<span class="token keyword">const</span> <span class="token constant">NESTED_UPDATE_LIMIT</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">nestedUpdateCount</span><span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">rootWithNestedUpdates</span><span class="token operator">:</span> FiberRoot <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">NESTED_PASSIVE_UPDATE_LIMIT</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">nestedPassiveUpdateCount</span><span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// 发起更新的时间</span>
<span class="token keyword">let</span> <span class="token literal-property property">currentEventTime</span><span class="token operator">:</span> number <span class="token operator">=</span> NoTimestamp<span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">currentEventWipLanes</span><span class="token operator">:</span> Lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">currentEventPendingLanes</span><span class="token operator">:</span> Lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在源码中, 大部分变量都带有英文注释(读者可自行查阅), 此处只列举了<code>fiber树构造循环</code>中最核心的变量</p><h3 id="执行上下文" tabindex="-1"><a class="header-anchor" href="#执行上下文" aria-hidden="true">#</a> 执行上下文</h3><p>在全局变量中有<code>executionContext</code>, 代表<code>渲染期间</code>的<code>执行栈</code>(或叫做<code>执行上下文</code>), 它也是一个二进制表示的变量, 通过位运算进行操作(参考<a href="/notes/react-illustration-series/algorithm/bitfiled.html" class="">React 算法之位运算</a>). 在源码中一共定义了 8 种执行执行栈:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>type ExecutionContext <span class="token operator">=</span> number<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> NoContext <span class="token operator">=</span> <span class="token comment">/*             */</span> <span class="token number">0b0000000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> BatchedContext <span class="token operator">=</span> <span class="token comment">/*               */</span> <span class="token number">0b0000001</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> EventContext <span class="token operator">=</span> <span class="token comment">/*                 */</span> <span class="token number">0b0000010</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DiscreteEventContext <span class="token operator">=</span> <span class="token comment">/*         */</span> <span class="token number">0b0000100</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> LegacyUnbatchedContext <span class="token operator">=</span> <span class="token comment">/*       */</span> <span class="token number">0b0001000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> RenderContext <span class="token operator">=</span> <span class="token comment">/*                */</span> <span class="token number">0b0010000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CommitContext <span class="token operator">=</span> <span class="token comment">/*                */</span> <span class="token number">0b0100000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上文回顾了<code>reconciler 运作流程</code>的 4 个阶段, 这 4 个阶段只是一个整体划分. 如果具体到每一次更新, 是有差异的. 比如说: <code>Legacy</code>模式下的所有更新, 不会经过<code>调度中心</code>(第 2 阶段),而是直接进入<code>fiber树构造</code>(第 3 阶段).</p><p>事实上正是<code>executionContext</code>在操控<code>reconciler 运作流程</code>(源码体现在<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L517-L619" target="_blank" rel="noopener noreferrer">scheduleUpdateOnFiber 函数<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>).</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">fiber</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
  <span class="token literal-property property">lane</span><span class="token operator">:</span> Lane<span class="token punctuation">,</span>
  <span class="token literal-property property">eventTime</span><span class="token operator">:</span> number<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>lane <span class="token operator">===</span> SyncLane<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// legacy或blocking模式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token punctuation">(</span>executionContext <span class="token operator">&amp;</span> LegacyUnbatchedContext<span class="token punctuation">)</span> <span class="token operator">!==</span> NoContext <span class="token operator">&amp;&amp;</span>
      <span class="token punctuation">(</span>executionContext <span class="token operator">&amp;</span> <span class="token punctuation">(</span>RenderContext <span class="token operator">|</span> CommitContext<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> NoContext
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">performSyncWorkOnRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 后续的更新</span>
      <span class="token comment">// 进入第2阶段, 注册调度任务</span>
      <span class="token function">ensureRootIsScheduled</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>executionContext <span class="token operator">===</span> NoContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果执行上下文为空, 会取消调度任务, 手动执行回调</span>
        <span class="token comment">// 进入第3阶段, 进行fiber树构造</span>
        <span class="token function">flushSyncCallbackQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// concurrent模式</span>
    <span class="token comment">// 无论是否初次更新, 都正常进入第2阶段, 注册调度任务</span>
    <span class="token function">ensureRootIsScheduled</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 render 过程中, 每一个阶段都会改变<code>executionContext</code>(render 之前, 会设置<code>executionContext |= RenderContext</code>; commit 之前, 会设置<code>executionContext |= CommitContext</code>), 假设在<code>render</code>过程中再次发起更新(如在<code>UNSAFE_componentWillReceiveProps</code>生命周期中调用<code>setState</code>)则可通过<code>executionContext</code>来判断当前的<code>render</code>状态.</p><h3 id="双缓冲技术-double-buffering" tabindex="-1"><a class="header-anchor" href="#双缓冲技术-double-buffering" aria-hidden="true">#</a> 双缓冲技术(double buffering)</h3><p>在全局变量中有<code>workInProgress</code>, 还有不少以<code>workInProgress</code>来命名的变量. <code>workInProgress</code>的应用实际上就是<code>React</code>的双缓冲技术(<code>double buffering</code>).</p><p>在上文我们梳理了<code>ReactElement, Fiber, DOM三者的关系</code>, <code>fiber树</code>的构造过程, 就是把<code>ReactElement</code>转换成<code>fiber树</code>的过程. 在这个过程中, 内存里会同时存在 2 棵<code>fiber树</code>:</p><ul><li>其一: 代表当前界面的<code>fiber</code>树(已经被展示出来, 挂载到<code>fiberRoot.current</code>上). 如果是初次构造(<code>初始化渲染</code>), 页面还没有渲染, 此时界面对应的 fiber 树为空(<code>fiberRoot.current = null</code>).</li><li>其二: 正在构造的<code>fiber</code>树(即将展示出来, 挂载到<code>HostRootFiber.alternate</code>上, 正在构造的节点称为<code>workInProgress</code>). 当构造完成之后, 重新渲染页面, 最后切换<code>fiberRoot.current = workInProgress</code>, 使得<code>fiberRoot.current</code>重新指向代表当前界面的<code>fiber</code>树.</li></ul><p>此处涉及到 2 个全局对象<code>fiberRoot</code>和<code>HostRootFiber</code>, 在<a href="/notes/react-illustration-series/main/bootstrap.html" class="">React 应用的启动过程</a>中有详细的说明.</p><p>用图来表述<code>double buffering</code>的概念如下:</p><ol><li>构造过程中, <code>fiberRoot.current</code>指向当前界面对应的<code>fiber</code>树.</li></ol><img src="/notes/assets/react-illustration-series/fibertreecreate1-progress.png" alt="demo"><ol><li>构造完成并渲染, 切换<code>fiberRoot.current</code>指针, 使其继续指向当前界面对应的<code>fiber</code>树(原来代表界面的 fiber 树, 变成了内存中).</li></ol><img src="/notes/assets/react-illustration-series/fibertreecreate2-complete.png" alt="demo"><h3 id="优先级-lanes" tabindex="-1"><a class="header-anchor" href="#优先级-lanes" aria-hidden="true">#</a> 优先级 {#lanes}</h3><p>在全局变量中有不少变量都以 Lanes 命名(如<code>workInProgressRootRenderLanes</code>,<code>subtreeRenderLanes</code>其作用见上文注释), 它们都与优先级相关.</p><p>在前文<a href="/notes/react-illustration-series/main/priority.html" class="">React 中的优先级管理</a>中, 我们介绍了<code>React</code>中有 3 套优先级体系, 并了解了它们之间的关联. 现在<code>fiber树构造</code>过程中, 将要深入分析车道模型<code>Lane</code>的具体应用.</p><p>在整个<code>react-reconciler</code>包中, <code>Lane</code>的应用可以分为 3 个方面:</p><h4 id="update优先级-update-lane-update-lane" tabindex="-1"><a class="header-anchor" href="#update优先级-update-lane-update-lane" aria-hidden="true">#</a> <code>update</code>优先级(update.lane) {#update-lane}</h4><p>在<a href="/notes/react-illustration-series/main/object-structure.html#Update" class="">React 应用中的高频对象</a>一文中, 介绍过<code>update</code>对象, 它是一个环形链表. 对于单个<code>update</code>对象来讲, <code>update.lane</code>代表它的优先级, 称之为<code>update</code>优先级.</p><p>观察其构造函数(<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactUpdateQueue.old.js#L152-L163" target="_blank" rel="noopener noreferrer">源码链接<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>),其优先级是由外界传入.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createUpdate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">eventTime</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">lane</span><span class="token operator">:</span> Lane</span><span class="token punctuation">)</span><span class="token operator">:</span> Update<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">update</span><span class="token operator">:</span> Update<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    eventTime<span class="token punctuation">,</span>
    lane<span class="token punctuation">,</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> UpdateState<span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">callback</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> update<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>React</code>体系中, 有 2 种情况会创建<code>update</code>对象:</p><ol><li>应用初始化: 在<code>react-reconciler</code>包中的<code>updateContainer</code>函数中(<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberReconciler.old.js#L250-L321" target="_blank" rel="noopener noreferrer">源码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">updateContainer</span><span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">element</span><span class="token operator">:</span> ReactNodeList<span class="token punctuation">,</span>
  <span class="token literal-property property">container</span><span class="token operator">:</span> OpaqueRoot<span class="token punctuation">,</span>
  <span class="token literal-property property">parentComponent</span><span class="token operator">:</span> <span class="token operator">?</span>React$Component<span class="token operator">&lt;</span>any<span class="token punctuation">,</span> any<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">callback</span><span class="token operator">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> Lane <span class="token punctuation">{</span>
  <span class="token keyword">const</span> current <span class="token operator">=</span> container<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
  <span class="token keyword">const</span> eventTime <span class="token operator">=</span> <span class="token function">requestEventTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> lane <span class="token operator">=</span> <span class="token function">requestUpdateLane</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 根据当前时间, 创建一个update优先级</span>
  <span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token function">createUpdate</span><span class="token punctuation">(</span>eventTime<span class="token punctuation">,</span> lane<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lane被用于创建update对象</span>
  update<span class="token punctuation">.</span>payload <span class="token operator">=</span> <span class="token punctuation">{</span> element <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">enqueueUpdate</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> lane<span class="token punctuation">,</span> eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> lane<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>发起组件更新: 假设在 class 组件中调用<code>setState</code>(<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L193-L288" target="_blank" rel="noopener noreferrer">源码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> classComponentUpdater <span class="token operator">=</span> <span class="token punctuation">{</span>
  isMounted<span class="token punctuation">,</span>
  <span class="token function">enqueueSetState</span><span class="token punctuation">(</span><span class="token parameter">inst<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fiber <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>inst<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> eventTime <span class="token operator">=</span> <span class="token function">requestEventTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 根据当前时间, 创建一个update优先级</span>
    <span class="token keyword">const</span> lane <span class="token operator">=</span> <span class="token function">requestUpdateLane</span><span class="token punctuation">(</span>fiber<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lane被用于创建update对象</span>
    <span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token function">createUpdate</span><span class="token punctuation">(</span>eventTime<span class="token punctuation">,</span> lane<span class="token punctuation">)</span><span class="token punctuation">;</span>
    update<span class="token punctuation">.</span>payload <span class="token operator">=</span> payload<span class="token punctuation">;</span>
    <span class="token function">enqueueUpdate</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> lane<span class="token punctuation">,</span> eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到, 无论是<code>应用初始化</code>或者<code>发起组件更新</code>, 创建<code>update.lane</code>的逻辑都是一样的, 都是根据当前时间, 创建一个 update 优先级.</p><p><a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L392-L493" target="_blank" rel="noopener noreferrer">requestUpdateLane<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">requestUpdateLane</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">fiber</span><span class="token operator">:</span> Fiber</span><span class="token punctuation">)</span><span class="token operator">:</span> Lane <span class="token punctuation">{</span>
  <span class="token comment">// Special cases</span>
  <span class="token keyword">const</span> mode <span class="token operator">=</span> fiber<span class="token punctuation">.</span>mode<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> BlockingMode<span class="token punctuation">)</span> <span class="token operator">===</span> NoMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// legacy 模式</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>SyncLane<span class="token operator">:</span> Lane<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> ConcurrentMode<span class="token punctuation">)</span> <span class="token operator">===</span> NoMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// blocking模式</span>
    <span class="token keyword">return</span> <span class="token function">getCurrentPriorityLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> ImmediateSchedulerPriority
      <span class="token operator">?</span> <span class="token punctuation">(</span>SyncLane<span class="token operator">:</span> Lane<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token punctuation">(</span>SyncBatchedLane<span class="token operator">:</span> Lane<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// concurrent模式</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentEventWipLanes <span class="token operator">===</span> NoLanes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentEventWipLanes <span class="token operator">=</span> workInProgressRootIncludedLanes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> isTransition <span class="token operator">=</span> <span class="token function">requestCurrentTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> NoTransition<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isTransition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 特殊情况, 处于suspense过程中</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentEventPendingLanes <span class="token operator">!==</span> NoLanes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      currentEventPendingLanes <span class="token operator">=</span>
        mostRecentlyUpdatedRoot <span class="token operator">!==</span> <span class="token keyword">null</span>
          <span class="token operator">?</span> mostRecentlyUpdatedRoot<span class="token punctuation">.</span>pendingLanes
          <span class="token operator">:</span> NoLanes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">findTransitionLane</span><span class="token punctuation">(</span>currentEventWipLanes<span class="token punctuation">,</span> currentEventPendingLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 正常情况, 获取调度优先级</span>
  <span class="token keyword">const</span> schedulerPriority <span class="token operator">=</span> <span class="token function">getCurrentPriorityLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> lane<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token punctuation">(</span>executionContext <span class="token operator">&amp;</span> DiscreteEventContext<span class="token punctuation">)</span> <span class="token operator">!==</span> NoContext <span class="token operator">&amp;&amp;</span>
    schedulerPriority <span class="token operator">===</span> UserBlockingSchedulerPriority
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// executionContext 存在输入事件. 且调度优先级是用户阻塞性质</span>
    lane <span class="token operator">=</span> <span class="token function">findUpdateLane</span><span class="token punctuation">(</span>InputDiscreteLanePriority<span class="token punctuation">,</span> currentEventWipLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调度优先级转换为车道模型</span>
    <span class="token keyword">const</span> schedulerLanePriority <span class="token operator">=</span> <span class="token function">schedulerPriorityToLanePriority</span><span class="token punctuation">(</span>
      schedulerPriority<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    lane <span class="token operator">=</span> <span class="token function">findUpdateLane</span><span class="token punctuation">(</span>schedulerLanePriority<span class="token punctuation">,</span> currentEventWipLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> lane<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到<code>requestUpdateLane</code>的作用是返回一个合适的 update 优先级.</p><ol><li>legacy 模式: 返回<code>SyncLane</code></li><li>blocking 模式: 返回<code>SyncLane</code></li><li>concurrent 模式: <ul><li>正常情况下, 根据当前的<code>调度优先级</code>来生成一个<code>lane</code>.</li><li>特殊情况下(处于 suspense 过程中), 会优先选择<code>TransitionLanes</code>通道中的空闲通道(如果所有<code>TransitionLanes</code>通道都被占用, 就取最高优先级. <a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberLane.js#L548-L563" target="_blank" rel="noopener noreferrer">源码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>).</li></ul></li></ol><p>最后通过<code>scheduleUpdateOnFiber(current, lane, eventTime);</code>函数, 把<code>update.lane</code>正式带入到了<code>输入</code>阶段.</p><p><code>scheduleUpdateOnFiber</code>是<code>输入</code>阶段的必经函数, 在本系列的文章中已经多次提到, 此处以<code>update.lane</code>的视角分析:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">fiber</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
  <span class="token literal-property property">lane</span><span class="token operator">:</span> Lane<span class="token punctuation">,</span>
  <span class="token literal-property property">eventTime</span><span class="token operator">:</span> number<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>lane <span class="token operator">===</span> SyncLane<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// legacy或blocking模式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token punctuation">(</span>executionContext <span class="token operator">&amp;</span> LegacyUnbatchedContext<span class="token punctuation">)</span> <span class="token operator">!==</span> NoContext <span class="token operator">&amp;&amp;</span>
      <span class="token punctuation">(</span>executionContext <span class="token operator">&amp;</span> <span class="token punctuation">(</span>RenderContext <span class="token operator">|</span> CommitContext<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> NoContext
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">performSyncWorkOnRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">ensureRootIsScheduled</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册回调任务</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>executionContext <span class="token operator">===</span> NoContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">flushSyncCallbackQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取消schedule调度 ,主动刷新回调队列,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// concurrent模式</span>
    <span class="token function">ensureRootIsScheduled</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当<code>lane === SyncLane</code>也就是 legacy 或 blocking 模式中, 注册完回调任务之后(<code>ensureRootIsScheduled(root, eventTime)</code>), 如果执行上下文为空, 会取消 schedule 调度, 主动刷新回调队列<code>flushSyncCallbackQueue()</code>.</p><p>这里包含了一个热点问题(<code>setState到底是同步还是异步</code>)的标准答案:</p><ul><li>如果逻辑进入<code>flushSyncCallbackQueue</code>(<code>executionContext === NoContext</code>), 则会主动取消调度, 并刷新回调, 立即进入<code>fiber树</code>构造过程. 当执行<code>setState</code>下一行代码时, <code>fiber树</code>已经重新渲染了, 故<code>setState</code>体现为同步.</li><li>正常情况下, 不会取消<code>schedule调度</code>. 由于<code>schedule调度</code>是通过<code>MessageChannel</code>触发(宏任务), 故体现为异步.</li></ul><h4 id="渲染优先级-renderlanes" tabindex="-1"><a class="header-anchor" href="#渲染优先级-renderlanes" aria-hidden="true">#</a> <code>渲染</code>优先级(renderLanes)</h4><p>这是一个全局概念, 每一次<code>render</code>之前, 首先要确定本次<code>render</code>的优先级. 具体对应到源码如下:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ...省略无关代码</span>
<span class="token keyword">function</span> <span class="token function">performSyncWorkOnRoot</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> lanes<span class="token punctuation">;</span>
  <span class="token keyword">let</span> exitStatus<span class="token punctuation">;</span>
  <span class="token comment">// 获取本次`render`的优先级</span>
  lanes <span class="token operator">=</span> <span class="token function">getNextLanes</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  exitStatus <span class="token operator">=</span> <span class="token function">renderRootSync</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...省略无关代码</span>
<span class="token keyword">function</span> <span class="token function">performConcurrentWorkOnRoot</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取本次`render`的优先级</span>
  <span class="token keyword">let</span> lanes <span class="token operator">=</span> <span class="token function">getNextLanes</span><span class="token punctuation">(</span>
    root<span class="token punctuation">,</span>
    root <span class="token operator">===</span> workInProgressRoot <span class="token operator">?</span> workInProgressRootRenderLanes <span class="token operator">:</span> NoLanes<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>lanes <span class="token operator">===</span> NoLanes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> exitStatus <span class="token operator">=</span> <span class="token function">renderRootConcurrent</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到, 无论是<code>Legacy</code>还是<code>Concurrent</code>模式, 在正式<code>render</code>之前, 都会调用<code>getNextLanes</code>获取一个优先级(<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberLane.js#L249-L303" target="_blank" rel="noopener noreferrer">源码链接<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>).</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ...省略部分代码</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getNextLanes</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> FiberRoot<span class="token punctuation">,</span> <span class="token literal-property property">wipLanes</span><span class="token operator">:</span> Lanes</span><span class="token punctuation">)</span><span class="token operator">:</span> Lanes <span class="token punctuation">{</span>
  <span class="token comment">// 1. check是否有等待中的lanes</span>
  <span class="token keyword">const</span> pendingLanes <span class="token operator">=</span> root<span class="token punctuation">.</span>pendingLanes<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingLanes <span class="token operator">===</span> NoLanes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    return_highestLanePriority <span class="token operator">=</span> NoLanePriority<span class="token punctuation">;</span>
    <span class="token keyword">return</span> NoLanes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> nextLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
  <span class="token keyword">let</span> nextLanePriority <span class="token operator">=</span> NoLanePriority<span class="token punctuation">;</span>
  <span class="token keyword">const</span> expiredLanes <span class="token operator">=</span> root<span class="token punctuation">.</span>expiredLanes<span class="token punctuation">;</span>
  <span class="token keyword">const</span> suspendedLanes <span class="token operator">=</span> root<span class="token punctuation">.</span>suspendedLanes<span class="token punctuation">;</span>
  <span class="token keyword">const</span> pingedLanes <span class="token operator">=</span> root<span class="token punctuation">.</span>pingedLanes<span class="token punctuation">;</span>
  <span class="token comment">// 2. check是否有已过期的lanes</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>expiredLanes <span class="token operator">!==</span> NoLanes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nextLanes <span class="token operator">=</span> expiredLanes<span class="token punctuation">;</span>
    nextLanePriority <span class="token operator">=</span> return_highestLanePriority <span class="token operator">=</span> SyncLanePriority<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nonIdlePendingLanes <span class="token operator">=</span> pendingLanes <span class="token operator">&amp;</span> NonIdleLanes<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nonIdlePendingLanes <span class="token operator">!==</span> NoLanes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 非Idle任务 ...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Idle任务 ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nextLanes <span class="token operator">===</span> NoLanes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> NoLanes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> nextLanes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>getNextLanes</code>会根据<code>fiberRoot</code>对象上的属性(<code>expiredLanes</code>, <code>suspendedLanes</code>, <code>pingedLanes</code>等), 确定出当前最紧急的<code>lanes</code>.</p><p>此处返回的<code>lanes</code>会作为全局渲染的优先级, 用于<code>fiber树构造过程</code>中. 针对<code>fiber对象</code>或<code>update对象</code>, 只要它们的优先级(如: <code>fiber.lanes</code>和<code>update.lane</code>)比<code>渲染优先级</code>低, 都将会被忽略.</p><p>以下源码展示了无论是<code>renderRootSync</code>或<code>renderRootConcurrent</code>在调用<code>render</code>之前, 都会通过<code>getNextLanes</code>获取全局渲染优先级, 并且在<code>fiber树构造</code>过程中使用.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">performSyncWorkOnRoot</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> lanes<span class="token punctuation">;</span>
  <span class="token keyword">let</span> exitStatus<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    root <span class="token operator">===</span> workInProgressRoot <span class="token operator">&amp;&amp;</span>
    <span class="token function">includesSomeLane</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>expiredLanes<span class="token punctuation">,</span> workInProgressRootRenderLanes<span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 渲染优先级</span>
    lanes <span class="token operator">=</span> <span class="token function">getNextLanes</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    exitStatus <span class="token operator">=</span> <span class="token function">renderRootSync</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 渲染优先级</span>
    lanes <span class="token operator">=</span> <span class="token function">getNextLanes</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> NoLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    exitStatus <span class="token operator">=</span> <span class="token function">renderRootSync</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">performConcurrentWorkOnRoot</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token keyword">let</span> lanes <span class="token operator">=</span> <span class="token function">getNextLanes</span><span class="token punctuation">(</span>
    root<span class="token punctuation">,</span>
    root <span class="token operator">===</span> workInProgressRoot <span class="token operator">?</span> workInProgressRootRenderLanes <span class="token operator">:</span> NoLanes<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 渲染优先级</span>
  <span class="token keyword">let</span> exitStatus <span class="token operator">=</span> <span class="token function">renderRootConcurrent</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="fiber优先级-fiber-lanes" tabindex="-1"><a class="header-anchor" href="#fiber优先级-fiber-lanes" aria-hidden="true">#</a> <code>fiber</code>优先级(fiber.lanes)</h4><p>在<a href="/notes/react-illustration-series/main/object-structure.html" class="">React 应用中的高频对象</a>一文中, 介绍过<code>fiber</code>对象的数据结构. 其中有 2 个属性与优先级相关:</p><ol><li><code>fiber.lanes</code>: 代表本节点的优先级</li><li><code>fiber.childLanes</code>: 代表子节点的优先级 从<code>FiberNode</code>的构造函数中可以看出, <code>fiber.lanes</code>和<code>fiber.childLanes</code>的初始值都为<code>NoLanes</code>, 在<code>fiber树构造</code>过程中, 使用全局的渲染优先级(<code>renderLanes</code>)和<code>fiber.lanes</code>判断<code>fiber</code>节点是否更新(<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L3121-L3296" target="_blank" rel="noopener noreferrer">源码地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>). <ul><li>如果全局的渲染优先级<code>renderLanes</code>不包括<code>fiber.lanes</code>, 证明该<code>fiber</code>节点没有更新, 可以复用.</li><li>如果不能复用, 进入创建阶段.</li></ul></li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">beginWork</span><span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">current</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">workInProgress</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
  <span class="token literal-property property">renderLanes</span><span class="token operator">:</span> Lanes<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> updateLanes <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>lanes<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> oldProps <span class="token operator">=</span> current<span class="token punctuation">.</span>memoizedProps<span class="token punctuation">;</span>
    <span class="token keyword">const</span> newProps <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>pendingProps<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      oldProps <span class="token operator">!==</span> newProps <span class="token operator">||</span>
      <span class="token function">hasLegacyContextChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token comment">// Force a re-render if the implementation changed due to hot reload:</span>
      <span class="token punctuation">(</span>__DEV__ <span class="token operator">?</span> workInProgress<span class="token punctuation">.</span>type <span class="token operator">!==</span> current<span class="token punctuation">.</span>type <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      didReceiveUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">includesSomeLane</span><span class="token punctuation">(</span>renderLanes<span class="token punctuation">,</span> updateLanes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      didReceiveUpdate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token comment">// 本`fiber`节点的没有更新, 可以复用, 进入bailout逻辑</span>
      <span class="token keyword">return</span> <span class="token function">bailoutOnAlreadyFinishedWork</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> workInProgress<span class="token punctuation">,</span> renderLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 不能复用, 创建新的fiber节点</span>
  workInProgress<span class="token punctuation">.</span>lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span> <span class="token comment">// 重置优先级为 NoLanes</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token literal-property property">ClassComponent</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> Component <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
      <span class="token keyword">const</span> unresolvedProps <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>pendingProps<span class="token punctuation">;</span>
      <span class="token keyword">const</span> resolvedProps <span class="token operator">=</span>
        workInProgress<span class="token punctuation">.</span>elementType <span class="token operator">===</span> Component
          <span class="token operator">?</span> unresolvedProps
          <span class="token operator">:</span> <span class="token function">resolveDefaultProps</span><span class="token punctuation">(</span>Component<span class="token punctuation">,</span> unresolvedProps<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token function">updateClassComponent</span><span class="token punctuation">(</span>
        current<span class="token punctuation">,</span>
        workInProgress<span class="token punctuation">,</span>
        Component<span class="token punctuation">,</span>
        resolvedProps<span class="token punctuation">,</span>
        <span class="token comment">// 正常情况想渲染优先级会被用于fiber树的构造过程</span>
        renderLanes<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="栈帧管理" tabindex="-1"><a class="header-anchor" href="#栈帧管理" aria-hidden="true">#</a> 栈帧管理</h3><p>在<code>React</code>源码中, 每一次执行<code>fiber树</code>构造(也就是调用<code>performSyncWorkOnRoot</code>或者<code>performConcurrentWorkOnRoot</code>函数)的过程, 都需要一些全局变量来保存状态. 在上文中已经介绍最核心的全局变量.</p><p>如果从单个变量来看, 它们就是一个个的全局变量. 如果将这些全局变量组合起来, 它们代表了当前<code>fiber树</code>构造的活动记录. 通过这一组全局变量, 可以还原<code>fiber树</code>构造过程(比如时间切片的实现过程(参考<a href="/notes/react-illustration-series/main/scheduler.html#%E5%86%85%E6%A0%B8" class="">React 调度原理</a>), <code>fiber树</code>构造过程被打断之后需要还原进度, 全靠这一组全局变量). 所以每次<code>fiber树</code>构造是一个独立的过程, 需要<code>独立的</code>一组全局变量, 在<code>React</code>内部把这一个独立的过程封装为一个栈帧<code>stack</code>(简单来说就是每次构造都需要独立的空间. 对于<code>栈帧</code>的深入理解, 请读者自行参考其他资料).</p><p>所以在进行<code>fiber树</code>构造之前, 如果不需要恢复上一次构造进度, 都会刷新栈帧(源码在<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L1301-L1337" target="_blank" rel="noopener noreferrer">prepareFreshStack 函数<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">renderRootConcurrent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> FiberRoot<span class="token punctuation">,</span> <span class="token literal-property property">lanes</span><span class="token operator">:</span> Lanes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> prevExecutionContext <span class="token operator">=</span> executionContext<span class="token punctuation">;</span>
  executionContext <span class="token operator">|=</span> RenderContext<span class="token punctuation">;</span>
  <span class="token keyword">const</span> prevDispatcher <span class="token operator">=</span> <span class="token function">pushDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果fiberRoot变动, 或者update.lane变动, 都会刷新栈帧, 丢弃上一次渲染进度</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressRoot <span class="token operator">!==</span> root <span class="token operator">||</span> workInProgressRootRenderLanes <span class="token operator">!==</span> lanes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resetRenderTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 刷新栈帧</span>
    <span class="token function">prepareFreshStack</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">startWorkOnPendingInteractions</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
刷新栈帧: 重置 FiberRoot上的全局属性 和 `fiber树构造`循环过程中的全局变量
*/</span>
<span class="token keyword">function</span> <span class="token function">prepareFreshStack</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> FiberRoot<span class="token punctuation">,</span> <span class="token literal-property property">lanes</span><span class="token operator">:</span> Lanes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 重置FiberRoot对象上的属性</span>
  root<span class="token punctuation">.</span>finishedWork <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  root<span class="token punctuation">.</span>finishedLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
  <span class="token keyword">const</span> timeoutHandle <span class="token operator">=</span> root<span class="token punctuation">.</span>timeoutHandle<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>timeoutHandle <span class="token operator">!==</span> noTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    root<span class="token punctuation">.</span>timeoutHandle <span class="token operator">=</span> noTimeout<span class="token punctuation">;</span>
    <span class="token function">cancelTimeout</span><span class="token punctuation">(</span>timeoutHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgress <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> interruptedWork <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>return<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>interruptedWork <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">unwindInterruptedWork</span><span class="token punctuation">(</span>interruptedWork<span class="token punctuation">)</span><span class="token punctuation">;</span>
      interruptedWork <span class="token operator">=</span> interruptedWork<span class="token punctuation">.</span>return<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 重置全局变量</span>
  workInProgressRoot <span class="token operator">=</span> root<span class="token punctuation">;</span>
  workInProgress <span class="token operator">=</span> <span class="token function">createWorkInProgress</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>current<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 给HostRootFiber对象创建一个alternate, 并将其设置成全局 workInProgress</span>
  workInProgressRootRenderLanes <span class="token operator">=</span> subtreeRenderLanes <span class="token operator">=</span> workInProgressRootIncludedLanes <span class="token operator">=</span> lanes<span class="token punctuation">;</span>
  workInProgressRootExitStatus <span class="token operator">=</span> RootIncomplete<span class="token punctuation">;</span>
  workInProgressRootFatalError <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  workInProgressRootSkippedLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
  workInProgressRootUpdatedLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
  workInProgressRootPingedLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意其中的<code>createWorkInProgress(root.current, null)</code>, 其参数<code>root.current</code>即<code>HostRootFiber</code>, 作用是给<code>HostRootFiber</code>创建一个<code>alternate</code>副本.<code>workInProgress</code>指针指向这个副本(即<code>workInProgress = HostRootFiber.alternate</code>), 在上文<code>double buffering</code>中分析过, <code>HostRootFiber.alternate</code>是<code>正在构造的fiber树</code>的根节点.</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>本节是<code>fiber树构造</code>的准备篇, 首先在宏观上从不同的视角(<code>任务调度循环</code>, <code>fiber树构造循环</code>)介绍了<code>fiber树构造</code>在<code>React</code>体系中所处的位置, 然后深入<code>react-reconciler</code>包分析<code>fiber树构造</code>过程中需要使用到的全局变量, 并解读了<code>双缓冲技术</code>和<code>优先级(车道模型)</code>的使用, 最后解释<code>栈帧管理</code>的实现细节. 有了这些基础知识, <code>fiber树构造</code>的具体实现过程会更加简单清晰.</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: suiyi19920228@qq.com">suiyi</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/notes/assets/app.013e756e.js" defer></script>
  </body>
</html>
